


<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>How to Use Advanced Prompting Techniques &#8212; wayflowcore 26.1.0.dev0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css-style.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/core.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'core/howtoguides/howto_prompttemplate';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://oracle.github.io/wayflow/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '26.1.0.dev0';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
  <script src="../../_static/announcement.js"></script>

    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to Ask for User Input in Flows" href="howto_userinputinflows.html" />
    <link rel="prev" title="How to Use OCI Generative AI Agents" href="howto_ociagent.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="26.1" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo-light.svg" class="logo__image only-light" alt="wayflowcore 26.1.0.dev0 documentation - Home"/>
    <img src="../../_static/logo-dark.svg" class="logo__image only-dark pst-js-only" alt="wayflowcore 26.1.0.dev0 documentation - Home"/>
  
  
</a></div>
    
      <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/oracle/wayflow" title="WayFlow GitHub repository" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/icons/github-icon.svg" class="icon-link-image" alt="WayFlow GitHub repository"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/oracle/wayflow" title="WayFlow GitHub repository" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/icons/github-icon.svg" class="icon-link-image" alt="WayFlow GitHub repository"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essentials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/index.html">Tutorials &amp; Use Cases</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/basic_agent.html">Build a Simple Conversational Assistant with Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/basic_flow.html">Build a Simple Fixed-flow Assistant with Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/usecase_prbot.html">Build a Simple Code Review Assistant</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">How-to Guides</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="io_descriptors.html">Change Input and Output Descriptors of Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_async.html">Use Asynchronous APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="agents.html">Create a ReAct Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_imagecontent.html">How to Send Images to LLMs and Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_ociagent.html">Use OCI Generative AI Agents</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Use Templates for Advanced Prompting Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_userinputinflows.html">Ask for User Input in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="conditional_flows.html">Create Conditional Transitions in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_promptexecutionstep.html">Do Structured LLM Generation in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_userconfirmation.html">Add User Confirmation to a Tool Call Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="catching_exceptions.html">Catch Exceptions in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_mapstep.html">Do Map and Reduce Operations in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_parallelflowexecution.html">Run Multiple Flows in Parallel</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_agents_in_flows.html">Use Agents in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_multiagent.html">Build a Hierarchical Multi-Agent System</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_swarm.html">Build a Swarm of Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_managerworkers.html">Build a ManagerWorkers of Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_build_assistants_with_tools.html">Build Assistants with Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_multiple_output_tool.html">Create Tools with Multiple Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_a_tool_from_a_flow.html">Convert Flows to Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_mcp.html">Connect MCP tools to Assistants</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_remote_tool_expired_token.html">Do Remote API Calls with Tokens</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_execute_agentspec_with_wayflowcore.html">Load and Execute an Agent Spec Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_serdeser.html">Serialize and Deserialize Flows and Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_serialize_conversations.html">Serialize and Deserialize Conversations</a></li>
<li class="toctree-l2"><a class="reference internal" href="generation_config.html">Specify the Generation Configuration when Using LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="llm_from_different_providers.html">Use LLM from Different LLM Sources and Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing_ollama.html">Install and Use Ollama</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_tracing.html">Enable Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_long_context.html">Handle long context with agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_datastores.html">Connect Assistants to Your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddingmodels_from_different_providers.html">Use Embedding Models from Different Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_variable.html">Use Variables for Shared State in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_data_synthesis.html">Synthesize Data in WayFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_evaluation.html">Evaluate Assistants</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_conversation_evaluation.html">Evaluate Conversations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/agentspec.html">Agent Spec Adapters</a></li>

<li class="toctree-l2"><a class="reference internal" href="../api/conversation.html">Conversations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/llmmodels.html">LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/flows.html">Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/agent.html">Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/embeddingmodels.html">Embedding Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/contextproviders.html">Context Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/interrupts.html">Execution Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/prompttemplate.html">PromptTemplates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/serialization.html">Serialization/Deserialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/tools.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/tracing.html">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/variables.html">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/datastores.html">Datastores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/warnings.html">Warnings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/evaluation.html">Evaluation</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../misc/reference_sheet.html">Reference Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">For Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faqs.html">Frequently Asked Questions</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">WayFlow</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">How-to Guides</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">How to Use Advanced Prompting Techniques</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="how-to-use-advanced-prompting-techniques">
<span id="top-howtoprompttemplates"></span><h1>How to Use Advanced Prompting Techniques<a class="headerlink" href="#how-to-use-advanced-prompting-techniques" title="Permalink to this heading">#</a></h1>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-row-cols-2 sd-row-cols-xs-2 sd-row-cols-sm-2 sd-row-cols-md-2 sd-row-cols-lg-2 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<a class="reference internal" href="../../_images/python-icon.svg"><img alt="python-icon" height="40px" src="../../_images/python-icon.svg" width="40px" /></a> Download Python Script</div>
<p class="sd-card-text">Python script/notebook for this guide.</p>
</div>
<a class="sd-stretched-link sd-hide-link-text reference external" href="../end_to_end_code_examples/howto_prompttemplate.py"><span>Prompt templates how-to script</span></a></div>
</div>
</div>
</div>
<div class="admonition-prerequisites admonition">
<p class="admonition-title">Prerequisites</p>
<p>This guide assumes familiarity with:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/llmmodels.html"><span class="doc">LLMs</span></a></p></li>
<li><p><a class="reference internal" href="../api/agent.html"><span class="doc">Agent</span></a></p></li>
</ul>
</div>
<p><a class="reference internal" href="../api/prompttemplate.html"><span class="doc">PromptTemplate</span></a> is a powerful way to configure how to prompt various LLMs.
Although WayFlow has very good defaults for most tasks and LLM providers, some specific use cases or providers require adapting prompt formatting to improve efficiency (e.g., token cost) or performance.
To address this, WayFlow introduces the concept of <code class="docutils literal notranslate"><span class="pre">PromptTemplate</span></code>, which enables you to define prompts in a very generic way, applicable across different scenarios.</p>
<p>This guide will show you how to:</p>
<ul class="simple">
<li><p>Recap how to use variables in prompts</p></li>
<li><p>Learn how to configure a custom <code class="docutils literal notranslate"><span class="pre">PromptTemplate</span></code></p></li>
<li><p>Learn how to configure a prompt template for an <code class="docutils literal notranslate"><span class="pre">Agent</span></code></p></li>
<li><p>Learn best practices for writing prompts</p></li>
</ul>
<section id="basics-of-prompting">
<h2>Basics of prompting<a class="headerlink" href="#basics-of-prompting" title="Permalink to this heading">#</a></h2>
<p>WayFlow leverages LLMs to perform chat completion, meaning that given a list of messages (which can be <code class="docutils literal notranslate"><span class="pre">system</span></code> (for instructions to the LLM),
<code class="docutils literal notranslate"><span class="pre">agent</span></code> (a message generated by the LLM), and <code class="docutils literal notranslate"><span class="pre">user</span></code> (a message from the user)), it returns a new message.</p>
<p>To perform agentic tasks, LLMs are equipped with <code class="docutils literal notranslate"><span class="pre">tools</span></code>, which are defined functions with names and arguments that the LLM may decide to call.
Prompting the LLM to generate such calls can be done using <code class="docutils literal notranslate"><span class="pre">native_tool_calling</span></code>, where the LLM provider handles how tools are presented to the model and how tool calls are parsed,
or through custom tool calling, where the presentation of tools to the model is controlled externally and the raw text output from the model must be parsed manually.</p>
<p>In many use cases, generating raw text is not enough because it is difficult to use in further pipeline steps.
LLMs can produce specific structured output, often through <code class="docutils literal notranslate"><span class="pre">structured_generation</span></code>.
Most LLM providers support this feature natively (the provider takes care of formatting the expected response and parsing the LLM output),
but you can also do it in a custom way, using a specific prompt combined with custom parsing.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">PromptTemplate</span></code> abstraction is designed so that configuring all these parameters is as simple as possible, while guaranteeing maximum customization.
Using <code class="docutils literal notranslate"><span class="pre">PromptTemplate</span></code> usually involves 3 steps:</p>
<ul class="simple">
<li><p>Create the basic template. This is done using either the constructor (<code class="docutils literal notranslate"><span class="pre">PromptTemplate()</span></code>) or the helper function from a string (<code class="docutils literal notranslate"><span class="pre">PromptTemplate.from_string()</span></code>).</p></li>
<li><p>Equip the template with <code class="docutils literal notranslate"><span class="pre">partial</span> <span class="pre">values</span></code>, <code class="docutils literal notranslate"><span class="pre">tools</span></code>, or <code class="docutils literal notranslate"><span class="pre">response_format</span></code>. This can be done dynamically, and is useful when these elements are unknown at template creation but can be reused across multiple generations.</p></li>
<li><p>Render the template: use <code class="docutils literal notranslate"><span class="pre">template.format()</span></code> to fill all variables and create a <code class="docutils literal notranslate"><span class="pre">Prompt</span></code> object, which can then be passed to an LLM (e.g., <code class="docutils literal notranslate"><span class="pre">llm.generate(prompt)</span></code>). This object contains all the information needed for the LLM generation.</p></li>
</ul>
</section>
<section id="configure-the-llm">
<h2>Configure the LLM<a class="headerlink" href="#configure-the-llm" title="Permalink to this heading">#</a></h2>
<p>WayFlow supports several LLM API providers.
Select an LLM from the options below:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">OCI GenAI</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">vLLM</button><button aria-controls="panel-0-0-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-2" name="0-2" role="tab" tabindex="-1">Ollama</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">OCIGenAIModel</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">llm</span> <span class="o">=</span> <span class="n">OCIGenAIModel</span><span class="p">(</span>
        <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;provider.model-id&quot;</span><span class="p">,</span>
        <span class="n">service_endpoint</span><span class="o">=</span><span class="s2">&quot;https://url-to-service-endpoint.com&quot;</span><span class="p">,</span>
        <span class="n">compartment_id</span><span class="o">=</span><span class="s2">&quot;compartment-id&quot;</span><span class="p">,</span>
        <span class="n">auth_type</span><span class="o">=</span><span class="s2">&quot;API_KEY&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">VllmModel</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">VllmModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;model-id&quot;</span><span class="p">,</span>
    <span class="n">host_port</span><span class="o">=</span><span class="s2">&quot;VLLM_HOST_PORT&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-2" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-2" name="0-2" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">OllamaModel</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">OllamaModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;model-id&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div></div>
</section>
<section id="basic-text-prompt-with-regex-parsing">
<h2>Basic text prompt with Regex parsing<a class="headerlink" href="#basic-text-prompt-with-regex-parsing" title="Permalink to this heading">#</a></h2>
<p>One possible use case is prompting an LLM and extracting some information from the raw text output.
This is especially relevant in a prompt template, since the parsing method highly depends on how the LLM is prompted in the first place.</p>
<p>The example below shows how to write a simple <code class="docutils literal notranslate"><span class="pre">Chain-of-Thoughts</span></code> prompt.
The <code class="docutils literal notranslate"><span class="pre">RegexOutputParser</span></code> is used to configure how output is extracted from the raw text.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.outputparser</span><span class="w"> </span><span class="kn">import</span> <span class="n">JsonOutputParser</span><span class="p">,</span> <span class="n">RegexOutputParser</span><span class="p">,</span> <span class="n">RegexPattern</span>
<span class="linenos"> 4</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.templates</span><span class="w"> </span><span class="kn">import</span> <span class="n">PromptTemplate</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="n">prompt_template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span>
<span class="linenos"> 7</span>    <span class="n">template</span><span class="o">=</span><span class="s2">&quot;What is the result of 100+(454-3). Think step by step and then give your answer between &lt;result&gt;...&lt;/result&gt; delimiters&quot;</span><span class="p">,</span>
<span class="linenos"> 8</span>    <span class="n">output_parser</span><span class="o">=</span><span class="n">RegexOutputParser</span><span class="p">(</span>
<span class="linenos"> 9</span>        <span class="n">regex_pattern</span><span class="o">=</span><span class="n">RegexPattern</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&lt;result&gt;(.*)&lt;/result&gt;&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
<span class="linenos">10</span>    <span class="p">),</span>
<span class="linenos">11</span><span class="p">)</span>
<span class="linenos">12</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt_template</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>  <span class="c1"># no inputs needed since the template has no variable</span>
<span class="linenos">13</span><span class="n">result</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<span class="linenos">14</span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="linenos">15</span><span class="c1"># 551</span>
</pre></div>
</div>
<p>API reference: <a class="reference internal" href="../api/prompttemplate.html#id1"><span class="std std-ref">PromptTemplate</span></a>,  <a class="reference internal" href="../api/prompttemplate.html#regexoutputparser"><span class="std std-ref">RegexOutputParser</span></a>, <a class="reference internal" href="../api/prompttemplate.html#regexpattern"><span class="std std-ref">RegexPattern</span></a>, <a class="reference internal" href="../api/prompttemplate.html#jsonoutputparser"><span class="std std-ref">JsonOutputParser</span></a>.</p>
</section>
<section id="prompt-with-chat-history">
<h2>Prompt with chat history<a class="headerlink" href="#prompt-with-chat-history" title="Permalink to this heading">#</a></h2>
<p>In many cases—especially when working with agents—it is necessary to format a list of messages within a prompt.
There are two ways to achieve this.
Assume a list of messages is available:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.messagelist</span><span class="w"> </span><span class="kn">import</span> <span class="n">Message</span><span class="p">,</span> <span class="n">MessageType</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos">4</span>    <span class="n">Message</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;What is the capital of Switzerland?&quot;</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="n">MessageType</span><span class="o">.</span><span class="n">USER</span><span class="p">),</span>
<span class="linenos">5</span>    <span class="n">Message</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;The capital of Switzerland is Bern?&quot;</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="n">MessageType</span><span class="o">.</span><span class="n">AGENT</span><span class="p">),</span>
<span class="linenos">6</span>    <span class="n">Message</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;Really? I thought it was Zurich?&quot;</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="n">MessageType</span><span class="o">.</span><span class="n">USER</span><span class="p">),</span>
<span class="linenos">7</span><span class="p">]</span>
</pre></div>
</div>
<p>The first way is to integrate the history of messages directly into the prompt’s list of messages.
This helps the model by presenting the entire conversation as a single context.
For example, to format the conversation as messages within a template, you can use the <code class="docutils literal notranslate"><span class="pre">CHAT_HISTORY_PLACEHOLDER</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">prompt_template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
<span class="linenos"> 2</span>    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
<span class="linenos"> 3</span>        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a helpful assistant. Answer the user questions&quot;</span><span class="p">},</span>
<span class="linenos"> 4</span>        <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER</span><span class="p">,</span>
<span class="linenos"> 5</span>    <span class="p">]</span>
<span class="linenos"> 6</span><span class="p">)</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER_NAME</span><span class="p">:</span> <span class="n">messages</span><span class="p">})</span>
<span class="linenos"> 9</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
<span class="linenos">10</span><span class="c1"># [</span>
<span class="linenos">11</span><span class="c1">#   Message(content=&#39;You are a helpful assistant. Answer the user questions&#39;, message_type=MessageType.SYSTEM),</span>
<span class="linenos">12</span><span class="c1">#   Message(content=&#39;What is the capital of Switzerland?&#39;, message_type=MessageType.USER),</span>
<span class="linenos">13</span><span class="c1">#   Message(content=&#39;The capital of Switzerland is Bern?&#39;, message_type=MessageType.AGENT),</span>
<span class="linenos">14</span><span class="c1">#   Message(content=&#39;Really? I thought it was Zurich?&#39;, message_type=MessageType.USER)</span>
<span class="linenos">15</span><span class="c1"># ]</span>
<span class="linenos">16</span><span class="n">result</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<span class="linenos">17</span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="linenos">18</span><span class="c1"># While Zurich is a major city in Switzerland and home to many international organizations, the capital is indeed Bern (also known as Berne).</span>
</pre></div>
</div>
<p>You can also format the chat history directly in a message, by using the <code class="docutils literal notranslate"><span class="pre">CHAT_HISTORY_PLACEHOLDER_NAME</span></code> placeholder (whose underlying value is the string <code class="docutils literal notranslate"><span class="pre">&quot;__CHAT_HISTORY__&quot;</span></code> as shown in the code snippet below):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">prompt_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;You are a helpful assistant. Answer the user questions.</span>
<span class="linenos"> 2</span><span class="s2">For context, the conversation was:</span>
<span class="linenos"> 3</span><span class="s2">{</span><span class="si">% f</span><span class="s2">or msg in __CHAT_HISTORY__ %}</span>
<span class="linenos"> 4</span><span class="s2">{{ msg.message_type.value }} &gt;&gt; {{msg.content}}</span>
<span class="linenos"> 5</span><span class="s2">{</span><span class="si">%- e</span><span class="s2">ndfor %}</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="s2">Just answer the user question.</span>
<span class="linenos"> 8</span><span class="s2">&quot;&quot;&quot;</span>
<span class="linenos"> 9</span><span class="n">prompt_template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span><span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">prompt_text</span><span class="p">}])</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER_NAME</span><span class="p">:</span> <span class="n">messages</span><span class="p">})</span>
<span class="linenos">12</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
<span class="linenos">13</span><span class="c1"># [Message(content=&quot;&quot;&quot;You are a helpful assistant. Answer the user questions.</span>
<span class="linenos">14</span><span class="c1"># For context, the conversation was:</span>
<span class="linenos">15</span><span class="c1">#</span>
<span class="linenos">16</span><span class="c1"># USER &gt;&gt; What is the capital of Switzerland?</span>
<span class="linenos">17</span><span class="c1"># AGENT &gt;&gt; The capital of Switzerland is Bern?</span>
<span class="linenos">18</span><span class="c1"># USER &gt;&gt; Really? I thought it was Zurich?</span>
<span class="linenos">19</span><span class="c1">#</span>
<span class="linenos">20</span><span class="c1"># Just answer the user question.&quot;&quot;&quot;, message_type=MessageType.SYSTEM]</span>
<span class="linenos">21</span><span class="n">result</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<span class="linenos">22</span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="linenos">23</span><span class="c1"># While Zurich is a major city and financial hub in Switzerland, the capital is indeed Bern.</span>
</pre></div>
</div>
<p>If you need to filter some part of the chat history before rendering it in the template, you may use some pre-rendering message transforms:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
<span class="linenos"> 2</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.transforms</span><span class="w"> </span><span class="kn">import</span> <span class="n">MessageTransform</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">class</span><span class="w"> </span><span class="nc">OnlyLastChatMessageTransform</span><span class="p">(</span><span class="n">MessageTransform</span><span class="p">):</span>
<span class="linenos"> 5</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">]:</span>
<span class="linenos"> 6</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 7</span>            <span class="k">return</span> <span class="p">[]</span>
<span class="linenos"> 8</span>        <span class="k">return</span> <span class="p">[</span><span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="n">prompt_template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
<span class="linenos">11</span>    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
<span class="linenos">12</span>        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a helpful assistant. Answer the user questions&quot;</span><span class="p">},</span>
<span class="linenos">13</span>        <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER</span><span class="p">,</span>
<span class="linenos">14</span>    <span class="p">],</span>
<span class="linenos">15</span>    <span class="n">pre_rendering_transforms</span><span class="o">=</span><span class="p">[</span><span class="n">OnlyLastChatMessageTransform</span><span class="p">()],</span>
<span class="linenos">16</span><span class="p">)</span>
<span class="linenos">17</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER_NAME</span><span class="p">:</span> <span class="n">messages</span><span class="p">})</span>
<span class="linenos">18</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
<span class="linenos">19</span><span class="c1"># [</span>
<span class="linenos">20</span><span class="c1">#   Message(content=&#39;You are a helpful assistant. Answer the user questions&#39;, message_type=MessageType.SYSTEM),</span>
<span class="linenos">21</span><span class="c1">#   Message(content=&#39;Really? I thought it was Zurich?&#39;, message_type=MessageType.USER)</span>
<span class="linenos">22</span><span class="c1"># ]</span>
</pre></div>
</div>
<p>API reference: <a class="reference internal" href="../api/prompttemplate.html#messagetransform"><span class="std std-ref">MessageTransform</span></a>.</p>
<p>This will ensure only the last chat history message is formatted in the prompt.</p>
</section>
<section id="configure-how-to-use-tools-in-templates">
<h2>Configure how to use tools in templates<a class="headerlink" href="#configure-how-to-use-tools-in-templates" title="Permalink to this heading">#</a></h2>
<p>Assume a tool is available and should be used for LLM generation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>
<span class="linenos">2</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="nd">@tool</span>
<span class="linenos">5</span><span class="k">def</span><span class="w"> </span><span class="nf">some_tool</span><span class="p">(</span><span class="n">param1</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;name of the user&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;tool_output&quot;</span><span class="p">]:</span>
<span class="linenos">6</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs some action&quot;&quot;&quot;</span>
<span class="linenos">7</span>    <span class="k">return</span> <span class="s2">&quot;some_tool_output&quot;</span>
</pre></div>
</div>
<p>If the LLM provider supports  <code class="docutils literal notranslate"><span class="pre">native_tool_calling</span></code>, integrating it into templates is straightforward:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
<span class="linenos"> 2</span>    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
<span class="linenos"> 3</span>        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a helpful assistant&quot;</span><span class="p">},</span>
<span class="linenos"> 4</span>        <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER</span><span class="p">,</span>
<span class="linenos"> 5</span>    <span class="p">],</span>
<span class="linenos"> 6</span><span class="p">)</span>
<span class="linenos"> 7</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">with_tools</span><span class="p">([</span><span class="n">some_tool</span><span class="p">])</span>
<span class="linenos"> 8</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos"> 9</span>    <span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER_NAME</span><span class="p">:</span> <span class="p">[</span><span class="n">Message</span><span class="p">(</span><span class="s2">&quot;call the some_output tool&quot;</span><span class="p">)]}</span>
<span class="linenos">10</span><span class="p">)</span>
<span class="linenos">11</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">tools</span><span class="p">)</span>
<span class="linenos">12</span><span class="c1"># [ServerTool()]</span>
<span class="linenos">13</span><span class="n">response</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span>
<span class="linenos">14</span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="linenos">15</span><span class="c1"># Message(content=&#39;&#39;, message_type=&lt;MessageType.TOOL_REQUEST, tool_requests=[ToolRequest(name=&#39;some_output&#39;, args={&#39;param1&#39;: &#39;call the some_output tool&#39;}, tool_request_id=&#39;chatcmpl-tool-ae924a4829324411add8760d3ae265bd&#39;)])</span>
</pre></div>
</div>
<p>In this case, the template uses native tool calling, so the prompt includes separate <code class="docutils literal notranslate"><span class="pre">tools</span></code> that are passed to the LLM endpoint.
The provider directly parses the output and returns a <code class="docutils literal notranslate"><span class="pre">ToolRequest</span></code>.</p>
<p>Sometimes, the provider’s native tool calling might not be available or may not work as needed (for example, when performing Chain-of-Thought reasoning with Llama native models, which do not support this feature).
In such cases, tool calling can be configured directly within the prompt template.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models.llmgenerationconfig</span><span class="w"> </span><span class="kn">import</span> <span class="n">LlmGenerationConfig</span>
<span class="linenos"> 2</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.templates.reacttemplates</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="linenos"> 3</span>    <span class="n">REACT_SYSTEM_TEMPLATE</span><span class="p">,</span>
<span class="linenos"> 4</span>    <span class="n">ReactToolOutputParser</span><span class="p">,</span>
<span class="linenos"> 5</span>    <span class="n">_ReactMergeToolRequestAndCallsTransform</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="p">)</span>
<span class="linenos"> 7</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.transforms</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="linenos"> 8</span>    <span class="n">CoalesceSystemMessagesTransform</span><span class="p">,</span>
<span class="linenos"> 9</span>    <span class="n">RemoveEmptyNonUserMessageTransform</span><span class="p">,</span>
<span class="linenos">10</span><span class="p">)</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="n">REACT_CHAT_TEMPLATE</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
<span class="linenos">13</span>    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
<span class="linenos">14</span>        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">REACT_SYSTEM_TEMPLATE</span><span class="p">},</span>
<span class="linenos">15</span>        <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER</span><span class="p">,</span>
<span class="linenos">16</span>    <span class="p">],</span>
<span class="linenos">17</span>    <span class="n">native_tool_calling</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="linenos">18</span>    <span class="n">post_rendering_transforms</span><span class="o">=</span><span class="p">[</span>
<span class="linenos">19</span>        <span class="n">_ReactMergeToolRequestAndCallsTransform</span><span class="p">(),</span>
<span class="linenos">20</span>        <span class="n">CoalesceSystemMessagesTransform</span><span class="p">(),</span>
<span class="linenos">21</span>        <span class="n">RemoveEmptyNonUserMessageTransform</span><span class="p">(),</span>
<span class="linenos">22</span>    <span class="p">],</span>
<span class="linenos">23</span>    <span class="n">output_parser</span><span class="o">=</span><span class="n">ReactToolOutputParser</span><span class="p">(),</span>
<span class="linenos">24</span>    <span class="n">generation_config</span><span class="o">=</span><span class="n">LlmGenerationConfig</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;## Observation&quot;</span><span class="p">]),</span>
<span class="linenos">25</span><span class="p">)</span>
<span class="linenos">26</span><span class="n">template</span> <span class="o">=</span> <span class="n">REACT_CHAT_TEMPLATE</span><span class="o">.</span><span class="n">with_tools</span><span class="p">([</span><span class="n">some_tool</span><span class="p">])</span>
<span class="linenos">27</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">28</span>    <span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER_NAME</span><span class="p">:</span> <span class="p">[</span><span class="n">Message</span><span class="p">(</span><span class="s2">&quot;call the some_output tool&quot;</span><span class="p">)]}</span>
<span class="linenos">29</span><span class="p">)</span>
<span class="linenos">30</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">tools</span><span class="p">)</span>
<span class="linenos">31</span><span class="c1"># [ServerTool()]</span>
<span class="linenos">32</span><span class="n">response</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span>
<span class="linenos">33</span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="linenos">34</span><span class="c1"># Message(content=&#39;&#39;, message_type=MessageType.TOOL_REQUEST, tool_requests=[ToolRequest(name=&#39;some_tool&#39;, args={&#39;param1&#39;: &#39;call the some_output tool&#39;}, tool_request_id=&#39;chatcmpl-tool-69c7e27e55474501be0dfc2509e5d4f2&#39;)]</span>
</pre></div>
</div>
<p>For custom tool calling, the important parameters to configure are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">native_tool_calling</span></code> indicates that the tools will be formatted in the prompt. This requires the <code class="docutils literal notranslate"><span class="pre">__TOOLS__</span></code> placeholder in one of the messages.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">post_rendering_transforms</span></code>: transformations applied to messages just before passing them to the LLM. These allow transformations specific to a tool-calling technique or an LLM provider’s requirements. The following post-transforms are used here:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_ReactMergeToolRequestAndCallsTransform</span></code> formats tool calls and tool requests into standard user or agent messages.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CoalesceSystemMessagesTransform</span></code> allows merging consecutive system messages into a single system message, as required by some LLM providers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RemoveEmptyNonUserMessageTransform</span></code> removes empty agent or system messages, since some LLMs do not support them.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_parser</span></code>: specifies how the raw LLM text output is parsed into a tool request. Several examples can be found in the  <code class="docutils literal notranslate"><span class="pre">wayflowcore.templates</span></code> subpackage.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">generation_config</span></code>: for this ReAct-style template, specific generation parameters are added to help reduce hallucinations.</p></li>
</ul>
</section>
<section id="configure-how-to-use-structured-generation-in-templates">
<h2>Configure how to use structured generation in templates<a class="headerlink" href="#configure-how-to-use-structured-generation-in-templates" title="Permalink to this heading">#</a></h2>
<p>Structured generation can be handled using either <code class="docutils literal notranslate"><span class="pre">native_tool_calling</span></code> (if the LLM provider supports it) or custom methods.
Assume the goal is to generate the following output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.property</span><span class="w"> </span><span class="kn">import</span> <span class="n">ObjectProperty</span><span class="p">,</span> <span class="n">StringProperty</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="n">output</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span>
<span class="linenos"> 4</span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span>
<span class="linenos"> 5</span>    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;information about a person&quot;</span><span class="p">,</span>
<span class="linenos"> 6</span>    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
<span class="linenos"> 7</span>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;name of the person&quot;</span><span class="p">),</span>
<span class="linenos"> 8</span>        <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;age of the person&quot;</span><span class="p">),</span>
<span class="linenos"> 9</span>    <span class="p">},</span>
<span class="linenos">10</span><span class="p">)</span>
</pre></div>
</div>
<p>API reference: <a class="reference internal" href="../api/flows.html#objectproperty"><span class="std std-ref">ObjectProperty</span></a>, <a class="reference internal" href="../api/flows.html#stringproperty"><span class="std std-ref">StringProperty</span></a>.</p>
<section id="with-native-structured-generation">
<h3>With native structured generation<a class="headerlink" href="#with-native-structured-generation" title="Permalink to this heading">#</a></h3>
<p>Some providers allow passing the desired output format separately and ensure the generated output follows the given format.
If the LLM provider supports it, then using a template is straightforward:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span>
<span class="linenos"> 2</span>    <span class="n">template</span><span class="o">=</span><span class="s2">&quot;Extract information about a person. The person is 65 years old, named Johnny&quot;</span><span class="p">,</span>
<span class="linenos"> 3</span>    <span class="n">response_format</span><span class="o">=</span><span class="n">output</span><span class="p">,</span>
<span class="linenos"> 4</span><span class="p">)</span>
<span class="linenos"> 5</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
<span class="linenos"> 6</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">response_format</span><span class="p">)</span>
<span class="linenos"> 7</span><span class="c1"># ObjectProperty(...)</span>
<span class="linenos"> 8</span><span class="n">response</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span>
<span class="linenos"> 9</span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="linenos">10</span><span class="c1"># Message(content=&#39;{&quot;name&quot;: &quot;Johnny&quot;, &quot;age&quot;: &quot;65&quot;}&#39;, message_type=MessageType.AGENT)</span>
</pre></div>
</div>
</section>
<section id="with-custom-structured-generation">
<h3>With custom structured generation<a class="headerlink" href="#with-custom-structured-generation" title="Permalink to this heading">#</a></h3>
<p>If the LLM provider does not support native structured generation, it is possible to prompt the LLM to produce output in the desired format manually:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">text_template</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Extract information about a person. The person is 65 years old, named Johnny.</span>
<span class="linenos"> 2</span><span class="s2">Just return a json document that respects this JSON Schema:</span>
<span class="linenos"> 3</span><span class="s2">{{__RESPONSE_FORMAT__.to_json_schema() | tojson }}</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="s2">Reminder: only output the required json document, no need to repeat the title of the description, just the properties are required!</span>
<span class="linenos"> 6</span><span class="s2">&quot;&quot;&quot;</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="n">template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
<span class="linenos"> 9</span>    <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">text_template</span><span class="p">}],</span>
<span class="linenos">10</span>    <span class="n">native_structured_generation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="linenos">11</span>    <span class="n">output_parser</span><span class="o">=</span><span class="n">JsonOutputParser</span><span class="p">(),</span>
<span class="linenos">12</span>    <span class="n">response_format</span><span class="o">=</span><span class="n">output</span><span class="p">,</span>
<span class="linenos">13</span><span class="p">)</span>
<span class="linenos">14</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
<span class="linenos">15</span><span class="c1"># ^no input needed since __RESPONSE_FORMAT__ is filled with `response_format`</span>
<span class="linenos">16</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">response_format</span><span class="p">)</span>
<span class="linenos">17</span><span class="c1"># None  # it is not passed separately, but will be taken care of by the output parser</span>
<span class="linenos">18</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
<span class="linenos">19</span><span class="c1"># [Message(content=&quot;&quot;&quot;Extract information about a person. The person is 65 years old, named Johnny.</span>
<span class="linenos">20</span><span class="c1"># Just return a json document that respects this JSON Schema:</span>
<span class="linenos">21</span><span class="c1"># {&quot;type&quot;: &quot;object&quot;, &quot;properties&quot;: {&quot;name&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;description&quot;: &quot;name of the person&quot;}, &quot;age&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;description&quot;: &quot;age of the person&quot;}}, &quot;title&quot;: &quot;output&quot;, &quot;description&quot;: &quot;information about a person&quot;}</span>
<span class="linenos">22</span><span class="c1">#</span>
<span class="linenos">23</span><span class="c1"># Reminder: only output the required json document, no need to repeat the title of the description, just the properties are required!&quot;&quot;&quot;, message_type=MessageType.USER)]</span>
<span class="linenos">24</span><span class="n">response</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span>
<span class="linenos">25</span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="linenos">26</span><span class="c1"># Message(content=&#39;{&quot;name&quot;: &quot;Johnny&quot;, &quot;age&quot;: &quot;65&quot;}&#39;, message_type=MessageType.AGENT)</span>
</pre></div>
</div>
<p>The main parameters to configure are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">native_structured_generation=False</span></code>: prevents the <code class="docutils literal notranslate"><span class="pre">response_format</span></code> from being passed separately. If a <code class="docutils literal notranslate"><span class="pre">__RESPONSE_FORMAT__</span></code> placeholder is used, the <code class="docutils literal notranslate"><span class="pre">response_format</span></code> will be inserted there.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_parser</span></code>: to correctly parse the raw LLM output into the expected object. In this example, a simple output parser is used that can repair malformed JSON output.</p></li>
</ul>
<p>You can also use custom output parser to ensure the expected format.
In such cases, it is beneficial to include the <code class="docutils literal notranslate"><span class="pre">response_format</span></code> in the template to clearly indicate the structured output format being generated.
For example, parsing the content of the chain-of-thoughts can be done as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">prompt_template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span>
<span class="linenos"> 2</span>    <span class="n">template</span><span class="o">=</span><span class="s2">&quot;What is the result of 100+(454-3). Think step by step and then give your answer between &lt;result&gt;...&lt;/result&gt; delimiters&quot;</span><span class="p">,</span>
<span class="linenos"> 3</span>    <span class="n">output_parser</span><span class="o">=</span><span class="n">RegexOutputParser</span><span class="p">(</span>
<span class="linenos"> 4</span>        <span class="n">regex_pattern</span><span class="o">=</span><span class="p">{</span>
<span class="linenos"> 5</span>            <span class="s2">&quot;thoughts&quot;</span><span class="p">:</span> <span class="n">RegexPattern</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(.*)&lt;result&gt;&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">),</span>
<span class="linenos"> 6</span>            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">RegexPattern</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&lt;result&gt;(.*)&lt;/result&gt;&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">),</span>
<span class="linenos"> 7</span>        <span class="p">}</span>
<span class="linenos"> 8</span>    <span class="p">),</span>
<span class="linenos"> 9</span>    <span class="n">response_format</span><span class="o">=</span><span class="n">ObjectProperty</span><span class="p">(</span>
<span class="linenos">10</span>        <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
<span class="linenos">11</span>            <span class="s2">&quot;thoughts&quot;</span><span class="p">:</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;step by step thinking of the LLM&quot;</span><span class="p">),</span>
<span class="linenos">12</span>            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;result of the computation&quot;</span><span class="p">),</span>
<span class="linenos">13</span>        <span class="p">}</span>
<span class="linenos">14</span>    <span class="p">),</span>
<span class="linenos">15</span><span class="p">)</span>
<span class="linenos">16</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt_template</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>  <span class="c1"># no inputs needed since the template has no variable</span>
<span class="linenos">17</span><span class="n">result</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<span class="linenos">18</span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="linenos">19</span><span class="c1"># {&quot;thoughts&quot;: &quot;To solve the expression step by step:\n\n1. Evaluate the expression inside the parentheses: 454 - 3 = 451\n2. Add the result to 100: 100 + 451 = 551\n\nSo, the final result is:\n\n&quot;, &quot;result&quot;: &quot;551&quot;}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Wayflow also provides a helper function to set up a simple JSON structured generation prompt and
the associated output parser from an existing prompt template leveraging native structured generation.
Check out the <a class="reference internal" href="../api/prompttemplate.html#prompttemplatehelpers"><span class="std std-ref">helper method’s API Reference</span></a>.</p>
</div>
</section>
</section>
<section id="agent-spec-exporting-loading">
<h2>Agent Spec Exporting/Loading<a class="headerlink" href="#agent-spec-exporting-loading" title="Permalink to this heading">#</a></h2>
<p>You can export the assistant configuration to its Agent Spec configuration using the <code class="docutils literal notranslate"><span class="pre">AgentSpecExporter</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agentspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentSpecExporter</span><span class="p">,</span> <span class="n">AgentSpecLoader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agentspec.components.template</span><span class="w"> </span><span class="kn">import</span> <span class="n">prompttemplate_serialization_plugin</span><span class="p">,</span> <span class="n">prompttemplate_deserialization_plugin</span>
<span class="n">assistant</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span> <span class="n">agent_template</span><span class="o">=</span><span class="n">prompt_template</span><span class="p">)</span>
<span class="n">serialized_assistant</span> <span class="o">=</span> <span class="n">AgentSpecExporter</span><span class="p">(</span><span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">prompttemplate_serialization_plugin</span><span class="p">])</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">assistant</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is what the <strong>Agent Spec representation will look like ↓</strong></p>
<details class="summary-click-here-to-see-the-assistant-configuration">
<summary>Click here to see the assistant configuration.</summary><div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">JSON</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">YAML</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;component_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ExtendedAgent&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0d75db5b-68bd-42b5-8a9f-79f2f3f5f85c&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;agent_6a2dfe98&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;__metadata_info__&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;agent_6a2dfe98&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nt">&quot;outputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nt">&quot;llm_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;component_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;VllmConfig&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;8534806a-5201-4c59-afee-e8a46ac8a17d&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LLAMA_MODEL_ID&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;__metadata_info__&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;default_generation_parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LLAMA_API_URL&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;model_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LLAMA_MODEL_ID&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;system_prompt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;tools&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nt">&quot;toolboxes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nt">&quot;context_providers&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;can_finish_conversation&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;max_iterations&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;initial_message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hi! How can I help you?&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;caller_input_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;always&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;agents&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nt">&quot;flows&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nt">&quot;agent_template&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;component_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PluginPromptTemplate&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;d3a8c0b1-722a-44a1-a2a7-c5aa727742e0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prompt_template&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;__metadata_info__&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;messages&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;contents&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;What is the result of 100+(454-3). Think step by step and then give your answer between &lt;result&gt;...&lt;/result&gt; delimiters&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;tool_requests&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;tool_result&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;display_only&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;sender&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;recipients&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">        </span><span class="nt">&quot;time_created&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-08-15T13:31:44.684406+00:00&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;time_updated&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-08-15T13:31:44.684406+00:00&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;output_parser&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;component_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PluginRegexOutputParser&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;09cdd631-0189-44bd-800f-4e924ab1ff15&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;regex_outputparser&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;__metadata_info__&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;regex_pattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;pattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;result&gt;(.*)&lt;/result&gt;&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;first&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;flags&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;thoughts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;pattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;(.*)&lt;result&gt;&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;first&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;flags&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;strict&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;component_plugin_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OutputParserPlugin&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;component_plugin_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;25.4.0.dev0&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">    </span><span class="nt">&quot;pre_rendering_transforms&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;post_rendering_transforms&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tools&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;native_tool_calling&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;response_format&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;result of the computation&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;thoughts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;step by step thinking of the LLM&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;native_structured_generation&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;generation_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;component_plugin_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PromptTemplatePlugin&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;component_plugin_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;25.4.0.dev0&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;component_plugin_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AgentPlugin&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;component_plugin_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;25.4.0.dev0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;agentspec_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;25.4.1&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">component_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ExtendedAgent</span>
<span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0d75db5b-68bd-42b5-8a9f-79f2f3f5f85c</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent_6a2dfe98</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">__metadata_info__</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent_6a2dfe98</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="nt">inputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="nt">outputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="nt">llm_config</span><span class="p">:</span>
<span class="w">  </span><span class="nt">component_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VllmConfig</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8534806a-5201-4c59-afee-e8a46ac8a17d</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LLAMA_MODEL_ID</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">__metadata_info__</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">default_generation_parameters</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LLAMA_API_URL</span>
<span class="w">  </span><span class="nt">model_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LLAMA_MODEL_ID</span>
<span class="nt">system_prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="nt">tools</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="nt">toolboxes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="nt">context_providers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="nt">can_finish_conversation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">max_iterations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="nt">initial_message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Hi! How can I help you?</span>
<span class="nt">caller_input_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
<span class="nt">agents</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="nt">flows</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="nt">agent_template</span><span class="p">:</span>
<span class="w">  </span><span class="nt">component_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PluginPromptTemplate</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">d3a8c0b1-722a-44a1-a2a7-c5aa727742e0</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prompt_template</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">__metadata_info__</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">messages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
<span class="w">    </span><span class="nt">contents</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">text</span>
<span class="w">      </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">What is the result of 100+(454-3). Think step by step and then give</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">your answer between &lt;result&gt;...&lt;/result&gt; delimiters</span>
<span class="w">    </span><span class="nt">tool_requests</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">tool_result</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">display_only</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">sender</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">recipients</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="w">    </span><span class="nt">time_created</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2025-08-15T13:31:44.684406+00:00&#39;</span>
<span class="w">    </span><span class="nt">time_updated</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2025-08-15T13:31:44.684406+00:00&#39;</span>
<span class="w">  </span><span class="nt">output_parser</span><span class="p">:</span>
<span class="w">    </span><span class="nt">component_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PluginRegexOutputParser</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">09cdd631-0189-44bd-800f-4e924ab1ff15</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">regex_outputparser</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">__metadata_info__</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">    </span><span class="nt">regex_pattern</span><span class="p">:</span>
<span class="w">      </span><span class="nt">result</span><span class="p">:</span>
<span class="w">        </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;result&gt;(.*)&lt;/result&gt;</span>
<span class="w">        </span><span class="nt">match</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">first</span>
<span class="w">        </span><span class="nt">flags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span>
<span class="w">      </span><span class="nt">thoughts</span><span class="p">:</span>
<span class="w">        </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(.*)&lt;result&gt;</span>
<span class="w">        </span><span class="nt">match</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">first</span>
<span class="w">        </span><span class="nt">flags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span>
<span class="w">    </span><span class="nt">strict</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">component_plugin_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OutputParserPlugin</span>
<span class="w">    </span><span class="nt">component_plugin_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25.4.0.dev0</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="w">  </span><span class="nt">pre_rendering_transforms</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">post_rendering_transforms</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">tools</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">native_tool_calling</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">response_format</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span>
<span class="w">    </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">      </span><span class="nt">result</span><span class="p">:</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result of the computation</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">thoughts</span><span class="p">:</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">step by step thinking of the LLM</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">  </span><span class="nt">native_structured_generation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">generation_config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">component_plugin_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PromptTemplatePlugin</span>
<span class="w">  </span><span class="nt">component_plugin_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25.4.0.dev0</span>
<span class="nt">component_plugin_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AgentPlugin</span>
<span class="nt">component_plugin_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25.4.0.dev0</span>
<span class="nt">agentspec_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25.4.1</span>
</pre></div>
</div>
</div></div>
</details><p>You can then load the configuration back to an assistant using the <code class="docutils literal notranslate"><span class="pre">AgentSpecLoader</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">new_agent</span><span class="p">:</span> <span class="n">Agent</span> <span class="o">=</span> <span class="n">AgentSpecLoader</span><span class="p">(</span><span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">prompttemplate_deserialization_plugin</span><span class="p">])</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="n">serialized_assistant</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This guide uses the following extension/plugin Agent Spec components:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PluginPromptTemplate</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PluginRegexOutputParser</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ExtendedAgent</span></code></p></li>
</ul>
<p>See the list of available Agent Spec extension/plugin components in the <a class="reference internal" href="../api/agentspec.html"><span class="doc">API Reference</span></a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, all WayFlow serialization/deserialization plugins are used when loading or exporting
from/to Agent Spec. Passing a list of plugins overrides the default ones.</p>
</div>
</section>
<section id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this heading">#</a></h2>
<p>Having learned how to use the <code class="docutils literal notranslate"><span class="pre">PromptTemplate</span></code>, you may now proceed to using it in <a class="reference internal" href="../api/flows.html#promptexecutionstep"><span class="std std-ref">PromptExecutionStep</span></a> or <a class="reference internal" href="../api/agent.html#agent"><span class="std std-ref">Agents</span></a>.</p>
</section>
<section id="full-code">
<h2>Full code<a class="headerlink" href="#full-code" title="Permalink to this heading">#</a></h2>
<p>Click on the card at the <a class="reference internal" href="#top-howtoprompttemplates"><span class="std std-ref">top of this page</span></a> to download the full code for this guide or copy the code below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1"># Copyright © 2025 Oracle and/or its affiliates.</span>
<span class="linenos">  2</span><span class="c1">#</span>
<span class="linenos">  3</span><span class="c1"># This software is under the Apache License 2.0</span>
<span class="linenos">  4</span><span class="c1"># %%[markdown]</span>
<span class="linenos">  5</span><span class="c1"># Code Example - How to Use Advanced Prompting Techniques</span>
<span class="linenos">  6</span><span class="c1"># -------------------------------------------------------</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="c1"># How to use:</span>
<span class="linenos">  9</span><span class="c1"># Create a new Python virtual environment and install the latest WayFlow version.</span>
<span class="linenos"> 10</span><span class="c1"># ```bash</span>
<span class="linenos"> 11</span><span class="c1"># python -m venv venv-wayflowcore</span>
<span class="linenos"> 12</span><span class="c1"># source venv-wayflowcore/bin/activate</span>
<span class="linenos"> 13</span><span class="c1"># pip install --upgrade pip</span>
<span class="linenos"> 14</span><span class="c1"># pip install &quot;wayflowcore==26.1&quot; </span>
<span class="linenos"> 15</span><span class="c1"># ```</span>
<span class="linenos"> 16</span>
<span class="linenos"> 17</span><span class="c1"># You can now run the script</span>
<span class="linenos"> 18</span><span class="c1"># 1. As a Python file:</span>
<span class="linenos"> 19</span><span class="c1"># ```bash</span>
<span class="linenos"> 20</span><span class="c1"># python howto_prompttemplate.py</span>
<span class="linenos"> 21</span><span class="c1"># ```</span>
<span class="linenos"> 22</span><span class="c1"># 2. As a Notebook (in VSCode):</span>
<span class="linenos"> 23</span><span class="c1"># When viewing the file,</span>
<span class="linenos"> 24</span><span class="c1">#  - press the keys Ctrl + Enter to run the selected cell</span>
<span class="linenos"> 25</span><span class="c1">#  - or Shift + Enter to run the selected cell and move to the cell below# (LICENSE-APACHE or http://www.apache.org/licenses/LICENSE-2.0) or Universal Permissive License</span>
<span class="linenos"> 26</span><span class="c1"># (UPL) 1.0 (LICENSE-UPL or https://oss.oracle.com/licenses/upl), at your option.</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 31</span><span class="c1">## Configure your LLM</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="c1"># %%</span>
<span class="linenos"> 34</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">VllmModel</span>
<span class="linenos"> 35</span>
<span class="linenos"> 36</span><span class="n">llm</span> <span class="o">=</span> <span class="n">VllmModel</span><span class="p">(</span>
<span class="linenos"> 37</span>    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;model-id&quot;</span><span class="p">,</span>
<span class="linenos"> 38</span>    <span class="n">host_port</span><span class="o">=</span><span class="s2">&quot;VLLM_HOST_PORT&quot;</span><span class="p">,</span>
<span class="linenos"> 39</span><span class="p">)</span>
<span class="linenos"> 40</span>
<span class="linenos"> 41</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 42</span><span class="c1">## Basic text prompt with Regex parsing</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span><span class="c1"># %%</span>
<span class="linenos"> 45</span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.outputparser</span><span class="w"> </span><span class="kn">import</span> <span class="n">JsonOutputParser</span><span class="p">,</span> <span class="n">RegexOutputParser</span><span class="p">,</span> <span class="n">RegexPattern</span>
<span class="linenos"> 48</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.templates</span><span class="w"> </span><span class="kn">import</span> <span class="n">PromptTemplate</span>
<span class="linenos"> 49</span>
<span class="linenos"> 50</span><span class="n">prompt_template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span>
<span class="linenos"> 51</span>    <span class="n">template</span><span class="o">=</span><span class="s2">&quot;What is the result of 100+(454-3). Think step by step and then give your answer between &lt;result&gt;...&lt;/result&gt; delimiters&quot;</span><span class="p">,</span>
<span class="linenos"> 52</span>    <span class="n">output_parser</span><span class="o">=</span><span class="n">RegexOutputParser</span><span class="p">(</span>
<span class="linenos"> 53</span>        <span class="n">regex_pattern</span><span class="o">=</span><span class="n">RegexPattern</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&lt;result&gt;(.*)&lt;/result&gt;&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
<span class="linenos"> 54</span>    <span class="p">),</span>
<span class="linenos"> 55</span><span class="p">)</span>
<span class="linenos"> 56</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt_template</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>  <span class="c1"># no inputs needed since the template has no variable</span>
<span class="linenos"> 57</span><span class="n">result</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<span class="linenos"> 58</span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="linenos"> 59</span><span class="c1"># 551</span>
<span class="linenos"> 60</span>
<span class="linenos"> 61</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 62</span><span class="c1">## Prompt with chat history</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span><span class="c1"># %%</span>
<span class="linenos"> 65</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.messagelist</span><span class="w"> </span><span class="kn">import</span> <span class="n">Message</span><span class="p">,</span> <span class="n">MessageType</span>
<span class="linenos"> 66</span>
<span class="linenos"> 67</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos"> 68</span>    <span class="n">Message</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;What is the capital of Switzerland?&quot;</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="n">MessageType</span><span class="o">.</span><span class="n">USER</span><span class="p">),</span>
<span class="linenos"> 69</span>    <span class="n">Message</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;The capital of Switzerland is Bern?&quot;</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="n">MessageType</span><span class="o">.</span><span class="n">AGENT</span><span class="p">),</span>
<span class="linenos"> 70</span>    <span class="n">Message</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;Really? I thought it was Zurich?&quot;</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="n">MessageType</span><span class="o">.</span><span class="n">USER</span><span class="p">),</span>
<span class="linenos"> 71</span><span class="p">]</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 74</span><span class="c1">### As inlined messages</span>
<span class="linenos"> 75</span>
<span class="linenos"> 76</span><span class="c1"># %%</span>
<span class="linenos"> 77</span><span class="n">prompt_template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
<span class="linenos"> 78</span>    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
<span class="linenos"> 79</span>        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a helpful assistant. Answer the user questions&quot;</span><span class="p">},</span>
<span class="linenos"> 80</span>        <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER</span><span class="p">,</span>
<span class="linenos"> 81</span>    <span class="p">]</span>
<span class="linenos"> 82</span><span class="p">)</span>
<span class="linenos"> 83</span>
<span class="linenos"> 84</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER_NAME</span><span class="p">:</span> <span class="n">messages</span><span class="p">})</span>
<span class="linenos"> 85</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
<span class="linenos"> 86</span><span class="c1"># [</span>
<span class="linenos"> 87</span><span class="c1">#   Message(content=&#39;You are a helpful assistant. Answer the user questions&#39;, message_type=MessageType.SYSTEM),</span>
<span class="linenos"> 88</span><span class="c1">#   Message(content=&#39;What is the capital of Switzerland?&#39;, message_type=MessageType.USER),</span>
<span class="linenos"> 89</span><span class="c1">#   Message(content=&#39;The capital of Switzerland is Bern?&#39;, message_type=MessageType.AGENT),</span>
<span class="linenos"> 90</span><span class="c1">#   Message(content=&#39;Really? I thought it was Zurich?&#39;, message_type=MessageType.USER)</span>
<span class="linenos"> 91</span><span class="c1"># ]</span>
<span class="linenos"> 92</span><span class="n">result</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<span class="linenos"> 93</span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="linenos"> 94</span><span class="c1"># While Zurich is a major city in Switzerland and home to many international organizations, the capital is indeed Bern (also known as Berne).</span>
<span class="linenos"> 95</span>
<span class="linenos"> 96</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 97</span><span class="c1">### In the system prompt</span>
<span class="linenos"> 98</span>
<span class="linenos"> 99</span><span class="c1"># %%</span>
<span class="linenos">100</span><span class="n">prompt_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;You are a helpful assistant. Answer the user questions.</span>
<span class="linenos">101</span><span class="s2">For context, the conversation was:</span>
<span class="linenos">102</span><span class="s2">{</span><span class="si">% f</span><span class="s2">or msg in __CHAT_HISTORY__ %}</span>
<span class="linenos">103</span><span class="s2">{{ msg.message_type.value }} &gt;&gt; {{msg.content}}</span>
<span class="linenos">104</span><span class="s2">{</span><span class="si">%- e</span><span class="s2">ndfor %}</span>
<span class="linenos">105</span>
<span class="linenos">106</span><span class="s2">Just answer the user question.</span>
<span class="linenos">107</span><span class="s2">&quot;&quot;&quot;</span>
<span class="linenos">108</span><span class="n">prompt_template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span><span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">prompt_text</span><span class="p">}])</span>
<span class="linenos">109</span>
<span class="linenos">110</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER_NAME</span><span class="p">:</span> <span class="n">messages</span><span class="p">})</span>
<span class="linenos">111</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
<span class="linenos">112</span><span class="c1"># [Message(content=&quot;&quot;&quot;You are a helpful assistant. Answer the user questions.</span>
<span class="linenos">113</span><span class="c1"># For context, the conversation was:</span>
<span class="linenos">114</span><span class="c1">#</span>
<span class="linenos">115</span><span class="c1"># USER &gt;&gt; What is the capital of Switzerland?</span>
<span class="linenos">116</span><span class="c1"># AGENT &gt;&gt; The capital of Switzerland is Bern?</span>
<span class="linenos">117</span><span class="c1"># USER &gt;&gt; Really? I thought it was Zurich?</span>
<span class="linenos">118</span><span class="c1">#</span>
<span class="linenos">119</span><span class="c1"># Just answer the user question.&quot;&quot;&quot;, message_type=MessageType.SYSTEM]</span>
<span class="linenos">120</span><span class="n">result</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<span class="linenos">121</span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="linenos">122</span><span class="c1"># While Zurich is a major city and financial hub in Switzerland, the capital is indeed Bern.</span>
<span class="linenos">123</span>
<span class="linenos">124</span><span class="c1"># %%[markdown]</span>
<span class="linenos">125</span><span class="c1">### With message transform</span>
<span class="linenos">126</span>
<span class="linenos">127</span><span class="c1"># %%</span>
<span class="linenos">128</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
<span class="linenos">129</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.transforms</span><span class="w"> </span><span class="kn">import</span> <span class="n">MessageTransform</span>
<span class="linenos">130</span>
<span class="linenos">131</span><span class="k">class</span><span class="w"> </span><span class="nc">OnlyLastChatMessageTransform</span><span class="p">(</span><span class="n">MessageTransform</span><span class="p">):</span>
<span class="linenos">132</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">]:</span>
<span class="linenos">133</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">134</span>            <span class="k">return</span> <span class="p">[]</span>
<span class="linenos">135</span>        <span class="k">return</span> <span class="p">[</span><span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="linenos">136</span>
<span class="linenos">137</span><span class="n">prompt_template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
<span class="linenos">138</span>    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
<span class="linenos">139</span>        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a helpful assistant. Answer the user questions&quot;</span><span class="p">},</span>
<span class="linenos">140</span>        <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER</span><span class="p">,</span>
<span class="linenos">141</span>    <span class="p">],</span>
<span class="linenos">142</span>    <span class="n">pre_rendering_transforms</span><span class="o">=</span><span class="p">[</span><span class="n">OnlyLastChatMessageTransform</span><span class="p">()],</span>
<span class="linenos">143</span><span class="p">)</span>
<span class="linenos">144</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER_NAME</span><span class="p">:</span> <span class="n">messages</span><span class="p">})</span>
<span class="linenos">145</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
<span class="linenos">146</span><span class="c1"># [</span>
<span class="linenos">147</span><span class="c1">#   Message(content=&#39;You are a helpful assistant. Answer the user questions&#39;, message_type=MessageType.SYSTEM),</span>
<span class="linenos">148</span><span class="c1">#   Message(content=&#39;Really? I thought it was Zurich?&#39;, message_type=MessageType.USER)</span>
<span class="linenos">149</span><span class="c1"># ]</span>
<span class="linenos">150</span>
<span class="linenos">151</span><span class="c1"># %%[markdown]</span>
<span class="linenos">152</span><span class="c1">## Configure how to use tools in templates</span>
<span class="linenos">153</span>
<span class="linenos">154</span><span class="c1"># %%</span>
<span class="linenos">155</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>
<span class="linenos">156</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>
<span class="linenos">157</span>
<span class="linenos">158</span><span class="nd">@tool</span>
<span class="linenos">159</span><span class="k">def</span><span class="w"> </span><span class="nf">some_tool</span><span class="p">(</span><span class="n">param1</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;name of the user&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;tool_output&quot;</span><span class="p">]:</span>
<span class="linenos">160</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs some action&quot;&quot;&quot;</span>
<span class="linenos">161</span>    <span class="k">return</span> <span class="s2">&quot;some_tool_output&quot;</span>
<span class="linenos">162</span>
<span class="linenos">163</span><span class="c1"># %%[markdown]</span>
<span class="linenos">164</span><span class="c1">### With native tool calling</span>
<span class="linenos">165</span>
<span class="linenos">166</span><span class="c1"># %%</span>
<span class="linenos">167</span><span class="n">template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
<span class="linenos">168</span>    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
<span class="linenos">169</span>        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a helpful assistant&quot;</span><span class="p">},</span>
<span class="linenos">170</span>        <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER</span><span class="p">,</span>
<span class="linenos">171</span>    <span class="p">],</span>
<span class="linenos">172</span><span class="p">)</span>
<span class="linenos">173</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">with_tools</span><span class="p">([</span><span class="n">some_tool</span><span class="p">])</span>
<span class="linenos">174</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">175</span>    <span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER_NAME</span><span class="p">:</span> <span class="p">[</span><span class="n">Message</span><span class="p">(</span><span class="s2">&quot;call the some_output tool&quot;</span><span class="p">)]}</span>
<span class="linenos">176</span><span class="p">)</span>
<span class="linenos">177</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">tools</span><span class="p">)</span>
<span class="linenos">178</span><span class="c1"># [ServerTool()]</span>
<span class="linenos">179</span><span class="n">response</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span>
<span class="linenos">180</span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="linenos">181</span><span class="c1"># Message(content=&#39;&#39;, message_type=&lt;MessageType.TOOL_REQUEST, tool_requests=[ToolRequest(name=&#39;some_output&#39;, args={&#39;param1&#39;: &#39;call the some_output tool&#39;}, tool_request_id=&#39;chatcmpl-tool-ae924a4829324411add8760d3ae265bd&#39;)])</span>
<span class="linenos">182</span>
<span class="linenos">183</span><span class="c1"># %%[markdown]</span>
<span class="linenos">184</span><span class="c1">### With custom tool calling</span>
<span class="linenos">185</span>
<span class="linenos">186</span><span class="c1"># %%</span>
<span class="linenos">187</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models.llmgenerationconfig</span><span class="w"> </span><span class="kn">import</span> <span class="n">LlmGenerationConfig</span>
<span class="linenos">188</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.templates.reacttemplates</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="linenos">189</span>    <span class="n">REACT_SYSTEM_TEMPLATE</span><span class="p">,</span>
<span class="linenos">190</span>    <span class="n">ReactToolOutputParser</span><span class="p">,</span>
<span class="linenos">191</span>    <span class="n">_ReactMergeToolRequestAndCallsTransform</span><span class="p">,</span>
<span class="linenos">192</span><span class="p">)</span>
<span class="linenos">193</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.transforms</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="linenos">194</span>    <span class="n">CoalesceSystemMessagesTransform</span><span class="p">,</span>
<span class="linenos">195</span>    <span class="n">RemoveEmptyNonUserMessageTransform</span><span class="p">,</span>
<span class="linenos">196</span><span class="p">)</span>
<span class="linenos">197</span>
<span class="linenos">198</span><span class="n">REACT_CHAT_TEMPLATE</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
<span class="linenos">199</span>    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
<span class="linenos">200</span>        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">REACT_SYSTEM_TEMPLATE</span><span class="p">},</span>
<span class="linenos">201</span>        <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER</span><span class="p">,</span>
<span class="linenos">202</span>    <span class="p">],</span>
<span class="linenos">203</span>    <span class="n">native_tool_calling</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="linenos">204</span>    <span class="n">post_rendering_transforms</span><span class="o">=</span><span class="p">[</span>
<span class="linenos">205</span>        <span class="n">_ReactMergeToolRequestAndCallsTransform</span><span class="p">(),</span>
<span class="linenos">206</span>        <span class="n">CoalesceSystemMessagesTransform</span><span class="p">(),</span>
<span class="linenos">207</span>        <span class="n">RemoveEmptyNonUserMessageTransform</span><span class="p">(),</span>
<span class="linenos">208</span>    <span class="p">],</span>
<span class="linenos">209</span>    <span class="n">output_parser</span><span class="o">=</span><span class="n">ReactToolOutputParser</span><span class="p">(),</span>
<span class="linenos">210</span>    <span class="n">generation_config</span><span class="o">=</span><span class="n">LlmGenerationConfig</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;## Observation&quot;</span><span class="p">]),</span>
<span class="linenos">211</span><span class="p">)</span>
<span class="linenos">212</span><span class="n">template</span> <span class="o">=</span> <span class="n">REACT_CHAT_TEMPLATE</span><span class="o">.</span><span class="n">with_tools</span><span class="p">([</span><span class="n">some_tool</span><span class="p">])</span>
<span class="linenos">213</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="linenos">214</span>    <span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="n">PromptTemplate</span><span class="o">.</span><span class="n">CHAT_HISTORY_PLACEHOLDER_NAME</span><span class="p">:</span> <span class="p">[</span><span class="n">Message</span><span class="p">(</span><span class="s2">&quot;call the some_output tool&quot;</span><span class="p">)]}</span>
<span class="linenos">215</span><span class="p">)</span>
<span class="linenos">216</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">tools</span><span class="p">)</span>
<span class="linenos">217</span><span class="c1"># [ServerTool()]</span>
<span class="linenos">218</span><span class="n">response</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span>
<span class="linenos">219</span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="linenos">220</span><span class="c1"># Message(content=&#39;&#39;, message_type=MessageType.TOOL_REQUEST, tool_requests=[ToolRequest(name=&#39;some_tool&#39;, args={&#39;param1&#39;: &#39;call the some_output tool&#39;}, tool_request_id=&#39;chatcmpl-tool-69c7e27e55474501be0dfc2509e5d4f2&#39;)]</span>
<span class="linenos">221</span>
<span class="linenos">222</span><span class="c1"># %%[markdown]</span>
<span class="linenos">223</span><span class="c1">## Configure how to use structured generation in templates</span>
<span class="linenos">224</span>
<span class="linenos">225</span><span class="c1"># %%</span>
<span class="linenos">226</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.property</span><span class="w"> </span><span class="kn">import</span> <span class="n">ObjectProperty</span><span class="p">,</span> <span class="n">StringProperty</span>
<span class="linenos">227</span>
<span class="linenos">228</span><span class="n">output</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span>
<span class="linenos">229</span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span>
<span class="linenos">230</span>    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;information about a person&quot;</span><span class="p">,</span>
<span class="linenos">231</span>    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
<span class="linenos">232</span>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;name of the person&quot;</span><span class="p">),</span>
<span class="linenos">233</span>        <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;age of the person&quot;</span><span class="p">),</span>
<span class="linenos">234</span>    <span class="p">},</span>
<span class="linenos">235</span><span class="p">)</span>
<span class="linenos">236</span>
<span class="linenos">237</span><span class="c1"># %%[markdown]</span>
<span class="linenos">238</span><span class="c1">### With native structured generation</span>
<span class="linenos">239</span>
<span class="linenos">240</span><span class="c1"># %%</span>
<span class="linenos">241</span><span class="n">template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span>
<span class="linenos">242</span>    <span class="n">template</span><span class="o">=</span><span class="s2">&quot;Extract information about a person. The person is 65 years old, named Johnny&quot;</span><span class="p">,</span>
<span class="linenos">243</span>    <span class="n">response_format</span><span class="o">=</span><span class="n">output</span><span class="p">,</span>
<span class="linenos">244</span><span class="p">)</span>
<span class="linenos">245</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
<span class="linenos">246</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">response_format</span><span class="p">)</span>
<span class="linenos">247</span><span class="c1"># ObjectProperty(...)</span>
<span class="linenos">248</span><span class="n">response</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span>
<span class="linenos">249</span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="linenos">250</span><span class="c1"># Message(content=&#39;{&quot;name&quot;: &quot;Johnny&quot;, &quot;age&quot;: &quot;65&quot;}&#39;, message_type=MessageType.AGENT)</span>
<span class="linenos">251</span>
<span class="linenos">252</span><span class="c1"># %%[markdown]</span>
<span class="linenos">253</span><span class="c1">### With custom structured generation</span>
<span class="linenos">254</span>
<span class="linenos">255</span><span class="c1"># %%</span>
<span class="linenos">256</span><span class="n">text_template</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Extract information about a person. The person is 65 years old, named Johnny.</span>
<span class="linenos">257</span><span class="s2">Just return a json document that respects this JSON Schema:</span>
<span class="linenos">258</span><span class="s2">{{__RESPONSE_FORMAT__.to_json_schema() | tojson }}</span>
<span class="linenos">259</span>
<span class="linenos">260</span><span class="s2">Reminder: only output the required json document, no need to repeat the title of the description, just the properties are required!</span>
<span class="linenos">261</span><span class="s2">&quot;&quot;&quot;</span>
<span class="linenos">262</span>
<span class="linenos">263</span><span class="n">template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
<span class="linenos">264</span>    <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">text_template</span><span class="p">}],</span>
<span class="linenos">265</span>    <span class="n">native_structured_generation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="linenos">266</span>    <span class="n">output_parser</span><span class="o">=</span><span class="n">JsonOutputParser</span><span class="p">(),</span>
<span class="linenos">267</span>    <span class="n">response_format</span><span class="o">=</span><span class="n">output</span><span class="p">,</span>
<span class="linenos">268</span><span class="p">)</span>
<span class="linenos">269</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
<span class="linenos">270</span><span class="c1"># ^no input needed since __RESPONSE_FORMAT__ is filled with `response_format`</span>
<span class="linenos">271</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">response_format</span><span class="p">)</span>
<span class="linenos">272</span><span class="c1"># None  # it is not passed separately, but will be taken care of by the output parser</span>
<span class="linenos">273</span><span class="nb">print</span><span class="p">(</span><span class="n">prompt</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
<span class="linenos">274</span><span class="c1"># [Message(content=&quot;&quot;&quot;Extract information about a person. The person is 65 years old, named Johnny.</span>
<span class="linenos">275</span><span class="c1"># Just return a json document that respects this JSON Schema:</span>
<span class="linenos">276</span><span class="c1"># {&quot;type&quot;: &quot;object&quot;, &quot;properties&quot;: {&quot;name&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;description&quot;: &quot;name of the person&quot;}, &quot;age&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;description&quot;: &quot;age of the person&quot;}}, &quot;title&quot;: &quot;output&quot;, &quot;description&quot;: &quot;information about a person&quot;}</span>
<span class="linenos">277</span><span class="c1">#</span>
<span class="linenos">278</span><span class="c1"># Reminder: only output the required json document, no need to repeat the title of the description, just the properties are required!&quot;&quot;&quot;, message_type=MessageType.USER)]</span>
<span class="linenos">279</span><span class="n">response</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span>
<span class="linenos">280</span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="linenos">281</span><span class="c1"># Message(content=&#39;{&quot;name&quot;: &quot;Johnny&quot;, &quot;age&quot;: &quot;65&quot;}&#39;, message_type=MessageType.AGENT)</span>
<span class="linenos">282</span>
<span class="linenos">283</span><span class="c1"># %%[markdown]</span>
<span class="linenos">284</span><span class="c1">### With additional output parser</span>
<span class="linenos">285</span>
<span class="linenos">286</span><span class="c1"># %%</span>
<span class="linenos">287</span><span class="n">prompt_template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span>
<span class="linenos">288</span>    <span class="n">template</span><span class="o">=</span><span class="s2">&quot;What is the result of 100+(454-3). Think step by step and then give your answer between &lt;result&gt;...&lt;/result&gt; delimiters&quot;</span><span class="p">,</span>
<span class="linenos">289</span>    <span class="n">output_parser</span><span class="o">=</span><span class="n">RegexOutputParser</span><span class="p">(</span>
<span class="linenos">290</span>        <span class="n">regex_pattern</span><span class="o">=</span><span class="p">{</span>
<span class="linenos">291</span>            <span class="s2">&quot;thoughts&quot;</span><span class="p">:</span> <span class="n">RegexPattern</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(.*)&lt;result&gt;&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">),</span>
<span class="linenos">292</span>            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">RegexPattern</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;&lt;result&gt;(.*)&lt;/result&gt;&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">),</span>
<span class="linenos">293</span>        <span class="p">}</span>
<span class="linenos">294</span>    <span class="p">),</span>
<span class="linenos">295</span>    <span class="n">response_format</span><span class="o">=</span><span class="n">ObjectProperty</span><span class="p">(</span>
<span class="linenos">296</span>        <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
<span class="linenos">297</span>            <span class="s2">&quot;thoughts&quot;</span><span class="p">:</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;step by step thinking of the LLM&quot;</span><span class="p">),</span>
<span class="linenos">298</span>            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">StringProperty</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;result of the computation&quot;</span><span class="p">),</span>
<span class="linenos">299</span>        <span class="p">}</span>
<span class="linenos">300</span>    <span class="p">),</span>
<span class="linenos">301</span><span class="p">)</span>
<span class="linenos">302</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt_template</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>  <span class="c1"># no inputs needed since the template has no variable</span>
<span class="linenos">303</span><span class="n">result</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
<span class="linenos">304</span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="linenos">305</span><span class="c1"># {&quot;thoughts&quot;: &quot;To solve the expression step by step:\n\n1. Evaluate the expression inside the parentheses: 454 - 3 = 451\n2. Add the result to 100: 100 + 451 = 551\n\nSo, the final result is:\n\n&quot;, &quot;result&quot;: &quot;551&quot;}</span>
<span class="linenos">306</span>
<span class="linenos">307</span><span class="c1"># %%[markdown]</span>
<span class="linenos">308</span><span class="c1">## Export config to Agent Spec</span>
<span class="linenos">309</span>
<span class="linenos">310</span><span class="c1"># %%</span>
<span class="linenos">311</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
<span class="linenos">312</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agentspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentSpecExporter</span><span class="p">,</span> <span class="n">AgentSpecLoader</span>
<span class="linenos">313</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agentspec.components.template</span><span class="w"> </span><span class="kn">import</span> <span class="n">prompttemplate_serialization_plugin</span><span class="p">,</span> <span class="n">prompttemplate_deserialization_plugin</span>
<span class="linenos">314</span><span class="n">assistant</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span> <span class="n">agent_template</span><span class="o">=</span><span class="n">prompt_template</span><span class="p">)</span>
<span class="linenos">315</span><span class="n">serialized_assistant</span> <span class="o">=</span> <span class="n">AgentSpecExporter</span><span class="p">(</span><span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">prompttemplate_serialization_plugin</span><span class="p">])</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">assistant</span><span class="p">)</span>
<span class="linenos">316</span>
<span class="linenos">317</span><span class="c1"># %%[markdown]</span>
<span class="linenos">318</span><span class="c1">## Load Agent Spec config</span>
<span class="linenos">319</span>
<span class="linenos">320</span><span class="c1"># %%</span>
<span class="linenos">321</span><span class="n">new_agent</span><span class="p">:</span> <span class="n">Agent</span> <span class="o">=</span> <span class="n">AgentSpecLoader</span><span class="p">(</span><span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">prompttemplate_deserialization_plugin</span><span class="p">])</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="n">serialized_assistant</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basics-of-prompting">Basics of prompting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-the-llm">Configure the LLM</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-text-prompt-with-regex-parsing">Basic text prompt with Regex parsing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prompt-with-chat-history">Prompt with chat history</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-how-to-use-tools-in-templates">Configure how to use tools in templates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configure-how-to-use-structured-generation-in-templates">Configure how to use structured generation in templates</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#with-native-structured-generation">With native structured generation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#with-custom-structured-generation">With custom structured generation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#agent-spec-exporting-loading">Agent Spec Exporting/Loading</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#full-code">Full code</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Oracle and/or its affiliates..
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>