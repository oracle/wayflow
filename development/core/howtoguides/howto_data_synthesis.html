


<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>How to Perform Data Synthesis in WayFlow &#8212; wayflowcore 26.1.0.dev0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css-style.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/core.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'core/howtoguides/howto_data_synthesis';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://oracle.github.io/wayflow/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '26.1.0.dev0';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
  <script src="../../_static/announcement.js"></script>

    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to Evaluate Assistants" href="howto_evaluation.html" />
    <link rel="prev" title="How to Use Variables for Shared State in Flows" href="howto_variable.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="26.1" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo-light.svg" class="logo__image only-light" alt="wayflowcore 26.1.0.dev0 documentation - Home"/>
    <img src="../../_static/logo-dark.svg" class="logo__image only-dark pst-js-only" alt="wayflowcore 26.1.0.dev0 documentation - Home"/>
  
  
</a></div>
    
      <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/oracle/wayflow" title="WayFlow GitHub repository" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/icons/github-icon.svg" class="icon-link-image" alt="WayFlow GitHub repository"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/oracle/wayflow" title="WayFlow GitHub repository" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/icons/github-icon.svg" class="icon-link-image" alt="WayFlow GitHub repository"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essentials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/index.html">Tutorials &amp; Use Cases</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/basic_agent.html">Build a Simple Conversational Assistant with Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/basic_flow.html">Build a Simple Fixed-flow Assistant with Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/usecase_prbot.html">Build a Simple Code Review Assistant</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">How-to Guides</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="io_descriptors.html">Change Input and Output Descriptors of Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_async.html">Use Asynchronous APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="agents.html">Create a ReAct Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_imagecontent.html">How to Send Images to LLMs and Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_ociagent.html">Use OCI Generative AI Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_prompttemplate.html">Use Templates for Advanced Prompting Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_userinputinflows.html">Ask for User Input in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="conditional_flows.html">Create Conditional Transitions in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_promptexecutionstep.html">Do Structured LLM Generation in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_userconfirmation.html">Add User Confirmation to a Tool Call Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="catching_exceptions.html">Catch Exceptions in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_mapstep.html">Do Map and Reduce Operations in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_parallelflowexecution.html">Run Multiple Flows in Parallel</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_agents_in_flows.html">Use Agents in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_multiagent.html">Build a Hierarchical Multi-Agent System</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_swarm.html">Build a Swarm of Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_managerworkers.html">Build a ManagerWorkers of Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_build_assistants_with_tools.html">Build Assistants with Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_multiple_output_tool.html">Create Tools with Multiple Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_a_tool_from_a_flow.html">Convert Flows to Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_mcp.html">Connect MCP tools to Assistants</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_remote_tool_expired_token.html">Do Remote API Calls with Tokens</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_execute_agentspec_with_wayflowcore.html">Load and Execute an Agent Spec Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_serdeser.html">Serialize and Deserialize Flows and Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_serialize_conversations.html">Serialize and Deserialize Conversations</a></li>
<li class="toctree-l2"><a class="reference internal" href="generation_config.html">Specify the Generation Configuration when Using LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="llm_from_different_providers.html">Use LLM from Different LLM Sources and Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing_ollama.html">Install and Use Ollama</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_tracing.html">Enable Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_long_context.html">Handle long context with agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_datastores.html">Connect Assistants to Your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddingmodels_from_different_providers.html">Use Embedding Models from Different Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_variable.html">Use Variables for Shared State in Flows</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Synthesize Data in WayFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_evaluation.html">Evaluate Assistants</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_conversation_evaluation.html">Evaluate Conversations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/agentspec.html">Agent Spec Adapters</a></li>

<li class="toctree-l2"><a class="reference internal" href="../api/conversation.html">Conversations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/llmmodels.html">LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/flows.html">Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/agent.html">Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/embeddingmodels.html">Embedding Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/contextproviders.html">Context Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/interrupts.html">Execution Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/prompttemplate.html">PromptTemplates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/serialization.html">Serialization/Deserialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/tools.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/tracing.html">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/variables.html">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/datastores.html">Datastores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/warnings.html">Warnings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/evaluation.html">Evaluation</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../misc/reference_sheet.html">Reference Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">For Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faqs.html">Frequently Asked Questions</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">WayFlow</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">How-to Guides</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">How to Perform Data Synthesis in WayFlow</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="how-to-perform-data-synthesis-in-wayflow">
<h1>How to Perform Data Synthesis in WayFlow<a class="headerlink" href="#how-to-perform-data-synthesis-in-wayflow" title="Permalink to this heading">#</a></h1>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-row-cols-2 sd-row-cols-xs-2 sd-row-cols-sm-2 sd-row-cols-md-2 sd-row-cols-lg-2 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<a class="reference internal" href="../../_images/python-icon.svg"><img alt="python-icon" height="40px" src="../../_images/python-icon.svg" width="40px" /></a> Download Python Script</div>
<p class="sd-card-text">Python script/notebook for this guide.</p>
</div>
<a class="sd-stretched-link sd-hide-link-text reference external" href="../end_to_end_code_examples/howto_data_synthesis.py"><span>Data Synthesis how-to script</span></a></div>
</div>
</div>
</div>
<p>This guide provides practical and adaptable methods for generating synthetic datasets tailored to a range of real-world use cases. Use it when you need to create evaluation datasets for model testing, sample data for demonstrations, or address data privacy requirements. You will find reproducible workflows and techniques that you can flexibly adapt to your own data schema and constraints.</p>
<p>Each synthesis approach is presented in relation to specific feature requirements. Most examples start from a seed dataset to capture authentic data characteristics. However, you can also apply these methods without real data by specifying a target schema and using tools such as <em>Faker</em>. With this guide, you can generate synthetic data that balances statistical realism with project flexibility.</p>
<section id="prerequisites-and-setup">
<h2>Prerequisites and setup<a class="headerlink" href="#prerequisites-and-setup" title="Permalink to this heading">#</a></h2>
<ul>
<li><p><strong>Desired output schema:</strong> Define the fields and features your synthetic dataset should contain. Specify each field’s type and any necessary constraints.</p></li>
<li><p><strong>Seed dataset (optional, recommended):</strong></p>
<ul class="simple">
<li><p>Use a seed dataset if you want to preserve real-world distributional properties, such as means, variances, or category frequencies.</p></li>
<li><p>A seed dataset is also essential if you need to interpolate or generate synthetic values conditioned on, or resembling, existing feature values (for example, generating synthetic ages based on a real distribution).</p></li>
</ul>
</li>
<li><p><strong>No seed dataset?</strong></p>
<p>If you do not have real data to start with, you can use the <em>Faker</em> package (<a class="reference external" href="https://faker.readthedocs.io/">Faker</a>). <em>Faker</em> provides many generators for structured data such as names, addresses, dates, countries, and phone numbers. Use this to quickly create dummy datasets with any schema, though the values will not reflect empirical sources.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Choosing whether to use a seed dataset or a synthetic generator depends on your use case.</p>
<ul class="simple">
<li><p>For data realism and statistical fidelity, start from a seed dataset.</p></li>
<li><p>For flexible or arbitrary data structures without statistical constraints, use <em>Faker</em> or similar tools.</p></li>
</ul>
</div>
</section>
<section id="target-schema-and-feature-properties">
<h2>Target schema and feature properties<a class="headerlink" href="#target-schema-and-feature-properties" title="Permalink to this heading">#</a></h2>
<p>The following table summarizes the type, synthesis method, and key properties or constraints for each feature:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Feature</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Interp./Extrap.</p></th>
<th class="head"><p>Method or constraint</p></th>
<th class="head"><p>Distribution target</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>customer_type</p></td>
<td><p>cat</p></td>
<td><p>Interpolation</p></td>
<td><p>Sampled with empirical (seed) univariate
distribution</p></td>
<td><p>Preserve univariate</p></td>
</tr>
<tr class="row-odd"><td><p>customer_name</p></td>
<td><p>string</p></td>
<td><p>Extrapolation</p></td>
<td><p>Use <code class="docutils literal notranslate"><span class="pre">fake.name()</span></code> if individual, else
<code class="docutils literal notranslate"><span class="pre">fake.company()</span></code></p></td>
<td><p>/</p></td>
</tr>
<tr class="row-even"><td><p>region</p></td>
<td><p>cat</p></td>
<td><p>Interpolation</p></td>
<td><p>Choice among [EMEA, JAPAC, LAD, NA]</p></td>
<td><p>/</p></td>
</tr>
<tr class="row-odd"><td><p>country</p></td>
<td><p>cat</p></td>
<td><p>Interpolation</p></td>
<td><p>Based on mapping from region; randomly
select among possible countries in region</p></td>
<td><p>Coherency: region</p></td>
</tr>
<tr class="row-even"><td><p>customer_net_worth</p></td>
<td><p>num</p></td>
<td><p>Interpolation</p></td>
<td><p>Sampled from joint empirical distribution
with region</p></td>
<td><p>Joint: region</p></td>
</tr>
<tr class="row-odd"><td><p>loan_value</p></td>
<td><p>num</p></td>
<td><p>Interpolation</p></td>
<td><p>Sampled from joint empirical distribution
with region</p></td>
<td><p>Joint: region</p></td>
</tr>
<tr class="row-even"><td><p>loan_proposed_interest</p></td>
<td><p>num</p></td>
<td><p>Interpolation</p></td>
<td><p>Sampled from joint empirical distribution
with region</p></td>
<td><p>Joint: region</p></td>
</tr>
<tr class="row-odd"><td><p>loan_reason</p></td>
<td><p>cat</p></td>
<td><p>Interpolation</p></td>
<td><p>Sampled with empirical (seed) univariate
distribution</p></td>
<td><p>Preserve univariate</p></td>
</tr>
<tr class="row-even"><td><p>justification</p></td>
<td><p>string</p></td>
<td><p>Extrapolation</p></td>
<td><p>Long text generation</p></td>
<td><p>Coherency with other
fields</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p><strong>Interp./Extrap.:</strong> Indicates if the feature is synthesized from existing (seed) values (interpolation) or from new, plausible values (extrapolation).</p></li>
<li><p><strong>Method or constraint:</strong> Specifies any specialized synthesis function or logic, including use of <em>Faker</em>.</p></li>
</ul>
</section>
<section id="load-and-inspect-the-seed-data">
<h2>Load and inspect the seed data<a class="headerlink" href="#load-and-inspect-the-seed-data" title="Permalink to this heading">#</a></h2>
<p>Begin by loading your seed dataset. This data provides distributions, feature values, and coherency patterns for synthetic data generation. For demonstration, the following example defines a small seed dataset matching the target schema above, but you can use your own data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">seed_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;organization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Atlas Engineering Ltd.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;EMEA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Germany&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">75200000</span><span class="p">,</span>
        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">12500000</span><span class="p">,</span>
        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">4.9</span><span class="p">,</span>
        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Business expansion&quot;</span><span class="p">,</span>
        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Atlas Engineering Ltd. seeks a $12,500,000 loan at a proposed 4.9</span><span class="si">% i</span><span class="s2">nterest to expand its operations across the German automotive sector. With a robust net worth of $75,200,000 and a history of successful project delivery, the company is poised for growth. The expansion will create new jobs and increase market share, while our solid financials and collateral provide strong assurance. This aligns with our strategic business roadmap and justifies a favorable interest rate approval.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;individual&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Samantha Rivera&quot;</span><span class="p">,</span>
        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;NA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;United States&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">1580000</span><span class="p">,</span>
        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">80000</span><span class="p">,</span>
        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">,</span>
        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Home renovation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Samantha Rivera requests a $80,000 loan at 3.5</span><span class="si">% i</span><span class="s2">nterest to renovate her primary residence. With a net worth of $1,580,000 and stable income, Samantha’s credit profile is strong. The renovation will enhance her property value, reducing default risk. Given her responsible financial management and the secured nature of the loan, she is a low-risk borrower deserving of these favorable terms.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;organization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;MedicoPharma Solutions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;JAPAC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Singapore&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">18500000</span><span class="p">,</span>
        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">4500000</span><span class="p">,</span>
        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">5.7</span><span class="p">,</span>
        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Investment capital&quot;</span><span class="p">,</span>
        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;MedicoPharma Solutions applies for a $4,500,000 loan at a 5.7</span><span class="si">% r</span><span class="s2">ate to fund critical biotech investments. With a net worth of $18,500,000 and consistent year-over-year growth, the company demonstrates fiscal responsibility. The requested capital is earmarked for new laboratory equipment and R&amp;D, supporting innovation and future revenue. The loan structure and interest rate are well-justified by the company&#39;s planned implementations and financial record.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;individual&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Rajeev Malhotra&quot;</span><span class="p">,</span>
        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;JAPAC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;India&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">280000</span><span class="p">,</span>
        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">42000</span><span class="p">,</span>
        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">4.2</span><span class="p">,</span>
        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Education costs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Rajeev Malhotra is seeking a $42,000 loan at 4.2</span><span class="si">% i</span><span class="s2">nterest to pursue a postgraduate program in Bangalore. With a net worth of $280,000 and a stable employment history, Rajeev is committed to investing in his education for career advancement. The loan will cover tuition and related expenses, and his repayment plan is backed by projected post-graduation earnings, warranting an approval at this rate.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;organization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Green Horizons Ltd.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;LAD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Brazil&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">6270000</span><span class="p">,</span>
        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">1300000</span><span class="p">,</span>
        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">5.2</span><span class="p">,</span>
        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Major appliance&quot;</span><span class="p">,</span>
        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Green Horizons Ltd. is requesting a $1,300,000 loan with a 5.2% proposed interest rate to acquire industrial-scale solar panel systems for its new facility. With a net worth of $6,270,000, the organization’s history in sustainable development makes this investment logical. The equipment will reduce operational costs and support environmental commitments, providing a compelling rationale for loan approval.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;individual&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Lucia González&quot;</span><span class="p">,</span>
        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;LAD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Argentina&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">98000</span><span class="p">,</span>
        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">19000</span><span class="p">,</span>
        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">6.0</span><span class="p">,</span>
        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Debt consolidation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Lucia González seeks a $19,000 loan at 6.0</span><span class="si">% i</span><span class="s2">nterest to consolidate existing debts into a single manageable payment. With a net worth of $98,000 and steady monthly income, Lucia will benefit from simplified repayment terms and reduced overall interest expenses. Her disciplined repayment record supports the requested terms and merits consideration.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;organization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;BlueStar Trading GmbH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;EMEA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Switzerland&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">26000000</span><span class="p">,</span>
        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">6200000</span><span class="p">,</span>
        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">3.3</span><span class="p">,</span>
        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Vehicle purchase&quot;</span><span class="p">,</span>
        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;BlueStar Trading GmbH is applying for a $6,200,000 loan at 3.3</span><span class="si">% i</span><span class="s2">nterest to upgrade its commercial vehicle fleet in Switzerland. Backed by a $26,000,000 net worth and healthy balance sheet, the acquisition will improve logistics and lower operational costs. Their creditworthiness and the use of vehicles as collateral minimize risk, justifying loan approval at this competitive rate.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;individual&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Fatima Al-Hassan&quot;</span><span class="p">,</span>
        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;EMEA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;United Arab Emirates&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">1200000</span><span class="p">,</span>
        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">38000</span><span class="p">,</span>
        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">3.9</span><span class="p">,</span>
        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Vacation funding&quot;</span><span class="p">,</span>
        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Fatima Al-Hassan requests a $38,000 loan at a 3.9</span><span class="si">% i</span><span class="s2">nterest rate to cover a family vacation abroad. With a net worth of $1,200,000 and a solid credit score, she is well-positioned to repay the loan comfortably. Her responsible financial history further supports approval at the proposed rate for this short-term, purpose-specific loan.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;organization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Aussie Urban Properties&quot;</span><span class="p">,</span>
        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;JAPAC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Australia&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">51200000</span><span class="p">,</span>
        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">9700000</span><span class="p">,</span>
        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">4.5</span><span class="p">,</span>
        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Business expansion&quot;</span><span class="p">,</span>
        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Aussie Urban Properties seeks $9,700,000 in funding at a 4.5</span><span class="si">% i</span><span class="s2">nterest rate to finance new residential developments in Sydney. With a net worth of $51,200,000 and proven experience in property management, the loan will be efficiently applied. The company’s past successes and robust financial health point to a strong ability to utilize and repay the loan as proposed.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;individual&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Jacob Peterson&quot;</span><span class="p">,</span>
        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;NA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Canada&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">405000</span><span class="p">,</span>
        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">31000</span><span class="p">,</span>
        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">2.7</span><span class="p">,</span>
        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Medical expenses&quot;</span><span class="p">,</span>
        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Jacob Peterson is requesting a $31,000 loan at 2.7</span><span class="si">% i</span><span class="s2">nterest to cover medical expenses resulting from an unexpected surgery. With a net worth of $405,000 and reliable employment, Jacob demonstrates strong repayment capacity. His consistent repayment track record and insurance partial coverage will mitigate lender risk, supporting approval at this attractive rate.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">df_seed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">seed_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_seed</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="data-synthesis">
<h2>Data synthesis<a class="headerlink" href="#data-synthesis" title="Permalink to this heading">#</a></h2>
<section id="synthesis-functions">
<h3>Synthesis functions<a class="headerlink" href="#synthesis-functions" title="Permalink to this heading">#</a></h3>
<p>Define Python functions to generate feature values according to empirical distributions and project-specific constraints.</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fake_categorical</span></code>: Sample a categorical column by seed frequency
It uses NumPy to reproduce marginal distributions.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>


<span class="k">def</span><span class="w"> </span><span class="nf">fake_categorical</span><span class="p">(</span>
    <span class="n">rng</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">,</span>
    <span class="n">pd_column</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">dropna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">choice_kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="n">value_counts_dict</span> <span class="o">=</span> <span class="n">pd_column</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="n">categories</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value_counts_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value_counts_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">probabilities</span><span class="p">,</span> <span class="o">**</span><span class="n">choice_kwargs</span><span class="p">)</span>


</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p><code class="docutils literal notranslate"><span class="pre">fake_joint_numerical</span></code>: Sample a numerical feature by joint distribution
It samples values for a numerical feature conditional on one or more categorical features (for example, <code class="docutils literal notranslate"><span class="pre">customer_net_worth</span></code> conditioned on region).</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fake_joint_numerical</span><span class="p">(</span>
    <span class="n">rng</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">value_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cat_cols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">synthesized_rows</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cat_array</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">synthesized_rows</span><span class="p">[</span><span class="n">cat_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="k">else</span> <span class="n">synthesized_rows</span><span class="p">[[</span><span class="n">cat_cols</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">cats</span> <span class="ow">in</span> <span class="n">cat_array</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">,</span> <span class="n">cats</span><span class="p">):</span>
                <span class="n">mask</span> <span class="o">&amp;=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">&amp;=</span> <span class="n">df</span><span class="p">[</span><span class="n">cat_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">cats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">matching_vals</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">value_col</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matching_vals</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">matching_vals</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fallback: overall empirical</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">value_col</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">result</span>


</pre></div>
</div>
</section>
</section>
<section id="structured-data-generation">
<h2>Structured data generation<a class="headerlink" href="#structured-data-generation" title="Permalink to this heading">#</a></h2>
<p>Each section below demonstrates how to synthesize features while upholding a specific property. After each example, synthesize all other features by specification.</p>
<section id="reproducibility">
<h3>Reproducibility<a class="headerlink" href="#reproducibility" title="Permalink to this heading">#</a></h3>
<p>Set seeds for all relevant random number generators to make synthesis repeatable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">faker</span><span class="w"> </span><span class="kn">import</span> <span class="n">Faker</span>

<span class="n">SEED</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">fake</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span>
<span class="n">Faker</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">SEED</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="generation-configuration">
<h3>Generation configuration<a class="headerlink" href="#generation-configuration" title="Permalink to this heading">#</a></h3>
<p>Configure the synthetic data generation process.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n_synthesized</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># adjust as needed</span>
</pre></div>
</div>
</section>
<section id="univariate-distribution-preservation-example-region">
<h3>Univariate distribution preservation example (region)<a class="headerlink" href="#univariate-distribution-preservation-example-region" title="Permalink to this heading">#</a></h3>
<p>Sample the <code class="docutils literal notranslate"><span class="pre">region</span></code> column according to the frequency distribution in the seed dataset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">synth_region</span> <span class="o">=</span> <span class="n">fake_categorical</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n_synthesized</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">synth_region</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="c1"># EMEA     7</span>
<span class="c1"># LAD      6</span>
<span class="c1"># NA       4</span>
<span class="c1"># JAPAC    3</span>
<span class="c1"># Name: count, dtype: int64</span>
</pre></div>
</div>
</section>
<section id="coherency-constraint-example-region-vs-country">
<h3>Coherency constraint example (region vs. country)<a class="headerlink" href="#coherency-constraint-example-region-vs-country" title="Permalink to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">country</span></code> and <code class="docutils literal notranslate"><span class="pre">region</span></code> must be coherent: each country should map to its correct business region.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">region_country_map</span> <span class="o">=</span> <span class="n">df_seed</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">synth_country</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">synth_region</span><span class="p">:</span>
    <span class="n">possible_countries</span> <span class="o">=</span> <span class="n">region_country_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">synth_country</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">possible_countries</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">synth_region</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">synth_country</span><span class="p">[:</span><span class="mi">10</span><span class="p">])))</span>
<span class="c1"># [(&#39;NA&#39;, &#39;United States&#39;),</span>
<span class="c1">#  (&#39;EMEA&#39;, &#39;Germany&#39;),</span>
<span class="c1">#  (&#39;EMEA&#39;, &#39;Germany&#39;),</span>
<span class="c1">#  (&#39;EMEA&#39;, &#39;Germany&#39;),</span>
<span class="c1">#  (&#39;LAD&#39;, &#39;Brazil&#39;),</span>
<span class="c1">#  (&#39;LAD&#39;, &#39;Argentina&#39;),</span>
<span class="c1">#  (&#39;NA&#39;, &#39;Canada&#39;),</span>
<span class="c1">#  (&#39;NA&#39;, &#39;Canada&#39;),</span>
<span class="c1">#  (&#39;JAPAC&#39;, &#39;Singapore&#39;),</span>
<span class="c1">#  (&#39;LAD&#39;, &#39;Argentina&#39;)]</span>
</pre></div>
</div>
</section>
<section id="joint-distribution-example-customer-net-worth-region">
<h3>Joint distribution example (customer_net_worth | region)<a class="headerlink" href="#joint-distribution-example-customer-net-worth-region" title="Permalink to this heading">#</a></h3>
<p>Synthesize <code class="docutils literal notranslate"><span class="pre">customer_net_worth</span></code> values respecting the empirical joint distribution over <code class="docutils literal notranslate"><span class="pre">region</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">demo_rows</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">synth_region</span><span class="p">})</span>
<span class="n">synth_customer_net_worth</span> <span class="o">=</span> <span class="n">fake_joint_numerical</span><span class="p">(</span>
    <span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">,</span> <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">],</span> <span class="n">demo_rows</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">synth_customer_net_worth</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
<span class="c1"># count    2.000000e+01</span>
<span class="c1"># mean     1.431880e+07</span>
<span class="c1"># std      2.174939e+07</span>
<span class="c1"># min      9.800000e+04</span>
<span class="c1"># 25%      4.050000e+05</span>
<span class="c1"># 50%      3.735000e+06</span>
<span class="c1"># 75%      2.600000e+07</span>
<span class="c1"># max      7.520000e+07</span>
<span class="c1"># dtype: float64</span>
</pre></div>
</div>
</section>
<section id="extrapolation-new-values-example-customer-name">
<h3>Extrapolation (new values) example (customer_name)<a class="headerlink" href="#extrapolation-new-values-example-customer-name" title="Permalink to this heading">#</a></h3>
<p>Use <em>Faker</em> to synthesize new individual names or company names, even if not present in the seed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">synth_customer_type</span> <span class="o">=</span> <span class="n">fake_categorical</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">[</span><span class="s2">&quot;customer_type&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n_synthesized</span><span class="p">)</span>
<span class="n">synth_customer_name</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">fake</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="k">if</span> <span class="n">ct</span> <span class="o">==</span> <span class="s2">&quot;individual&quot;</span> <span class="k">else</span> <span class="n">fake</span><span class="o">.</span><span class="n">company</span><span class="p">()</span> <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">synth_customer_type</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">synth_customer_name</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
<span class="c1"># [&#39;Norma Fisher&#39;,</span>
<span class="c1">#  &#39;Sheppard-Tucker&#39;,</span>
<span class="c1">#  &#39;Sandra Faulkner&#39;,</span>
<span class="c1">#  &#39;Silva-Odonnell&#39;,</span>
<span class="c1">#  &#39;Taylor, Taylor and Davis&#39;,</span>
<span class="c1">#  &#39;Victoria Patel&#39;,</span>
<span class="c1">#  &#39;Patrick, Barrera and Collins&#39;,</span>
<span class="c1">#  &#39;Stephanie Sutton&#39;,</span>
<span class="c1">#  &#39;Castro-Gomez&#39;,</span>
<span class="c1">#  &#39;Martin Harris&#39;]</span>
</pre></div>
</div>
</section>
<section id="synthesizing-remaining-structured-features-according-to-property-table">
<h3>Synthesizing remaining structured features according to property table<a class="headerlink" href="#synthesizing-remaining-structured-features-according-to-property-table" title="Permalink to this heading">#</a></h3>
<p>With each property demonstrated, now synthesize the remaining structured features as specified above.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.property</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnyProperty</span><span class="p">,</span> <span class="n">IntegerProperty</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.steps</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToolExecutionStep</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServerTool</span>


<span class="k">def</span><span class="w"> </span><span class="nf">synthesize_structured_features</span><span class="p">(</span>
    <span class="n">df_seed</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">n_synthesized</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">fake</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span>
    <span class="n">fake</span><span class="o">.</span><span class="n">seed_instance</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">synth_loan_reason</span> <span class="o">=</span> <span class="n">fake_categorical</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">[</span><span class="s2">&quot;loan_reason&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n_synthesized</span><span class="p">)</span>
    <span class="n">synth_region_full</span> <span class="o">=</span> <span class="n">fake_categorical</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n_synthesized</span><span class="p">)</span>
    <span class="n">synth_customer_type_full</span> <span class="o">=</span> <span class="n">fake_categorical</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">[</span><span class="s2">&quot;customer_type&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n_synthesized</span><span class="p">)</span>
    <span class="n">region_country_map</span> <span class="o">=</span> <span class="n">df_seed</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="n">synth_country_full</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">synth_region_full</span><span class="p">:</span>
        <span class="n">possible_countries</span> <span class="o">=</span> <span class="n">region_country_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">synth_country_full</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">possible_countries</span><span class="p">))</span>
    <span class="n">synth_rows_for_joint</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">synth_region_full</span><span class="p">})</span>
    <span class="n">synth_customer_net_worth_full</span> <span class="o">=</span> <span class="n">fake_joint_numerical</span><span class="p">(</span>
        <span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">,</span> <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">],</span> <span class="n">synth_rows_for_joint</span>
    <span class="p">)</span>
    <span class="n">synth_loan_value_full</span> <span class="o">=</span> <span class="n">fake_joint_numerical</span><span class="p">(</span>
        <span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">,</span> <span class="s2">&quot;loan_value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">],</span> <span class="n">synth_rows_for_joint</span>
    <span class="p">)</span>
    <span class="n">synth_loan_proposed_interest_full</span> <span class="o">=</span> <span class="n">fake_joint_numerical</span><span class="p">(</span>
        <span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">,</span> <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">],</span> <span class="n">synth_rows_for_joint</span>
    <span class="p">)</span>
    <span class="n">synth_customer_name_full</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">fake</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="k">if</span> <span class="n">ct</span> <span class="o">==</span> <span class="s2">&quot;individual&quot;</span> <span class="k">else</span> <span class="n">fake</span><span class="o">.</span><span class="n">company</span><span class="p">()</span> <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">synth_customer_type_full</span>
    <span class="p">]</span>
    <span class="n">df_synthesized</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="n">synth_customer_type_full</span><span class="p">,</span>
            <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="n">synth_customer_name_full</span><span class="p">,</span>
            <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">synth_region_full</span><span class="p">,</span>
            <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="n">synth_country_full</span><span class="p">,</span>
            <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="n">synth_loan_reason</span><span class="p">,</span>
            <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="n">synth_customer_net_worth_full</span><span class="p">,</span>
            <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="n">synth_loan_value_full</span><span class="p">,</span>
            <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="n">synth_loan_proposed_interest_full</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">df_synthesized</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_synthesize_structured_features_step</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ToolExecutionStep</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">ToolExecutionStep</span><span class="p">(</span>
        <span class="n">tool</span><span class="o">=</span><span class="n">ServerTool</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;synthesize_structured_features&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Synthesize all structured features&quot;</span><span class="p">,</span>
            <span class="n">func</span><span class="o">=</span><span class="n">synthesize_structured_features</span><span class="p">,</span>
            <span class="n">input_descriptors</span><span class="o">=</span><span class="p">[</span>
                <span class="n">AnyProperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;df_seed&quot;</span><span class="p">),</span>
                <span class="n">IntegerProperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;n_synthesized&quot;</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
                <span class="n">IntegerProperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;seed&quot;</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="n">output_descriptors</span><span class="o">=</span><span class="p">[</span><span class="n">AnyProperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;df_synthesized&quot;</span><span class="p">)],</span>
        <span class="p">),</span>
        <span class="n">raise_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>


</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.flowhelpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_single_step_flow</span>

<span class="n">flow</span> <span class="o">=</span> <span class="n">create_single_step_flow</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">get_synthesize_structured_features_step</span><span class="p">())</span>
<span class="n">conv</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;df_seed&quot;</span><span class="p">:</span> <span class="n">df_seed</span><span class="p">,</span> <span class="s2">&quot;n_synthesized&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">conv</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="n">df_synthesized</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">output_values</span><span class="p">[</span><span class="s2">&quot;df_synthesized&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_synthesized</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="verification-sanity-checks-and-distribution-comparison">
<h2>Verification: sanity checks and distribution comparison<a class="headerlink" href="#verification-sanity-checks-and-distribution-comparison" title="Permalink to this heading">#</a></h2>
<p>Compare value counts and distributions for select features, and compare them to the original seed dataset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Synthesized region distribution:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_synthesized</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="c1"># Synthesized region distribution:</span>
<span class="c1"># JAPAC    46</span>
<span class="c1"># LAD      38</span>
<span class="c1"># EMEA     36</span>
<span class="c1"># NA       30</span>
<span class="c1"># Name: count, dtype: int64</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Seed region distribution:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_seed</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="c1"># Seed region distribution:</span>
<span class="c1"># EMEA     3</span>
<span class="c1"># JAPAC    3</span>
<span class="c1"># NA       2</span>
<span class="c1"># LAD      2</span>
<span class="c1"># Name: count, dtype: int64</span>
</pre></div>
</div>
</section>
<section id="long-text-generation">
<h2>Long text generation<a class="headerlink" href="#long-text-generation" title="Permalink to this heading">#</a></h2>
<p>To generate realistic business justifications for each record, you will use a language model (LLM) as part of your synthesis workflow. This section explains the configuration of the LLM, describes the prompts and parsing logic, outlines the flow definition, and demonstrates parallelized generation and validation.</p>
<section id="llm-selection-and-initialization">
<h3>LLM selection and initialization<a class="headerlink" href="#llm-selection-and-initialization" title="Permalink to this heading">#</a></h3>
<p>For long text generation, you need to use an LLM.
WayFlow supports several LLM providers. Select and configure your LLM below:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">OCI GenAI</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">vLLM</button><button aria-controls="panel-0-0-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-2" name="0-2" role="tab" tabindex="-1">Ollama</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">OCIGenAIModel</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">llm</span> <span class="o">=</span> <span class="n">OCIGenAIModel</span><span class="p">(</span>
        <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;provider.model-id&quot;</span><span class="p">,</span>
        <span class="n">service_endpoint</span><span class="o">=</span><span class="s2">&quot;https://url-to-service-endpoint.com&quot;</span><span class="p">,</span>
        <span class="n">compartment_id</span><span class="o">=</span><span class="s2">&quot;compartment-id&quot;</span><span class="p">,</span>
        <span class="n">auth_type</span><span class="o">=</span><span class="s2">&quot;API_KEY&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">VllmModel</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">VllmModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;model-id&quot;</span><span class="p">,</span>
    <span class="n">host_port</span><span class="o">=</span><span class="s2">&quot;VLLM_HOST_PORT&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-2" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-2" name="0-2" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">OllamaModel</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">OllamaModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;model-id&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div></div>
</section>
<section id="prompt-and-i-o-constants">
<h3>Prompt and I/O constants<a class="headerlink" href="#prompt-and-i-o-constants" title="Permalink to this heading">#</a></h3>
<p>Begin by defining the necessary output constants and prompts used to instruct the LLM and structure the flow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Define I/O constants and step names</span>
<span class="n">JUSTIFICATION_GEN_IO</span> <span class="o">=</span> <span class="s2">&quot;JUSTIFICATION_GEN_IO&quot;</span>
<span class="n">JUSTIFICATION_PARSING_IO</span> <span class="o">=</span> <span class="s2">&quot;JUSTIFICATION_PARSING_IO&quot;</span>
<span class="n">VALIDATION_IO</span> <span class="o">=</span> <span class="s2">&quot;VALIDATION_IO&quot;</span>
<span class="n">VALIDATION_PARSING_IO</span> <span class="o">=</span> <span class="s2">&quot;VALIDATION_PARSING_IO&quot;</span>

<span class="n">JUSTIFICATION_GEN_STEP</span> <span class="o">=</span> <span class="s2">&quot;JUSTIFICATION_GEN_STEP&quot;</span>
<span class="n">JUSTIFICATION_PARSING_STEP</span> <span class="o">=</span> <span class="s2">&quot;JUSTIFICATION_PARSING_STEP&quot;</span>
<span class="n">VALIDATION_STEP</span> <span class="o">=</span> <span class="s2">&quot;VALIDATION_STEP&quot;</span>
<span class="n">VALIDATION_PARSING_STEP</span> <span class="o">=</span> <span class="s2">&quot;VALIDATION_PARSING_STEP&quot;</span>

<span class="c1"># Define prompts</span>
<span class="n">JUSTIFICATION_PROMPT</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">## Context</span>
<span class="s2">You are an assistant that helps the business with loan applications.</span>


<span class="s2">## Task</span>
<span class="s2">Write a justification for a loan application, given certain customer data points.</span>
<span class="s2">The justification should be concise and detailed, and include all infomration that could be relevant for the loan application.</span>
<span class="s2">As an intermediate step before writing the justification, provide a reasoning section consisting of facts, arguments or any other relevant data that would help you with writing the justification.</span>


<span class="s2">## Example</span>
<span class="s2">Below is an example of the input data points and how they are structured, and an output justitifcation. Note that in this example the reasoning section has been omitted.</span>

<span class="s2">Customer: {{ seed_example[&#39;customer_name&#39;] }} (type = {{ seed_example[&#39;customer_type&#39;] }})</span>
<span class="s2">Location: {{ seed_example[&#39;region&#39;] }}, {{ seed_example[&#39;country&#39;] }}</span>
<span class="s2">Customer Net Worth: {{ seed_example[&#39;customer_net_worth&#39;] }}</span>
<span class="s2">Loan: {{ seed_example[&#39;loan_value&#39;] }} at {{ seed_example[&#39;loan_proposed_interest&#39;] }} interest</span>
<span class="s2">Purpose: {{ seed_example[&#39;loan_reason&#39;] }}</span>

<span class="s2">Justification: {{ seed_example[&#39;justification&#39;] }}</span>


<span class="s2">## Data</span>
<span class="s2">Below are the input data points based on which you have to write the justification.</span>

<span class="s2">Customer: {{ generated_row[&#39;customer_name&#39;] }} (type = {{ generated_row[&#39;customer_type&#39;] }})</span>
<span class="s2">Location: {{ generated_row[&#39;region&#39;] }}, {{ generated_row[&#39;country&#39;] }}</span>
<span class="s2">Customer Net Worth: {{ generated_row[&#39;customer_net_worth&#39;] }}</span>
<span class="s2">Loan: {{ generated_row[&#39;loan_value&#39;] }} at {{ generated_row[&#39;loan_proposed_interest&#39;] }} interest</span>
<span class="s2">Purpose: {{ generated_row[&#39;loan_reason&#39;] }}</span>


<span class="s2">## Insturctions</span>
<span class="s2">You must follow these guidelines:</span>
<span class="s2">- The tone, length and level of details in your justification are similarly aligned with the provided example</span>
<span class="s2">- The justification must be solely based on the provided data points</span>
<span class="s2">- The justification must be written around the `Purpose` data point</span>
<span class="s2">- The language should be professional and business-appropriate</span>
<span class="s2">- Include any specific financial details if relevant</span>

<span class="s2">The output must stricly follow the exacty format as below:</span>
<span class="s2">Reasoning: &lt;fill this section with any facts or arguments relevant to the justification&gt;</span>
<span class="s2">Justification: &lt;fill this section with the justification&gt;</span>


<span class="s2">## Output</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>


<span class="n">VALIDATION_PROMPT</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">## Context</span>
<span class="s2">You are an assistant that helps the bank evaluate loan applications.</span>


<span class="s2">## Task</span>
<span class="s2">Evaluate the quality and plausibility of a loan justification against provided application data points of the customer.</span>
<span class="s2">The evaluation has to consider the folllowing criteria:</span>
<span class="s2">1. Factual accuracy: All amounts, names, and details in the justification match the provided customer data points</span>
<span class="s2">2. Logical consistency: The reasoning aligns with customer profile and loan parameters</span>
<span class="s2">3. Realism: The justification is plausible for this type of loan application</span>
<span class="s2">4. Professional tone: The justification is written in business-appropriate language, and follows a coherent and logical structure</span>
<span class="s2">5. Completeness: The justification adequately addresses the loan reason and key factors</span>


<span class="s2">## Example</span>
<span class="s2">Below is an example of how the input data should look like. It starts with the customer data points and ends with the loan justification.</span>

<span class="s2">Customer: {{ seed_example[&#39;customer_name&#39;] }} (type = {{ seed_example[&#39;customer_type&#39;] }})</span>
<span class="s2">Location: {{ seed_example[&#39;region&#39;] }}, {{ seed_example[&#39;country&#39;] }}</span>
<span class="s2">Customer Net Worth: {{ seed_example[&#39;customer_net_worth&#39;] }}</span>
<span class="s2">Loan: {{ seed_example[&#39;loan_value&#39;] }} at {{ seed_example[&#39;loan_proposed_interest&#39;] }} interest</span>
<span class="s2">Purpose: {{ seed_example[&#39;loan_reason&#39;] }}</span>

<span class="s2">Justification: {{ seed_example[&#39;justification&#39;] }}</span>


<span class="s2">## Data</span>
<span class="s2">Below is the input data for the current loan application you need to analyze.</span>

<span class="s2">Customer: {{ generated_row[&#39;customer_name&#39;] }} (type = {{ generated_row[&#39;customer_type&#39;] }})</span>
<span class="s2">Location: {{ generated_row[&#39;region&#39;] }}, {{ generated_row[&#39;country&#39;] }}</span>
<span class="s2">Customer Net Worth: {{ generated_row[&#39;customer_net_worth&#39;] }}</span>
<span class="s2">Loan: {{ generated_row[&#39;loan_value&#39;] }} at {{ generated_row[&#39;loan_proposed_interest&#39;]}} interest</span>
<span class="s2">Purpose: {{ generated_row[&#39;loan_reason&#39;] }}</span>

<span class="s2">Justification: {{ justification }}</span>


<span class="s2">## Instructions</span>
<span class="s2">You must follow these guidelines:</span>
<span class="s2">- All evaluation criteria must be assessed</span>
<span class="s2">- Each evaluation criterion must be assessed solely based on the currently provided data points</span>
<span class="s2">- If a criterion cannot be confidently assessed based on the provided data points, say so</span>
<span class="s2">- Keep the evaluation reasoning short and concise</span>

<span class="s2">After all criteria have been assessed, you must end your answer with a verdict. The verdict must be in uppercase letters, and the list of possible verdicts and their formats is provided below:</span>
<span class="s2">- VALID (if the justification meets all evaluation criteria)</span>
<span class="s2">- INVALID: &lt;reasoning&gt; (if the justification fails any criteria, list them and provide short reasoning)</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="parsing-functions">
<h3>Parsing functions<a class="headerlink" href="#parsing-functions" title="Permalink to this heading">#</a></h3>
<p>Parsing functions are responsible for extracting and normalizing the LLM outputs produced during justification and validation steps:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">parse_cot_justification_output</span><span class="p">(</span><span class="n">llm_output</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">llm_output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Justification:&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Justification is not provided&quot;</span>
    <span class="k">return</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">parse_validation_output</span><span class="p">(</span><span class="n">llm_output</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="s2">&quot;INVALID&quot;</span> <span class="ow">in</span> <span class="n">llm_output</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="s2">&quot;VALID&quot;</span> <span class="ow">in</span> <span class="n">llm_output</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
</section>
<section id="justification-generation-flow-definition">
<h3>Justification generation flow definition<a class="headerlink" href="#justification-generation-flow-definition" title="Permalink to this heading">#</a></h3>
<p>This flow defines a multi-step pipeline for generation, parsing, validation, and conditional retry of business justifications:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.controlconnection</span><span class="w"> </span><span class="kn">import</span> <span class="n">ControlFlowEdge</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models.llmgenerationconfig</span><span class="w"> </span><span class="kn">import</span> <span class="n">LlmGenerationConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.steps</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompleteStep</span><span class="p">,</span> <span class="n">PromptExecutionStep</span><span class="p">,</span> <span class="n">RetryStep</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_justification_generation_step</span><span class="p">(</span><span class="n">llm</span><span class="p">:</span> <span class="n">LlmModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PromptExecutionStep</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">PromptExecutionStep</span><span class="p">(</span>
        <span class="n">prompt_template</span><span class="o">=</span><span class="n">JUSTIFICATION_PROMPT</span><span class="p">,</span>
        <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="o">=</span><span class="n">LlmGenerationConfig</span><span class="p">(</span><span class="n">max_tokens</span><span class="o">=</span><span class="mi">2048</span><span class="p">),</span>
        <span class="n">input_mapping</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;seed_example&quot;</span><span class="p">:</span> <span class="s2">&quot;seed_example&quot;</span><span class="p">,</span>
            <span class="s2">&quot;generated_row&quot;</span><span class="p">:</span> <span class="s2">&quot;generated_row&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">output_mapping</span><span class="o">=</span><span class="p">{</span><span class="n">PromptExecutionStep</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">:</span> <span class="n">JUSTIFICATION_GEN_IO</span><span class="p">},</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_parse_justification_step</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ToolExecutionStep</span><span class="p">:</span>
    <span class="n">tool</span> <span class="o">=</span> <span class="n">ServerTool</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;parse_cot_justification_output&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Parsing the specific LLM output of the justification generation step.&quot;</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;llm_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Output from justification generation step.&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="n">func</span><span class="o">=</span><span class="n">parse_cot_justification_output</span><span class="p">,</span>
        <span class="n">output</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">ToolExecutionStep</span><span class="p">(</span>
        <span class="n">tool</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span>
        <span class="n">input_mapping</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;llm_output&quot;</span><span class="p">:</span> <span class="n">JUSTIFICATION_GEN_IO</span><span class="p">},</span>
        <span class="n">output_mapping</span><span class="o">=</span><span class="p">{</span><span class="n">ToolExecutionStep</span><span class="o">.</span><span class="n">TOOL_OUTPUT</span><span class="p">:</span> <span class="n">JUSTIFICATION_PARSING_IO</span><span class="p">},</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_validation_step</span><span class="p">(</span><span class="n">llm</span><span class="p">:</span> <span class="n">LlmModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PromptExecutionStep</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">PromptExecutionStep</span><span class="p">(</span>
        <span class="n">prompt_template</span><span class="o">=</span><span class="n">VALIDATION_PROMPT</span><span class="p">,</span>
        <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="o">=</span><span class="n">LlmGenerationConfig</span><span class="p">(</span><span class="n">max_tokens</span><span class="o">=</span><span class="mi">2048</span><span class="p">),</span>
        <span class="n">input_mapping</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;seed_example&quot;</span><span class="p">:</span> <span class="s2">&quot;seed_example&quot;</span><span class="p">,</span>
            <span class="s2">&quot;generated_row&quot;</span><span class="p">:</span> <span class="s2">&quot;generated_row&quot;</span><span class="p">,</span>
            <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="n">JUSTIFICATION_PARSING_IO</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">output_mapping</span><span class="o">=</span><span class="p">{</span><span class="n">PromptExecutionStep</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">:</span> <span class="n">VALIDATION_IO</span><span class="p">},</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_parse_validation_step</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ToolExecutionStep</span><span class="p">:</span>
    <span class="n">tool</span> <span class="o">=</span> <span class="n">ServerTool</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;parse_validation_output&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Parsing the specific LLM output of the validation step.&quot;</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;llm_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Output from validation step.&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="n">func</span><span class="o">=</span><span class="n">parse_validation_output</span><span class="p">,</span>
        <span class="n">output</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">ToolExecutionStep</span><span class="p">(</span>
        <span class="n">tool</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span>
        <span class="n">input_mapping</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;llm_output&quot;</span><span class="p">:</span> <span class="n">VALIDATION_IO</span><span class="p">},</span>
        <span class="n">output_mapping</span><span class="o">=</span><span class="p">{</span><span class="n">ToolExecutionStep</span><span class="o">.</span><span class="n">TOOL_OUTPUT</span><span class="p">:</span> <span class="n">VALIDATION_PARSING_IO</span><span class="p">},</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_retry_step</span><span class="p">(</span><span class="n">flow</span><span class="p">:</span> <span class="n">Flow</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RetryStep</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">RetryStep</span><span class="p">(</span>
        <span class="n">flow</span><span class="o">=</span><span class="n">flow</span><span class="p">,</span>
        <span class="n">success_condition</span><span class="o">=</span><span class="n">VALIDATION_PARSING_IO</span><span class="p">,</span>
        <span class="n">max_num_trials</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_main_flow</span><span class="p">(</span><span class="n">llm_justification</span><span class="p">:</span> <span class="n">LlmModel</span><span class="p">,</span> <span class="n">llm_validation</span><span class="p">:</span> <span class="n">LlmModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Flow</span><span class="p">:</span>
    <span class="n">justification_gen_step</span> <span class="o">=</span> <span class="n">get_justification_generation_step</span><span class="p">(</span><span class="n">llm_justification</span><span class="p">)</span>
    <span class="n">justification_parse_step</span> <span class="o">=</span> <span class="n">get_parse_justification_step</span><span class="p">()</span>
    <span class="n">validation_step</span> <span class="o">=</span> <span class="n">get_validation_step</span><span class="p">(</span><span class="n">llm_validation</span><span class="p">)</span>
    <span class="n">validation_parse_step</span> <span class="o">=</span> <span class="n">get_parse_validation_step</span><span class="p">()</span>

    <span class="n">steps</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">JUSTIFICATION_GEN_STEP</span><span class="p">:</span> <span class="n">justification_gen_step</span><span class="p">,</span>
        <span class="n">JUSTIFICATION_PARSING_STEP</span><span class="p">:</span> <span class="n">justification_parse_step</span><span class="p">,</span>
        <span class="n">VALIDATION_STEP</span><span class="p">:</span> <span class="n">validation_step</span><span class="p">,</span>
        <span class="n">VALIDATION_PARSING_STEP</span><span class="p">:</span> <span class="n">validation_parse_step</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">transitions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">JUSTIFICATION_GEN_STEP</span><span class="p">:</span> <span class="p">[</span><span class="n">JUSTIFICATION_PARSING_STEP</span><span class="p">],</span>
        <span class="n">JUSTIFICATION_PARSING_STEP</span><span class="p">:</span> <span class="p">[</span><span class="n">VALIDATION_STEP</span><span class="p">],</span>
        <span class="n">VALIDATION_STEP</span><span class="p">:</span> <span class="p">[</span><span class="n">VALIDATION_PARSING_STEP</span><span class="p">],</span>
        <span class="n">VALIDATION_PARSING_STEP</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">Flow</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span> <span class="n">begin_step</span><span class="o">=</span><span class="n">justification_gen_step</span><span class="p">,</span> <span class="n">transitions</span><span class="o">=</span><span class="n">transitions</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_flow</span><span class="p">(</span><span class="n">llm_justification</span><span class="p">:</span> <span class="n">LlmModel</span><span class="p">,</span> <span class="n">llm_validation</span><span class="p">:</span> <span class="n">LlmModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Flow</span><span class="p">:</span>
    <span class="n">main_flow</span> <span class="o">=</span> <span class="n">get_main_flow</span><span class="p">(</span><span class="n">llm_justification</span><span class="p">,</span> <span class="n">llm_validation</span><span class="p">)</span>
    <span class="n">retry_step</span> <span class="o">=</span> <span class="n">get_retry_step</span><span class="p">(</span><span class="n">main_flow</span><span class="p">)</span>
    <span class="n">success_step</span> <span class="o">=</span> <span class="n">CompleteStep</span><span class="p">()</span>
    <span class="n">failure_step</span> <span class="o">=</span> <span class="n">CompleteStep</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">Flow</span><span class="p">(</span>
        <span class="n">begin_step</span><span class="o">=</span><span class="n">retry_step</span><span class="p">,</span>
        <span class="n">steps</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">retry_step</span><span class="p">,</span>
            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="n">success_step</span><span class="p">,</span>
            <span class="s2">&quot;failure&quot;</span><span class="p">:</span> <span class="n">failure_step</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">control_flow_edges</span><span class="o">=</span><span class="p">[</span>
            <span class="n">ControlFlowEdge</span><span class="p">(</span>
                <span class="n">source_step</span><span class="o">=</span><span class="n">retry_step</span><span class="p">,</span>
                <span class="n">source_branch</span><span class="o">=</span><span class="n">retry_step</span><span class="o">.</span><span class="n">BRANCH_NEXT</span><span class="p">,</span>
                <span class="n">destination_step</span><span class="o">=</span><span class="n">success_step</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">ControlFlowEdge</span><span class="p">(</span>
                <span class="n">source_step</span><span class="o">=</span><span class="n">retry_step</span><span class="p">,</span>
                <span class="n">source_branch</span><span class="o">=</span><span class="n">retry_step</span><span class="o">.</span><span class="n">BRANCH_FAILURE</span><span class="p">,</span>
                <span class="n">destination_step</span><span class="o">=</span><span class="n">failure_step</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="batch-justification-generation-and-validation">
<h3>Batch justification generation and validation<a class="headerlink" href="#batch-justification-generation-and-validation" title="Permalink to this heading">#</a></h3>
<p>Finally, apply the justification generation flow in parallel over your dataset using a <cite>MapStep</cite> (for more information see <a class="reference internal" href="howto_mapstep.html"><span class="doc">How to Do Map and Reduce Operations in Flows</span></a>). This enables efficient batch generation and validation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.property</span><span class="w"> </span><span class="kn">import</span> <span class="n">ListProperty</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.steps</span><span class="w"> </span><span class="kn">import</span> <span class="n">MapStep</span>

<span class="n">flow</span> <span class="o">=</span> <span class="n">create_single_step_flow</span><span class="p">(</span>
    <span class="n">step</span><span class="o">=</span><span class="n">MapStep</span><span class="p">(</span>
        <span class="n">flow</span><span class="o">=</span><span class="n">get_flow</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="n">llm</span><span class="p">),</span>
        <span class="n">parallel_execution</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">unpack_input</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;seed_example&quot;</span><span class="p">:</span> <span class="s2">&quot;.seed_example&quot;</span><span class="p">,</span>
            <span class="s2">&quot;generated_row&quot;</span><span class="p">:</span> <span class="s2">&quot;.generated_row&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">output_descriptors</span><span class="o">=</span><span class="p">[</span><span class="n">ListProperty</span><span class="p">(</span><span class="n">JUSTIFICATION_PARSING_IO</span><span class="p">)],</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">input_sequence</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;seed_example&quot;</span><span class="p">:</span> <span class="n">df_seed</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
        <span class="s2">&quot;generated_row&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_synthesized</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
<span class="p">]</span>
<span class="n">conversation</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="n">MapStep</span><span class="o">.</span><span class="n">ITERATED_INPUT</span><span class="p">:</span> <span class="n">input_sequence</span><span class="p">})</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="n">df_synthesized</span><span class="p">[</span><span class="s2">&quot;justification&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">output_values</span><span class="p">[</span><span class="n">JUSTIFICATION_PARSING_IO</span><span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="synthetic-dataset-export">
<h2>Synthetic dataset export<a class="headerlink" href="#synthetic-dataset-export" title="Permalink to this heading">#</a></h2>
<p>Save the synthesized dataset for downstream use.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_synthesized</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="recap">
<h2>Recap<a class="headerlink" href="#recap" title="Permalink to this heading">#</a></h2>
<p>This guide demonstrated property-respecting structured data synthesis, including logic for univariate, joint, interpolated, extrapolated, and coherent features. It also described long text generation and validation with a language model as a judge, including conditional retries. By following these workflows and recommendations, you can create realistic, flexible synthetic datasets to support your WayFlow projects.</p>
</section>
<section id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this heading">#</a></h2>
<p>Having learned how to synthesize data in WayFlow, you may now proceed to <a class="reference internal" href="howto_datastores.html"><span class="doc">How to Connect Assistants to Your Data</span></a> to learn how to integrate your synthesized datasets with your assistants for downstream applications and enhanced testing.</p>
</section>
<section id="full-code">
<h2>Full code<a class="headerlink" href="#full-code" title="Permalink to this heading">#</a></h2>
<p>You can copy the full code for this guide below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1"># Copyright © 2025 Oracle and/or its affiliates.</span>
<span class="linenos">  2</span><span class="c1">#</span>
<span class="linenos">  3</span><span class="c1"># This software is under the Apache License 2.0</span>
<span class="linenos">  4</span><span class="c1"># %%[markdown]</span>
<span class="linenos">  5</span><span class="c1"># WayFlow Code Example - How to Perform Data Synthesis</span>
<span class="linenos">  6</span><span class="c1"># ----------------------------------------------------</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="c1"># How to use:</span>
<span class="linenos">  9</span><span class="c1"># Create a new Python virtual environment and install the latest WayFlow version.</span>
<span class="linenos"> 10</span><span class="c1"># ```bash</span>
<span class="linenos"> 11</span><span class="c1"># python -m venv venv-wayflowcore</span>
<span class="linenos"> 12</span><span class="c1"># source venv-wayflowcore/bin/activate</span>
<span class="linenos"> 13</span><span class="c1"># pip install --upgrade pip</span>
<span class="linenos"> 14</span><span class="c1"># pip install &quot;wayflowcore==26.1&quot; </span>
<span class="linenos"> 15</span><span class="c1"># ```</span>
<span class="linenos"> 16</span>
<span class="linenos"> 17</span><span class="c1"># You can now run the script</span>
<span class="linenos"> 18</span><span class="c1"># 1. As a Python file:</span>
<span class="linenos"> 19</span><span class="c1"># ```bash</span>
<span class="linenos"> 20</span><span class="c1"># python howto_data_synthesis.py</span>
<span class="linenos"> 21</span><span class="c1"># ```</span>
<span class="linenos"> 22</span><span class="c1"># 2. As a Notebook (in VSCode):</span>
<span class="linenos"> 23</span><span class="c1"># When viewing the file,</span>
<span class="linenos"> 24</span><span class="c1">#  - press the keys Ctrl + Enter to run the selected cell</span>
<span class="linenos"> 25</span><span class="c1">#  - or Shift + Enter to run the selected cell and move to the cell below# (LICENSE-APACHE or http://www.apache.org/licenses/LICENSE-2.0) or Universal Permissive License</span>
<span class="linenos"> 26</span><span class="c1"># (UPL) 1.0 (LICENSE-UPL or https://oss.oracle.com/licenses/upl), at your option.</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 31</span><span class="n">data</span><span class="p">:</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="c1"># %%</span>
<span class="linenos"> 34</span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="linenos"> 35</span>
<span class="linenos"> 36</span><span class="n">seed_data</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos"> 37</span>    <span class="p">{</span>
<span class="linenos"> 38</span>        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;organization&quot;</span><span class="p">,</span>
<span class="linenos"> 39</span>        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Atlas Engineering Ltd.&quot;</span><span class="p">,</span>
<span class="linenos"> 40</span>        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;EMEA&quot;</span><span class="p">,</span>
<span class="linenos"> 41</span>        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Germany&quot;</span><span class="p">,</span>
<span class="linenos"> 42</span>        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">75200000</span><span class="p">,</span>
<span class="linenos"> 43</span>        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">12500000</span><span class="p">,</span>
<span class="linenos"> 44</span>        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">4.9</span><span class="p">,</span>
<span class="linenos"> 45</span>        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Business expansion&quot;</span><span class="p">,</span>
<span class="linenos"> 46</span>        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Atlas Engineering Ltd. seeks a $12,500,000 loan at a proposed 4.9</span><span class="si">% i</span><span class="s2">nterest to expand its operations across the German automotive sector. With a robust net worth of $75,200,000 and a history of successful project delivery, the company is poised for growth. The expansion will create new jobs and increase market share, while our solid financials and collateral provide strong assurance. This aligns with our strategic business roadmap and justifies a favorable interest rate approval.&quot;</span><span class="p">,</span>
<span class="linenos"> 47</span>    <span class="p">},</span>
<span class="linenos"> 48</span>    <span class="p">{</span>
<span class="linenos"> 49</span>        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;individual&quot;</span><span class="p">,</span>
<span class="linenos"> 50</span>        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Samantha Rivera&quot;</span><span class="p">,</span>
<span class="linenos"> 51</span>        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<span class="linenos"> 52</span>        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;United States&quot;</span><span class="p">,</span>
<span class="linenos"> 53</span>        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">1580000</span><span class="p">,</span>
<span class="linenos"> 54</span>        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">80000</span><span class="p">,</span>
<span class="linenos"> 55</span>        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">,</span>
<span class="linenos"> 56</span>        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Home renovation&quot;</span><span class="p">,</span>
<span class="linenos"> 57</span>        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Samantha Rivera requests a $80,000 loan at 3.5</span><span class="si">% i</span><span class="s2">nterest to renovate her primary residence. With a net worth of $1,580,000 and stable income, Samantha’s credit profile is strong. The renovation will enhance her property value, reducing default risk. Given her responsible financial management and the secured nature of the loan, she is a low-risk borrower deserving of these favorable terms.&quot;</span><span class="p">,</span>
<span class="linenos"> 58</span>    <span class="p">},</span>
<span class="linenos"> 59</span>    <span class="p">{</span>
<span class="linenos"> 60</span>        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;organization&quot;</span><span class="p">,</span>
<span class="linenos"> 61</span>        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;MedicoPharma Solutions&quot;</span><span class="p">,</span>
<span class="linenos"> 62</span>        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;JAPAC&quot;</span><span class="p">,</span>
<span class="linenos"> 63</span>        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Singapore&quot;</span><span class="p">,</span>
<span class="linenos"> 64</span>        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">18500000</span><span class="p">,</span>
<span class="linenos"> 65</span>        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">4500000</span><span class="p">,</span>
<span class="linenos"> 66</span>        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">5.7</span><span class="p">,</span>
<span class="linenos"> 67</span>        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Investment capital&quot;</span><span class="p">,</span>
<span class="linenos"> 68</span>        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;MedicoPharma Solutions applies for a $4,500,000 loan at a 5.7</span><span class="si">% r</span><span class="s2">ate to fund critical biotech investments. With a net worth of $18,500,000 and consistent year-over-year growth, the company demonstrates fiscal responsibility. The requested capital is earmarked for new laboratory equipment and R&amp;D, supporting innovation and future revenue. The loan structure and interest rate are well-justified by the company&#39;s planned implementations and financial record.&quot;</span><span class="p">,</span>
<span class="linenos"> 69</span>    <span class="p">},</span>
<span class="linenos"> 70</span>    <span class="p">{</span>
<span class="linenos"> 71</span>        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;individual&quot;</span><span class="p">,</span>
<span class="linenos"> 72</span>        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Rajeev Malhotra&quot;</span><span class="p">,</span>
<span class="linenos"> 73</span>        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;JAPAC&quot;</span><span class="p">,</span>
<span class="linenos"> 74</span>        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;India&quot;</span><span class="p">,</span>
<span class="linenos"> 75</span>        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">280000</span><span class="p">,</span>
<span class="linenos"> 76</span>        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">42000</span><span class="p">,</span>
<span class="linenos"> 77</span>        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">4.2</span><span class="p">,</span>
<span class="linenos"> 78</span>        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Education costs&quot;</span><span class="p">,</span>
<span class="linenos"> 79</span>        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Rajeev Malhotra is seeking a $42,000 loan at 4.2</span><span class="si">% i</span><span class="s2">nterest to pursue a postgraduate program in Bangalore. With a net worth of $280,000 and a stable employment history, Rajeev is committed to investing in his education for career advancement. The loan will cover tuition and related expenses, and his repayment plan is backed by projected post-graduation earnings, warranting an approval at this rate.&quot;</span><span class="p">,</span>
<span class="linenos"> 80</span>    <span class="p">},</span>
<span class="linenos"> 81</span>    <span class="p">{</span>
<span class="linenos"> 82</span>        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;organization&quot;</span><span class="p">,</span>
<span class="linenos"> 83</span>        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Green Horizons Ltd.&quot;</span><span class="p">,</span>
<span class="linenos"> 84</span>        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;LAD&quot;</span><span class="p">,</span>
<span class="linenos"> 85</span>        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Brazil&quot;</span><span class="p">,</span>
<span class="linenos"> 86</span>        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">6270000</span><span class="p">,</span>
<span class="linenos"> 87</span>        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">1300000</span><span class="p">,</span>
<span class="linenos"> 88</span>        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">5.2</span><span class="p">,</span>
<span class="linenos"> 89</span>        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Major appliance&quot;</span><span class="p">,</span>
<span class="linenos"> 90</span>        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Green Horizons Ltd. is requesting a $1,300,000 loan with a 5.2% proposed interest rate to acquire industrial-scale solar panel systems for its new facility. With a net worth of $6,270,000, the organization’s history in sustainable development makes this investment logical. The equipment will reduce operational costs and support environmental commitments, providing a compelling rationale for loan approval.&quot;</span><span class="p">,</span>
<span class="linenos"> 91</span>    <span class="p">},</span>
<span class="linenos"> 92</span>    <span class="p">{</span>
<span class="linenos"> 93</span>        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;individual&quot;</span><span class="p">,</span>
<span class="linenos"> 94</span>        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Lucia González&quot;</span><span class="p">,</span>
<span class="linenos"> 95</span>        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;LAD&quot;</span><span class="p">,</span>
<span class="linenos"> 96</span>        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Argentina&quot;</span><span class="p">,</span>
<span class="linenos"> 97</span>        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">98000</span><span class="p">,</span>
<span class="linenos"> 98</span>        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">19000</span><span class="p">,</span>
<span class="linenos"> 99</span>        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">6.0</span><span class="p">,</span>
<span class="linenos">100</span>        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Debt consolidation&quot;</span><span class="p">,</span>
<span class="linenos">101</span>        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Lucia González seeks a $19,000 loan at 6.0</span><span class="si">% i</span><span class="s2">nterest to consolidate existing debts into a single manageable payment. With a net worth of $98,000 and steady monthly income, Lucia will benefit from simplified repayment terms and reduced overall interest expenses. Her disciplined repayment record supports the requested terms and merits consideration.&quot;</span><span class="p">,</span>
<span class="linenos">102</span>    <span class="p">},</span>
<span class="linenos">103</span>    <span class="p">{</span>
<span class="linenos">104</span>        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;organization&quot;</span><span class="p">,</span>
<span class="linenos">105</span>        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;BlueStar Trading GmbH&quot;</span><span class="p">,</span>
<span class="linenos">106</span>        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;EMEA&quot;</span><span class="p">,</span>
<span class="linenos">107</span>        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Switzerland&quot;</span><span class="p">,</span>
<span class="linenos">108</span>        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">26000000</span><span class="p">,</span>
<span class="linenos">109</span>        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">6200000</span><span class="p">,</span>
<span class="linenos">110</span>        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">3.3</span><span class="p">,</span>
<span class="linenos">111</span>        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Vehicle purchase&quot;</span><span class="p">,</span>
<span class="linenos">112</span>        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;BlueStar Trading GmbH is applying for a $6,200,000 loan at 3.3</span><span class="si">% i</span><span class="s2">nterest to upgrade its commercial vehicle fleet in Switzerland. Backed by a $26,000,000 net worth and healthy balance sheet, the acquisition will improve logistics and lower operational costs. Their creditworthiness and the use of vehicles as collateral minimize risk, justifying loan approval at this competitive rate.&quot;</span><span class="p">,</span>
<span class="linenos">113</span>    <span class="p">},</span>
<span class="linenos">114</span>    <span class="p">{</span>
<span class="linenos">115</span>        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;individual&quot;</span><span class="p">,</span>
<span class="linenos">116</span>        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Fatima Al-Hassan&quot;</span><span class="p">,</span>
<span class="linenos">117</span>        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;EMEA&quot;</span><span class="p">,</span>
<span class="linenos">118</span>        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;United Arab Emirates&quot;</span><span class="p">,</span>
<span class="linenos">119</span>        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">1200000</span><span class="p">,</span>
<span class="linenos">120</span>        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">38000</span><span class="p">,</span>
<span class="linenos">121</span>        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">3.9</span><span class="p">,</span>
<span class="linenos">122</span>        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Vacation funding&quot;</span><span class="p">,</span>
<span class="linenos">123</span>        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Fatima Al-Hassan requests a $38,000 loan at a 3.9</span><span class="si">% i</span><span class="s2">nterest rate to cover a family vacation abroad. With a net worth of $1,200,000 and a solid credit score, she is well-positioned to repay the loan comfortably. Her responsible financial history further supports approval at the proposed rate for this short-term, purpose-specific loan.&quot;</span><span class="p">,</span>
<span class="linenos">124</span>    <span class="p">},</span>
<span class="linenos">125</span>    <span class="p">{</span>
<span class="linenos">126</span>        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;organization&quot;</span><span class="p">,</span>
<span class="linenos">127</span>        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Aussie Urban Properties&quot;</span><span class="p">,</span>
<span class="linenos">128</span>        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;JAPAC&quot;</span><span class="p">,</span>
<span class="linenos">129</span>        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Australia&quot;</span><span class="p">,</span>
<span class="linenos">130</span>        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">51200000</span><span class="p">,</span>
<span class="linenos">131</span>        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">9700000</span><span class="p">,</span>
<span class="linenos">132</span>        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">4.5</span><span class="p">,</span>
<span class="linenos">133</span>        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Business expansion&quot;</span><span class="p">,</span>
<span class="linenos">134</span>        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Aussie Urban Properties seeks $9,700,000 in funding at a 4.5</span><span class="si">% i</span><span class="s2">nterest rate to finance new residential developments in Sydney. With a net worth of $51,200,000 and proven experience in property management, the loan will be efficiently applied. The company’s past successes and robust financial health point to a strong ability to utilize and repay the loan as proposed.&quot;</span><span class="p">,</span>
<span class="linenos">135</span>    <span class="p">},</span>
<span class="linenos">136</span>    <span class="p">{</span>
<span class="linenos">137</span>        <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="s2">&quot;individual&quot;</span><span class="p">,</span>
<span class="linenos">138</span>        <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Jacob Peterson&quot;</span><span class="p">,</span>
<span class="linenos">139</span>        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;NA&quot;</span><span class="p">,</span>
<span class="linenos">140</span>        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;Canada&quot;</span><span class="p">,</span>
<span class="linenos">141</span>        <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="mi">405000</span><span class="p">,</span>
<span class="linenos">142</span>        <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="mi">31000</span><span class="p">,</span>
<span class="linenos">143</span>        <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="mf">2.7</span><span class="p">,</span>
<span class="linenos">144</span>        <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Medical expenses&quot;</span><span class="p">,</span>
<span class="linenos">145</span>        <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="s2">&quot;Jacob Peterson is requesting a $31,000 loan at 2.7</span><span class="si">% i</span><span class="s2">nterest to cover medical expenses resulting from an unexpected surgery. With a net worth of $405,000 and reliable employment, Jacob demonstrates strong repayment capacity. His consistent repayment track record and insurance partial coverage will mitigate lender risk, supporting approval at this attractive rate.&quot;</span><span class="p">,</span>
<span class="linenos">146</span>    <span class="p">},</span>
<span class="linenos">147</span><span class="p">]</span>
<span class="linenos">148</span>
<span class="linenos">149</span><span class="n">df_seed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">seed_data</span><span class="p">)</span>
<span class="linenos">150</span><span class="nb">print</span><span class="p">(</span><span class="n">df_seed</span><span class="p">)</span>
<span class="linenos">151</span>
<span class="linenos">152</span>
<span class="linenos">153</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
<span class="linenos">154</span>
<span class="linenos">155</span>
<span class="linenos">156</span><span class="c1"># %%[markdown]</span>
<span class="linenos">157</span><span class="n">fake</span> <span class="n">categorical</span><span class="p">:</span>
<span class="linenos">158</span>
<span class="linenos">159</span><span class="c1"># %%</span>
<span class="linenos">160</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="linenos">161</span>
<span class="linenos">162</span>
<span class="linenos">163</span><span class="k">def</span><span class="w"> </span><span class="nf">fake_categorical</span><span class="p">(</span>
<span class="linenos">164</span>    <span class="n">rng</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">,</span>
<span class="linenos">165</span>    <span class="n">pd_column</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
<span class="linenos">166</span>    <span class="n">dropna</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="linenos">167</span>    <span class="o">**</span><span class="n">choice_kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="linenos">168</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="linenos">169</span>    <span class="n">value_counts_dict</span> <span class="o">=</span> <span class="n">pd_column</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="linenos">170</span>    <span class="n">categories</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value_counts_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="linenos">171</span>    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value_counts_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="linenos">172</span>    <span class="k">return</span> <span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">probabilities</span><span class="p">,</span> <span class="o">**</span><span class="n">choice_kwargs</span><span class="p">)</span>
<span class="linenos">173</span>
<span class="linenos">174</span>
<span class="linenos">175</span>
<span class="linenos">176</span>
<span class="linenos">177</span>
<span class="linenos">178</span><span class="c1"># %%[markdown]</span>
<span class="linenos">179</span><span class="n">fake</span> <span class="n">joint</span> <span class="n">numerical</span><span class="p">:</span>
<span class="linenos">180</span>
<span class="linenos">181</span><span class="c1"># %%</span>
<span class="linenos">182</span><span class="k">def</span><span class="w"> </span><span class="nf">fake_joint_numerical</span><span class="p">(</span>
<span class="linenos">183</span>    <span class="n">rng</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">,</span>
<span class="linenos">184</span>    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="linenos">185</span>    <span class="n">value_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="linenos">186</span>    <span class="n">cat_cols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="linenos">187</span>    <span class="n">synthesized_rows</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="linenos">188</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="linenos">189</span>    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">190</span>    <span class="n">cat_array</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos">191</span>        <span class="n">synthesized_rows</span><span class="p">[</span><span class="n">cat_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="linenos">192</span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
<span class="linenos">193</span>        <span class="k">else</span> <span class="n">synthesized_rows</span><span class="p">[[</span><span class="n">cat_cols</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
<span class="linenos">194</span>    <span class="p">)</span>
<span class="linenos">195</span>    <span class="k">for</span> <span class="n">cats</span> <span class="ow">in</span> <span class="n">cat_array</span><span class="p">:</span>
<span class="linenos">196</span>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="linenos">197</span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<span class="linenos">198</span>            <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">,</span> <span class="n">cats</span><span class="p">):</span>
<span class="linenos">199</span>                <span class="n">mask</span> <span class="o">&amp;=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">val</span>
<span class="linenos">200</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">201</span>            <span class="n">mask</span> <span class="o">&amp;=</span> <span class="n">df</span><span class="p">[</span><span class="n">cat_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">cats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">202</span>        <span class="n">matching_vals</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">value_col</span><span class="p">]</span>
<span class="linenos">203</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">matching_vals</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<span class="linenos">204</span>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">matching_vals</span><span class="p">))</span>
<span class="linenos">205</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">206</span>            <span class="c1"># Fallback: overall empirical</span>
<span class="linenos">207</span>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">value_col</span><span class="p">]))</span>
<span class="linenos">208</span>    <span class="k">return</span> <span class="n">result</span>
<span class="linenos">209</span>
<span class="linenos">210</span>
<span class="linenos">211</span>
<span class="linenos">212</span><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="linenos">213</span>
<span class="linenos">214</span>
<span class="linenos">215</span><span class="c1"># %%[markdown]</span>
<span class="linenos">216</span><span class="n">seeds</span><span class="p">:</span>
<span class="linenos">217</span>
<span class="linenos">218</span><span class="c1"># %%</span>
<span class="linenos">219</span><span class="kn">from</span><span class="w"> </span><span class="nn">faker</span><span class="w"> </span><span class="kn">import</span> <span class="n">Faker</span>
<span class="linenos">220</span>
<span class="linenos">221</span><span class="n">SEED</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">222</span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">SEED</span><span class="p">)</span>
<span class="linenos">223</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">SEED</span><span class="p">)</span>
<span class="linenos">224</span><span class="n">fake</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span>
<span class="linenos">225</span><span class="n">Faker</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">SEED</span><span class="p">)</span>
<span class="linenos">226</span>
<span class="linenos">227</span>
<span class="linenos">228</span><span class="c1"># %%[markdown]</span>
<span class="linenos">229</span><span class="n">generation</span> <span class="n">configuration</span><span class="p">:</span>
<span class="linenos">230</span>
<span class="linenos">231</span><span class="c1"># %%</span>
<span class="linenos">232</span><span class="n">n_synthesized</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># adjust as needed</span>
<span class="linenos">233</span>
<span class="linenos">234</span>
<span class="linenos">235</span><span class="c1"># %%[markdown]</span>
<span class="linenos">236</span><span class="n">univariate</span> <span class="n">distribution</span><span class="p">:</span>
<span class="linenos">237</span>
<span class="linenos">238</span><span class="c1"># %%</span>
<span class="linenos">239</span><span class="n">synth_region</span> <span class="o">=</span> <span class="n">fake_categorical</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n_synthesized</span><span class="p">)</span>
<span class="linenos">240</span><span class="nb">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">synth_region</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="linenos">241</span><span class="c1"># EMEA     7</span>
<span class="linenos">242</span><span class="c1"># LAD      6</span>
<span class="linenos">243</span><span class="c1"># NA       4</span>
<span class="linenos">244</span><span class="c1"># JAPAC    3</span>
<span class="linenos">245</span><span class="c1"># Name: count, dtype: int64</span>
<span class="linenos">246</span>
<span class="linenos">247</span>
<span class="linenos">248</span><span class="c1"># %%[markdown]</span>
<span class="linenos">249</span><span class="n">coherency</span> <span class="n">constraint</span><span class="p">:</span>
<span class="linenos">250</span>
<span class="linenos">251</span><span class="c1"># %%</span>
<span class="linenos">252</span><span class="n">region_country_map</span> <span class="o">=</span> <span class="n">df_seed</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="linenos">253</span><span class="n">synth_country</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">254</span><span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">synth_region</span><span class="p">:</span>
<span class="linenos">255</span>    <span class="n">possible_countries</span> <span class="o">=</span> <span class="n">region_country_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="p">[])</span>
<span class="linenos">256</span>    <span class="n">synth_country</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">possible_countries</span><span class="p">))</span>
<span class="linenos">257</span><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">synth_region</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">synth_country</span><span class="p">[:</span><span class="mi">10</span><span class="p">])))</span>
<span class="linenos">258</span><span class="c1"># [(&#39;NA&#39;, &#39;United States&#39;),</span>
<span class="linenos">259</span><span class="c1">#  (&#39;EMEA&#39;, &#39;Germany&#39;),</span>
<span class="linenos">260</span><span class="c1">#  (&#39;EMEA&#39;, &#39;Germany&#39;),</span>
<span class="linenos">261</span><span class="c1">#  (&#39;EMEA&#39;, &#39;Germany&#39;),</span>
<span class="linenos">262</span><span class="c1">#  (&#39;LAD&#39;, &#39;Brazil&#39;),</span>
<span class="linenos">263</span><span class="c1">#  (&#39;LAD&#39;, &#39;Argentina&#39;),</span>
<span class="linenos">264</span><span class="c1">#  (&#39;NA&#39;, &#39;Canada&#39;),</span>
<span class="linenos">265</span><span class="c1">#  (&#39;NA&#39;, &#39;Canada&#39;),</span>
<span class="linenos">266</span><span class="c1">#  (&#39;JAPAC&#39;, &#39;Singapore&#39;),</span>
<span class="linenos">267</span><span class="c1">#  (&#39;LAD&#39;, &#39;Argentina&#39;)]</span>
<span class="linenos">268</span>
<span class="linenos">269</span>
<span class="linenos">270</span><span class="c1"># %%[markdown]</span>
<span class="linenos">271</span><span class="n">joint</span> <span class="n">distribution</span><span class="p">:</span>
<span class="linenos">272</span>
<span class="linenos">273</span><span class="c1"># %%</span>
<span class="linenos">274</span><span class="n">demo_rows</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">synth_region</span><span class="p">})</span>
<span class="linenos">275</span><span class="n">synth_customer_net_worth</span> <span class="o">=</span> <span class="n">fake_joint_numerical</span><span class="p">(</span>
<span class="linenos">276</span>    <span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">,</span> <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">],</span> <span class="n">demo_rows</span>
<span class="linenos">277</span><span class="p">)</span>
<span class="linenos">278</span><span class="nb">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">synth_customer_net_worth</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
<span class="linenos">279</span><span class="c1"># count    2.000000e+01</span>
<span class="linenos">280</span><span class="c1"># mean     1.431880e+07</span>
<span class="linenos">281</span><span class="c1"># std      2.174939e+07</span>
<span class="linenos">282</span><span class="c1"># min      9.800000e+04</span>
<span class="linenos">283</span><span class="c1"># 25%      4.050000e+05</span>
<span class="linenos">284</span><span class="c1"># 50%      3.735000e+06</span>
<span class="linenos">285</span><span class="c1"># 75%      2.600000e+07</span>
<span class="linenos">286</span><span class="c1"># max      7.520000e+07</span>
<span class="linenos">287</span><span class="c1"># dtype: float64</span>
<span class="linenos">288</span>
<span class="linenos">289</span>
<span class="linenos">290</span><span class="c1"># %%[markdown]</span>
<span class="linenos">291</span><span class="n">extrapolation</span><span class="p">:</span>
<span class="linenos">292</span>
<span class="linenos">293</span><span class="c1"># %%</span>
<span class="linenos">294</span><span class="n">synth_customer_type</span> <span class="o">=</span> <span class="n">fake_categorical</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">[</span><span class="s2">&quot;customer_type&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n_synthesized</span><span class="p">)</span>
<span class="linenos">295</span><span class="n">synth_customer_name</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos">296</span>    <span class="n">fake</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="k">if</span> <span class="n">ct</span> <span class="o">==</span> <span class="s2">&quot;individual&quot;</span> <span class="k">else</span> <span class="n">fake</span><span class="o">.</span><span class="n">company</span><span class="p">()</span> <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">synth_customer_type</span>
<span class="linenos">297</span><span class="p">]</span>
<span class="linenos">298</span><span class="nb">print</span><span class="p">(</span><span class="n">synth_customer_name</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
<span class="linenos">299</span><span class="c1"># [&#39;Norma Fisher&#39;,</span>
<span class="linenos">300</span><span class="c1">#  &#39;Sheppard-Tucker&#39;,</span>
<span class="linenos">301</span><span class="c1">#  &#39;Sandra Faulkner&#39;,</span>
<span class="linenos">302</span><span class="c1">#  &#39;Silva-Odonnell&#39;,</span>
<span class="linenos">303</span><span class="c1">#  &#39;Taylor, Taylor and Davis&#39;,</span>
<span class="linenos">304</span><span class="c1">#  &#39;Victoria Patel&#39;,</span>
<span class="linenos">305</span><span class="c1">#  &#39;Patrick, Barrera and Collins&#39;,</span>
<span class="linenos">306</span><span class="c1">#  &#39;Stephanie Sutton&#39;,</span>
<span class="linenos">307</span><span class="c1">#  &#39;Castro-Gomez&#39;,</span>
<span class="linenos">308</span><span class="c1">#  &#39;Martin Harris&#39;]</span>
<span class="linenos">309</span>
<span class="linenos">310</span>
<span class="linenos">311</span>
<span class="linenos">312</span><span class="c1"># %%[markdown]</span>
<span class="linenos">313</span><span class="n">full</span> <span class="n">synthesis</span><span class="p">:</span>
<span class="linenos">314</span>
<span class="linenos">315</span><span class="c1"># %%</span>
<span class="linenos">316</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.property</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnyProperty</span><span class="p">,</span> <span class="n">IntegerProperty</span>
<span class="linenos">317</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.steps</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToolExecutionStep</span>
<span class="linenos">318</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServerTool</span>
<span class="linenos">319</span>
<span class="linenos">320</span>
<span class="linenos">321</span><span class="k">def</span><span class="w"> </span><span class="nf">synthesize_structured_features</span><span class="p">(</span>
<span class="linenos">322</span>    <span class="n">df_seed</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">n_synthesized</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">323</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="linenos">324</span>    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="linenos">325</span>    <span class="n">fake</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span>
<span class="linenos">326</span>    <span class="n">fake</span><span class="o">.</span><span class="n">seed_instance</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="linenos">327</span>    <span class="n">synth_loan_reason</span> <span class="o">=</span> <span class="n">fake_categorical</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">[</span><span class="s2">&quot;loan_reason&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n_synthesized</span><span class="p">)</span>
<span class="linenos">328</span>    <span class="n">synth_region_full</span> <span class="o">=</span> <span class="n">fake_categorical</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n_synthesized</span><span class="p">)</span>
<span class="linenos">329</span>    <span class="n">synth_customer_type_full</span> <span class="o">=</span> <span class="n">fake_categorical</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">[</span><span class="s2">&quot;customer_type&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n_synthesized</span><span class="p">)</span>
<span class="linenos">330</span>    <span class="n">region_country_map</span> <span class="o">=</span> <span class="n">df_seed</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="linenos">331</span>    <span class="n">synth_country_full</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">332</span>    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">synth_region_full</span><span class="p">:</span>
<span class="linenos">333</span>        <span class="n">possible_countries</span> <span class="o">=</span> <span class="n">region_country_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="p">[])</span>
<span class="linenos">334</span>        <span class="n">synth_country_full</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">possible_countries</span><span class="p">))</span>
<span class="linenos">335</span>    <span class="n">synth_rows_for_joint</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">synth_region_full</span><span class="p">})</span>
<span class="linenos">336</span>    <span class="n">synth_customer_net_worth_full</span> <span class="o">=</span> <span class="n">fake_joint_numerical</span><span class="p">(</span>
<span class="linenos">337</span>        <span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">,</span> <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">],</span> <span class="n">synth_rows_for_joint</span>
<span class="linenos">338</span>    <span class="p">)</span>
<span class="linenos">339</span>    <span class="n">synth_loan_value_full</span> <span class="o">=</span> <span class="n">fake_joint_numerical</span><span class="p">(</span>
<span class="linenos">340</span>        <span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">,</span> <span class="s2">&quot;loan_value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">],</span> <span class="n">synth_rows_for_joint</span>
<span class="linenos">341</span>    <span class="p">)</span>
<span class="linenos">342</span>    <span class="n">synth_loan_proposed_interest_full</span> <span class="o">=</span> <span class="n">fake_joint_numerical</span><span class="p">(</span>
<span class="linenos">343</span>        <span class="n">rng</span><span class="p">,</span> <span class="n">df_seed</span><span class="p">,</span> <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">],</span> <span class="n">synth_rows_for_joint</span>
<span class="linenos">344</span>    <span class="p">)</span>
<span class="linenos">345</span>    <span class="n">synth_customer_name_full</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos">346</span>        <span class="n">fake</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="k">if</span> <span class="n">ct</span> <span class="o">==</span> <span class="s2">&quot;individual&quot;</span> <span class="k">else</span> <span class="n">fake</span><span class="o">.</span><span class="n">company</span><span class="p">()</span> <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">synth_customer_type_full</span>
<span class="linenos">347</span>    <span class="p">]</span>
<span class="linenos">348</span>    <span class="n">df_synthesized</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="linenos">349</span>        <span class="p">{</span>
<span class="linenos">350</span>            <span class="s2">&quot;customer_type&quot;</span><span class="p">:</span> <span class="n">synth_customer_type_full</span><span class="p">,</span>
<span class="linenos">351</span>            <span class="s2">&quot;customer_name&quot;</span><span class="p">:</span> <span class="n">synth_customer_name_full</span><span class="p">,</span>
<span class="linenos">352</span>            <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">synth_region_full</span><span class="p">,</span>
<span class="linenos">353</span>            <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="n">synth_country_full</span><span class="p">,</span>
<span class="linenos">354</span>            <span class="s2">&quot;loan_reason&quot;</span><span class="p">:</span> <span class="n">synth_loan_reason</span><span class="p">,</span>
<span class="linenos">355</span>            <span class="s2">&quot;customer_net_worth&quot;</span><span class="p">:</span> <span class="n">synth_customer_net_worth_full</span><span class="p">,</span>
<span class="linenos">356</span>            <span class="s2">&quot;loan_value&quot;</span><span class="p">:</span> <span class="n">synth_loan_value_full</span><span class="p">,</span>
<span class="linenos">357</span>            <span class="s2">&quot;loan_proposed_interest&quot;</span><span class="p">:</span> <span class="n">synth_loan_proposed_interest_full</span><span class="p">,</span>
<span class="linenos">358</span>        <span class="p">}</span>
<span class="linenos">359</span>    <span class="p">)</span>
<span class="linenos">360</span>    <span class="k">return</span> <span class="n">df_synthesized</span>
<span class="linenos">361</span>
<span class="linenos">362</span>
<span class="linenos">363</span><span class="k">def</span><span class="w"> </span><span class="nf">get_synthesize_structured_features_step</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ToolExecutionStep</span><span class="p">:</span>
<span class="linenos">364</span>    <span class="k">return</span> <span class="n">ToolExecutionStep</span><span class="p">(</span>
<span class="linenos">365</span>        <span class="n">tool</span><span class="o">=</span><span class="n">ServerTool</span><span class="p">(</span>
<span class="linenos">366</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;synthesize_structured_features&quot;</span><span class="p">,</span>
<span class="linenos">367</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Synthesize all structured features&quot;</span><span class="p">,</span>
<span class="linenos">368</span>            <span class="n">func</span><span class="o">=</span><span class="n">synthesize_structured_features</span><span class="p">,</span>
<span class="linenos">369</span>            <span class="n">input_descriptors</span><span class="o">=</span><span class="p">[</span>
<span class="linenos">370</span>                <span class="n">AnyProperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;df_seed&quot;</span><span class="p">),</span>
<span class="linenos">371</span>                <span class="n">IntegerProperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;n_synthesized&quot;</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<span class="linenos">372</span>                <span class="n">IntegerProperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;seed&quot;</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
<span class="linenos">373</span>            <span class="p">],</span>
<span class="linenos">374</span>            <span class="n">output_descriptors</span><span class="o">=</span><span class="p">[</span><span class="n">AnyProperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;df_synthesized&quot;</span><span class="p">)],</span>
<span class="linenos">375</span>        <span class="p">),</span>
<span class="linenos">376</span>        <span class="n">raise_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">377</span>    <span class="p">)</span>
<span class="linenos">378</span>
<span class="linenos">379</span>
<span class="linenos">380</span>
<span class="linenos">381</span>
<span class="linenos">382</span><span class="c1"># %%[markdown]</span>
<span class="linenos">383</span><span class="n">full</span> <span class="n">synthesis</span> <span class="n">flow</span><span class="p">:</span>
<span class="linenos">384</span>
<span class="linenos">385</span><span class="c1"># %%</span>
<span class="linenos">386</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.flowhelpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_single_step_flow</span>
<span class="linenos">387</span>
<span class="linenos">388</span><span class="n">flow</span> <span class="o">=</span> <span class="n">create_single_step_flow</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">get_synthesize_structured_features_step</span><span class="p">())</span>
<span class="linenos">389</span><span class="n">conv</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;df_seed&quot;</span><span class="p">:</span> <span class="n">df_seed</span><span class="p">,</span> <span class="s2">&quot;n_synthesized&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="linenos">390</span><span class="n">status</span> <span class="o">=</span> <span class="n">conv</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">391</span><span class="n">df_synthesized</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">output_values</span><span class="p">[</span><span class="s2">&quot;df_synthesized&quot;</span><span class="p">]</span>
<span class="linenos">392</span><span class="nb">print</span><span class="p">(</span><span class="n">df_synthesized</span><span class="p">)</span>
<span class="linenos">393</span>
<span class="linenos">394</span>
<span class="linenos">395</span><span class="c1"># %%[markdown]</span>
<span class="linenos">396</span><span class="n">verification</span><span class="p">:</span>
<span class="linenos">397</span>
<span class="linenos">398</span><span class="c1"># %%</span>
<span class="linenos">399</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Synthesized region distribution:&quot;</span><span class="p">)</span>
<span class="linenos">400</span><span class="nb">print</span><span class="p">(</span><span class="n">df_synthesized</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="linenos">401</span><span class="c1"># Synthesized region distribution:</span>
<span class="linenos">402</span><span class="c1"># JAPAC    46</span>
<span class="linenos">403</span><span class="c1"># LAD      38</span>
<span class="linenos">404</span><span class="c1"># EMEA     36</span>
<span class="linenos">405</span><span class="c1"># NA       30</span>
<span class="linenos">406</span><span class="c1"># Name: count, dtype: int64</span>
<span class="linenos">407</span>
<span class="linenos">408</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Seed region distribution:&quot;</span><span class="p">)</span>
<span class="linenos">409</span><span class="nb">print</span><span class="p">(</span><span class="n">df_seed</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="linenos">410</span><span class="c1"># Seed region distribution:</span>
<span class="linenos">411</span><span class="c1"># EMEA     3</span>
<span class="linenos">412</span><span class="c1"># JAPAC    3</span>
<span class="linenos">413</span><span class="c1"># NA       2</span>
<span class="linenos">414</span><span class="c1"># LAD      2</span>
<span class="linenos">415</span><span class="c1"># Name: count, dtype: int64</span>
<span class="linenos">416</span>
<span class="linenos">417</span>
<span class="linenos">418</span><span class="c1"># %%[markdown]</span>
<span class="linenos">419</span><span class="n">long</span> <span class="n">text</span> <span class="n">generation</span><span class="p">:</span>
<span class="linenos">420</span>
<span class="linenos">421</span><span class="c1"># %%</span>
<span class="linenos">422</span>
<span class="linenos">423</span><span class="c1"># Define I/O constants and step names</span>
<span class="linenos">424</span><span class="n">JUSTIFICATION_GEN_IO</span> <span class="o">=</span> <span class="s2">&quot;JUSTIFICATION_GEN_IO&quot;</span>
<span class="linenos">425</span><span class="n">JUSTIFICATION_PARSING_IO</span> <span class="o">=</span> <span class="s2">&quot;JUSTIFICATION_PARSING_IO&quot;</span>
<span class="linenos">426</span><span class="n">VALIDATION_IO</span> <span class="o">=</span> <span class="s2">&quot;VALIDATION_IO&quot;</span>
<span class="linenos">427</span><span class="n">VALIDATION_PARSING_IO</span> <span class="o">=</span> <span class="s2">&quot;VALIDATION_PARSING_IO&quot;</span>
<span class="linenos">428</span>
<span class="linenos">429</span><span class="n">JUSTIFICATION_GEN_STEP</span> <span class="o">=</span> <span class="s2">&quot;JUSTIFICATION_GEN_STEP&quot;</span>
<span class="linenos">430</span><span class="n">JUSTIFICATION_PARSING_STEP</span> <span class="o">=</span> <span class="s2">&quot;JUSTIFICATION_PARSING_STEP&quot;</span>
<span class="linenos">431</span><span class="n">VALIDATION_STEP</span> <span class="o">=</span> <span class="s2">&quot;VALIDATION_STEP&quot;</span>
<span class="linenos">432</span><span class="n">VALIDATION_PARSING_STEP</span> <span class="o">=</span> <span class="s2">&quot;VALIDATION_PARSING_STEP&quot;</span>
<span class="linenos">433</span>
<span class="linenos">434</span><span class="c1"># Define prompts</span>
<span class="linenos">435</span><span class="n">JUSTIFICATION_PROMPT</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="linenos">436</span><span class="s2">## Context</span>
<span class="linenos">437</span><span class="s2">You are an assistant that helps the business with loan applications.</span>
<span class="linenos">438</span>
<span class="linenos">439</span>
<span class="linenos">440</span><span class="s2">## Task</span>
<span class="linenos">441</span><span class="s2">Write a justification for a loan application, given certain customer data points.</span>
<span class="linenos">442</span><span class="s2">The justification should be concise and detailed, and include all infomration that could be relevant for the loan application.</span>
<span class="linenos">443</span><span class="s2">As an intermediate step before writing the justification, provide a reasoning section consisting of facts, arguments or any other relevant data that would help you with writing the justification.</span>
<span class="linenos">444</span>
<span class="linenos">445</span>
<span class="linenos">446</span><span class="s2">## Example</span>
<span class="linenos">447</span><span class="s2">Below is an example of the input data points and how they are structured, and an output justitifcation. Note that in this example the reasoning section has been omitted.</span>
<span class="linenos">448</span>
<span class="linenos">449</span><span class="s2">Customer: {{ seed_example[&#39;customer_name&#39;] }} (type = {{ seed_example[&#39;customer_type&#39;] }})</span>
<span class="linenos">450</span><span class="s2">Location: {{ seed_example[&#39;region&#39;] }}, {{ seed_example[&#39;country&#39;] }}</span>
<span class="linenos">451</span><span class="s2">Customer Net Worth: {{ seed_example[&#39;customer_net_worth&#39;] }}</span>
<span class="linenos">452</span><span class="s2">Loan: {{ seed_example[&#39;loan_value&#39;] }} at {{ seed_example[&#39;loan_proposed_interest&#39;] }} interest</span>
<span class="linenos">453</span><span class="s2">Purpose: {{ seed_example[&#39;loan_reason&#39;] }}</span>
<span class="linenos">454</span>
<span class="linenos">455</span><span class="s2">Justification: {{ seed_example[&#39;justification&#39;] }}</span>
<span class="linenos">456</span>
<span class="linenos">457</span>
<span class="linenos">458</span><span class="s2">## Data</span>
<span class="linenos">459</span><span class="s2">Below are the input data points based on which you have to write the justification.</span>
<span class="linenos">460</span>
<span class="linenos">461</span><span class="s2">Customer: {{ generated_row[&#39;customer_name&#39;] }} (type = {{ generated_row[&#39;customer_type&#39;] }})</span>
<span class="linenos">462</span><span class="s2">Location: {{ generated_row[&#39;region&#39;] }}, {{ generated_row[&#39;country&#39;] }}</span>
<span class="linenos">463</span><span class="s2">Customer Net Worth: {{ generated_row[&#39;customer_net_worth&#39;] }}</span>
<span class="linenos">464</span><span class="s2">Loan: {{ generated_row[&#39;loan_value&#39;] }} at {{ generated_row[&#39;loan_proposed_interest&#39;] }} interest</span>
<span class="linenos">465</span><span class="s2">Purpose: {{ generated_row[&#39;loan_reason&#39;] }}</span>
<span class="linenos">466</span>
<span class="linenos">467</span>
<span class="linenos">468</span><span class="s2">## Insturctions</span>
<span class="linenos">469</span><span class="s2">You must follow these guidelines:</span>
<span class="linenos">470</span><span class="s2">- The tone, length and level of details in your justification are similarly aligned with the provided example</span>
<span class="linenos">471</span><span class="s2">- The justification must be solely based on the provided data points</span>
<span class="linenos">472</span><span class="s2">- The justification must be written around the `Purpose` data point</span>
<span class="linenos">473</span><span class="s2">- The language should be professional and business-appropriate</span>
<span class="linenos">474</span><span class="s2">- Include any specific financial details if relevant</span>
<span class="linenos">475</span>
<span class="linenos">476</span><span class="s2">The output must stricly follow the exacty format as below:</span>
<span class="linenos">477</span><span class="s2">Reasoning: &lt;fill this section with any facts or arguments relevant to the justification&gt;</span>
<span class="linenos">478</span><span class="s2">Justification: &lt;fill this section with the justification&gt;</span>
<span class="linenos">479</span>
<span class="linenos">480</span>
<span class="linenos">481</span><span class="s2">## Output</span>
<span class="linenos">482</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="linenos">483</span>
<span class="linenos">484</span>
<span class="linenos">485</span><span class="n">VALIDATION_PROMPT</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="linenos">486</span><span class="s2">## Context</span>
<span class="linenos">487</span><span class="s2">You are an assistant that helps the bank evaluate loan applications.</span>
<span class="linenos">488</span>
<span class="linenos">489</span>
<span class="linenos">490</span><span class="s2">## Task</span>
<span class="linenos">491</span><span class="s2">Evaluate the quality and plausibility of a loan justification against provided application data points of the customer.</span>
<span class="linenos">492</span><span class="s2">The evaluation has to consider the folllowing criteria:</span>
<span class="linenos">493</span><span class="s2">1. Factual accuracy: All amounts, names, and details in the justification match the provided customer data points</span>
<span class="linenos">494</span><span class="s2">2. Logical consistency: The reasoning aligns with customer profile and loan parameters</span>
<span class="linenos">495</span><span class="s2">3. Realism: The justification is plausible for this type of loan application</span>
<span class="linenos">496</span><span class="s2">4. Professional tone: The justification is written in business-appropriate language, and follows a coherent and logical structure</span>
<span class="linenos">497</span><span class="s2">5. Completeness: The justification adequately addresses the loan reason and key factors</span>
<span class="linenos">498</span>
<span class="linenos">499</span>
<span class="linenos">500</span><span class="s2">## Example</span>
<span class="linenos">501</span><span class="s2">Below is an example of how the input data should look like. It starts with the customer data points and ends with the loan justification.</span>
<span class="linenos">502</span>
<span class="linenos">503</span><span class="s2">Customer: {{ seed_example[&#39;customer_name&#39;] }} (type = {{ seed_example[&#39;customer_type&#39;] }})</span>
<span class="linenos">504</span><span class="s2">Location: {{ seed_example[&#39;region&#39;] }}, {{ seed_example[&#39;country&#39;] }}</span>
<span class="linenos">505</span><span class="s2">Customer Net Worth: {{ seed_example[&#39;customer_net_worth&#39;] }}</span>
<span class="linenos">506</span><span class="s2">Loan: {{ seed_example[&#39;loan_value&#39;] }} at {{ seed_example[&#39;loan_proposed_interest&#39;] }} interest</span>
<span class="linenos">507</span><span class="s2">Purpose: {{ seed_example[&#39;loan_reason&#39;] }}</span>
<span class="linenos">508</span>
<span class="linenos">509</span><span class="s2">Justification: {{ seed_example[&#39;justification&#39;] }}</span>
<span class="linenos">510</span>
<span class="linenos">511</span>
<span class="linenos">512</span><span class="s2">## Data</span>
<span class="linenos">513</span><span class="s2">Below is the input data for the current loan application you need to analyze.</span>
<span class="linenos">514</span>
<span class="linenos">515</span><span class="s2">Customer: {{ generated_row[&#39;customer_name&#39;] }} (type = {{ generated_row[&#39;customer_type&#39;] }})</span>
<span class="linenos">516</span><span class="s2">Location: {{ generated_row[&#39;region&#39;] }}, {{ generated_row[&#39;country&#39;] }}</span>
<span class="linenos">517</span><span class="s2">Customer Net Worth: {{ generated_row[&#39;customer_net_worth&#39;] }}</span>
<span class="linenos">518</span><span class="s2">Loan: {{ generated_row[&#39;loan_value&#39;] }} at {{ generated_row[&#39;loan_proposed_interest&#39;]}} interest</span>
<span class="linenos">519</span><span class="s2">Purpose: {{ generated_row[&#39;loan_reason&#39;] }}</span>
<span class="linenos">520</span>
<span class="linenos">521</span><span class="s2">Justification: {{ justification }}</span>
<span class="linenos">522</span>
<span class="linenos">523</span>
<span class="linenos">524</span><span class="s2">## Instructions</span>
<span class="linenos">525</span><span class="s2">You must follow these guidelines:</span>
<span class="linenos">526</span><span class="s2">- All evaluation criteria must be assessed</span>
<span class="linenos">527</span><span class="s2">- Each evaluation criterion must be assessed solely based on the currently provided data points</span>
<span class="linenos">528</span><span class="s2">- If a criterion cannot be confidently assessed based on the provided data points, say so</span>
<span class="linenos">529</span><span class="s2">- Keep the evaluation reasoning short and concise</span>
<span class="linenos">530</span>
<span class="linenos">531</span><span class="s2">After all criteria have been assessed, you must end your answer with a verdict. The verdict must be in uppercase letters, and the list of possible verdicts and their formats is provided below:</span>
<span class="linenos">532</span><span class="s2">- VALID (if the justification meets all evaluation criteria)</span>
<span class="linenos">533</span><span class="s2">- INVALID: &lt;reasoning&gt; (if the justification fails any criteria, list them and provide short reasoning)</span>
<span class="linenos">534</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="linenos">535</span>
<span class="linenos">536</span>
<span class="linenos">537</span>
<span class="linenos">538</span><span class="c1"># %%[markdown]</span>
<span class="linenos">539</span><span class="n">parsing</span> <span class="n">functions</span><span class="p">:</span>
<span class="linenos">540</span>
<span class="linenos">541</span><span class="c1"># %%</span>
<span class="linenos">542</span><span class="k">def</span><span class="w"> </span><span class="nf">parse_cot_justification_output</span><span class="p">(</span><span class="n">llm_output</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos">543</span>    <span class="n">parts</span> <span class="o">=</span> <span class="n">llm_output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Justification:&quot;</span><span class="p">)</span>
<span class="linenos">544</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
<span class="linenos">545</span>        <span class="k">return</span> <span class="s2">&quot;Justification is not provided&quot;</span>
<span class="linenos">546</span>    <span class="k">return</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="linenos">547</span>
<span class="linenos">548</span>
<span class="linenos">549</span><span class="k">def</span><span class="w"> </span><span class="nf">parse_validation_output</span><span class="p">(</span><span class="n">llm_output</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">550</span>    <span class="k">if</span> <span class="s2">&quot;INVALID&quot;</span> <span class="ow">in</span> <span class="n">llm_output</span><span class="p">:</span>
<span class="linenos">551</span>        <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">552</span>    <span class="k">elif</span> <span class="s2">&quot;VALID&quot;</span> <span class="ow">in</span> <span class="n">llm_output</span><span class="p">:</span>
<span class="linenos">553</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">554</span>    <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">555</span>
<span class="linenos">556</span>
<span class="linenos">557</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.flow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flow</span>
<span class="linenos">558</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">LlmModel</span>
<span class="linenos">559</span>
<span class="linenos">560</span>
<span class="linenos">561</span><span class="c1"># %%[markdown]</span>
<span class="linenos">562</span><span class="n">justification</span> <span class="n">generation</span> <span class="n">flow</span><span class="p">:</span>
<span class="linenos">563</span>
<span class="linenos">564</span><span class="c1"># %%</span>
<span class="linenos">565</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.controlconnection</span><span class="w"> </span><span class="kn">import</span> <span class="n">ControlFlowEdge</span>
<span class="linenos">566</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models.llmgenerationconfig</span><span class="w"> </span><span class="kn">import</span> <span class="n">LlmGenerationConfig</span>
<span class="linenos">567</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.steps</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompleteStep</span><span class="p">,</span> <span class="n">PromptExecutionStep</span><span class="p">,</span> <span class="n">RetryStep</span>
<span class="linenos">568</span>
<span class="linenos">569</span>
<span class="linenos">570</span><span class="k">def</span><span class="w"> </span><span class="nf">get_justification_generation_step</span><span class="p">(</span><span class="n">llm</span><span class="p">:</span> <span class="n">LlmModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PromptExecutionStep</span><span class="p">:</span>
<span class="linenos">571</span>    <span class="k">return</span> <span class="n">PromptExecutionStep</span><span class="p">(</span>
<span class="linenos">572</span>        <span class="n">prompt_template</span><span class="o">=</span><span class="n">JUSTIFICATION_PROMPT</span><span class="p">,</span>
<span class="linenos">573</span>        <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
<span class="linenos">574</span>        <span class="n">generation_config</span><span class="o">=</span><span class="n">LlmGenerationConfig</span><span class="p">(</span><span class="n">max_tokens</span><span class="o">=</span><span class="mi">2048</span><span class="p">),</span>
<span class="linenos">575</span>        <span class="n">input_mapping</span><span class="o">=</span><span class="p">{</span>
<span class="linenos">576</span>            <span class="s2">&quot;seed_example&quot;</span><span class="p">:</span> <span class="s2">&quot;seed_example&quot;</span><span class="p">,</span>
<span class="linenos">577</span>            <span class="s2">&quot;generated_row&quot;</span><span class="p">:</span> <span class="s2">&quot;generated_row&quot;</span><span class="p">,</span>
<span class="linenos">578</span>        <span class="p">},</span>
<span class="linenos">579</span>        <span class="n">output_mapping</span><span class="o">=</span><span class="p">{</span><span class="n">PromptExecutionStep</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">:</span> <span class="n">JUSTIFICATION_GEN_IO</span><span class="p">},</span>
<span class="linenos">580</span>    <span class="p">)</span>
<span class="linenos">581</span>
<span class="linenos">582</span>
<span class="linenos">583</span><span class="k">def</span><span class="w"> </span><span class="nf">get_parse_justification_step</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ToolExecutionStep</span><span class="p">:</span>
<span class="linenos">584</span>    <span class="n">tool</span> <span class="o">=</span> <span class="n">ServerTool</span><span class="p">(</span>
<span class="linenos">585</span>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;parse_cot_justification_output&quot;</span><span class="p">,</span>
<span class="linenos">586</span>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Parsing the specific LLM output of the justification generation step.&quot;</span><span class="p">,</span>
<span class="linenos">587</span>        <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
<span class="linenos">588</span>            <span class="s2">&quot;llm_output&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">589</span>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="linenos">590</span>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Output from justification generation step.&quot;</span><span class="p">,</span>
<span class="linenos">591</span>            <span class="p">}</span>
<span class="linenos">592</span>        <span class="p">},</span>
<span class="linenos">593</span>        <span class="n">func</span><span class="o">=</span><span class="n">parse_cot_justification_output</span><span class="p">,</span>
<span class="linenos">594</span>        <span class="n">output</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">},</span>
<span class="linenos">595</span>    <span class="p">)</span>
<span class="linenos">596</span>    <span class="k">return</span> <span class="n">ToolExecutionStep</span><span class="p">(</span>
<span class="linenos">597</span>        <span class="n">tool</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span>
<span class="linenos">598</span>        <span class="n">input_mapping</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;llm_output&quot;</span><span class="p">:</span> <span class="n">JUSTIFICATION_GEN_IO</span><span class="p">},</span>
<span class="linenos">599</span>        <span class="n">output_mapping</span><span class="o">=</span><span class="p">{</span><span class="n">ToolExecutionStep</span><span class="o">.</span><span class="n">TOOL_OUTPUT</span><span class="p">:</span> <span class="n">JUSTIFICATION_PARSING_IO</span><span class="p">},</span>
<span class="linenos">600</span>    <span class="p">)</span>
<span class="linenos">601</span>
<span class="linenos">602</span>
<span class="linenos">603</span><span class="k">def</span><span class="w"> </span><span class="nf">get_validation_step</span><span class="p">(</span><span class="n">llm</span><span class="p">:</span> <span class="n">LlmModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PromptExecutionStep</span><span class="p">:</span>
<span class="linenos">604</span>    <span class="k">return</span> <span class="n">PromptExecutionStep</span><span class="p">(</span>
<span class="linenos">605</span>        <span class="n">prompt_template</span><span class="o">=</span><span class="n">VALIDATION_PROMPT</span><span class="p">,</span>
<span class="linenos">606</span>        <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
<span class="linenos">607</span>        <span class="n">generation_config</span><span class="o">=</span><span class="n">LlmGenerationConfig</span><span class="p">(</span><span class="n">max_tokens</span><span class="o">=</span><span class="mi">2048</span><span class="p">),</span>
<span class="linenos">608</span>        <span class="n">input_mapping</span><span class="o">=</span><span class="p">{</span>
<span class="linenos">609</span>            <span class="s2">&quot;seed_example&quot;</span><span class="p">:</span> <span class="s2">&quot;seed_example&quot;</span><span class="p">,</span>
<span class="linenos">610</span>            <span class="s2">&quot;generated_row&quot;</span><span class="p">:</span> <span class="s2">&quot;generated_row&quot;</span><span class="p">,</span>
<span class="linenos">611</span>            <span class="s2">&quot;justification&quot;</span><span class="p">:</span> <span class="n">JUSTIFICATION_PARSING_IO</span><span class="p">,</span>
<span class="linenos">612</span>        <span class="p">},</span>
<span class="linenos">613</span>        <span class="n">output_mapping</span><span class="o">=</span><span class="p">{</span><span class="n">PromptExecutionStep</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">:</span> <span class="n">VALIDATION_IO</span><span class="p">},</span>
<span class="linenos">614</span>    <span class="p">)</span>
<span class="linenos">615</span>
<span class="linenos">616</span>
<span class="linenos">617</span><span class="k">def</span><span class="w"> </span><span class="nf">get_parse_validation_step</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ToolExecutionStep</span><span class="p">:</span>
<span class="linenos">618</span>    <span class="n">tool</span> <span class="o">=</span> <span class="n">ServerTool</span><span class="p">(</span>
<span class="linenos">619</span>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;parse_validation_output&quot;</span><span class="p">,</span>
<span class="linenos">620</span>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Parsing the specific LLM output of the validation step.&quot;</span><span class="p">,</span>
<span class="linenos">621</span>        <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
<span class="linenos">622</span>            <span class="s2">&quot;llm_output&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">623</span>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="linenos">624</span>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Output from validation step.&quot;</span><span class="p">,</span>
<span class="linenos">625</span>            <span class="p">}</span>
<span class="linenos">626</span>        <span class="p">},</span>
<span class="linenos">627</span>        <span class="n">func</span><span class="o">=</span><span class="n">parse_validation_output</span><span class="p">,</span>
<span class="linenos">628</span>        <span class="n">output</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">},</span>
<span class="linenos">629</span>    <span class="p">)</span>
<span class="linenos">630</span>    <span class="k">return</span> <span class="n">ToolExecutionStep</span><span class="p">(</span>
<span class="linenos">631</span>        <span class="n">tool</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span>
<span class="linenos">632</span>        <span class="n">input_mapping</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;llm_output&quot;</span><span class="p">:</span> <span class="n">VALIDATION_IO</span><span class="p">},</span>
<span class="linenos">633</span>        <span class="n">output_mapping</span><span class="o">=</span><span class="p">{</span><span class="n">ToolExecutionStep</span><span class="o">.</span><span class="n">TOOL_OUTPUT</span><span class="p">:</span> <span class="n">VALIDATION_PARSING_IO</span><span class="p">},</span>
<span class="linenos">634</span>    <span class="p">)</span>
<span class="linenos">635</span>
<span class="linenos">636</span>
<span class="linenos">637</span><span class="k">def</span><span class="w"> </span><span class="nf">get_retry_step</span><span class="p">(</span><span class="n">flow</span><span class="p">:</span> <span class="n">Flow</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RetryStep</span><span class="p">:</span>
<span class="linenos">638</span>    <span class="k">return</span> <span class="n">RetryStep</span><span class="p">(</span>
<span class="linenos">639</span>        <span class="n">flow</span><span class="o">=</span><span class="n">flow</span><span class="p">,</span>
<span class="linenos">640</span>        <span class="n">success_condition</span><span class="o">=</span><span class="n">VALIDATION_PARSING_IO</span><span class="p">,</span>
<span class="linenos">641</span>        <span class="n">max_num_trials</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="linenos">642</span>    <span class="p">)</span>
<span class="linenos">643</span>
<span class="linenos">644</span>
<span class="linenos">645</span><span class="k">def</span><span class="w"> </span><span class="nf">get_main_flow</span><span class="p">(</span><span class="n">llm_justification</span><span class="p">:</span> <span class="n">LlmModel</span><span class="p">,</span> <span class="n">llm_validation</span><span class="p">:</span> <span class="n">LlmModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Flow</span><span class="p">:</span>
<span class="linenos">646</span>    <span class="n">justification_gen_step</span> <span class="o">=</span> <span class="n">get_justification_generation_step</span><span class="p">(</span><span class="n">llm_justification</span><span class="p">)</span>
<span class="linenos">647</span>    <span class="n">justification_parse_step</span> <span class="o">=</span> <span class="n">get_parse_justification_step</span><span class="p">()</span>
<span class="linenos">648</span>    <span class="n">validation_step</span> <span class="o">=</span> <span class="n">get_validation_step</span><span class="p">(</span><span class="n">llm_validation</span><span class="p">)</span>
<span class="linenos">649</span>    <span class="n">validation_parse_step</span> <span class="o">=</span> <span class="n">get_parse_validation_step</span><span class="p">()</span>
<span class="linenos">650</span>
<span class="linenos">651</span>    <span class="n">steps</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">652</span>        <span class="n">JUSTIFICATION_GEN_STEP</span><span class="p">:</span> <span class="n">justification_gen_step</span><span class="p">,</span>
<span class="linenos">653</span>        <span class="n">JUSTIFICATION_PARSING_STEP</span><span class="p">:</span> <span class="n">justification_parse_step</span><span class="p">,</span>
<span class="linenos">654</span>        <span class="n">VALIDATION_STEP</span><span class="p">:</span> <span class="n">validation_step</span><span class="p">,</span>
<span class="linenos">655</span>        <span class="n">VALIDATION_PARSING_STEP</span><span class="p">:</span> <span class="n">validation_parse_step</span><span class="p">,</span>
<span class="linenos">656</span>    <span class="p">}</span>
<span class="linenos">657</span>    <span class="n">transitions</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">658</span>        <span class="n">JUSTIFICATION_GEN_STEP</span><span class="p">:</span> <span class="p">[</span><span class="n">JUSTIFICATION_PARSING_STEP</span><span class="p">],</span>
<span class="linenos">659</span>        <span class="n">JUSTIFICATION_PARSING_STEP</span><span class="p">:</span> <span class="p">[</span><span class="n">VALIDATION_STEP</span><span class="p">],</span>
<span class="linenos">660</span>        <span class="n">VALIDATION_STEP</span><span class="p">:</span> <span class="p">[</span><span class="n">VALIDATION_PARSING_STEP</span><span class="p">],</span>
<span class="linenos">661</span>        <span class="n">VALIDATION_PARSING_STEP</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">],</span>
<span class="linenos">662</span>    <span class="p">}</span>
<span class="linenos">663</span>
<span class="linenos">664</span>    <span class="k">return</span> <span class="n">Flow</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span> <span class="n">begin_step</span><span class="o">=</span><span class="n">justification_gen_step</span><span class="p">,</span> <span class="n">transitions</span><span class="o">=</span><span class="n">transitions</span><span class="p">)</span>
<span class="linenos">665</span>
<span class="linenos">666</span>
<span class="linenos">667</span><span class="k">def</span><span class="w"> </span><span class="nf">get_flow</span><span class="p">(</span><span class="n">llm_justification</span><span class="p">:</span> <span class="n">LlmModel</span><span class="p">,</span> <span class="n">llm_validation</span><span class="p">:</span> <span class="n">LlmModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Flow</span><span class="p">:</span>
<span class="linenos">668</span>    <span class="n">main_flow</span> <span class="o">=</span> <span class="n">get_main_flow</span><span class="p">(</span><span class="n">llm_justification</span><span class="p">,</span> <span class="n">llm_validation</span><span class="p">)</span>
<span class="linenos">669</span>    <span class="n">retry_step</span> <span class="o">=</span> <span class="n">get_retry_step</span><span class="p">(</span><span class="n">main_flow</span><span class="p">)</span>
<span class="linenos">670</span>    <span class="n">success_step</span> <span class="o">=</span> <span class="n">CompleteStep</span><span class="p">()</span>
<span class="linenos">671</span>    <span class="n">failure_step</span> <span class="o">=</span> <span class="n">CompleteStep</span><span class="p">()</span>
<span class="linenos">672</span>
<span class="linenos">673</span>    <span class="k">return</span> <span class="n">Flow</span><span class="p">(</span>
<span class="linenos">674</span>        <span class="n">begin_step</span><span class="o">=</span><span class="n">retry_step</span><span class="p">,</span>
<span class="linenos">675</span>        <span class="n">steps</span><span class="o">=</span><span class="p">{</span>
<span class="linenos">676</span>            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">retry_step</span><span class="p">,</span>
<span class="linenos">677</span>            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="n">success_step</span><span class="p">,</span>
<span class="linenos">678</span>            <span class="s2">&quot;failure&quot;</span><span class="p">:</span> <span class="n">failure_step</span><span class="p">,</span>
<span class="linenos">679</span>        <span class="p">},</span>
<span class="linenos">680</span>        <span class="n">control_flow_edges</span><span class="o">=</span><span class="p">[</span>
<span class="linenos">681</span>            <span class="n">ControlFlowEdge</span><span class="p">(</span>
<span class="linenos">682</span>                <span class="n">source_step</span><span class="o">=</span><span class="n">retry_step</span><span class="p">,</span>
<span class="linenos">683</span>                <span class="n">source_branch</span><span class="o">=</span><span class="n">retry_step</span><span class="o">.</span><span class="n">BRANCH_NEXT</span><span class="p">,</span>
<span class="linenos">684</span>                <span class="n">destination_step</span><span class="o">=</span><span class="n">success_step</span><span class="p">,</span>
<span class="linenos">685</span>            <span class="p">),</span>
<span class="linenos">686</span>            <span class="n">ControlFlowEdge</span><span class="p">(</span>
<span class="linenos">687</span>                <span class="n">source_step</span><span class="o">=</span><span class="n">retry_step</span><span class="p">,</span>
<span class="linenos">688</span>                <span class="n">source_branch</span><span class="o">=</span><span class="n">retry_step</span><span class="o">.</span><span class="n">BRANCH_FAILURE</span><span class="p">,</span>
<span class="linenos">689</span>                <span class="n">destination_step</span><span class="o">=</span><span class="n">failure_step</span><span class="p">,</span>
<span class="linenos">690</span>            <span class="p">),</span>
<span class="linenos">691</span>        <span class="p">],</span>
<span class="linenos">692</span>    <span class="p">)</span>
<span class="linenos">693</span>
<span class="linenos">694</span>
<span class="linenos">695</span><span class="c1"># %%[markdown]</span>
<span class="linenos">696</span><span class="n">llm</span> <span class="n">definition</span><span class="p">:</span>
<span class="linenos">697</span>
<span class="linenos">698</span><span class="c1"># %%</span>
<span class="linenos">699</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">VllmModel</span>
<span class="linenos">700</span>
<span class="linenos">701</span><span class="n">llm</span> <span class="o">=</span> <span class="n">VllmModel</span><span class="p">(</span>
<span class="linenos">702</span>    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;LLAMA_MODEL_ID&quot;</span><span class="p">,</span>
<span class="linenos">703</span>    <span class="n">host_port</span><span class="o">=</span><span class="s2">&quot;LLAMA_API_URL&quot;</span><span class="p">,</span>
<span class="linenos">704</span><span class="p">)</span>
<span class="linenos">705</span>
<span class="linenos">706</span>
<span class="linenos">707</span><span class="c1"># %%[markdown]</span>
<span class="linenos">708</span><span class="n">justification</span> <span class="n">generation</span><span class="p">:</span>
<span class="linenos">709</span>
<span class="linenos">710</span><span class="c1"># %%</span>
<span class="linenos">711</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.property</span><span class="w"> </span><span class="kn">import</span> <span class="n">ListProperty</span>
<span class="linenos">712</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.steps</span><span class="w"> </span><span class="kn">import</span> <span class="n">MapStep</span>
<span class="linenos">713</span>
<span class="linenos">714</span><span class="n">flow</span> <span class="o">=</span> <span class="n">create_single_step_flow</span><span class="p">(</span>
<span class="linenos">715</span>    <span class="n">step</span><span class="o">=</span><span class="n">MapStep</span><span class="p">(</span>
<span class="linenos">716</span>        <span class="n">flow</span><span class="o">=</span><span class="n">get_flow</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="n">llm</span><span class="p">),</span>
<span class="linenos">717</span>        <span class="n">parallel_execution</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">718</span>        <span class="n">unpack_input</span><span class="o">=</span><span class="p">{</span>
<span class="linenos">719</span>            <span class="s2">&quot;seed_example&quot;</span><span class="p">:</span> <span class="s2">&quot;.seed_example&quot;</span><span class="p">,</span>
<span class="linenos">720</span>            <span class="s2">&quot;generated_row&quot;</span><span class="p">:</span> <span class="s2">&quot;.generated_row&quot;</span><span class="p">,</span>
<span class="linenos">721</span>        <span class="p">},</span>
<span class="linenos">722</span>        <span class="n">output_descriptors</span><span class="o">=</span><span class="p">[</span><span class="n">ListProperty</span><span class="p">(</span><span class="n">JUSTIFICATION_PARSING_IO</span><span class="p">)],</span>
<span class="linenos">723</span>    <span class="p">)</span>
<span class="linenos">724</span><span class="p">)</span>
<span class="linenos">725</span>
<span class="linenos">726</span><span class="n">input_sequence</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos">727</span>    <span class="p">{</span>
<span class="linenos">728</span>        <span class="s2">&quot;seed_example&quot;</span><span class="p">:</span> <span class="n">df_seed</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos">729</span>        <span class="s2">&quot;generated_row&quot;</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
<span class="linenos">730</span>    <span class="p">}</span>
<span class="linenos">731</span>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_synthesized</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
<span class="linenos">732</span><span class="p">]</span>
<span class="linenos">733</span><span class="n">conversation</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="n">MapStep</span><span class="o">.</span><span class="n">ITERATED_INPUT</span><span class="p">:</span> <span class="n">input_sequence</span><span class="p">})</span>
<span class="linenos">734</span><span class="n">status</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">735</span><span class="n">df_synthesized</span><span class="p">[</span><span class="s2">&quot;justification&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">output_values</span><span class="p">[</span><span class="n">JUSTIFICATION_PARSING_IO</span><span class="p">]</span>
<span class="linenos">736</span>
<span class="linenos">737</span>
<span class="linenos">738</span>
<span class="linenos">739</span><span class="c1"># %%[markdown]</span>
<span class="linenos">740</span><span class="n">exporting</span> <span class="n">synthetic</span> <span class="n">dataset</span><span class="p">:</span>
<span class="linenos">741</span>
<span class="linenos">742</span><span class="c1"># %%</span>
<span class="linenos">743</span><span class="n">df_synthesized</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites-and-setup">Prerequisites and setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#target-schema-and-feature-properties">Target schema and feature properties</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-and-inspect-the-seed-data">Load and inspect the seed data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-synthesis">Data synthesis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#synthesis-functions">Synthesis functions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#structured-data-generation">Structured data generation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reproducibility">Reproducibility</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generation-configuration">Generation configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#univariate-distribution-preservation-example-region">Univariate distribution preservation example (region)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coherency-constraint-example-region-vs-country">Coherency constraint example (region vs. country)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#joint-distribution-example-customer-net-worth-region">Joint distribution example (customer_net_worth | region)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extrapolation-new-values-example-customer-name">Extrapolation (new values) example (customer_name)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#synthesizing-remaining-structured-features-according-to-property-table">Synthesizing remaining structured features according to property table</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verification-sanity-checks-and-distribution-comparison">Verification: sanity checks and distribution comparison</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#long-text-generation">Long text generation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#llm-selection-and-initialization">LLM selection and initialization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prompt-and-i-o-constants">Prompt and I/O constants</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parsing-functions">Parsing functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#justification-generation-flow-definition">Justification generation flow definition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#batch-justification-generation-and-validation">Batch justification generation and validation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synthetic-dataset-export">Synthetic dataset export</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap">Recap</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#full-code">Full code</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Oracle and/or its affiliates..
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>