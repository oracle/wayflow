


<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>How to Serve Agents with WayFlow &#8212; wayflowcore 26.1.0.dev0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dba54f56160742ef5599" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dba54f56160742ef5599" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css-style.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/core.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=dba54f56160742ef5599"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dba54f56160742ef5599" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dba54f56160742ef5599" />

  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'core/howtoguides/howto_serve_agents';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://oracle.github.io/wayflow/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
  <script src="../../_static/announcement.js"></script>

    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to Serve Assistants with A2A Protocol" href="howto_a2a_serving.html" />
    <link rel="prev" title="How to Build a Manager-Workers of Agents" href="howto_managerworkers.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="26.1" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo-light.svg" class="logo__image only-light" alt="wayflowcore 26.1.0.dev0 documentation - Home"/>
    <img src="../../_static/logo-dark.svg" class="logo__image only-dark pst-js-only" alt="wayflowcore 26.1.0.dev0 documentation - Home"/>
  
  
</a></div>
    
      <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/oracle/wayflow" title="WayFlow GitHub repository" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/icons/github-icon.svg" class="icon-link-image" alt="WayFlow GitHub repository"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/oracle/wayflow" title="WayFlow GitHub repository" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/icons/github-icon.svg" class="icon-link-image" alt="WayFlow GitHub repository"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essentials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/index.html">Tutorials &amp; Use Cases</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/basic_agent.html">Build a Simple Conversational Assistant with Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/basic_flow.html">Build a Simple Fixed-flow Assistant with Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/usecase_prbot.html">Build a Simple Code Review Assistant</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">How-to Guides</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="io_descriptors.html">Change Input and Output Descriptors of Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_async.html">Use Asynchronous APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing_ollama.html">Install and Use Ollama</a></li>
<li class="toctree-l2"><a class="reference internal" href="generation_config.html">Specify the Generation Configuration when Using LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="llm_from_different_providers.html">Use LLM from Different LLM Sources and Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_long_context.html">Handle long context with agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="agents.html">Create a ReAct Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_imagecontent.html">How to Send Images to LLMs and Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_ociagent.html">Use OCI Generative AI Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_a2aagent.html">How to Connect to A2A Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_prompttemplate.html">Use Templates for Advanced Prompting Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_userinputinflows.html">Ask for User Input in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="conditional_flows.html">Create Conditional Transitions in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_promptexecutionstep.html">Do Structured LLM Generation in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_userconfirmation.html">Add User Confirmation to a Tool Call Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="catching_exceptions.html">Catch Exceptions in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_mapstep.html">Do Map and Reduce Operations in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_parallelflowexecution.html">Run Multiple Flows in Parallel</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_agents_in_flows.html">Use Agents in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_multiagent.html">Build a Hierarchical Multi-Agent System</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_swarm.html">Build a Swarm of Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_managerworkers.html">Build a ManagerWorkers of Agents</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Serve Agents with WayFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_a2a_serving.html">Serve Assistants with A2A protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_build_assistants_with_tools.html">Build Assistants with Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_multiple_output_tool.html">Create Tools with Multiple Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_a_tool_from_a_flow.html">Convert Flows to Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_mcp.html">Connect MCP tools to Assistants</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_remote_tool_expired_token.html">Do Remote API Calls with Tokens</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_execute_agentspec_with_wayflowcore.html">Load and Execute an Agent Spec Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_serdeser.html">Serialize and Deserialize Flows and Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_serialize_conversations.html">Serialize and Deserialize Conversations</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_plugins.html">Build a New WayFlow Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_tracing.html">Enable Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_datastores.html">Connect Assistants to Your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddingmodels_from_different_providers.html">Use Embedding Models from Different Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_variable.html">Use Variables for Shared State in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_data_synthesis.html">Synthesize Data in WayFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_evaluation.html">Evaluate Assistants</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_conversation_evaluation.html">Evaluate Conversations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/agentspec.html">Agent Spec Adapters</a></li>


<li class="toctree-l2"><a class="reference internal" href="../api/conversation.html">Conversations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/llmmodels.html">LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/flows.html">Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/agent.html">Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/agentserver.html">Agent Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/embeddingmodels.html">Embedding Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/contextproviders.html">Context Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/interrupts.html">Execution Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/prompttemplate.html">PromptTemplates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/serialization.html">Serialization/Deserialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/tools.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/tracing.html">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/variables.html">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/datastores.html">Datastores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/warnings.html">Warnings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/evaluation.html">Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/component.html">Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/a2a.html">A2A</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../misc/reference_sheet.html">Reference Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">For Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faqs.html">Frequently Asked Questions</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">WayFlow</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">How-to Guides</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">How to Serve Agents with WayFlow</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="how-to-serve-agents-with-wayflow">
<span id="top-howtoserveagents"></span><h1>How to Serve Agents with WayFlow<a class="headerlink" href="#how-to-serve-agents-with-wayflow" title="Permalink to this heading">#</a></h1>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-row-cols-2 sd-row-cols-xs-2 sd-row-cols-sm-2 sd-row-cols-md-2 sd-row-cols-lg-2 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<a class="reference internal" href="../../_images/python-icon.svg"><img alt="python-icon" height="40px" src="../../_images/python-icon.svg" width="40px" /></a> Download Python Script</div>
<p class="sd-card-text">Python script/notebook for this guide.</p>
</div>
<a class="sd-stretched-link sd-hide-link-text reference external" href="../end_to_end_code_examples/howto_serve_agents.py"><span>Serve Agents how-to script</span></a></div>
</div>
</div>
</div>
<div class="admonition-prerequisites admonition">
<p class="admonition-title">Prerequisites</p>
<p>This guide assumes familiarity with:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../tutorials/basic_agent.html"><span class="doc">Agents</span></a></p></li>
<li><p><a class="reference internal" href="howto_datastores.html"><span class="doc">Datastores</span></a></p></li>
<li><p><a class="reference internal" href="../api/tools.html"><span class="doc">WayFlow Tools</span></a></p></li>
</ul>
</div>
<p>WayFlow can host agents behind an
<a class="reference external" href="https://platform.openai.com/docs/api-reference/responses">OpenAI Responses API</a> compatible
endpoint. Reliable serving unlocks predictable SLAs, reusable state, and consistent security, while
letting clients keep using familiar OpenAI SDKs. Start with an in-memory setup for quick
experiments, then add persistence to reuse conversation state and layer FastAPI security controls
that fit your environment.</p>
<section id="create-an-agent-to-host">
<h2>Create an agent to host<a class="headerlink" href="#create-an-agent-to-host" title="Permalink to this heading">#</a></h2>
<p>WayFlow supports several LLM API providers.
Select an LLM from the options below:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">OCI GenAI</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">vLLM</button><button aria-controls="panel-0-0-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-2" name="0-2" role="tab" tabindex="-1">Ollama</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">OCIGenAIModel</span><span class="p">,</span> <span class="n">OCIClientConfigWithApiKey</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">OCIGenAIModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;provider.model-id&quot;</span><span class="p">,</span>
    <span class="n">compartment_id</span><span class="o">=</span><span class="s2">&quot;compartment-id&quot;</span><span class="p">,</span>
    <span class="n">client_config</span><span class="o">=</span><span class="n">OCIClientConfigWithApiKey</span><span class="p">(</span>
        <span class="n">service_endpoint</span><span class="o">=</span><span class="s2">&quot;https://url-to-service-endpoint.com&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">VllmModel</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">VllmModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;model-id&quot;</span><span class="p">,</span>
    <span class="n">host_port</span><span class="o">=</span><span class="s2">&quot;VLLM_HOST_PORT&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-2" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-2" name="0-2" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">OllamaModel</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">OllamaModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;model-id&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>API keys should not be stored anywhere in the code. Use environment variables or tools such as <a class="reference external" href="https://pypi.org/project/python-dotenv/">python-dotenv</a>.</p>
</div>
<p>Then, create or reuse an agent you want to serve. You can define it as code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.tools.toolhelpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">DescriptionMode</span><span class="p">,</span> <span class="n">tool</span>

<span class="nd">@tool</span><span class="p">(</span><span class="n">description_mode</span><span class="o">=</span><span class="n">DescriptionMode</span><span class="o">.</span><span class="n">ONLY_DOCSTRING</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_policy</span><span class="p">(</span><span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a short HR policy excerpt.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2"> is available. Check the HR portal for details.&quot;</span>


<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">get_policy</span><span class="p">],</span>
    <span class="n">custom_instruction</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;You are an HR assistant.</span>
<span class="s2">- Call tools when you need facts.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>API Reference: <a class="reference internal" href="../api/agent.html#agent"><span class="std std-ref">Agent</span></a> | <a class="reference internal" href="../api/tools.html#servertool"><span class="std std-ref">Tool</span></a></p>
</section>
<section id="export-and-reload-agent-specs">
<h2>Export and reload agent specs<a class="headerlink" href="#export-and-reload-agent-specs" title="Permalink to this heading">#</a></h2>
<p>Save your agent as an Agent Spec so you can deploy from a config file or ship it to another team.
Reloading requires a <code class="docutils literal notranslate"><span class="pre">tool_registry</span></code> that maps tool names back to callables.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agentspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentSpecExporter</span><span class="p">,</span> <span class="n">AgentSpecLoader</span>

<span class="n">spec</span> <span class="o">=</span> <span class="n">AgentSpecExporter</span><span class="p">()</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
<span class="n">tool_registry</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;get_policy&quot;</span><span class="p">:</span> <span class="n">get_policy</span><span class="p">}</span>
<span class="n">agent_from_spec</span> <span class="o">=</span> <span class="n">AgentSpecLoader</span><span class="p">(</span><span class="n">tool_registry</span><span class="o">=</span><span class="n">tool_registry</span><span class="p">)</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
</pre></div>
</div>
<p>API Reference: <a class="reference internal" href="../api/agentspec.html#agentspecexporter"><span class="std std-ref">AgentSpecExporter</span></a> | <a class="reference internal" href="../api/agentspec.html#agentspecloader"><span class="std std-ref">AgentSpecLoader</span></a></p>
</section>
<section id="run-an-in-memory-responses-api-server">
<h2>Run an in-memory Responses API server<a class="headerlink" href="#run-an-in-memory-responses-api-server" title="Permalink to this heading">#</a></h2>
<p>Expose the agent with <a class="reference internal" href="../api/agentserver.html#openairesponsesserver"><span class="std std-ref">OpenAIResponsesServer</span></a>. The server mounts
<code class="docutils literal notranslate"><span class="pre">/v1/responses</span></code> and <code class="docutils literal notranslate"><span class="pre">/v1/models</span></code> endpoints that work with the official <code class="docutils literal notranslate"><span class="pre">openai</span></code> SDK or
<a class="reference internal" href="../api/llmmodels.html#openaicompatiblemodel"><span class="std std-ref">OpenAICompatibleModel</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agentserver.server</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIResponsesServer</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">OpenAIResponsesServer</span><span class="p">()</span>
<span class="n">server</span><span class="o">.</span><span class="n">serve_agent</span><span class="p">(</span><span class="s2">&quot;hr-assistant&quot;</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">get_app</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">3000</span><span class="p">)</span>
</pre></div>
</div>
<p>You can now call the server with an OpenAI-compatible client:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIAPIType</span><span class="p">,</span> <span class="n">OpenAICompatibleModel</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">OpenAICompatibleModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;hr-assistant&quot;</span><span class="p">,</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;http://127.0.0.1:3000&quot;</span><span class="p">,</span>
    <span class="n">api_type</span><span class="o">=</span><span class="n">OpenAIAPIType</span><span class="o">.</span><span class="n">RESPONSES</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">completion</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="s2">&quot;Summarize the vacation policy.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">completion</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<p>API Reference: <a class="reference internal" href="../api/agentserver.html#openairesponsesserver"><span class="std std-ref">OpenAIResponsesServer</span></a></p>
</section>
<section id="persist-conversations-with-datastores">
<h2>Persist conversations with datastores<a class="headerlink" href="#persist-conversations-with-datastores" title="Permalink to this heading">#</a></h2>
<p>To reuse conversation history across requests or server restarts, attach a datastore. Use
<a class="reference internal" href="../api/agentserver.html#serverstorageconfig"><span class="std std-ref">ServerStorageConfig</span></a> to define table and column names, then pass a
supported <a class="reference internal" href="../api/datastores.html#datastore"><span class="std std-ref">Datastore</span></a> implementation such as
<a class="reference internal" href="../api/datastores.html#postgresdatabasedatastore"><span class="std std-ref">PostgresDatabaseDatastore</span></a> or
<a class="reference internal" href="../api/datastores.html#oracledatabasedatastore"><span class="std std-ref">OracleDatabaseDatastore</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agentserver</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServerStorageConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.datastore.postgres</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">WithoutTlsPostgresDatabaseConnectionConfig</span><span class="p">,</span>
    <span class="n">PostgresDatabaseDatastore</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">storage_config</span> <span class="o">=</span> <span class="n">ServerStorageConfig</span><span class="p">(</span><span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;assistant_conversations&quot;</span><span class="p">)</span>

<span class="n">connection_config</span> <span class="o">=</span> <span class="n">WithoutTlsPostgresDatabaseConnectionConfig</span><span class="p">(</span>
    <span class="n">user</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PG_USER&quot;</span><span class="p">,</span> <span class="s2">&quot;postgres&quot;</span><span class="p">),</span>
    <span class="n">password</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PG_PASSWORD&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">),</span>
    <span class="n">url</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PG_HOST&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost:5432&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">datastore</span> <span class="o">=</span> <span class="n">PostgresDatabaseDatastore</span><span class="p">(</span>
    <span class="n">schema</span><span class="o">=</span><span class="n">storage_config</span><span class="o">.</span><span class="n">to_schema</span><span class="p">(),</span>
    <span class="n">connection_config</span><span class="o">=</span><span class="n">connection_config</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">persistent_server</span> <span class="o">=</span> <span class="n">OpenAIResponsesServer</span><span class="p">(</span>
    <span class="n">storage</span><span class="o">=</span><span class="n">datastore</span><span class="p">,</span>
    <span class="n">storage_config</span><span class="o">=</span><span class="n">storage_config</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">persistent_server</span><span class="o">.</span><span class="n">serve_agent</span><span class="p">(</span><span class="s2">&quot;hr-assistant&quot;</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span>
</pre></div>
</div>
<p>In production, create the table beforehand or run <code class="docutils literal notranslate"><span class="pre">wayflow</span> <span class="pre">serve</span></code> with <code class="docutils literal notranslate"><span class="pre">--setup-datastore</span> <span class="pre">yes</span></code>
to let WayFlow prepare it when the backend supports schema management. It will not override any
existing table, so you will need to first delete any existing table to allow wayflow to set it up
for you.</p>
<p>API Reference: <a class="reference internal" href="../api/agentserver.html#serverstorageconfig"><span class="std std-ref">ServerStorageConfig</span></a> | <a class="reference internal" href="../api/datastores.html#datastore"><span class="std std-ref">Datastore</span></a></p>
</section>
<section id="add-fastapi-security-controls">
<h2>Add FastAPI security controls<a class="headerlink" href="#add-fastapi-security-controls" title="Permalink to this heading">#</a></h2>
<p><a class="reference internal" href="../api/agentserver.html#openairesponsesserver"><span class="std std-ref">OpenAIResponsesServer</span></a> gives you the FastAPI <code class="docutils literal notranslate"><span class="pre">app</span></code> instance so
you can stack your own middleware, dependencies, or routers. This example enforces a simple bearer
token check.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">status</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.responses</span><span class="w"> </span><span class="kn">import</span> <span class="n">JSONResponse</span>

<span class="n">API_TOKEN</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;WAYFLOW_SERVER_TOKEN&quot;</span><span class="p">,</span> <span class="s2">&quot;change-me&quot;</span><span class="p">)</span>

<span class="n">secured_app</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">get_app</span><span class="p">()</span>

<span class="nd">@secured_app</span><span class="o">.</span><span class="n">middleware</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">require_bearer_token</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">call_next</span><span class="p">):</span>
    <span class="n">auth_header</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;authorization&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">expected_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">API_TOKEN</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">secrets</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">expected_header</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_401_UNAUTHORIZED</span><span class="p">,</span>
            <span class="n">content</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;detail&quot;</span><span class="p">:</span> <span class="s2">&quot;Missing or invalid bearer token&quot;</span><span class="p">},</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">call_next</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
<p>Replace the token check with your own authentication handler (OAuth2, mTLS validation, signed
cookies, IP filtering, etc.) and add rate limiting or CORS rules as needed.</p>
<p>API Reference: <a class="reference internal" href="../api/agentserver.html#openairesponsesserver"><span class="std std-ref">OpenAIResponsesServer</span></a></p>
</section>
<section id="use-the-cli">
<h2>Use the CLI<a class="headerlink" href="#use-the-cli" title="Permalink to this heading">#</a></h2>
<p>You can also serve an agent spec file directly from the CLI:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wayflow<span class="w"> </span>serve<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--api<span class="w"> </span>openai-responses<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--agent-config<span class="w"> </span>hr_agent.json<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--agent-id<span class="w"> </span>hr-assistant<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--server-storage<span class="w"> </span>postgres-db<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--datastore-connection-config<span class="w"> </span>postgres_conn.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--setup-datastore<span class="w"> </span>yes
</pre></div>
</div>
<p>Pass <code class="docutils literal notranslate"><span class="pre">--tool-registry</span></code> to load your own tools, swap <code class="docutils literal notranslate"><span class="pre">--server-storage</span></code> to <code class="docutils literal notranslate"><span class="pre">oracle-db</span></code> or
<code class="docutils literal notranslate"><span class="pre">in-memory</span></code>, and set <code class="docutils literal notranslate"><span class="pre">--server-storage-config</span></code> to override column names. See the <a class="reference internal" href="../api/agentserver.html#cliwayflowreference"><span class="std std-ref">API reference</span></a> for a
complete description of all arguments.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This CLI does not implement any security features; use it only for development or inside an
already-secured environment such as OCI agent deployments. Missing controls include:</p>
<ul class="simple">
<li><p><strong>Authentication</strong>: No verification of caller identity—anyone with network access can invoke the agent.</p></li>
<li><p><strong>Authorization</strong>: No role or permission checks to restrict which users can access specific agents or actions.</p></li>
<li><p><strong>Rate limiting</strong>: No protection against excessive requests that could exhaust resources or incur runaway costs.</p></li>
<li><p><strong>TLS/HTTPS</strong>: Traffic is unencrypted by default, risking interception of sensitive prompts and responses.</p></li>
</ul>
<p>For production deployments, wrap the server with an API gateway, reverse proxy, or custom FastAPI middleware that enforces these controls.</p>
</div>
</section>
<section id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="howto_agents_in_flows.html"><span class="doc">Use Agents in Flows</span></a></p></li>
<li><p><a class="reference internal" href="howto_datastores.html"><span class="doc">Connect Assistants to Your Data</span></a></p></li>
<li><p><a class="reference internal" href="howto_build_assistants_with_tools.html"><span class="doc">Build Assistants with Tools</span></a></p></li>
</ul>
</section>
<section id="full-code">
<h2>Full code<a class="headerlink" href="#full-code" title="Permalink to this heading">#</a></h2>
<p>Click on the card at the <a class="reference internal" href="#top-howtoserveagents"><span class="std std-ref">top of this page</span></a> to download the full code
for this guide or copy the code below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1"># Copyright © 2025 Oracle and/or its affiliates.</span>
<span class="linenos">  2</span><span class="c1">#</span>
<span class="linenos">  3</span><span class="c1"># This software is under the Apache License 2.0</span>
<span class="linenos">  4</span><span class="c1"># %%[markdown]</span>
<span class="linenos">  5</span><span class="c1"># WayFlow Code Example - How to Serve Agents with WayFlow</span>
<span class="linenos">  6</span><span class="c1"># -------------------------------------------------------</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="c1"># How to use:</span>
<span class="linenos">  9</span><span class="c1"># Create a new Python virtual environment and install the latest WayFlow version.</span>
<span class="linenos"> 10</span><span class="c1"># ```bash</span>
<span class="linenos"> 11</span><span class="c1"># python -m venv venv-wayflowcore</span>
<span class="linenos"> 12</span><span class="c1"># source venv-wayflowcore/bin/activate</span>
<span class="linenos"> 13</span><span class="c1"># pip install --upgrade pip</span>
<span class="linenos"> 14</span><span class="c1"># pip install &quot;wayflowcore==26.1&quot; </span>
<span class="linenos"> 15</span><span class="c1"># ```</span>
<span class="linenos"> 16</span>
<span class="linenos"> 17</span><span class="c1"># You can now run the script</span>
<span class="linenos"> 18</span><span class="c1"># 1. As a Python file:</span>
<span class="linenos"> 19</span><span class="c1"># ```bash</span>
<span class="linenos"> 20</span><span class="c1"># python howto_serve_agents.py</span>
<span class="linenos"> 21</span><span class="c1"># ```</span>
<span class="linenos"> 22</span><span class="c1"># 2. As a Notebook (in VSCode):</span>
<span class="linenos"> 23</span><span class="c1"># When viewing the file,</span>
<span class="linenos"> 24</span><span class="c1">#  - press the keys Ctrl + Enter to run the selected cell</span>
<span class="linenos"> 25</span><span class="c1">#  - or Shift + Enter to run the selected cell and move to the cell below# (LICENSE-APACHE or http://www.apache.org/licenses/LICENSE-2.0) or Universal Permissive License</span>
<span class="linenos"> 26</span><span class="c1"># (UPL) 1.0 (LICENSE-UPL or https://oss.oracle.com/licenses/upl), at your option.</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="linenos"> 30</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 33</span><span class="c1">## Define the llm</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span><span class="c1"># %%</span>
<span class="linenos"> 36</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">VllmModel</span>
<span class="linenos"> 37</span>
<span class="linenos"> 38</span><span class="n">llm</span> <span class="o">=</span> <span class="n">VllmModel</span><span class="p">(</span>
<span class="linenos"> 39</span>    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;LLAMA_MODEL_ID&quot;</span><span class="p">,</span>
<span class="linenos"> 40</span>    <span class="n">host_port</span><span class="o">=</span><span class="s2">&quot;LLAMA_API_URL&quot;</span><span class="p">,</span>
<span class="linenos"> 41</span><span class="p">)</span>
<span class="linenos"> 42</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 45</span><span class="c1">## Define the agent</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span><span class="c1"># %%</span>
<span class="linenos"> 48</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
<span class="linenos"> 49</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.tools.toolhelpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">DescriptionMode</span><span class="p">,</span> <span class="n">tool</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span><span class="nd">@tool</span><span class="p">(</span><span class="n">description_mode</span><span class="o">=</span><span class="n">DescriptionMode</span><span class="o">.</span><span class="n">ONLY_DOCSTRING</span><span class="p">)</span>
<span class="linenos"> 52</span><span class="k">def</span><span class="w"> </span><span class="nf">get_policy</span><span class="p">(</span><span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 53</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a short HR policy excerpt.&quot;&quot;&quot;</span>
<span class="linenos"> 54</span>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2"> is available. Check the HR portal for details.&quot;</span>
<span class="linenos"> 55</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
<span class="linenos"> 58</span>    <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
<span class="linenos"> 59</span>    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">get_policy</span><span class="p">],</span>
<span class="linenos"> 60</span>    <span class="n">custom_instruction</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;You are an HR assistant.</span>
<span class="linenos"> 61</span><span class="s2">- Call tools when you need facts.&quot;&quot;&quot;</span><span class="p">,</span>
<span class="linenos"> 62</span><span class="p">)</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span>
<span class="linenos"> 65</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 66</span><span class="c1">## Export agent spec</span>
<span class="linenos"> 67</span>
<span class="linenos"> 68</span><span class="c1"># %%</span>
<span class="linenos"> 69</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agentspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentSpecExporter</span><span class="p">,</span> <span class="n">AgentSpecLoader</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span><span class="n">spec</span> <span class="o">=</span> <span class="n">AgentSpecExporter</span><span class="p">()</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
<span class="linenos"> 72</span><span class="n">tool_registry</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;get_policy&quot;</span><span class="p">:</span> <span class="n">get_policy</span><span class="p">}</span>
<span class="linenos"> 73</span><span class="n">agent_from_spec</span> <span class="o">=</span> <span class="n">AgentSpecLoader</span><span class="p">(</span><span class="n">tool_registry</span><span class="o">=</span><span class="n">tool_registry</span><span class="p">)</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
<span class="linenos"> 74</span>
<span class="linenos"> 75</span>
<span class="linenos"> 76</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 77</span><span class="c1">## Serve in memory</span>
<span class="linenos"> 78</span>
<span class="linenos"> 79</span><span class="c1"># %%</span>
<span class="linenos"> 80</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agentserver.server</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIResponsesServer</span>
<span class="linenos"> 81</span>
<span class="linenos"> 82</span><span class="n">server</span> <span class="o">=</span> <span class="n">OpenAIResponsesServer</span><span class="p">()</span>
<span class="linenos"> 83</span><span class="n">server</span><span class="o">.</span><span class="n">serve_agent</span><span class="p">(</span><span class="s2">&quot;hr-assistant&quot;</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span>
<span class="linenos"> 84</span><span class="n">app</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">get_app</span><span class="p">()</span>
<span class="linenos"> 85</span>
<span class="linenos"> 86</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos"> 87</span>    <span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">3000</span><span class="p">)</span>
<span class="linenos"> 88</span>
<span class="linenos"> 89</span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 92</span><span class="c1">## Call the server</span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span><span class="c1"># %%</span>
<span class="linenos"> 95</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenAIAPIType</span><span class="p">,</span> <span class="n">OpenAICompatibleModel</span>
<span class="linenos"> 96</span>
<span class="linenos"> 97</span><span class="n">client</span> <span class="o">=</span> <span class="n">OpenAICompatibleModel</span><span class="p">(</span>
<span class="linenos"> 98</span>    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;hr-assistant&quot;</span><span class="p">,</span>
<span class="linenos"> 99</span>    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;http://127.0.0.1:3000&quot;</span><span class="p">,</span>
<span class="linenos">100</span>    <span class="n">api_type</span><span class="o">=</span><span class="n">OpenAIAPIType</span><span class="o">.</span><span class="n">RESPONSES</span><span class="p">,</span>
<span class="linenos">101</span><span class="p">)</span>
<span class="linenos">102</span><span class="n">completion</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="s2">&quot;Summarize the vacation policy.&quot;</span><span class="p">)</span>
<span class="linenos">103</span><span class="nb">print</span><span class="p">(</span><span class="n">completion</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="linenos">104</span>
<span class="linenos">105</span>
<span class="linenos">106</span><span class="c1"># %%[markdown]</span>
<span class="linenos">107</span><span class="c1">## Persistent storage</span>
<span class="linenos">108</span>
<span class="linenos">109</span><span class="c1"># %%</span>
<span class="linenos">110</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agentserver</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServerStorageConfig</span>
<span class="linenos">111</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.datastore.postgres</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="linenos">112</span>    <span class="n">WithoutTlsPostgresDatabaseConnectionConfig</span><span class="p">,</span>
<span class="linenos">113</span>    <span class="n">PostgresDatabaseDatastore</span><span class="p">,</span>
<span class="linenos">114</span><span class="p">)</span>
<span class="linenos">115</span>
<span class="linenos">116</span><span class="n">storage_config</span> <span class="o">=</span> <span class="n">ServerStorageConfig</span><span class="p">(</span><span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;assistant_conversations&quot;</span><span class="p">)</span>
<span class="linenos">117</span>
<span class="linenos">118</span><span class="n">connection_config</span> <span class="o">=</span> <span class="n">WithoutTlsPostgresDatabaseConnectionConfig</span><span class="p">(</span>
<span class="linenos">119</span>    <span class="n">user</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PG_USER&quot;</span><span class="p">,</span> <span class="s2">&quot;postgres&quot;</span><span class="p">),</span>
<span class="linenos">120</span>    <span class="n">password</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PG_PASSWORD&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">),</span>
<span class="linenos">121</span>    <span class="n">url</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PG_HOST&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost:5432&quot;</span><span class="p">),</span>
<span class="linenos">122</span><span class="p">)</span>
<span class="linenos">123</span>
<span class="linenos">124</span><span class="n">datastore</span> <span class="o">=</span> <span class="n">PostgresDatabaseDatastore</span><span class="p">(</span>
<span class="linenos">125</span>    <span class="n">schema</span><span class="o">=</span><span class="n">storage_config</span><span class="o">.</span><span class="n">to_schema</span><span class="p">(),</span>
<span class="linenos">126</span>    <span class="n">connection_config</span><span class="o">=</span><span class="n">connection_config</span><span class="p">,</span>
<span class="linenos">127</span><span class="p">)</span>
<span class="linenos">128</span>
<span class="linenos">129</span><span class="n">persistent_server</span> <span class="o">=</span> <span class="n">OpenAIResponsesServer</span><span class="p">(</span>
<span class="linenos">130</span>    <span class="n">storage</span><span class="o">=</span><span class="n">datastore</span><span class="p">,</span>
<span class="linenos">131</span>    <span class="n">storage_config</span><span class="o">=</span><span class="n">storage_config</span><span class="p">,</span>
<span class="linenos">132</span><span class="p">)</span>
<span class="linenos">133</span><span class="n">persistent_server</span><span class="o">.</span><span class="n">serve_agent</span><span class="p">(</span><span class="s2">&quot;hr-assistant&quot;</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span>
<span class="linenos">134</span>
<span class="linenos">135</span>
<span class="linenos">136</span><span class="c1"># %%[markdown]</span>
<span class="linenos">137</span><span class="c1">## Add fastapi security</span>
<span class="linenos">138</span>
<span class="linenos">139</span><span class="c1"># %%</span>
<span class="linenos">140</span><span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
<span class="linenos">141</span><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">status</span>
<span class="linenos">142</span><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.responses</span><span class="w"> </span><span class="kn">import</span> <span class="n">JSONResponse</span>
<span class="linenos">143</span>
<span class="linenos">144</span><span class="n">API_TOKEN</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;WAYFLOW_SERVER_TOKEN&quot;</span><span class="p">,</span> <span class="s2">&quot;change-me&quot;</span><span class="p">)</span>
<span class="linenos">145</span>
<span class="linenos">146</span><span class="n">secured_app</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">get_app</span><span class="p">()</span>
<span class="linenos">147</span>
<span class="linenos">148</span><span class="nd">@secured_app</span><span class="o">.</span><span class="n">middleware</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">)</span>
<span class="linenos">149</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">require_bearer_token</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">call_next</span><span class="p">):</span>
<span class="linenos">150</span>    <span class="n">auth_header</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;authorization&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="linenos">151</span>    <span class="n">expected_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">API_TOKEN</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="linenos">152</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">secrets</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">auth_header</span><span class="p">,</span> <span class="n">expected_header</span><span class="p">):</span>
<span class="linenos">153</span>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span>
<span class="linenos">154</span>            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_401_UNAUTHORIZED</span><span class="p">,</span>
<span class="linenos">155</span>            <span class="n">content</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;detail&quot;</span><span class="p">:</span> <span class="s2">&quot;Missing or invalid bearer token&quot;</span><span class="p">},</span>
<span class="linenos">156</span>        <span class="p">)</span>
<span class="linenos">157</span>    <span class="k">return</span> <span class="k">await</span> <span class="n">call_next</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-an-agent-to-host">Create an agent to host</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#export-and-reload-agent-specs">Export and reload agent specs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-an-in-memory-responses-api-server">Run an in-memory Responses API server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#persist-conversations-with-datastores">Persist conversations with datastores</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-fastapi-security-controls">Add FastAPI security controls</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-the-cli">Use the CLI</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#full-code">Full code</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=dba54f56160742ef5599"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=dba54f56160742ef5599"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Oracle and/or its affiliates..
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>