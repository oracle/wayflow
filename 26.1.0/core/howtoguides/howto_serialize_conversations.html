


<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>How to Serialize and Deserialize Conversations &#8212; wayflowcore 26.1.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css-style.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/core.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'core/howtoguides/howto_serialize_conversations';</script>
  <script src="../../_static/announcement.js"></script>

    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to Create New WayFlow Components" href="howto_plugins.html" />
    <link rel="prev" title="How to Serialize and Deserialize Flows and Agents" href="howto_serdeser.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="26.1" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo-light.svg" class="logo__image only-light" alt="wayflowcore 26.1.0 documentation - Home"/>
    <img src="../../_static/logo-dark.svg" class="logo__image only-dark pst-js-only" alt="wayflowcore 26.1.0 documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/oracle/wayflow" title="WayFlow GitHub repository" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/icons/github-icon.svg" class="icon-link-image" alt="WayFlow GitHub repository"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/oracle/wayflow" title="WayFlow GitHub repository" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/icons/github-icon.svg" class="icon-link-image" alt="WayFlow GitHub repository"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essentials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/index.html">Tutorials &amp; Use Cases</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/basic_agent.html">Build a Simple Conversational Assistant with Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/basic_flow.html">Build a Simple Fixed-flow Assistant with Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/usecase_prbot.html">Build a Simple Code Review Assistant</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">How-to Guides</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="io_descriptors.html">Change Input and Output Descriptors of Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_async.html">Use Asynchronous APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing_ollama.html">Install and Use Ollama</a></li>
<li class="toctree-l2"><a class="reference internal" href="generation_config.html">Specify the Generation Configuration when Using LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="llm_from_different_providers.html">Use LLM from Different LLM Sources and Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_long_context.html">Handle long context with agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="agents.html">Create a ReAct Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_imagecontent.html">How to Send Images to LLMs and Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_ociagent.html">Use OCI Generative AI Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_a2aagent.html">How to Connect to A2A Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_prompttemplate.html">Use Templates for Advanced Prompting Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_userinputinflows.html">Ask for User Input in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="conditional_flows.html">Create Conditional Transitions in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_promptexecutionstep.html">Do Structured LLM Generation in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_userconfirmation.html">Add User Confirmation to a Tool Call Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="catching_exceptions.html">Catch Exceptions in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_mapstep.html">Do Map and Reduce Operations in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_parallelflowexecution.html">Run Multiple Flows in Parallel</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_flowbuilder.html">Build Flows with the Flow Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_agents_in_flows.html">Use Agents in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_multiagent.html">Build a Hierarchical Multi-Agent System</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_swarm.html">Build a Swarm of Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_managerworkers.html">Build a ManagerWorkers of Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_serve_agents.html">Serve Agents with WayFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_a2a_serving.html">Serve Assistants with A2A protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_build_assistants_with_tools.html">Build Assistants with Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_multiple_output_tool.html">Create Tools with Multiple Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_a_tool_from_a_flow.html">Convert Flows to Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_mcp.html">Connect MCP tools to Assistants</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_remote_tool_expired_token.html">Do Remote API Calls with Tokens</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_execute_agentspec_with_wayflowcore.html">Load and Execute an Agent Spec Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_serdeser.html">Serialize and Deserialize Flows and Agents</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Serialize and Deserialize Conversations</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_plugins.html">Build a New WayFlow Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_tracing.html">Enable Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_event_system.html">Use the Event System</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_datastores.html">Connect Assistants to Your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddingmodels_from_different_providers.html">Use Embedding Models from Different Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_variable.html">Use Variables for Shared State in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_data_synthesis.html">Synthesize Data in WayFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_evaluation.html">Evaluate Assistants</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_conversation_evaluation.html">Evaluate Conversations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/agentspec.html">Agent Spec Adapters</a></li>


<li class="toctree-l2"><a class="reference internal" href="../api/conversation.html">Conversations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/llmmodels.html">LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/flows.html">Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/agent.html">Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/agentserver.html">Agent Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/embeddingmodels.html">Embedding Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/contextproviders.html">Context Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/interrupts.html">Execution Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/prompttemplate.html">PromptTemplates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/serialization.html">Serialization/Deserialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/tools.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/tracing.html">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/variables.html">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/datastores.html">Datastores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/warnings.html">Warnings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/evaluation.html">Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/component.html">Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/a2a.html">A2A</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../misc/reference_sheet.html">Reference Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">For Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faqs.html">Frequently Asked Questions</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">WayFlow</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">How-to Guides</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">How to Serialize and Deserialize Conversations</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="how-to-serialize-and-deserialize-conversations">
<span id="top-howtoserializeconversations"></span><h1>How to Serialize and Deserialize Conversations<a class="headerlink" href="#how-to-serialize-and-deserialize-conversations" title="Permalink to this heading">#</a></h1>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-row-cols-2 sd-row-cols-xs-2 sd-row-cols-sm-2 sd-row-cols-md-2 sd-row-cols-lg-2 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<a class="reference internal" href="../../_images/python-icon.svg"><img alt="python-icon" height="40px" src="../../_images/python-icon.svg" width="40px" /></a> Download Python Script</div>
<p class="sd-card-text">Python script/notebook for this guide.</p>
</div>
<a class="sd-stretched-link sd-hide-link-text reference external" href="../end_to_end_code_examples/howto_serialize_conversations.py"><span>Serialize conversation how-to script</span></a></div>
</div>
</div>
</div>
<div class="admonition-prerequisites admonition">
<p class="admonition-title">Prerequisites</p>
<p>This guide assumes familiarity with:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../tutorials/basic_agent.html"><span class="doc">Agents</span></a></p></li>
<li><p><a class="reference internal" href="../tutorials/basic_flow.html"><span class="doc">Flows</span></a></p></li>
</ul>
</div>
<p>When building AI assistants, it id=s often necessary to save the state of a conversation to disk and restore it later.
This is essential for creating persistent applications that can:</p>
<ul class="simple">
<li><p>Resume conversations after an application restart</p></li>
<li><p>Save user sessions for later continuation</p></li>
<li><p>Implement conversation history and analytics</p></li>
<li><p>Support multi-session workflows</p></li>
</ul>
<p>In this tutorial, you will learn how to:</p>
<ul class="simple">
<li><p><strong>Serialize Agent conversations</strong> to JSON files</p></li>
<li><p><strong>Serialize Flow conversations</strong> at any point during execution</p></li>
<li><p><strong>Deserialize and resume</strong> both types of conversations</p></li>
<li><p><strong>Build persistent conversation loops</strong> that survive application restarts</p></li>
</ul>
<section id="concepts-shown-in-this-guide">
<h2>Concepts shown in this guide<a class="headerlink" href="#concepts-shown-in-this-guide" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../api/serialization.html#serialize"><span class="std std-ref">serialize</span></a> to convert conversations to storable format</p></li>
<li><p><a class="reference internal" href="../api/serialization.html#autodeserialize"><span class="std std-ref">autodeserialize</span></a> to restore conversations from storage</p></li>
<li><p>Handling conversation state persistence for both Agents and Flows</p></li>
</ul>
</section>
<section id="basic-serialization">
<h2>Basic Serialization<a class="headerlink" href="#basic-serialization" title="Permalink to this heading">#</a></h2>
<section id="step-1-add-imports-and-configure-llm">
<h3>Step 1. Add imports and configure LLM<a class="headerlink" href="#step-1-add-imports-and-configure-llm" title="Permalink to this heading">#</a></h3>
<p>Start by importing the necessary packages for serialization:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.controlconnection</span><span class="w"> </span><span class="kn">import</span> <span class="n">ControlFlowEdge</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.conversation</span><span class="w"> </span><span class="kn">import</span> <span class="n">Conversation</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.dataconnection</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataFlowEdge</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.executors.executionstatus</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">FinishedStatus</span><span class="p">,</span>
    <span class="n">UserMessageRequestStatus</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.flow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flow</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.serialization</span><span class="w"> </span><span class="kn">import</span> <span class="n">autodeserialize</span><span class="p">,</span> <span class="n">serialize</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.steps</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">CompleteStep</span><span class="p">,</span>
    <span class="n">InputMessageStep</span><span class="p">,</span>
    <span class="n">OutputMessageStep</span><span class="p">,</span>
    <span class="n">StartStep</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>WayFlow supports several LLM API providers.
Select an LLM from the options below:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">OCI GenAI</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">vLLM</button><button aria-controls="panel-0-0-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-2" name="0-2" role="tab" tabindex="-1">Ollama</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">OCIGenAIModel</span><span class="p">,</span> <span class="n">OCIClientConfigWithApiKey</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">OCIGenAIModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;provider.model-id&quot;</span><span class="p">,</span>
    <span class="n">compartment_id</span><span class="o">=</span><span class="s2">&quot;compartment-id&quot;</span><span class="p">,</span>
    <span class="n">client_config</span><span class="o">=</span><span class="n">OCIClientConfigWithApiKey</span><span class="p">(</span>
        <span class="n">service_endpoint</span><span class="o">=</span><span class="s2">&quot;https://url-to-service-endpoint.com&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">VllmModel</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">VllmModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;model-id&quot;</span><span class="p">,</span>
    <span class="n">host_port</span><span class="o">=</span><span class="s2">&quot;VLLM_HOST_PORT&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-2" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-2" name="0-2" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">OllamaModel</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">OllamaModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;model-id&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div></div>
</section>
<section id="step-2-create-storage-functions">
<h3>Step 2. Create storage functions<a class="headerlink" href="#step-2-create-storage-functions" title="Permalink to this heading">#</a></h3>
<p>Define helper functions to store and load conversations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DIR_PATH</span> <span class="o">=</span> <span class="s2">&quot;path/to/your/dir&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">store_conversation</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversation</span><span class="p">:</span> <span class="n">Conversation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Store the given conversation and return the conversation id.&quot;&quot;&quot;</span>
    <span class="n">conversation_id</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">conversation_id</span>
    <span class="n">serialized_conversation</span> <span class="o">=</span> <span class="n">serialize</span><span class="p">(</span><span class="n">conversation</span><span class="p">)</span>

    <span class="c1"># Read existing data</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Add new conversation</span>
    <span class="n">data</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialized_conversation</span>

    <span class="c1"># Write back to file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">conversation_id</span>


<span class="k">def</span><span class="w"> </span><span class="nf">load_conversation</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Conversation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a conversation given its id.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">serialized_conversation</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">autodeserialize</span><span class="p">(</span><span class="n">serialized_conversation</span><span class="p">)</span>
</pre></div>
</div>
<p>These functions:</p>
<ul class="simple">
<li><p>Use WayFlowâ€™s <code class="docutils literal notranslate"><span class="pre">serialize()</span></code> to convert conversations to a storable format</p></li>
<li><p>Store multiple conversations in a single JSON file indexed by conversation ID</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">autodeserialize()</span></code> to restore the original conversation objects</p></li>
</ul>
</section>
</section>
<section id="serializing-agent-conversations">
<h2>Serializing Agent conversations<a class="headerlink" href="#serializing-agent-conversations" title="Permalink to this heading">#</a></h2>
<p>Agent conversations can be serialized at any point during execution:</p>
<section id="step-1-create-an-agent">
<h3>Step 1. Create an Agent<a class="headerlink" href="#step-1-create-an-agent" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">assistant</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">custom_instruction</span><span class="o">=</span><span class="s2">&quot;You are a helpful assistant. Be concise.&quot;</span><span class="p">,</span>
    <span class="n">agent_id</span><span class="o">=</span><span class="s2">&quot;simple_assistant&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="step-2-run-the-conversation">
<h3>Step 2. Run the conversation<a class="headerlink" href="#step-2-run-the-conversation" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start a conversation</span>
<span class="n">conversation</span> <span class="o">=</span> <span class="n">assistant</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">()</span>
<span class="n">conversation_id</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">conversation_id</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1. Started conversation with ID: </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Execute initial greeting</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;2. Assistant says: </span><span class="si">{</span><span class="n">conversation</span><span class="o">.</span><span class="n">get_last_message</span><span class="p">()</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Add user message</span>
<span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;What is 2+2?&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. User asks: What is 2+2?&quot;</span><span class="p">)</span>

<span class="c1"># Execute to get response</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;4. Assistant responds: </span><span class="si">{</span><span class="n">conversation</span><span class="o">.</span><span class="n">get_last_message</span><span class="p">()</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="step-3-serialize-the-conversation">
<h3>Step 3. Serialize the conversation<a class="headerlink" href="#step-3-serialize-the-conversation" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">AGENT_STORE_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DIR_PATH</span><span class="p">,</span> <span class="s2">&quot;agent_conversation.json&quot;</span><span class="p">)</span>
<span class="n">store_conversation</span><span class="p">(</span><span class="n">AGENT_STORE_PATH</span><span class="p">,</span> <span class="n">conversation</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;5. Conversation serialized to </span><span class="si">{</span><span class="n">AGENT_STORE_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="step-4-deserialize-the-conversation">
<h3>Step 4. Deserialize the conversation<a class="headerlink" href="#step-4-deserialize-the-conversation" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">loaded_conversation</span> <span class="o">=</span> <span class="n">load_conversation</span><span class="p">(</span><span class="n">AGENT_STORE_PATH</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;6. Conversation deserialized from </span><span class="si">{</span><span class="n">AGENT_STORE_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Print the loaded conversation messages</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;7. Loaded conversation messages:&quot;</span><span class="p">)</span>
<span class="n">messages</span> <span class="o">=</span> <span class="n">loaded_conversation</span><span class="o">.</span><span class="n">message_list</span><span class="o">.</span><span class="n">messages</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">message_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;AGENT&quot;</span><span class="p">:</span>
        <span class="n">role</span> <span class="o">=</span> <span class="s2">&quot;Assistant&quot;</span>
    <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">message_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;USER&quot;</span><span class="p">:</span>
        <span class="n">role</span> <span class="o">=</span> <span class="s2">&quot;User&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">message_type</span><span class="o">.</span><span class="n">name</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   [</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">role</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>Key points:</p>
<ul class="simple">
<li><p>Each conversation has a unique <code class="docutils literal notranslate"><span class="pre">conversation_id</span></code></p></li>
<li><p>The entire conversation state is preserved, including message history</p></li>
<li><p>Loaded conversations retain their complete state and can resume execution</p></li>
<li><p>Access messages through <code class="docutils literal notranslate"><span class="pre">conversation.message_list.messages</span></code></p></li>
</ul>
</section>
</section>
<section id="serializing-flow-conversations">
<h2>Serializing Flow Conversations<a class="headerlink" href="#serializing-flow-conversations" title="Permalink to this heading">#</a></h2>
<p>Flow conversations require special attention as they can be serialized mid-execution:</p>
<section id="step-1-create-a-flow">
<h3>Step 1. Create a Flow<a class="headerlink" href="#step-1-create-a-flow" title="Permalink to this heading">#</a></h3>
<p>First, create a flow using the builder function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">start_step</span> <span class="o">=</span> <span class="n">StartStep</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;start_step&quot;</span><span class="p">)</span>
<span class="n">input_step</span> <span class="o">=</span> <span class="n">InputMessageStep</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;input_step&quot;</span><span class="p">,</span>
    <span class="n">message_template</span><span class="o">=</span><span class="s2">&quot;What&#39;s your favorite color?&quot;</span><span class="p">,</span>
    <span class="n">output_mapping</span><span class="o">=</span><span class="p">{</span><span class="n">InputMessageStep</span><span class="o">.</span><span class="n">USER_PROVIDED_INPUT</span><span class="p">:</span> <span class="s2">&quot;user_color&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">output_step</span> <span class="o">=</span> <span class="n">OutputMessageStep</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;output_step&quot;</span><span class="p">,</span> <span class="n">message_template</span><span class="o">=</span><span class="s2">&quot;Your favorite color is {{ user_color }}. Nice choice!&quot;</span>
<span class="p">)</span>
<span class="n">end_step</span> <span class="o">=</span> <span class="n">CompleteStep</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;end_step&quot;</span><span class="p">)</span>

<span class="n">simple_flow</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">(</span>
    <span class="n">begin_step</span><span class="o">=</span><span class="n">start_step</span><span class="p">,</span>
    <span class="n">control_flow_edges</span><span class="o">=</span><span class="p">[</span>
        <span class="n">ControlFlowEdge</span><span class="p">(</span><span class="n">start_step</span><span class="p">,</span> <span class="n">input_step</span><span class="p">),</span>
        <span class="n">ControlFlowEdge</span><span class="p">(</span><span class="n">input_step</span><span class="p">,</span> <span class="n">output_step</span><span class="p">),</span>
        <span class="n">ControlFlowEdge</span><span class="p">(</span><span class="n">output_step</span><span class="p">,</span> <span class="n">end_step</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">data_flow_edges</span><span class="o">=</span><span class="p">[</span>
        <span class="n">DataFlowEdge</span><span class="p">(</span>
            <span class="n">source_step</span><span class="o">=</span><span class="n">input_step</span><span class="p">,</span>
            <span class="n">source_output</span><span class="o">=</span><span class="s2">&quot;user_color&quot;</span><span class="p">,</span>
            <span class="n">destination_step</span><span class="o">=</span><span class="n">output_step</span><span class="p">,</span>
            <span class="n">destination_input</span><span class="o">=</span><span class="s2">&quot;user_color&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id1">
<h3>Step 2. Run the conversation<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>Then start and run the flow conversation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">flow_conversation</span> <span class="o">=</span> <span class="n">simple_flow</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">()</span>
<span class="n">flow_id</span> <span class="o">=</span> <span class="n">flow_conversation</span><span class="o">.</span><span class="n">conversation_id</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1. Started flow conversation with ID: </span><span class="si">{</span><span class="n">flow_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Execute until user input is needed</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">flow_conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;2. Flow asks: </span><span class="si">{</span><span class="n">flow_conversation</span><span class="o">.</span><span class="n">get_last_message</span><span class="p">()</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="step-3-serialize-during-execution">
<h3>Step 3. Serialize during execution<a class="headerlink" href="#step-3-serialize-during-execution" title="Permalink to this heading">#</a></h3>
<p>You can now serialize the conversation during its execution, for instance
here the flow is requesting the user to input some information but you can
serialize the conversation and resume it later.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">FLOW_STORE_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DIR_PATH</span><span class="p">,</span> <span class="s2">&quot;flow_conversation.json&quot;</span><span class="p">)</span>
<span class="n">store_conversation</span><span class="p">(</span><span class="n">FLOW_STORE_PATH</span><span class="p">,</span> <span class="n">flow_conversation</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3. Flow conversation serialized to </span><span class="si">{</span><span class="n">FLOW_STORE_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>Step 4. Deserialize the conversation<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<p>You can now load back the serialized conversation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">loaded_flow_conversation</span> <span class="o">=</span> <span class="n">load_conversation</span><span class="p">(</span><span class="n">FLOW_STORE_PATH</span><span class="p">,</span> <span class="n">flow_id</span><span class="p">)</span>
<span class="n">input_step_1</span> <span class="o">=</span> <span class="n">loaded_flow_conversation</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="s1">&#39;input_step&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;4. Flow conversation deserialized from </span><span class="si">{</span><span class="n">FLOW_STORE_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Provide user input to the loaded conversation</span>
<span class="n">loaded_flow_conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;Blue&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;5. User responds: Blue&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="step-5-resume-the-conversation-execution">
<h3>Step 5. Resume the conversation execution<a class="headerlink" href="#step-5-resume-the-conversation-execution" title="Permalink to this heading">#</a></h3>
<p>You can resume the conversation from its state before serializing it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">outputs</span> <span class="o">=</span> <span class="n">loaded_flow_conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;6. Flow output: </span><span class="si">{</span><span class="n">outputs</span><span class="o">.</span><span class="n">output_values</span><span class="p">[</span><span class="n">OutputMessageStep</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Print the loaded conversation messages</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;7. Loaded flow conversation messages:&quot;</span><span class="p">)</span>
<span class="n">messages</span> <span class="o">=</span> <span class="n">loaded_flow_conversation</span><span class="o">.</span><span class="n">message_list</span><span class="o">.</span><span class="n">messages</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">message_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;AGENT&quot;</span><span class="p">:</span>
        <span class="n">role</span> <span class="o">=</span> <span class="s2">&quot;Flow&quot;</span>
    <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">message_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;USER&quot;</span><span class="p">:</span>
        <span class="n">role</span> <span class="o">=</span> <span class="s2">&quot;User&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">message_type</span><span class="o">.</span><span class="n">name</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   [</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">role</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


</pre></div>
</div>
<p>Important considerations:</p>
<ul class="simple">
<li><p>Flows can be serialized while waiting for user input</p></li>
<li><p>The loaded Flow conversation resumes exactly where it left off</p></li>
<li><p>User input can be provided to the loaded conversation to continue execution</p></li>
</ul>
</section>
</section>
<section id="building-persistent-applications">
<h2>Building persistent applications<a class="headerlink" href="#building-persistent-applications" title="Permalink to this heading">#</a></h2>
<p>For real-world applications, youâ€™ll want to create persistent conversation loops:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">run_persistent_agent</span><span class="p">(</span><span class="n">assistant</span><span class="p">:</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">store_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run an agent with persistent conversation storage.&quot;&quot;&quot;</span>

    <span class="c1"># Load existing conversation or start new one</span>
    <span class="k">if</span> <span class="n">conversation_id</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">conversation</span> <span class="o">=</span> <span class="n">load_conversation</span><span class="p">(</span><span class="n">store_path</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resuming conversation </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conversation </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2"> not found, starting new one&quot;</span><span class="p">)</span>
            <span class="n">conversation</span> <span class="o">=</span> <span class="n">assistant</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">conversation</span> <span class="o">=</span> <span class="n">assistant</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Started new conversation </span><span class="si">{</span><span class="n">conversation</span><span class="o">.</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Main conversation loop</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">FinishedStatus</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Conversation finished&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">UserMessageRequestStatus</span><span class="p">):</span>
            <span class="c1"># Save before waiting for user input</span>
            <span class="n">store_conversation</span><span class="p">(</span><span class="n">store_path</span><span class="p">,</span> <span class="n">conversation</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assistant: </span><span class="si">{</span><span class="n">conversation</span><span class="o">.</span><span class="n">get_last_message</span><span class="p">()</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;You: &quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">user_input</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;exit&quot;</span><span class="p">,</span> <span class="s2">&quot;quit&quot;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exiting and saving conversation...&quot;</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span>

    <span class="c1"># Final save</span>
    <span class="n">final_id</span> <span class="o">=</span> <span class="n">store_conversation</span><span class="p">(</span><span class="n">store_path</span><span class="p">,</span> <span class="n">conversation</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conversation saved with ID: </span><span class="si">{</span><span class="n">final_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">final_id</span>


</pre></div>
</div>
<p>This function:</p>
<ul class="simple">
<li><p>Loads existing conversations or starts new ones</p></li>
<li><p>Saves state before waiting for user input</p></li>
<li><p>Allows users to exit and resume later</p></li>
<li><p>Returns the conversation ID for future reference</p></li>
</ul>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><strong>Save before user input</strong>: Always serialize conversations before waiting for user input to prevent data loss.</p></li>
<li><p><strong>Use unique IDs</strong>: Store conversations using their built-in <code class="docutils literal notranslate"><span class="pre">conversation_id</span></code> to avoid conflicts.</p></li>
<li><p><strong>Handle errors gracefully</strong>: Wrap deserialization in try-except blocks to handle missing or corrupted data.</p></li>
<li><p><strong>Consider storage format</strong>: While JSON is human-readable, consider other formats for production use.</p></li>
<li><p><strong>Version your serialization</strong>: Consider adding version information to handle future schema changes.</p></li>
</ol>
</section>
<section id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Tool state</strong>: When using tools with Agents, ensure tools are stateless or their state is managed separately.</p></li>
<li><p><strong>Large conversations</strong>: Very long conversations may result in large serialized files.</p></li>
<li><p><strong>Binary data</strong>: The default JSON serialization does not handle binary data directly.</p></li>
</ul>
</section>
<section id="agent-spec-exporting-loading">
<h2>Agent Spec Exporting/Loading<a class="headerlink" href="#agent-spec-exporting-loading" title="Permalink to this heading">#</a></h2>
<p>You can export the assistant configuration to its Agent Spec configuration using the <code class="docutils literal notranslate"><span class="pre">AgentSpecExporter</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agentspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentSpecExporter</span>

<span class="n">serialized_assistant</span> <span class="o">=</span> <span class="n">AgentSpecExporter</span><span class="p">()</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">assistant</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is what the <strong>Agent Spec representation will look like â†“</strong></p>
<details class="summary-click-here-to-see-the-assistant-configuration">
<summary>Click here to see the assistant configuration.</summary><div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">JSON</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">YAML</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;component_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Agent&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;simple_assistant&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;agent_0f75efc7&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;__metadata_info__&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;agent_0f75efc7&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nt">&quot;outputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nt">&quot;llm_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;component_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;VllmConfig&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;80c8028b-0dd6-4dc9-ad7d-a4860ef1b849&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LLAMA_MODEL_ID&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;__metadata_info__&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;default_generation_parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LLAMA_API_URL&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;model_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LLAMA_MODEL_ID&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;system_prompt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;You are a helpful assistant. Be concise.&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;tools&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">  </span><span class="nt">&quot;agentspec_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;25.4.1&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">component_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Agent</span>
<span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">simple_assistant</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent_0f75efc7</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">__metadata_info__</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent_0f75efc7</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
<span class="nt">inputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="nt">outputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="nt">llm_config</span><span class="p">:</span>
<span class="w">  </span><span class="nt">component_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VllmConfig</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80c8028b-0dd6-4dc9-ad7d-a4860ef1b849</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LLAMA_MODEL_ID</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">__metadata_info__</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">default_generation_parameters</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LLAMA_API_URL</span>
<span class="w">  </span><span class="nt">model_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LLAMA_MODEL_ID</span>
<span class="nt">system_prompt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">You are a helpful assistant. Be concise.</span>
<span class="nt">tools</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="nt">agentspec_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25.4.1</span>
</pre></div>
</div>
</div></div>
</details><p>You can then load the configuration back to an assistant using the <code class="docutils literal notranslate"><span class="pre">AgentSpecLoader</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agentspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentSpecLoader</span>

<span class="n">assistant</span><span class="p">:</span> <span class="n">Agent</span> <span class="o">=</span> <span class="n">AgentSpecLoader</span><span class="p">()</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="n">serialized_assistant</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this heading">#</a></h2>
<p>In this guide, you learned how to:</p>
<ul class="simple">
<li><p>Serialize both Agent and Flow conversations</p></li>
<li><p>Restore conversations and continue execution</p></li>
<li><p>Build persistent conversation loops</p></li>
<li><p>Handle conversation state across application restarts</p></li>
</ul>
<p>Having learned how to serialize a conversation, you may now proceed to <a class="reference internal" href="howto_serdeser.html"><span class="doc">How to Serialize and Deserialize Flows and Agents</span></a>.</p>
<ul class="simple">
<li><p><a class="reference internal" href="howto_serdeser.html"><span class="doc">Serialization</span></a></p></li>
</ul>
</section>
<section id="full-code">
<h2>Full code<a class="headerlink" href="#full-code" title="Permalink to this heading">#</a></h2>
<p>Click on the card at the <a class="reference internal" href="#top-howtoserializeconversations"><span class="std std-ref">top of this page</span></a> to download the full code for this guide or copy the code below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1"># Copyright Â© 2025 Oracle and/or its affiliates.</span>
<span class="linenos">  2</span><span class="c1">#</span>
<span class="linenos">  3</span><span class="c1"># This software is under the Apache License 2.0</span>
<span class="linenos">  4</span><span class="c1"># %%[markdown]</span>
<span class="linenos">  5</span><span class="c1"># Code Example - How to Serialize and Deserialize Conversations</span>
<span class="linenos">  6</span><span class="c1"># -------------------------------------------------------------</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="c1"># How to use:</span>
<span class="linenos">  9</span><span class="c1"># Create a new Python virtual environment and install the latest WayFlow version.</span>
<span class="linenos"> 10</span><span class="c1"># ```bash</span>
<span class="linenos"> 11</span><span class="c1"># python -m venv venv-wayflowcore</span>
<span class="linenos"> 12</span><span class="c1"># source venv-wayflowcore/bin/activate</span>
<span class="linenos"> 13</span><span class="c1"># pip install --upgrade pip</span>
<span class="linenos"> 14</span><span class="c1"># pip install &quot;wayflowcore==26.1&quot; </span>
<span class="linenos"> 15</span><span class="c1"># ```</span>
<span class="linenos"> 16</span>
<span class="linenos"> 17</span><span class="c1"># You can now run the script</span>
<span class="linenos"> 18</span><span class="c1"># 1. As a Python file:</span>
<span class="linenos"> 19</span><span class="c1"># ```bash</span>
<span class="linenos"> 20</span><span class="c1"># python howto_serialize_conversations.py</span>
<span class="linenos"> 21</span><span class="c1"># ```</span>
<span class="linenos"> 22</span><span class="c1"># 2. As a Notebook (in VSCode):</span>
<span class="linenos"> 23</span><span class="c1"># When viewing the file,</span>
<span class="linenos"> 24</span><span class="c1">#  - press the keys Ctrl + Enter to run the selected cell</span>
<span class="linenos"> 25</span><span class="c1">#  - or Shift + Enter to run the selected cell and move to the cell below# (LICENSE-APACHE or http://www.apache.org/licenses/LICENSE-2.0) or Universal Permissive License</span>
<span class="linenos"> 26</span><span class="c1"># (UPL) 1.0 (LICENSE-UPL or https://oss.oracle.com/licenses/upl), at your option.</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 31</span><span class="c1">## Imports for this guide</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="c1"># %%</span>
<span class="linenos"> 34</span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="linenos"> 35</span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="linenos"> 36</span>
<span class="linenos"> 37</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
<span class="linenos"> 38</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.controlconnection</span><span class="w"> </span><span class="kn">import</span> <span class="n">ControlFlowEdge</span>
<span class="linenos"> 39</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.conversation</span><span class="w"> </span><span class="kn">import</span> <span class="n">Conversation</span>
<span class="linenos"> 40</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.dataconnection</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataFlowEdge</span>
<span class="linenos"> 41</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.executors.executionstatus</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="linenos"> 42</span>    <span class="n">FinishedStatus</span><span class="p">,</span>
<span class="linenos"> 43</span>    <span class="n">UserMessageRequestStatus</span><span class="p">,</span>
<span class="linenos"> 44</span><span class="p">)</span>
<span class="linenos"> 45</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.flow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flow</span>
<span class="linenos"> 46</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.serialization</span><span class="w"> </span><span class="kn">import</span> <span class="n">autodeserialize</span><span class="p">,</span> <span class="n">serialize</span>
<span class="linenos"> 47</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.steps</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="linenos"> 48</span>    <span class="n">CompleteStep</span><span class="p">,</span>
<span class="linenos"> 49</span>    <span class="n">InputMessageStep</span><span class="p">,</span>
<span class="linenos"> 50</span>    <span class="n">OutputMessageStep</span><span class="p">,</span>
<span class="linenos"> 51</span>    <span class="n">StartStep</span><span class="p">,</span>
<span class="linenos"> 52</span><span class="p">)</span>
<span class="linenos"> 53</span>
<span class="linenos"> 54</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 55</span><span class="c1">## Configure your LLM</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span><span class="c1"># %%</span>
<span class="linenos"> 58</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">VllmModel</span>
<span class="linenos"> 59</span>
<span class="linenos"> 60</span><span class="n">llm</span> <span class="o">=</span> <span class="n">VllmModel</span><span class="p">(</span>
<span class="linenos"> 61</span>    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;LLAMA_MODEL_ID&quot;</span><span class="p">,</span>
<span class="linenos"> 62</span>    <span class="n">host_port</span><span class="o">=</span><span class="s2">&quot;LLAMA_API_URL&quot;</span><span class="p">,</span>
<span class="linenos"> 63</span><span class="p">)</span>
<span class="linenos"> 64</span>
<span class="linenos"> 65</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 66</span><span class="c1">## Create storage functions</span>
<span class="linenos"> 67</span>
<span class="linenos"> 68</span><span class="c1"># %%</span>
<span class="linenos"> 69</span><span class="n">DIR_PATH</span> <span class="o">=</span> <span class="s2">&quot;path/to/your/dir&quot;</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span><span class="k">def</span><span class="w"> </span><span class="nf">store_conversation</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversation</span><span class="p">:</span> <span class="n">Conversation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 72</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Store the given conversation and return the conversation id.&quot;&quot;&quot;</span>
<span class="linenos"> 73</span>    <span class="n">conversation_id</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">conversation_id</span>
<span class="linenos"> 74</span>    <span class="n">serialized_conversation</span> <span class="o">=</span> <span class="n">serialize</span><span class="p">(</span><span class="n">conversation</span><span class="p">)</span>
<span class="linenos"> 75</span>
<span class="linenos"> 76</span>    <span class="c1"># Read existing data</span>
<span class="linenos"> 77</span>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="linenos"> 78</span>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos"> 79</span>            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="linenos"> 80</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 81</span>        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 82</span>
<span class="linenos"> 83</span>    <span class="c1"># Add new conversation</span>
<span class="linenos"> 84</span>    <span class="n">data</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialized_conversation</span>
<span class="linenos"> 85</span>
<span class="linenos"> 86</span>    <span class="c1"># Write back to file</span>
<span class="linenos"> 87</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos"> 88</span>        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos"> 89</span>
<span class="linenos"> 90</span>    <span class="k">return</span> <span class="n">conversation_id</span>
<span class="linenos"> 91</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span><span class="k">def</span><span class="w"> </span><span class="nf">load_conversation</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Conversation</span><span class="p">:</span>
<span class="linenos"> 94</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a conversation given its id.&quot;&quot;&quot;</span>
<span class="linenos"> 95</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos"> 96</span>        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>    <span class="n">serialized_conversation</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">conversation_id</span><span class="p">]</span>
<span class="linenos"> 99</span>    <span class="k">return</span> <span class="n">autodeserialize</span><span class="p">(</span><span class="n">serialized_conversation</span><span class="p">)</span>
<span class="linenos">100</span>
<span class="linenos">101</span><span class="c1"># %%[markdown]</span>
<span class="linenos">102</span><span class="c1">## Creating an agent</span>
<span class="linenos">103</span>
<span class="linenos">104</span><span class="c1"># %%</span>
<span class="linenos">105</span><span class="n">assistant</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
<span class="linenos">106</span>    <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
<span class="linenos">107</span>    <span class="n">custom_instruction</span><span class="o">=</span><span class="s2">&quot;You are a helpful assistant. Be concise.&quot;</span><span class="p">,</span>
<span class="linenos">108</span>    <span class="n">agent_id</span><span class="o">=</span><span class="s2">&quot;simple_assistant&quot;</span><span class="p">,</span>
<span class="linenos">109</span><span class="p">)</span>
<span class="linenos">110</span>
<span class="linenos">111</span><span class="c1"># %%[markdown]</span>
<span class="linenos">112</span><span class="c1">## Run the agent</span>
<span class="linenos">113</span>
<span class="linenos">114</span><span class="c1"># %%</span>
<span class="linenos">115</span><span class="c1"># Start a conversation</span>
<span class="linenos">116</span><span class="n">conversation</span> <span class="o">=</span> <span class="n">assistant</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">()</span>
<span class="linenos">117</span><span class="n">conversation_id</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">conversation_id</span>
<span class="linenos">118</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1. Started conversation with ID: </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">119</span>
<span class="linenos">120</span><span class="c1"># Execute initial greeting</span>
<span class="linenos">121</span><span class="n">status</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">122</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;2. Assistant says: </span><span class="si">{</span><span class="n">conversation</span><span class="o">.</span><span class="n">get_last_message</span><span class="p">()</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">123</span>
<span class="linenos">124</span><span class="c1"># Add user message</span>
<span class="linenos">125</span><span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;What is 2+2?&quot;</span><span class="p">)</span>
<span class="linenos">126</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. User asks: What is 2+2?&quot;</span><span class="p">)</span>
<span class="linenos">127</span>
<span class="linenos">128</span><span class="c1"># Execute to get response</span>
<span class="linenos">129</span><span class="n">status</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">130</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;4. Assistant responds: </span><span class="si">{</span><span class="n">conversation</span><span class="o">.</span><span class="n">get_last_message</span><span class="p">()</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">131</span>
<span class="linenos">132</span><span class="c1"># %%[markdown]</span>
<span class="linenos">133</span><span class="c1">## Serialize the conversation</span>
<span class="linenos">134</span>
<span class="linenos">135</span><span class="c1"># %%</span>
<span class="linenos">136</span><span class="n">AGENT_STORE_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DIR_PATH</span><span class="p">,</span> <span class="s2">&quot;agent_conversation.json&quot;</span><span class="p">)</span>
<span class="linenos">137</span><span class="n">store_conversation</span><span class="p">(</span><span class="n">AGENT_STORE_PATH</span><span class="p">,</span> <span class="n">conversation</span><span class="p">)</span>
<span class="linenos">138</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;5. Conversation serialized to </span><span class="si">{</span><span class="n">AGENT_STORE_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">139</span>
<span class="linenos">140</span><span class="c1"># %%[markdown]</span>
<span class="linenos">141</span><span class="c1">## Deserialize the conversation</span>
<span class="linenos">142</span>
<span class="linenos">143</span><span class="c1"># %%</span>
<span class="linenos">144</span><span class="n">loaded_conversation</span> <span class="o">=</span> <span class="n">load_conversation</span><span class="p">(</span><span class="n">AGENT_STORE_PATH</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">)</span>
<span class="linenos">145</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;6. Conversation deserialized from </span><span class="si">{</span><span class="n">AGENT_STORE_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">146</span>
<span class="linenos">147</span><span class="c1"># Print the loaded conversation messages</span>
<span class="linenos">148</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;7. Loaded conversation messages:&quot;</span><span class="p">)</span>
<span class="linenos">149</span><span class="n">messages</span> <span class="o">=</span> <span class="n">loaded_conversation</span><span class="o">.</span><span class="n">message_list</span><span class="o">.</span><span class="n">messages</span>
<span class="linenos">150</span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>
<span class="linenos">151</span>    <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">message_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;AGENT&quot;</span><span class="p">:</span>
<span class="linenos">152</span>        <span class="n">role</span> <span class="o">=</span> <span class="s2">&quot;Assistant&quot;</span>
<span class="linenos">153</span>    <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">message_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;USER&quot;</span><span class="p">:</span>
<span class="linenos">154</span>        <span class="n">role</span> <span class="o">=</span> <span class="s2">&quot;User&quot;</span>
<span class="linenos">155</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">156</span>        <span class="n">role</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">message_type</span><span class="o">.</span><span class="n">name</span>
<span class="linenos">157</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   [</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">role</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">158</span>
<span class="linenos">159</span>
<span class="linenos">160</span><span class="c1"># %%[markdown]</span>
<span class="linenos">161</span><span class="c1">## Creating a flow</span>
<span class="linenos">162</span>
<span class="linenos">163</span><span class="c1"># %%</span>
<span class="linenos">164</span><span class="n">start_step</span> <span class="o">=</span> <span class="n">StartStep</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;start_step&quot;</span><span class="p">)</span>
<span class="linenos">165</span><span class="n">input_step</span> <span class="o">=</span> <span class="n">InputMessageStep</span><span class="p">(</span>
<span class="linenos">166</span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;input_step&quot;</span><span class="p">,</span>
<span class="linenos">167</span>    <span class="n">message_template</span><span class="o">=</span><span class="s2">&quot;What&#39;s your favorite color?&quot;</span><span class="p">,</span>
<span class="linenos">168</span>    <span class="n">output_mapping</span><span class="o">=</span><span class="p">{</span><span class="n">InputMessageStep</span><span class="o">.</span><span class="n">USER_PROVIDED_INPUT</span><span class="p">:</span> <span class="s2">&quot;user_color&quot;</span><span class="p">},</span>
<span class="linenos">169</span><span class="p">)</span>
<span class="linenos">170</span><span class="n">output_step</span> <span class="o">=</span> <span class="n">OutputMessageStep</span><span class="p">(</span>
<span class="linenos">171</span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;output_step&quot;</span><span class="p">,</span> <span class="n">message_template</span><span class="o">=</span><span class="s2">&quot;Your favorite color is {{ user_color }}. Nice choice!&quot;</span>
<span class="linenos">172</span><span class="p">)</span>
<span class="linenos">173</span><span class="n">end_step</span> <span class="o">=</span> <span class="n">CompleteStep</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;end_step&quot;</span><span class="p">)</span>
<span class="linenos">174</span>
<span class="linenos">175</span><span class="n">simple_flow</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">(</span>
<span class="linenos">176</span>    <span class="n">begin_step</span><span class="o">=</span><span class="n">start_step</span><span class="p">,</span>
<span class="linenos">177</span>    <span class="n">control_flow_edges</span><span class="o">=</span><span class="p">[</span>
<span class="linenos">178</span>        <span class="n">ControlFlowEdge</span><span class="p">(</span><span class="n">start_step</span><span class="p">,</span> <span class="n">input_step</span><span class="p">),</span>
<span class="linenos">179</span>        <span class="n">ControlFlowEdge</span><span class="p">(</span><span class="n">input_step</span><span class="p">,</span> <span class="n">output_step</span><span class="p">),</span>
<span class="linenos">180</span>        <span class="n">ControlFlowEdge</span><span class="p">(</span><span class="n">output_step</span><span class="p">,</span> <span class="n">end_step</span><span class="p">),</span>
<span class="linenos">181</span>    <span class="p">],</span>
<span class="linenos">182</span>    <span class="n">data_flow_edges</span><span class="o">=</span><span class="p">[</span>
<span class="linenos">183</span>        <span class="n">DataFlowEdge</span><span class="p">(</span>
<span class="linenos">184</span>            <span class="n">source_step</span><span class="o">=</span><span class="n">input_step</span><span class="p">,</span>
<span class="linenos">185</span>            <span class="n">source_output</span><span class="o">=</span><span class="s2">&quot;user_color&quot;</span><span class="p">,</span>
<span class="linenos">186</span>            <span class="n">destination_step</span><span class="o">=</span><span class="n">output_step</span><span class="p">,</span>
<span class="linenos">187</span>            <span class="n">destination_input</span><span class="o">=</span><span class="s2">&quot;user_color&quot;</span><span class="p">,</span>
<span class="linenos">188</span>        <span class="p">)</span>
<span class="linenos">189</span>    <span class="p">],</span>
<span class="linenos">190</span><span class="p">)</span>
<span class="linenos">191</span>
<span class="linenos">192</span><span class="c1"># %%[markdown]</span>
<span class="linenos">193</span><span class="c1">## Run the flow</span>
<span class="linenos">194</span>
<span class="linenos">195</span><span class="c1"># %%</span>
<span class="linenos">196</span><span class="n">flow_conversation</span> <span class="o">=</span> <span class="n">simple_flow</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">()</span>
<span class="linenos">197</span><span class="n">flow_id</span> <span class="o">=</span> <span class="n">flow_conversation</span><span class="o">.</span><span class="n">conversation_id</span>
<span class="linenos">198</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1. Started flow conversation with ID: </span><span class="si">{</span><span class="n">flow_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">199</span>
<span class="linenos">200</span><span class="c1"># Execute until user input is needed</span>
<span class="linenos">201</span><span class="n">status</span> <span class="o">=</span> <span class="n">flow_conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">202</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;2. Flow asks: </span><span class="si">{</span><span class="n">flow_conversation</span><span class="o">.</span><span class="n">get_last_message</span><span class="p">()</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">203</span>
<span class="linenos">204</span><span class="c1"># %%[markdown]</span>
<span class="linenos">205</span><span class="c1">## Serialize before providing user input</span>
<span class="linenos">206</span>
<span class="linenos">207</span><span class="c1"># %%</span>
<span class="linenos">208</span><span class="n">FLOW_STORE_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DIR_PATH</span><span class="p">,</span> <span class="s2">&quot;flow_conversation.json&quot;</span><span class="p">)</span>
<span class="linenos">209</span><span class="n">store_conversation</span><span class="p">(</span><span class="n">FLOW_STORE_PATH</span><span class="p">,</span> <span class="n">flow_conversation</span><span class="p">)</span>
<span class="linenos">210</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3. Flow conversation serialized to </span><span class="si">{</span><span class="n">FLOW_STORE_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">211</span>
<span class="linenos">212</span><span class="c1"># %%[markdown]</span>
<span class="linenos">213</span><span class="c1">## Deserialize the flow conversation</span>
<span class="linenos">214</span>
<span class="linenos">215</span><span class="c1"># %%</span>
<span class="linenos">216</span><span class="n">loaded_flow_conversation</span> <span class="o">=</span> <span class="n">load_conversation</span><span class="p">(</span><span class="n">FLOW_STORE_PATH</span><span class="p">,</span> <span class="n">flow_id</span><span class="p">)</span>
<span class="linenos">217</span><span class="n">input_step_1</span> <span class="o">=</span> <span class="n">loaded_flow_conversation</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="s1">&#39;input_step&#39;</span><span class="p">]</span>
<span class="linenos">218</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;4. Flow conversation deserialized from </span><span class="si">{</span><span class="n">FLOW_STORE_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">219</span>
<span class="linenos">220</span><span class="c1"># Provide user input to the loaded conversation</span>
<span class="linenos">221</span><span class="n">loaded_flow_conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;Blue&quot;</span><span class="p">)</span>
<span class="linenos">222</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;5. User responds: Blue&quot;</span><span class="p">)</span>
<span class="linenos">223</span>
<span class="linenos">224</span><span class="c1"># %%[markdown]</span>
<span class="linenos">225</span><span class="c1">## Resume the conversation execution</span>
<span class="linenos">226</span>
<span class="linenos">227</span><span class="c1"># %%</span>
<span class="linenos">228</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">loaded_flow_conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">229</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;6. Flow output: </span><span class="si">{</span><span class="n">outputs</span><span class="o">.</span><span class="n">output_values</span><span class="p">[</span><span class="n">OutputMessageStep</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">230</span>
<span class="linenos">231</span><span class="c1"># Print the loaded conversation messages</span>
<span class="linenos">232</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;7. Loaded flow conversation messages:&quot;</span><span class="p">)</span>
<span class="linenos">233</span><span class="n">messages</span> <span class="o">=</span> <span class="n">loaded_flow_conversation</span><span class="o">.</span><span class="n">message_list</span><span class="o">.</span><span class="n">messages</span>
<span class="linenos">234</span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>
<span class="linenos">235</span>    <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">message_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;AGENT&quot;</span><span class="p">:</span>
<span class="linenos">236</span>        <span class="n">role</span> <span class="o">=</span> <span class="s2">&quot;Flow&quot;</span>
<span class="linenos">237</span>    <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">message_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;USER&quot;</span><span class="p">:</span>
<span class="linenos">238</span>        <span class="n">role</span> <span class="o">=</span> <span class="s2">&quot;User&quot;</span>
<span class="linenos">239</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">240</span>        <span class="n">role</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">message_type</span><span class="o">.</span><span class="n">name</span>
<span class="linenos">241</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   [</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">role</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">242</span>
<span class="linenos">243</span>
<span class="linenos">244</span>
<span class="linenos">245</span><span class="c1"># %%[markdown]</span>
<span class="linenos">246</span><span class="c1">## Creating a persistent conversation loop</span>
<span class="linenos">247</span>
<span class="linenos">248</span><span class="c1"># %%</span>
<span class="linenos">249</span><span class="k">def</span><span class="w"> </span><span class="nf">run_persistent_agent</span><span class="p">(</span><span class="n">assistant</span><span class="p">:</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">store_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="linenos">250</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Run an agent with persistent conversation storage.&quot;&quot;&quot;</span>
<span class="linenos">251</span>
<span class="linenos">252</span>    <span class="c1"># Load existing conversation or start new one</span>
<span class="linenos">253</span>    <span class="k">if</span> <span class="n">conversation_id</span><span class="p">:</span>
<span class="linenos">254</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">255</span>            <span class="n">conversation</span> <span class="o">=</span> <span class="n">load_conversation</span><span class="p">(</span><span class="n">store_path</span><span class="p">,</span> <span class="n">conversation_id</span><span class="p">)</span>
<span class="linenos">256</span>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resuming conversation </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">257</span>        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
<span class="linenos">258</span>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conversation </span><span class="si">{</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2"> not found, starting new one&quot;</span><span class="p">)</span>
<span class="linenos">259</span>            <span class="n">conversation</span> <span class="o">=</span> <span class="n">assistant</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">()</span>
<span class="linenos">260</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">261</span>        <span class="n">conversation</span> <span class="o">=</span> <span class="n">assistant</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">()</span>
<span class="linenos">262</span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Started new conversation </span><span class="si">{</span><span class="n">conversation</span><span class="o">.</span><span class="n">conversation_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">263</span>
<span class="linenos">264</span>    <span class="c1"># Main conversation loop</span>
<span class="linenos">265</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">266</span>        <span class="n">status</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">267</span>
<span class="linenos">268</span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">FinishedStatus</span><span class="p">):</span>
<span class="linenos">269</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Conversation finished&quot;</span><span class="p">)</span>
<span class="linenos">270</span>            <span class="k">break</span>
<span class="linenos">271</span>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">UserMessageRequestStatus</span><span class="p">):</span>
<span class="linenos">272</span>            <span class="c1"># Save before waiting for user input</span>
<span class="linenos">273</span>            <span class="n">store_conversation</span><span class="p">(</span><span class="n">store_path</span><span class="p">,</span> <span class="n">conversation</span><span class="p">)</span>
<span class="linenos">274</span>
<span class="linenos">275</span>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assistant: </span><span class="si">{</span><span class="n">conversation</span><span class="o">.</span><span class="n">get_last_message</span><span class="p">()</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">276</span>            <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;You: &quot;</span><span class="p">)</span>
<span class="linenos">277</span>
<span class="linenos">278</span>            <span class="k">if</span> <span class="n">user_input</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;exit&quot;</span><span class="p">,</span> <span class="s2">&quot;quit&quot;</span><span class="p">]:</span>
<span class="linenos">279</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exiting and saving conversation...&quot;</span><span class="p">)</span>
<span class="linenos">280</span>                <span class="k">break</span>
<span class="linenos">281</span>
<span class="linenos">282</span>            <span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span>
<span class="linenos">283</span>
<span class="linenos">284</span>    <span class="c1"># Final save</span>
<span class="linenos">285</span>    <span class="n">final_id</span> <span class="o">=</span> <span class="n">store_conversation</span><span class="p">(</span><span class="n">store_path</span><span class="p">,</span> <span class="n">conversation</span><span class="p">)</span>
<span class="linenos">286</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conversation saved with ID: </span><span class="si">{</span><span class="n">final_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">287</span>    <span class="k">return</span> <span class="n">final_id</span>
<span class="linenos">288</span>
<span class="linenos">289</span>
<span class="linenos">290</span>
<span class="linenos">291</span><span class="c1"># %%[markdown]</span>
<span class="linenos">292</span><span class="c1">## Export config to Agent Spec</span>
<span class="linenos">293</span>
<span class="linenos">294</span><span class="c1"># %%</span>
<span class="linenos">295</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agentspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentSpecExporter</span>
<span class="linenos">296</span>
<span class="linenos">297</span><span class="n">serialized_assistant</span> <span class="o">=</span> <span class="n">AgentSpecExporter</span><span class="p">()</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">assistant</span><span class="p">)</span>
<span class="linenos">298</span>
<span class="linenos">299</span><span class="c1"># %%[markdown]</span>
<span class="linenos">300</span><span class="c1">## Load Agent Spec config</span>
<span class="linenos">301</span>
<span class="linenos">302</span><span class="c1"># %%</span>
<span class="linenos">303</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agentspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentSpecLoader</span>
<span class="linenos">304</span>
<span class="linenos">305</span><span class="n">assistant</span><span class="p">:</span> <span class="n">Agent</span> <span class="o">=</span> <span class="n">AgentSpecLoader</span><span class="p">()</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="n">serialized_assistant</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concepts-shown-in-this-guide">Concepts shown in this guide</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-serialization">Basic Serialization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-add-imports-and-configure-llm">Step 1. Add imports and configure LLM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-create-storage-functions">Step 2. Create storage functions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#serializing-agent-conversations">Serializing Agent conversations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-create-an-agent">Step 1. Create an Agent</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-run-the-conversation">Step 2. Run the conversation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-serialize-the-conversation">Step 3. Serialize the conversation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-deserialize-the-conversation">Step 4. Deserialize the conversation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#serializing-flow-conversations">Serializing Flow Conversations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-create-a-flow">Step 1. Create a Flow</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Step 2. Run the conversation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-serialize-during-execution">Step 3. Serialize during execution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Step 4. Deserialize the conversation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-resume-the-conversation-execution">Step 5. Resume the conversation execution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-persistent-applications">Building persistent applications</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#best-practices">Best Practices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#limitations">Limitations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#agent-spec-exporting-loading">Agent Spec Exporting/Loading</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#full-code">Full code</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      Â© Copyright 2025, Oracle and/or its affiliates..
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>