


<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>How to Enable Agents to Handle Long Contexts &#8212; wayflowcore 26.1.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css-style.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/core.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'core/howtoguides/howto_long_context';</script>
  <script src="../../_static/announcement.js"></script>

    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="How to Configure Agents Instructions" href="agents.html" />
    <link rel="prev" title="How to Use LLMs from Different LLM Providers" href="llm_from_different_providers.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="26.1" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo-light.svg" class="logo__image only-light" alt="wayflowcore 26.1.0 documentation - Home"/>
    <img src="../../_static/logo-dark.svg" class="logo__image only-dark pst-js-only" alt="wayflowcore 26.1.0 documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/oracle/wayflow" title="WayFlow GitHub repository" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/icons/github-icon.svg" class="icon-link-image" alt="WayFlow GitHub repository"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/oracle/wayflow" title="WayFlow GitHub repository" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../_static/icons/github-icon.svg" class="icon-link-image" alt="WayFlow GitHub repository"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essentials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/index.html">Tutorials &amp; Use Cases</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/basic_agent.html">Build a Simple Conversational Assistant with Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/basic_flow.html">Build a Simple Fixed-flow Assistant with Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/usecase_prbot.html">Build a Simple Code Review Assistant</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">How-to Guides</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="io_descriptors.html">Change Input and Output Descriptors of Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_async.html">Use Asynchronous APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing_ollama.html">Install and Use Ollama</a></li>
<li class="toctree-l2"><a class="reference internal" href="generation_config.html">Specify the Generation Configuration when Using LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="llm_from_different_providers.html">Use LLM from Different LLM Sources and Providers</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Handle long context with agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="agents.html">Create a ReAct Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_imagecontent.html">How to Send Images to LLMs and Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_ociagent.html">Use OCI Generative AI Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_a2aagent.html">How to Connect to A2A Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_prompttemplate.html">Use Templates for Advanced Prompting Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_userinputinflows.html">Ask for User Input in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="conditional_flows.html">Create Conditional Transitions in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_promptexecutionstep.html">Do Structured LLM Generation in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_userconfirmation.html">Add User Confirmation to a Tool Call Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="catching_exceptions.html">Catch Exceptions in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_mapstep.html">Do Map and Reduce Operations in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_parallelflowexecution.html">Run Multiple Flows in Parallel</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_flowbuilder.html">Build Flows with the Flow Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_agents_in_flows.html">Use Agents in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_multiagent.html">Build a Hierarchical Multi-Agent System</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_swarm.html">Build a Swarm of Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_managerworkers.html">Build a ManagerWorkers of Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_serve_agents.html">Serve Agents with WayFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_a2a_serving.html">Serve Assistants with A2A protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_build_assistants_with_tools.html">Build Assistants with Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_multiple_output_tool.html">Create Tools with Multiple Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_a_tool_from_a_flow.html">Convert Flows to Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_mcp.html">Connect MCP tools to Assistants</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_remote_tool_expired_token.html">Do Remote API Calls with Tokens</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_execute_agentspec_with_wayflowcore.html">Load and Execute an Agent Spec Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_serdeser.html">Serialize and Deserialize Flows and Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_serialize_conversations.html">Serialize and Deserialize Conversations</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_plugins.html">Build a New WayFlow Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_tracing.html">Enable Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_event_system.html">Use the Event System</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_datastores.html">Connect Assistants to Your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddingmodels_from_different_providers.html">Use Embedding Models from Different Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_variable.html">Use Variables for Shared State in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_data_synthesis.html">Synthesize Data in WayFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_evaluation.html">Evaluate Assistants</a></li>
<li class="toctree-l2"><a class="reference internal" href="howto_conversation_evaluation.html">Evaluate Conversations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/index.html">API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/agentspec.html">Agent Spec Adapters</a></li>


<li class="toctree-l2"><a class="reference internal" href="../api/conversation.html">Conversations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/llmmodels.html">LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/flows.html">Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/agent.html">Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/agentserver.html">Agent Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/embeddingmodels.html">Embedding Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/contextproviders.html">Context Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/interrupts.html">Execution Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/prompttemplate.html">PromptTemplates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/serialization.html">Serialization/Deserialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/tools.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/tracing.html">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/variables.html">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/datastores.html">Datastores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/warnings.html">Warnings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/evaluation.html">Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/component.html">Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/a2a.html">A2A</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../misc/reference_sheet.html">Reference Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">For Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faqs.html">Frequently Asked Questions</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">WayFlow</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">How-to Guides</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">How to Enable Agents to Handle Long Contexts</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="how-to-enable-agents-to-handle-long-contexts">
<span id="top-howtolongmessage"></span><h1>How to Enable Agents to Handle Long Contexts<a class="headerlink" href="#how-to-enable-agents-to-handle-long-contexts" title="Permalink to this heading">#</a></h1>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-row-cols-2 sd-row-cols-xs-2 sd-row-cols-sm-2 sd-row-cols-md-2 sd-row-cols-lg-2 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
<a class="reference internal" href="../../_images/python-icon.svg"><img alt="python-icon" height="40px" src="../../_images/python-icon.svg" width="40px" /></a> Download Python Script</div>
<p class="sd-card-text">Python script/notebook for this guide.</p>
</div>
<a class="sd-stretched-link sd-hide-link-text reference external" href="../end_to_end_code_examples/howto_long_context.py"><span>Long message how-to script</span></a></div>
</div>
</div>
</div>
<div class="admonition-prerequisites admonition">
<p class="admonition-title">Prerequisites</p>
<p>This guide assumes familiarity with:</p>
<ul class="simple">
<li><p><a class="reference internal" href="llm_from_different_providers.html"><span class="doc">LLM configuration</span></a></p></li>
<li><p><a class="reference internal" href="agents.html"><span class="doc">Using agents</span></a></p></li>
<li><p><a class="reference internal" href="howto_prompttemplate.html"><span class="doc">Advanced Prompting Techniques</span></a></p></li>
</ul>
</div>
<p>In agentic systems, conversations can become lengthy, building up extensive context over many interactions.
Large Language Models (LLMs) have limits on the context they can process effectively, which may result in reduced
performance or errors when these limits are surpassed. Long context also incur higher costs.</p>
<p>To address these performance issues and reduce cost, you can apply techniques that reduce the context size while retaining key information.</p>
<p>This guide demonstrates three methods for reducing context size using built-in transforms:</p>
<ul class="simple">
<li><p><strong>Summarizing long messages</strong> using <a class="reference internal" href="../api/prompttemplate.html#messagesummarizationtransform"><span class="std std-ref">MessageSummarizationTransform</span></a>: Individual messages that exceed size limits (such as large tool outputs or long user inputs) are automatically summarized using an LLM.</p></li>
<li><p><strong>Summarizing long conversations</strong> using <a class="reference internal" href="../api/prompttemplate.html#conversationsummarizationtransform"><span class="std std-ref">ConversationSummarizationTransform</span></a>: When conversations become too lengthy, older messages are summarized to maintain context while keeping the total size manageable.</p></li>
<li><p><strong>Using both transforms together</strong>: Combining both approaches for comprehensive context management.</p></li>
</ul>
<p>This guide shows how to use built-in <a class="reference internal" href="../api/prompttemplate.html#messagetransform"><span class="std std-ref">MessageTransform</span></a> objects to reduce the context size in agents.</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<section id="message-transforms">
<h3>Message Transforms<a class="headerlink" href="#message-transforms" title="Permalink to this heading">#</a></h3>
<p>A <a class="reference internal" href="../api/prompttemplate.html#messagetransform"><span class="std std-ref">MessageTransform</span></a> is a transformation applied to a list of messages before they are sent to the LLM powering the agent. You can learn
more about them in the <a class="reference internal" href="howto_prompttemplate.html"><span class="doc">Advanced Prompting Techniques</span></a> guide.</p>
<p>In this guide, we use built-in message transforms to adjust the agent’s chat history by passing them directly to the <a class="reference internal" href="../api/agent.html#agent"><span class="std std-ref">Agent</span></a> constructor.</p>
</section>
<section id="llm-setup">
<h3>LLM Setup<a class="headerlink" href="#llm-setup" title="Permalink to this heading">#</a></h3>
<p>There are multiple ways to define an LLM in WayFlow depending on the provider.
Choose the one adapted to your needs:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">OCI GenAI</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">vLLM</button><button aria-controls="panel-0-0-2" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-2" name="0-2" role="tab" tabindex="-1">Ollama</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">OCIGenAIModel</span><span class="p">,</span> <span class="n">OCIClientConfigWithApiKey</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">OCIGenAIModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;provider.model-id&quot;</span><span class="p">,</span>
    <span class="n">compartment_id</span><span class="o">=</span><span class="s2">&quot;compartment-id&quot;</span><span class="p">,</span>
    <span class="n">client_config</span><span class="o">=</span><span class="n">OCIClientConfigWithApiKey</span><span class="p">(</span>
        <span class="n">service_endpoint</span><span class="o">=</span><span class="s2">&quot;https://url-to-service-endpoint.com&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">VllmModel</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">VllmModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;model-id&quot;</span><span class="p">,</span>
    <span class="n">host_port</span><span class="o">=</span><span class="s2">&quot;VLLM_HOST_PORT&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-0-2" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-2" name="0-2" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">OllamaModel</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">OllamaModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;model-id&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div></div>
<p>In this guide, we will use <cite>VllmModel</cite>.  We can use two different LLMs - a capable LLM as the agent and a fast LLM as the summarizer. Note that if conversations include images, the summarization LLM should support image processing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">VllmModel</span>

<span class="n">summarization_llm</span> <span class="o">=</span> <span class="n">VllmModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;SMALL_LLAMA_MODEL_ID&quot;</span><span class="p">,</span>
    <span class="n">host_port</span><span class="o">=</span><span class="s2">&quot;SMALL_LLAMA_API_URL&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">agent_llm</span> <span class="o">=</span> <span class="n">VllmModel</span><span class="p">(</span>
    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;LLAMA_MODEL_ID&quot;</span><span class="p">,</span>
    <span class="n">host_port</span><span class="o">=</span><span class="s2">&quot;LLAMA_API_URL&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="summarizing-long-messages">
<h2>Summarizing Long Messages<a class="headerlink" href="#summarizing-long-messages" title="Permalink to this heading">#</a></h2>
<p>We use the built-in <a class="reference internal" href="../api/prompttemplate.html#messagesummarizationtransform"><span class="std std-ref">MessageSummarizationTransform</span></a> to automatically summarize individual messages that exceed a specified size limit, including tool outputs, user messages and images.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.transforms</span><span class="w"> </span><span class="kn">import</span> <span class="n">MessageSummarizationTransform</span>


<span class="n">transform</span> <span class="o">=</span> <span class="n">MessageSummarizationTransform</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">summarization_llm</span><span class="p">,</span>
    <span class="n">max_message_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
    <span class="n">summarized_message_template</span><span class="o">=</span><span class="s2">&quot;Summarized result:</span><span class="se">\n</span><span class="s2">{{summary}}&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When creating <a class="reference internal" href="../api/prompttemplate.html#messagesummarizationtransform"><span class="std std-ref">MessageSummarizationTransform</span></a> without specifying a <code class="docutils literal notranslate"><span class="pre">datastore</span></code>, it will initialize a default <a class="reference internal" href="../api/datastores.html#inmemorydatastore"><span class="std std-ref">InMemoryDatastore</span></a> for caching, which is only suitable for prototyping. This will raise a user warning indicating that in-memory datastores are not recommended for production systems.
For production systems, you can use <a class="reference internal" href="../api/datastores.html#oracledatabasedatastore"><span class="std std-ref">OracleDatabaseDatastore</span></a> or <a class="reference internal" href="../api/datastores.html#postgresdatabasedatastore"><span class="std std-ref">PostgresDatabaseDatastore</span></a>.</p>
</div>
<p>Let’s integrate the <a class="reference internal" href="../api/prompttemplate.html#messagesummarizationtransform"><span class="std std-ref">MessageSummarizationTransform</span></a> into the <a class="reference internal" href="../api/agent.html#agent"><span class="std std-ref">Agent</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">Message</span><span class="p">,</span> <span class="n">tool</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">read_logs_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return logs from the system&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="s2">&quot;Starting long processing</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="o">+</span> <span class="s2">&quot;Waiting for process ...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">2_000</span>
        <span class="o">+</span> <span class="s2">&quot;Found error: Missing credentials for user kurt_andrews.&quot;</span>
        <span class="o">+</span> <span class="s2">&quot; Please pass the correct credentials.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">agent_llm</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">read_logs_tool</span><span class="p">],</span>
    <span class="n">transforms</span><span class="o">=</span><span class="p">[</span><span class="n">transform</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Before seeing an example, let’s define a token counting event listener that will help us see the impact of our summarizer on token consumption.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.events.eventlistener</span><span class="w"> </span><span class="kn">import</span> <span class="n">EventListener</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.events.event</span><span class="w"> </span><span class="kn">import</span> <span class="n">LlmGenerationResponseEvent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.events</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_event_listeners</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.tokenusage</span><span class="w"> </span><span class="kn">import</span> <span class="n">TokenUsage</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TokenListener</span><span class="p">(</span><span class="n">EventListener</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">TokenUsage</span><span class="p">()</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">LlmGenerationResponseEvent</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">+=</span> <span class="n">event</span><span class="o">.</span><span class="n">completion</span><span class="o">.</span><span class="n">token_usage</span>
</pre></div>
</div>
<p>In this example, we run a conversation where the agent uses a tool that returns a very long log output. The <a class="reference internal" href="../api/prompttemplate.html#messagesummarizationtransform"><span class="std std-ref">MessageSummarizationTransform</span></a> automatically summarizes this long message to stay within size limits. The agent then answers questions about the error, demonstrating that key information is preserved despite the summarization.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">listener_with_transform</span> <span class="o">=</span> <span class="n">TokenListener</span><span class="p">()</span>
<span class="k">with</span> <span class="n">register_event_listeners</span><span class="p">([</span><span class="n">listener_with_transform</span><span class="p">]):</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.executors.executionstatus</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserMessageRequestStatus</span>

    <span class="n">conversation</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">()</span>
    <span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;Can you explain the error in the system?&quot;</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">UserMessageRequestStatus</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="c1"># The error is likely due to a missing credential for</span>
        <span class="c1"># a user named kurt_andrews. Please ensure the credentials</span>
        <span class="c1"># are provided correctly for kurt_andrews to resolve the issue.</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token usage with MessageSummarizationTransform after 1 user message: </span><span class="si">{</span><span class="n">listener_with_transform</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">total_tokens</span><span class="si">}</span><span class="s2"> tokens&quot;</span><span class="p">)</span>
    <span class="c1"># Token usage with MessageSummarizationTransform after 1 user message: 8854 tokens</span>

    <span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s1">&#39;What is the exact message repeated in a loop? Do not recall the tool&#39;</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">UserMessageRequestStatus</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="c1"># The tool is stuck in an infinite loop, repeatedly displaying the message &quot;Waiting for process&quot; until it encounters an error due to missing credentials for user &quot;kurt_andrews&quot;.</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token usage with MessageSummarizationTransform after 2 user messages: </span><span class="si">{</span><span class="n">listener_with_transform</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">total_tokens</span><span class="si">}</span><span class="s2"> tokens&quot;</span><span class="p">)</span><span class="c1"># .. start-##_Create_Token_Event_Listener</span>
    <span class="c1"># Token usage with MessageSummarizationTransform after 2 user messages: 9314 tokens</span>


</pre></div>
</div>
<p>To compare, let’s run the same conversation without any transforms to see the difference in token usage.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">agent_no_transform</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">agent_llm</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">read_logs_tool</span><span class="p">],</span>
    <span class="n">transforms</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># no transforms</span>
<span class="p">)</span>
</pre></div>
</div>
<p>After one user message, we have used the following number of tokens:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
    <span class="c1"># ... (same conversation as above)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token usage without MessageSummarizationTransform after 1 user message: </span><span class="si">{</span><span class="n">listener_no_transform</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">total_tokens</span><span class="si">}</span><span class="s2"> tokens&quot;</span><span class="p">)</span>
    <span class="c1"># Token usage without MessageSummarizationTransform after 1 user message: 12757 tokens</span>

</pre></div>
</div>
<p>And after the second user message:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token usage without MessageSummarizationTransform after 2 user messages: </span><span class="si">{</span><span class="n">listener_no_transform</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">total_tokens</span><span class="si">}</span><span class="s2"> tokens&quot;</span><span class="p">)</span><span class="c1"># .. start-##_Create_Token_Event_Listener</span>
    <span class="c1"># Token usage without MessageSummarizationTransform after 2 user messages: 25224 tokens</span>

</pre></div>
</div>
<ul class="simple">
<li><p><strong>After one user message</strong>, both approaches show high token usage:</p>
<ul>
<li><p>Without <a class="reference internal" href="../api/prompttemplate.html#messagesummarizationtransform"><span class="std std-ref">MessageSummarizationTransform</span></a>: the agent LLM must process the full long tool output (around 12,800 tokens)</p></li>
<li><p>With <a class="reference internal" href="../api/prompttemplate.html#messagesummarizationtransform"><span class="std std-ref">MessageSummarizationTransform</span></a>: the summarization LLM generates a summary (around 8,900 tokens)</p></li>
</ul>
</li>
<li><p><strong>After a second message</strong>, the difference becomes significant:</p>
<ul>
<li><p>Without the transform: token usage doubles to about 25,300 tokens as the agent LLM must reprocess the long tool output</p></li>
<li><p>With the transform: token usage only increases slightly to about 9,400 tokens due to summaries being cached in datastores and not regenerated.</p></li>
</ul>
</li>
</ul>
<p>This demonstrates that the messages were effectively summarized and cached.</p>
</section>
<section id="summarizing-long-conversations">
<h2>Summarizing Long Conversations<a class="headerlink" href="#summarizing-long-conversations" title="Permalink to this heading">#</a></h2>
<p>This method uses the built-in <a class="reference internal" href="../api/prompttemplate.html#conversationsummarizationtransform"><span class="std std-ref">ConversationSummarizationTransform</span></a> to summarize older messages when conversations become too long, preserving historical information while keeping the context manageable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.transforms</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConversationSummarizationTransform</span>

<span class="n">transform</span> <span class="o">=</span> <span class="n">ConversationSummarizationTransform</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">summarization_llm</span><span class="p">,</span>
    <span class="n">max_num_messages</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">min_num_messages</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Let’s integrate the <a class="reference internal" href="../api/prompttemplate.html#messagetransform"><span class="std std-ref">MessageTransform</span></a> into the <a class="reference internal" href="../api/agent.html#agent"><span class="std std-ref">Agent</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">agent_llm</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">transforms</span><span class="o">=</span><span class="p">[</span><span class="n">transform</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">conversation</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">()</span>
<span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;What is the capital of Switzerland?&quot;</span><span class="p">)</span>
<span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;Tell me a fun fact about it.&quot;</span><span class="p">)</span>
<span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;What is the population?&quot;</span><span class="p">)</span>
<span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;What is the area?&quot;</span><span class="p">)</span>
<span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;What languages are spoken there?&quot;</span><span class="p">)</span>
<span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="c1"># The conversation will be summarized when it exceeds 5 messages</span>
</pre></div>
</div>
<p>If you want to check that the <a class="reference internal" href="../api/prompttemplate.html#conversationsummarizationtransform"><span class="std std-ref">ConversationSummarizationTransform</span></a> is really summarizing old messages together, you either use the same <code class="docutils literal notranslate"><span class="pre">TokenLister</span></code> as in the previous section to measure tokens or you can also create your own <code class="docutils literal notranslate"><span class="pre">EventListener</span></code> that prints the conversation.</p>
</section>
<section id="using-both-transforms-together">
<h2>Using Both Transforms Together<a class="headerlink" href="#using-both-transforms-together" title="Permalink to this heading">#</a></h2>
<p>For comprehensive context management, you can apply both transforms together. The <a class="reference internal" href="../api/prompttemplate.html#messagesummarizationtransform"><span class="std std-ref">MessageSummarizationTransform</span></a> will first handle individual long messages, and then the <a class="reference internal" href="../api/prompttemplate.html#conversationsummarizationtransform"><span class="std std-ref">ConversationSummarizationTransform</span></a> will manage the overall conversation length.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">transforms</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">MessageSummarizationTransform</span><span class="p">(</span>
        <span class="n">llm</span><span class="o">=</span><span class="n">summarization_llm</span><span class="p">,</span>
        <span class="n">max_message_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
        <span class="n">summarized_message_template</span><span class="o">=</span><span class="s2">&quot;Summarized content:</span><span class="se">\n</span><span class="s2">{{summary}}&quot;</span>
    <span class="p">),</span>
    <span class="n">ConversationSummarizationTransform</span><span class="p">(</span>
        <span class="n">llm</span><span class="o">=</span><span class="n">summarization_llm</span><span class="p">,</span>
        <span class="n">max_num_messages</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">min_num_messages</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Let’s integrate the <a class="reference internal" href="../api/prompttemplate.html#messagetransform"><span class="std std-ref">MessageTransform</span></a> into the <a class="reference internal" href="../api/agent.html#agent"><span class="std std-ref">Agent</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">summarization_llm</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">read_logs_tool</span><span class="p">],</span>
    <span class="n">transforms</span><span class="o">=</span><span class="n">transforms</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">conversation</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">()</span>

<span class="n">LONG_CONVERSATION</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hi! Can you tell me something interesting about dolphins?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Absolutely! Dolphins are fascinating creatures, famous for their intelligence and complex behavior. For example, they have been observed using tools, such as covering their snouts with sponges to protect themselves while foraging on the seafloor. Dolphins also display strong social bonds and have been known to help injured individuals within their pods. Communication among dolphins is advanced; they use a series of clicks, whistles, and body movements to convey information, and some species even have distinctive signature whistles that function like names.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Wow, I didn’t know that. Do dolphins have good memory?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Dolphins possess remarkable memories, particularly when it comes to their social groups and vocal communication. Researchers have discovered that dolphins can remember the unique signature whistles of other dolphins for over 20 years, which is the longest social memory recorded in non-human animals. This ability highlights their sophisticated cognitive abilities and the importance of long-term relationships in dolphin societies. Memory also plays a crucial role in their navigation and hunting skills, as dolphins migrate and follow paths in the oceans over great distances. In addition, their keen memory supports learning from one another, enhancing the social structure of their pods.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;That’s impressive. Are there other animals with similar intelligence?&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Indeed, there are several other animals that exhibit forms of intelligence comparable to dolphins. Great apes, such as chimpanzees and orangutans, have been observed making and using tools, solving puzzles, and displaying empathy and self-awareness. Elephants show emotional intelligence and have complex social relationships, including mourning their dead and helping injured companions. Crows and parrots, members of the bird family, demonstrate advanced problem-solving, mimicry, and even the ability to plan for future events. These examples across different branches of the animal kingdom show that intelligence has evolved in diverse and fascinating ways.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Can elephants recognize themselves in a mirror like dolphins?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Yes, elephants are among the elite group of species known to pass the mirror self-recognition test, an experiment generally considered evidence of self-awareness. In these experiments, elephants explore themselves in mirrors and investigate marks on their bodies they otherwise couldn’t see. Notably, this test has only been passed by a few species, including certain great apes, dolphins, magpies, and elephants. Such ability hints at a deep cognitive capacity, suggesting they have a mental representation of themselves, which is foundational for empathy and understanding the experiences of others. This self-recognition is just one of the many amazing aspects of elephant intelligence that continue to be studied.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;What is the mirror test?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;The mirror test, also known as the mark test, is a behavioral technique designed to assess self-awareness in animals. In the test, an animal is marked with an odorless dye in a place it cannot see without a mirror. The animal is then given access to a mirror, and researchers observe whether it investigates or tries to touch the mark on its own body, indicating recognition of its reflection as itself, not another animal. Passing the mirror test suggests a level of self-concept, which is considered an advanced cognitive trait. However, not all intelligent animals pass the mirror test, and failing it doesn’t necessarily mean an animal lacks self-awareness – it might simply not care about the mark or not rely on visual cues.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Besides animals, what’s another field where recognition is important?&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Recognition is vitally important in many human technologies, notably in the field of artificial intelligence. Facial recognition technology is widely used for security purposes, such as unlocking smartphones or monitoring public spaces. In social media, these algorithms help automatically tag friends in photos, organizing vast amounts of visual data. Additionally, recognition systems are applied in retail, for personalized marketing, and in health care, for patient identification and monitoring. However, these powerful tools also raise important questions around privacy and data security, sparking ongoing debates about their regulation and ethical use.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Is facial recognition always accurate?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Facial recognition technology has improved significantly over recent years, but it is not flawless and its accuracy can vary depending on several factors. Lighting, angle, image quality, and the diversity of data used to train the algorithms all influence performance. Notably, many studies have shown that facial recognition systems can have higher error rates when identifying people with darker skin tones or from underrepresented demographics, leading to concerns about bias and discrimination. This has prompted researchers and policymakers to push for better training data, algorithmic transparency, and stricter oversight. As the technology becomes more widespread, ensuring fairness and accuracy is an essential focus for developers and regulators alike.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;What are some other ethical concerns in AI?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Ethical challenges in AI are numerous and complex, reflecting the far-reaching impact of these technologies on society. Privacy concerns are paramount, as AI systems often require large amounts of personal data, raising questions about consent and data protection. Bias in algorithms is another major issue, as AI can inadvertently reinforce existing societal prejudices if not carefully monitored and tested. Transparency is crucial, because many AI systems, especially those using deep learning, can behave as &#39;black boxes&#39;—making decisions in ways that aren’t easily understandable to humans. Additionally, there are fears around job displacement, as automation could replace roles faster than new opportunities are created, necessitating careful consideration and retraining initiatives.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Job displacement is interesting. Which jobs are most at risk from AI?&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Jobs that involve repetitive, predictable tasks are currently considered the most vulnerable to automation by AI. For example, data entry clerks, assembly line workers, and certain types of customer service representatives face a high likelihood of being replaced or augmented by machines. Even within fields like transportation, we’re seeing the rise of autonomous vehicles that could impact truck drivers and delivery personnel. On the other hand, roles that require creativity, complex decision-making, emotional intelligence, or physical dexterity in unpredictable environments—such as healthcare providers, artists, and skilled trades—are less susceptible for now. To manage this transition, many experts recommend investing in retraining programs and encouraging adaptability in the workforce.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;On a lighter note, do you know any fun space facts?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Absolutely, space offers an endless trove of fascinating discoveries. For example, Venus has a very unusual rotation: a single day on Venus (one rotation on its axis) is actually longer than its year (one complete orbit around the Sun) due to its slow spin. There are also diamond rains on planets like Neptune and Uranus, caused by extreme pressure turning carbon into solid diamonds. You might be surprised to learn that there are more stars in the observable universe than grains of sand on all the Earth’s beaches combined. Finally, if you were to fall into a black hole, the laws of physics as we understand them break down at the singularity—a phenomenon still not fully explained by scientists.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;That’s fascinating! How hot does it get on Venus?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Venus is the hottest planet in our solar system, even outpacing Mercury, which is closer to the Sun. The average surface temperature on Venus can reach an astonishing 465 degrees Celsius, or about 869 degrees Fahrenheit. This is hot enough to melt lead, and it creates an extremely inhospitable environment for life as we know it. The intense heat is largely due to the planet’s dense atmosphere, composed mostly of carbon dioxide, which traps heat through a runaway greenhouse effect. In addition to being scorching, Venus’s atmosphere features thick clouds of sulfuric acid that make its surface perpetually shrouded and acidic.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Why is Venus hotter than Mercury?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Despite being the second planet from the Sun, Venus is hotter than Mercury primarily because of its thick, carbon dioxide-rich atmosphere. This atmosphere acts as a blanket, trapping incoming solar radiation and preventing heat from escaping, leading to the planet&#39;s infamous runaway greenhouse effect. Meanwhile, Mercury has only a thin exosphere, which allows heat to escape into space quickly, resulting in dramatic temperature swings between day and night. The conditions on Venus are so extreme that even spacecraft sent to the surface survive only a few hours before being destroyed by the temperature and pressure. In effect, Venus offers a dramatic example of how atmospheric composition can significantly influence planetary climates.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Are there any missions planned to Venus soon?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Yes, the next decade promises to be exciting for Venus exploration, with both NASA and the European Space Agency planning new missions. NASA has announced the VERITAS and DAVINCI+ missions, aiming to study Venus’s geology, atmosphere, and history, with launches expected later this decade. ESA is preparing its own mission called EnVision, which will investigate Venus&#39;s surface and atmosphere using advanced radar and spectrometry. These missions hope to resolve key questions, such as whether Venus ever had oceans, what processes led to its intense greenhouse state, and if volcanic activity is still ongoing. Renewed interest in Venus stems from its potential to teach us about planetary evolution, including factors that affect habitability.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Cool! Back to Earth, what&#39;s the largest living structure here?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;The largest living structure on Earth is the Great Barrier Reef, stretching more than 2,300 kilometers along Australia’s northeastern coast. This massive coral system is so large it can be seen from space, and it comprises thousands of individual reefs and hundreds of islands built by billions of tiny coral polyps. The reef supports an extraordinary diversity of marine life, hosting over 1,500 fish species, turtles, sea snakes, and countless invertebrates. It also plays a crucial ecological role, protecting coastlines from storms and supporting local economies through tourism and fishing. Unfortunately, despite its size and importance, the Great Barrier Reef faces significant threats from climate change, particularly coral bleaching and ocean acidification.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Is it in danger?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Sadly, the Great Barrier Reef is indeed at risk due to multiple environmental pressures. One of the most severe challenges is coral bleaching, which occurs when higher sea temperatures stress corals, causing them to expel the symbiotic algae they rely on for food and color. Repeated bleaching events in recent years have resulted in large-scale loss of coral cover, and the recovery process can be slow or incomplete. Additional threats include poor water quality from agricultural runoff, overfishing, cyclones, and outbreaks of crown-of-thorns starfish, which prey on corals. Conservation efforts are underway, but reducing global carbon emissions is crucial to ensuring the reef’s long-term survival.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Can coral reefs recover from bleaching?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Reef recovery after bleaching is possible, but it depends on the severity of the event and the time between subsequent stress episodes. Corals can regain their symbiotic algae and recover their vibrant colors if water temperatures return to normal quickly enough. However, back-to-back bleaching events—such as those in recent years—inhibit full recovery and can lead to widespread coral death. The resilience of a reef also depends on the health of its local ecosystem, water quality, and the diversity of coral species present. Active restoration efforts, like coral gardening and selective breeding for heat-tolerant corals, are being explored to help boost reef recovery in the face of a warming climate.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Are there artificial reefs?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Yes, artificial reefs have been employed worldwide as a means to enhance marine habitats and promote biodiversity. These structures can be made from a variety of materials, including concrete blocks, purpose-built modules, and even deliberately sunken ships or decommissioned military vehicles. When placed on the ocean floor, artificial reefs provide surfaces for corals to attach to and develop, which in turn attract fish and other marine species seeking food and shelter. Over time, these reefs can become thriving ecosystems, sometimes rivaling their natural counterparts in productivity. Besides ecological benefits, artificial reefs are also used to create tourist attractions for diving and help reduce pressure on natural reefs by diverting fishing and recreational activity.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Do fish immediately move into new artificial reefs?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Fish and other marine organisms often begin exploring and colonizing new artificial reefs quite quickly—sometimes within just a few weeks of their deployment. The structures offer instant shelter from predators and new feeding opportunities, which attract small fish and invertebrates first. Over several months, larger predatory species may start appearing as the new reef becomes established as a hunting and breeding ground. The colonization process is further accelerated if the surrounding water already hosts healthy marine life populations. Eventually, the artificial reef can develop complex food webs, supporting a community of organisms similar to that of natural reefs, though full ecosystem development takes several years.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I love learning these facts. Can you tell me one more surprising animal fact?&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Of course! One particularly astonishing animal fact concerns the octopus: these remarkable creatures possess not one, but three hearts. Two of the hearts are responsible for pumping blood through the gills, where it picks up oxygen, while the third pumps oxygenated blood throughout the rest of the body. Octopuses also have blue blood, a consequence of their use of a copper-rich protein called hemocyanin instead of hemoglobin, which is based on iron and gives human blood its red color. The blue blood is more efficient at transporting oxygen in the cold, low-oxygen conditions of the ocean, making it especially advantageous for the octopus’s varied habitats. In addition to their unique circulatory system, octopuses are also known for their high intelligence, problem-solving abilities, and incredible camouflage skills.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;That’s wild. Why do they have blue blood?&quot;</span><span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;The blue color of octopus blood is due to the presence of hemocyanin, a copper-based molecule that binds with oxygen for transport throughout the body. This adaptation is particularly effective in the cold, low-oxygen environments found in many parts of the oceans where octopuses live. Hemocyanin is more efficient than hemoglobin (the iron-based molecule in red blood) under these conditions, which helps octopuses thrive in diverse and sometimes extreme marine settings. The evolution of blue blood is an example of the many unique physiological characteristics that have enabled cephalopods to become such successful marine invertebrates. It’s remarkable how life develops specialized solutions to meet the challenges of different environments.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">LONG_CONVERSATION</span><span class="p">:</span>
    <span class="n">conversation</span><span class="o">.</span><span class="n">append_message</span><span class="p">(</span>
        <span class="n">Message</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">msg</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">],</span> <span class="n">role</span><span class="o">=</span><span class="n">msg</span><span class="p">[</span><span class="s2">&quot;role&quot;</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
    <span class="p">)</span>

<span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;What tool do dolphins sometimes use when foraging on the seafloor, and why?&quot;</span><span class="p">)</span>
<span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this heading">#</a></h2>
<p>We have seen in this how-to how to leverage <a class="reference internal" href="../api/prompttemplate.html#messagesummarizationtransform"><span class="std std-ref">MessageSummarizationTransform</span></a> and <a class="reference internal" href="../api/prompttemplate.html#conversationsummarizationtransform"><span class="std std-ref">ConversationSummarizationTransform</span></a> to reduce the size of the LLM context.
We have also seen how to use event listeners to measure LLM token consumption. With this new knowledge, you can proceed to <a class="reference internal" href="howto_build_assistants_with_tools.html"><span class="doc">How to Build Assistants with Tools</span></a>.</p>
</section>
<section id="full-code">
<h2>Full Code<a class="headerlink" href="#full-code" title="Permalink to this heading">#</a></h2>
<p>Click the card at the <a class="reference internal" href="#top-howtolongmessage"><span class="std std-ref">top of this page</span></a> to download the complete code for this guide, or copy it below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1"># Copyright © 2025 Oracle and/or its affiliates.</span>
<span class="linenos">  2</span><span class="c1">#</span>
<span class="linenos">  3</span><span class="c1"># This software is under the Apache License 2.0</span>
<span class="linenos">  4</span><span class="c1"># %%[markdown]</span>
<span class="linenos">  5</span><span class="c1"># Code Example - How to use MessageTransform</span>
<span class="linenos">  6</span><span class="c1"># ------------------------------------------</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="c1"># How to use:</span>
<span class="linenos">  9</span><span class="c1"># Create a new Python virtual environment and install the latest WayFlow version.</span>
<span class="linenos"> 10</span><span class="c1"># ```bash</span>
<span class="linenos"> 11</span><span class="c1"># python -m venv venv-wayflowcore</span>
<span class="linenos"> 12</span><span class="c1"># source venv-wayflowcore/bin/activate</span>
<span class="linenos"> 13</span><span class="c1"># pip install --upgrade pip</span>
<span class="linenos"> 14</span><span class="c1"># pip install &quot;wayflowcore==26.1&quot; </span>
<span class="linenos"> 15</span><span class="c1"># ```</span>
<span class="linenos"> 16</span>
<span class="linenos"> 17</span><span class="c1"># You can now run the script</span>
<span class="linenos"> 18</span><span class="c1"># 1. As a Python file:</span>
<span class="linenos"> 19</span><span class="c1"># ```bash</span>
<span class="linenos"> 20</span><span class="c1"># python howto_long_context.py</span>
<span class="linenos"> 21</span><span class="c1"># ```</span>
<span class="linenos"> 22</span><span class="c1"># 2. As a Notebook (in VSCode):</span>
<span class="linenos"> 23</span><span class="c1"># When viewing the file,</span>
<span class="linenos"> 24</span><span class="c1">#  - press the keys Ctrl + Enter to run the selected cell</span>
<span class="linenos"> 25</span><span class="c1">#  - or Shift + Enter to run the selected cell and move to the cell below# (LICENSE-APACHE or http://www.apache.org/licenses/LICENSE-2.0) or Universal Permissive License</span>
<span class="linenos"> 26</span><span class="c1"># (UPL) 1.0 (LICENSE-UPL or https://oss.oracle.com/licenses/upl), at your option.</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="linenos"> 30</span>
<span class="linenos"> 31</span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span>
<span class="linenos"> 34</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 35</span><span class="c1">## Define LLMS</span>
<span class="linenos"> 36</span>
<span class="linenos"> 37</span><span class="c1"># %%</span>
<span class="linenos"> 38</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">VllmModel</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span><span class="n">summarization_llm</span> <span class="o">=</span> <span class="n">VllmModel</span><span class="p">(</span>
<span class="linenos"> 41</span>    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;SMALL_LLAMA_MODEL_ID&quot;</span><span class="p">,</span>
<span class="linenos"> 42</span>    <span class="n">host_port</span><span class="o">=</span><span class="s2">&quot;SMALL_LLAMA_API_URL&quot;</span><span class="p">,</span>
<span class="linenos"> 43</span><span class="p">)</span>
<span class="linenos"> 44</span><span class="n">agent_llm</span> <span class="o">=</span> <span class="n">VllmModel</span><span class="p">(</span>
<span class="linenos"> 45</span>    <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;LLAMA_MODEL_ID&quot;</span><span class="p">,</span>
<span class="linenos"> 46</span>    <span class="n">host_port</span><span class="o">=</span><span class="s2">&quot;LLAMA_API_URL&quot;</span><span class="p">,</span>
<span class="linenos"> 47</span><span class="p">)</span>
<span class="linenos"> 48</span>
<span class="linenos"> 49</span>
<span class="linenos"> 50</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 51</span><span class="c1">## Create MessageSummarizationTransform</span>
<span class="linenos"> 52</span>
<span class="linenos"> 53</span><span class="c1"># %%</span>
<span class="linenos"> 54</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.transforms</span><span class="w"> </span><span class="kn">import</span> <span class="n">MessageSummarizationTransform</span>
<span class="linenos"> 55</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span><span class="n">transform</span> <span class="o">=</span> <span class="n">MessageSummarizationTransform</span><span class="p">(</span>
<span class="linenos"> 58</span>    <span class="n">llm</span><span class="o">=</span><span class="n">summarization_llm</span><span class="p">,</span>
<span class="linenos"> 59</span>    <span class="n">max_message_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
<span class="linenos"> 60</span>    <span class="n">summarized_message_template</span><span class="o">=</span><span class="s2">&quot;Summarized result:</span><span class="se">\n</span><span class="s2">{{summary}}&quot;</span>
<span class="linenos"> 61</span><span class="p">)</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span>
<span class="linenos"> 65</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 66</span><span class="c1">## Create Agent</span>
<span class="linenos"> 67</span>
<span class="linenos"> 68</span><span class="c1"># %%</span>
<span class="linenos"> 69</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">Message</span><span class="p">,</span> <span class="n">tool</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span><span class="nd">@tool</span>
<span class="linenos"> 72</span><span class="k">def</span><span class="w"> </span><span class="nf">read_logs_tool</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 73</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return logs from the system&quot;&quot;&quot;</span>
<span class="linenos"> 74</span>    <span class="k">return</span> <span class="p">(</span>
<span class="linenos"> 75</span>        <span class="s2">&quot;Starting long processing</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="linenos"> 76</span>        <span class="o">+</span> <span class="s2">&quot;Waiting for process ...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">2_000</span>
<span class="linenos"> 77</span>        <span class="o">+</span> <span class="s2">&quot;Found error: Missing credentials for user kurt_andrews.&quot;</span>
<span class="linenos"> 78</span>        <span class="o">+</span> <span class="s2">&quot; Please pass the correct credentials.</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="linenos"> 79</span>    <span class="p">)</span>
<span class="linenos"> 80</span>
<span class="linenos"> 81</span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
<span class="linenos"> 82</span>    <span class="n">llm</span><span class="o">=</span><span class="n">agent_llm</span><span class="p">,</span>
<span class="linenos"> 83</span>    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">read_logs_tool</span><span class="p">],</span>
<span class="linenos"> 84</span>    <span class="n">transforms</span><span class="o">=</span><span class="p">[</span><span class="n">transform</span><span class="p">],</span>
<span class="linenos"> 85</span><span class="p">)</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>
<span class="linenos"> 88</span><span class="c1"># %%[markdown]</span>
<span class="linenos"> 89</span><span class="c1">## Create Token Event Listener</span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span><span class="c1"># %%</span>
<span class="linenos"> 92</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.events.eventlistener</span><span class="w"> </span><span class="kn">import</span> <span class="n">EventListener</span>
<span class="linenos"> 93</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.events.event</span><span class="w"> </span><span class="kn">import</span> <span class="n">LlmGenerationResponseEvent</span>
<span class="linenos"> 94</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.events</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_event_listeners</span>
<span class="linenos"> 95</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.tokenusage</span><span class="w"> </span><span class="kn">import</span> <span class="n">TokenUsage</span>
<span class="linenos"> 96</span>
<span class="linenos"> 97</span><span class="k">class</span><span class="w"> </span><span class="nc">TokenListener</span><span class="p">(</span><span class="n">EventListener</span><span class="p">):</span>
<span class="linenos"> 98</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 99</span>        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">TokenUsage</span><span class="p">()</span>
<span class="linenos">100</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="linenos">101</span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">LlmGenerationResponseEvent</span><span class="p">):</span>
<span class="linenos">102</span>            <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">+=</span> <span class="n">event</span><span class="o">.</span><span class="n">completion</span><span class="o">.</span><span class="n">token_usage</span>
<span class="linenos">103</span>
<span class="linenos">104</span>
<span class="linenos">105</span><span class="c1"># %%[markdown]</span>
<span class="linenos">106</span><span class="c1">## Run Agent With MessageSummarizationTransform</span>
<span class="linenos">107</span>
<span class="linenos">108</span><span class="c1"># %%</span>
<span class="linenos">109</span><span class="n">listener_with_transform</span> <span class="o">=</span> <span class="n">TokenListener</span><span class="p">()</span>
<span class="linenos">110</span><span class="k">with</span> <span class="n">register_event_listeners</span><span class="p">([</span><span class="n">listener_with_transform</span><span class="p">]):</span>
<span class="linenos">111</span>    <span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.executors.executionstatus</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserMessageRequestStatus</span>
<span class="linenos">112</span>
<span class="linenos">113</span>    <span class="n">conversation</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">()</span>
<span class="linenos">114</span>    <span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;Can you explain the error in the system?&quot;</span><span class="p">)</span>
<span class="linenos">115</span>    <span class="n">status</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">116</span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">UserMessageRequestStatus</span><span class="p">):</span>
<span class="linenos">117</span>        <span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="linenos">118</span>        <span class="c1"># The error is likely due to a missing credential for</span>
<span class="linenos">119</span>        <span class="c1"># a user named kurt_andrews. Please ensure the credentials</span>
<span class="linenos">120</span>        <span class="c1"># are provided correctly for kurt_andrews to resolve the issue.</span>
<span class="linenos">121</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token usage with MessageSummarizationTransform after 1 user message: </span><span class="si">{</span><span class="n">listener_with_transform</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">total_tokens</span><span class="si">}</span><span class="s2"> tokens&quot;</span><span class="p">)</span>
<span class="linenos">122</span>    <span class="c1"># Token usage with MessageSummarizationTransform after 1 user message: 8854 tokens</span>
<span class="linenos">123</span>
<span class="linenos">124</span>    <span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s1">&#39;What is the exact message repeated in a loop? Do not recall the tool&#39;</span><span class="p">)</span>
<span class="linenos">125</span>    <span class="n">status</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">126</span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">UserMessageRequestStatus</span><span class="p">):</span>
<span class="linenos">127</span>        <span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="linenos">128</span>        <span class="c1"># The tool is stuck in an infinite loop, repeatedly displaying the message &quot;Waiting for process&quot; until it encounters an error due to missing credentials for user &quot;kurt_andrews&quot;.</span>
<span class="linenos">129</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token usage with MessageSummarizationTransform after 2 user messages: </span><span class="si">{</span><span class="n">listener_with_transform</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">total_tokens</span><span class="si">}</span><span class="s2"> tokens&quot;</span><span class="p">)</span><span class="c1"># .. start-##_Create_Token_Event_Listener</span>
<span class="linenos">130</span>    <span class="c1"># Token usage with MessageSummarizationTransform after 2 user messages: 9314 tokens</span>
<span class="linenos">131</span>
<span class="linenos">132</span>
<span class="linenos">133</span>
<span class="linenos">134</span>
<span class="linenos">135</span>
<span class="linenos">136</span><span class="c1"># %%[markdown]</span>
<span class="linenos">137</span><span class="c1">## Create Agent Without Transform</span>
<span class="linenos">138</span>
<span class="linenos">139</span><span class="c1"># %%</span>
<span class="linenos">140</span><span class="n">agent_no_transform</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
<span class="linenos">141</span>    <span class="n">llm</span><span class="o">=</span><span class="n">agent_llm</span><span class="p">,</span>
<span class="linenos">142</span>    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">read_logs_tool</span><span class="p">],</span>
<span class="linenos">143</span>    <span class="n">transforms</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># no transforms</span>
<span class="linenos">144</span><span class="p">)</span>
<span class="linenos">145</span>
<span class="linenos">146</span><span class="n">listener_no_transform</span> <span class="o">=</span> <span class="n">TokenListener</span><span class="p">()</span>
<span class="linenos">147</span><span class="k">with</span> <span class="n">register_event_listeners</span><span class="p">([</span><span class="n">listener_no_transform</span><span class="p">]):</span>
<span class="linenos">148</span>    <span class="n">conversation</span> <span class="o">=</span> <span class="n">agent_no_transform</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">()</span>
<span class="linenos">149</span>    <span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;Can you explain the error in the system?&quot;</span><span class="p">)</span>
<span class="linenos">150</span>    <span class="n">status</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">151</span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">UserMessageRequestStatus</span><span class="p">):</span>
<span class="linenos">152</span>        <span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="linenos">153</span>
<span class="linenos">154</span>    <span class="c1"># ... (same conversation as above)</span>
<span class="linenos">155</span>
<span class="linenos">156</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token usage without MessageSummarizationTransform after 1 user message: </span><span class="si">{</span><span class="n">listener_no_transform</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">total_tokens</span><span class="si">}</span><span class="s2"> tokens&quot;</span><span class="p">)</span>
<span class="linenos">157</span>    <span class="c1"># Token usage without MessageSummarizationTransform after 1 user message: 12757 tokens</span>
<span class="linenos">158</span>
<span class="linenos">159</span>
<span class="linenos">160</span>    <span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s1">&#39;What is the exact message repeated in a loop? Do not recall the tool&#39;</span><span class="p">)</span>
<span class="linenos">161</span>    <span class="n">status</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">162</span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">UserMessageRequestStatus</span><span class="p">):</span>
<span class="linenos">163</span>        <span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="linenos">164</span>
<span class="linenos">165</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token usage without MessageSummarizationTransform after 2 user messages: </span><span class="si">{</span><span class="n">listener_no_transform</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">total_tokens</span><span class="si">}</span><span class="s2"> tokens&quot;</span><span class="p">)</span><span class="c1"># .. start-##_Create_Token_Event_Listener</span>
<span class="linenos">166</span>    <span class="c1"># Token usage without MessageSummarizationTransform after 2 user messages: 25224 tokens</span>
<span class="linenos">167</span>
<span class="linenos">168</span>
<span class="linenos">169</span>
<span class="linenos">170</span>
<span class="linenos">171</span>
<span class="linenos">172</span><span class="c1"># %%[markdown]</span>
<span class="linenos">173</span><span class="c1">## Create ConversationSummarizationTransform</span>
<span class="linenos">174</span>
<span class="linenos">175</span><span class="c1"># %%</span>
<span class="linenos">176</span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.transforms</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConversationSummarizationTransform</span>
<span class="linenos">177</span>
<span class="linenos">178</span><span class="n">transform</span> <span class="o">=</span> <span class="n">ConversationSummarizationTransform</span><span class="p">(</span>
<span class="linenos">179</span>    <span class="n">llm</span><span class="o">=</span><span class="n">summarization_llm</span><span class="p">,</span>
<span class="linenos">180</span>    <span class="n">max_num_messages</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="linenos">181</span>    <span class="n">min_num_messages</span><span class="o">=</span><span class="mi">2</span>
<span class="linenos">182</span><span class="p">)</span>
<span class="linenos">183</span>
<span class="linenos">184</span>
<span class="linenos">185</span><span class="c1"># %%[markdown]</span>
<span class="linenos">186</span><span class="c1">## Run Agent With ConversationSummarizationTransform</span>
<span class="linenos">187</span>
<span class="linenos">188</span><span class="c1"># %%</span>
<span class="linenos">189</span>
<span class="linenos">190</span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
<span class="linenos">191</span>    <span class="n">llm</span><span class="o">=</span><span class="n">agent_llm</span><span class="p">,</span>
<span class="linenos">192</span>    <span class="n">tools</span><span class="o">=</span><span class="p">[],</span>
<span class="linenos">193</span>    <span class="n">transforms</span><span class="o">=</span><span class="p">[</span><span class="n">transform</span><span class="p">],</span>
<span class="linenos">194</span><span class="p">)</span>
<span class="linenos">195</span>
<span class="linenos">196</span><span class="n">conversation</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">()</span>
<span class="linenos">197</span><span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;What is the capital of Switzerland?&quot;</span><span class="p">)</span>
<span class="linenos">198</span><span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">199</span><span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;Tell me a fun fact about it.&quot;</span><span class="p">)</span>
<span class="linenos">200</span><span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">201</span><span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;What is the population?&quot;</span><span class="p">)</span>
<span class="linenos">202</span><span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">203</span><span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;What is the area?&quot;</span><span class="p">)</span>
<span class="linenos">204</span><span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">205</span><span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;What languages are spoken there?&quot;</span><span class="p">)</span>
<span class="linenos">206</span><span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="linenos">207</span><span class="c1"># The conversation will be summarized when it exceeds 5 messages</span>
<span class="linenos">208</span>
<span class="linenos">209</span>
<span class="linenos">210</span>
<span class="linenos">211</span><span class="c1"># %%[markdown]</span>
<span class="linenos">212</span><span class="c1">## Create Both Transforms</span>
<span class="linenos">213</span>
<span class="linenos">214</span><span class="c1"># %%</span>
<span class="linenos">215</span><span class="n">transforms</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos">216</span>    <span class="n">MessageSummarizationTransform</span><span class="p">(</span>
<span class="linenos">217</span>        <span class="n">llm</span><span class="o">=</span><span class="n">summarization_llm</span><span class="p">,</span>
<span class="linenos">218</span>        <span class="n">max_message_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
<span class="linenos">219</span>        <span class="n">summarized_message_template</span><span class="o">=</span><span class="s2">&quot;Summarized content:</span><span class="se">\n</span><span class="s2">{{summary}}&quot;</span>
<span class="linenos">220</span>    <span class="p">),</span>
<span class="linenos">221</span>    <span class="n">ConversationSummarizationTransform</span><span class="p">(</span>
<span class="linenos">222</span>        <span class="n">llm</span><span class="o">=</span><span class="n">summarization_llm</span><span class="p">,</span>
<span class="linenos">223</span>        <span class="n">max_num_messages</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="linenos">224</span>        <span class="n">min_num_messages</span><span class="o">=</span><span class="mi">2</span>
<span class="linenos">225</span>    <span class="p">)</span>
<span class="linenos">226</span><span class="p">]</span>
<span class="linenos">227</span>
<span class="linenos">228</span>
<span class="linenos">229</span><span class="c1"># %%[markdown]</span>
<span class="linenos">230</span><span class="c1">## Run Agent With Both Transforms</span>
<span class="linenos">231</span>
<span class="linenos">232</span><span class="c1"># %%</span>
<span class="linenos">233</span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
<span class="linenos">234</span>    <span class="n">llm</span><span class="o">=</span><span class="n">summarization_llm</span><span class="p">,</span>
<span class="linenos">235</span>    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">read_logs_tool</span><span class="p">],</span>
<span class="linenos">236</span>    <span class="n">transforms</span><span class="o">=</span><span class="n">transforms</span><span class="p">,</span>
<span class="linenos">237</span><span class="p">)</span>
<span class="linenos">238</span>
<span class="linenos">239</span><span class="n">conversation</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">()</span>
<span class="linenos">240</span>
<span class="linenos">241</span><span class="n">LONG_CONVERSATION</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos">242</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Hi! Can you tell me something interesting about dolphins?&quot;</span><span class="p">},</span>
<span class="linenos">243</span>    <span class="p">{</span>
<span class="linenos">244</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">245</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Absolutely! Dolphins are fascinating creatures, famous for their intelligence and complex behavior. For example, they have been observed using tools, such as covering their snouts with sponges to protect themselves while foraging on the seafloor. Dolphins also display strong social bonds and have been known to help injured individuals within their pods. Communication among dolphins is advanced; they use a series of clicks, whistles, and body movements to convey information, and some species even have distinctive signature whistles that function like names.&quot;</span><span class="p">,</span>
<span class="linenos">246</span>    <span class="p">},</span>
<span class="linenos">247</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Wow, I didn’t know that. Do dolphins have good memory?&quot;</span><span class="p">},</span>
<span class="linenos">248</span>    <span class="p">{</span>
<span class="linenos">249</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">250</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Dolphins possess remarkable memories, particularly when it comes to their social groups and vocal communication. Researchers have discovered that dolphins can remember the unique signature whistles of other dolphins for over 20 years, which is the longest social memory recorded in non-human animals. This ability highlights their sophisticated cognitive abilities and the importance of long-term relationships in dolphin societies. Memory also plays a crucial role in their navigation and hunting skills, as dolphins migrate and follow paths in the oceans over great distances. In addition, their keen memory supports learning from one another, enhancing the social structure of their pods.&quot;</span><span class="p">,</span>
<span class="linenos">251</span>    <span class="p">},</span>
<span class="linenos">252</span>    <span class="p">{</span>
<span class="linenos">253</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
<span class="linenos">254</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;That’s impressive. Are there other animals with similar intelligence?&quot;</span><span class="p">,</span>
<span class="linenos">255</span>    <span class="p">},</span>
<span class="linenos">256</span>    <span class="p">{</span>
<span class="linenos">257</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">258</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Indeed, there are several other animals that exhibit forms of intelligence comparable to dolphins. Great apes, such as chimpanzees and orangutans, have been observed making and using tools, solving puzzles, and displaying empathy and self-awareness. Elephants show emotional intelligence and have complex social relationships, including mourning their dead and helping injured companions. Crows and parrots, members of the bird family, demonstrate advanced problem-solving, mimicry, and even the ability to plan for future events. These examples across different branches of the animal kingdom show that intelligence has evolved in diverse and fascinating ways.&quot;</span><span class="p">,</span>
<span class="linenos">259</span>    <span class="p">},</span>
<span class="linenos">260</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Can elephants recognize themselves in a mirror like dolphins?&quot;</span><span class="p">},</span>
<span class="linenos">261</span>    <span class="p">{</span>
<span class="linenos">262</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">263</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Yes, elephants are among the elite group of species known to pass the mirror self-recognition test, an experiment generally considered evidence of self-awareness. In these experiments, elephants explore themselves in mirrors and investigate marks on their bodies they otherwise couldn’t see. Notably, this test has only been passed by a few species, including certain great apes, dolphins, magpies, and elephants. Such ability hints at a deep cognitive capacity, suggesting they have a mental representation of themselves, which is foundational for empathy and understanding the experiences of others. This self-recognition is just one of the many amazing aspects of elephant intelligence that continue to be studied.&quot;</span><span class="p">,</span>
<span class="linenos">264</span>    <span class="p">},</span>
<span class="linenos">265</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;What is the mirror test?&quot;</span><span class="p">},</span>
<span class="linenos">266</span>    <span class="p">{</span>
<span class="linenos">267</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">268</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;The mirror test, also known as the mark test, is a behavioral technique designed to assess self-awareness in animals. In the test, an animal is marked with an odorless dye in a place it cannot see without a mirror. The animal is then given access to a mirror, and researchers observe whether it investigates or tries to touch the mark on its own body, indicating recognition of its reflection as itself, not another animal. Passing the mirror test suggests a level of self-concept, which is considered an advanced cognitive trait. However, not all intelligent animals pass the mirror test, and failing it doesn’t necessarily mean an animal lacks self-awareness – it might simply not care about the mark or not rely on visual cues.&quot;</span><span class="p">,</span>
<span class="linenos">269</span>    <span class="p">},</span>
<span class="linenos">270</span>    <span class="p">{</span>
<span class="linenos">271</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
<span class="linenos">272</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Besides animals, what’s another field where recognition is important?&quot;</span><span class="p">,</span>
<span class="linenos">273</span>    <span class="p">},</span>
<span class="linenos">274</span>    <span class="p">{</span>
<span class="linenos">275</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">276</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Recognition is vitally important in many human technologies, notably in the field of artificial intelligence. Facial recognition technology is widely used for security purposes, such as unlocking smartphones or monitoring public spaces. In social media, these algorithms help automatically tag friends in photos, organizing vast amounts of visual data. Additionally, recognition systems are applied in retail, for personalized marketing, and in health care, for patient identification and monitoring. However, these powerful tools also raise important questions around privacy and data security, sparking ongoing debates about their regulation and ethical use.&quot;</span><span class="p">,</span>
<span class="linenos">277</span>    <span class="p">},</span>
<span class="linenos">278</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Is facial recognition always accurate?&quot;</span><span class="p">},</span>
<span class="linenos">279</span>    <span class="p">{</span>
<span class="linenos">280</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">281</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Facial recognition technology has improved significantly over recent years, but it is not flawless and its accuracy can vary depending on several factors. Lighting, angle, image quality, and the diversity of data used to train the algorithms all influence performance. Notably, many studies have shown that facial recognition systems can have higher error rates when identifying people with darker skin tones or from underrepresented demographics, leading to concerns about bias and discrimination. This has prompted researchers and policymakers to push for better training data, algorithmic transparency, and stricter oversight. As the technology becomes more widespread, ensuring fairness and accuracy is an essential focus for developers and regulators alike.&quot;</span><span class="p">,</span>
<span class="linenos">282</span>    <span class="p">},</span>
<span class="linenos">283</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;What are some other ethical concerns in AI?&quot;</span><span class="p">},</span>
<span class="linenos">284</span>    <span class="p">{</span>
<span class="linenos">285</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">286</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Ethical challenges in AI are numerous and complex, reflecting the far-reaching impact of these technologies on society. Privacy concerns are paramount, as AI systems often require large amounts of personal data, raising questions about consent and data protection. Bias in algorithms is another major issue, as AI can inadvertently reinforce existing societal prejudices if not carefully monitored and tested. Transparency is crucial, because many AI systems, especially those using deep learning, can behave as &#39;black boxes&#39;—making decisions in ways that aren’t easily understandable to humans. Additionally, there are fears around job displacement, as automation could replace roles faster than new opportunities are created, necessitating careful consideration and retraining initiatives.&quot;</span><span class="p">,</span>
<span class="linenos">287</span>    <span class="p">},</span>
<span class="linenos">288</span>    <span class="p">{</span>
<span class="linenos">289</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
<span class="linenos">290</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Job displacement is interesting. Which jobs are most at risk from AI?&quot;</span><span class="p">,</span>
<span class="linenos">291</span>    <span class="p">},</span>
<span class="linenos">292</span>    <span class="p">{</span>
<span class="linenos">293</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">294</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Jobs that involve repetitive, predictable tasks are currently considered the most vulnerable to automation by AI. For example, data entry clerks, assembly line workers, and certain types of customer service representatives face a high likelihood of being replaced or augmented by machines. Even within fields like transportation, we’re seeing the rise of autonomous vehicles that could impact truck drivers and delivery personnel. On the other hand, roles that require creativity, complex decision-making, emotional intelligence, or physical dexterity in unpredictable environments—such as healthcare providers, artists, and skilled trades—are less susceptible for now. To manage this transition, many experts recommend investing in retraining programs and encouraging adaptability in the workforce.&quot;</span><span class="p">,</span>
<span class="linenos">295</span>    <span class="p">},</span>
<span class="linenos">296</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;On a lighter note, do you know any fun space facts?&quot;</span><span class="p">},</span>
<span class="linenos">297</span>    <span class="p">{</span>
<span class="linenos">298</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">299</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Absolutely, space offers an endless trove of fascinating discoveries. For example, Venus has a very unusual rotation: a single day on Venus (one rotation on its axis) is actually longer than its year (one complete orbit around the Sun) due to its slow spin. There are also diamond rains on planets like Neptune and Uranus, caused by extreme pressure turning carbon into solid diamonds. You might be surprised to learn that there are more stars in the observable universe than grains of sand on all the Earth’s beaches combined. Finally, if you were to fall into a black hole, the laws of physics as we understand them break down at the singularity—a phenomenon still not fully explained by scientists.&quot;</span><span class="p">,</span>
<span class="linenos">300</span>    <span class="p">},</span>
<span class="linenos">301</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;That’s fascinating! How hot does it get on Venus?&quot;</span><span class="p">},</span>
<span class="linenos">302</span>    <span class="p">{</span>
<span class="linenos">303</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">304</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Venus is the hottest planet in our solar system, even outpacing Mercury, which is closer to the Sun. The average surface temperature on Venus can reach an astonishing 465 degrees Celsius, or about 869 degrees Fahrenheit. This is hot enough to melt lead, and it creates an extremely inhospitable environment for life as we know it. The intense heat is largely due to the planet’s dense atmosphere, composed mostly of carbon dioxide, which traps heat through a runaway greenhouse effect. In addition to being scorching, Venus’s atmosphere features thick clouds of sulfuric acid that make its surface perpetually shrouded and acidic.&quot;</span><span class="p">,</span>
<span class="linenos">305</span>    <span class="p">},</span>
<span class="linenos">306</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Why is Venus hotter than Mercury?&quot;</span><span class="p">},</span>
<span class="linenos">307</span>    <span class="p">{</span>
<span class="linenos">308</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">309</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Despite being the second planet from the Sun, Venus is hotter than Mercury primarily because of its thick, carbon dioxide-rich atmosphere. This atmosphere acts as a blanket, trapping incoming solar radiation and preventing heat from escaping, leading to the planet&#39;s infamous runaway greenhouse effect. Meanwhile, Mercury has only a thin exosphere, which allows heat to escape into space quickly, resulting in dramatic temperature swings between day and night. The conditions on Venus are so extreme that even spacecraft sent to the surface survive only a few hours before being destroyed by the temperature and pressure. In effect, Venus offers a dramatic example of how atmospheric composition can significantly influence planetary climates.&quot;</span><span class="p">,</span>
<span class="linenos">310</span>    <span class="p">},</span>
<span class="linenos">311</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Are there any missions planned to Venus soon?&quot;</span><span class="p">},</span>
<span class="linenos">312</span>    <span class="p">{</span>
<span class="linenos">313</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">314</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Yes, the next decade promises to be exciting for Venus exploration, with both NASA and the European Space Agency planning new missions. NASA has announced the VERITAS and DAVINCI+ missions, aiming to study Venus’s geology, atmosphere, and history, with launches expected later this decade. ESA is preparing its own mission called EnVision, which will investigate Venus&#39;s surface and atmosphere using advanced radar and spectrometry. These missions hope to resolve key questions, such as whether Venus ever had oceans, what processes led to its intense greenhouse state, and if volcanic activity is still ongoing. Renewed interest in Venus stems from its potential to teach us about planetary evolution, including factors that affect habitability.&quot;</span><span class="p">,</span>
<span class="linenos">315</span>    <span class="p">},</span>
<span class="linenos">316</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Cool! Back to Earth, what&#39;s the largest living structure here?&quot;</span><span class="p">},</span>
<span class="linenos">317</span>    <span class="p">{</span>
<span class="linenos">318</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">319</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;The largest living structure on Earth is the Great Barrier Reef, stretching more than 2,300 kilometers along Australia’s northeastern coast. This massive coral system is so large it can be seen from space, and it comprises thousands of individual reefs and hundreds of islands built by billions of tiny coral polyps. The reef supports an extraordinary diversity of marine life, hosting over 1,500 fish species, turtles, sea snakes, and countless invertebrates. It also plays a crucial ecological role, protecting coastlines from storms and supporting local economies through tourism and fishing. Unfortunately, despite its size and importance, the Great Barrier Reef faces significant threats from climate change, particularly coral bleaching and ocean acidification.&quot;</span><span class="p">,</span>
<span class="linenos">320</span>    <span class="p">},</span>
<span class="linenos">321</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Is it in danger?&quot;</span><span class="p">},</span>
<span class="linenos">322</span>    <span class="p">{</span>
<span class="linenos">323</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">324</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Sadly, the Great Barrier Reef is indeed at risk due to multiple environmental pressures. One of the most severe challenges is coral bleaching, which occurs when higher sea temperatures stress corals, causing them to expel the symbiotic algae they rely on for food and color. Repeated bleaching events in recent years have resulted in large-scale loss of coral cover, and the recovery process can be slow or incomplete. Additional threats include poor water quality from agricultural runoff, overfishing, cyclones, and outbreaks of crown-of-thorns starfish, which prey on corals. Conservation efforts are underway, but reducing global carbon emissions is crucial to ensuring the reef’s long-term survival.&quot;</span><span class="p">,</span>
<span class="linenos">325</span>    <span class="p">},</span>
<span class="linenos">326</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Can coral reefs recover from bleaching?&quot;</span><span class="p">},</span>
<span class="linenos">327</span>    <span class="p">{</span>
<span class="linenos">328</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">329</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Reef recovery after bleaching is possible, but it depends on the severity of the event and the time between subsequent stress episodes. Corals can regain their symbiotic algae and recover their vibrant colors if water temperatures return to normal quickly enough. However, back-to-back bleaching events—such as those in recent years—inhibit full recovery and can lead to widespread coral death. The resilience of a reef also depends on the health of its local ecosystem, water quality, and the diversity of coral species present. Active restoration efforts, like coral gardening and selective breeding for heat-tolerant corals, are being explored to help boost reef recovery in the face of a warming climate.&quot;</span><span class="p">,</span>
<span class="linenos">330</span>    <span class="p">},</span>
<span class="linenos">331</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Are there artificial reefs?&quot;</span><span class="p">},</span>
<span class="linenos">332</span>    <span class="p">{</span>
<span class="linenos">333</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">334</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Yes, artificial reefs have been employed worldwide as a means to enhance marine habitats and promote biodiversity. These structures can be made from a variety of materials, including concrete blocks, purpose-built modules, and even deliberately sunken ships or decommissioned military vehicles. When placed on the ocean floor, artificial reefs provide surfaces for corals to attach to and develop, which in turn attract fish and other marine species seeking food and shelter. Over time, these reefs can become thriving ecosystems, sometimes rivaling their natural counterparts in productivity. Besides ecological benefits, artificial reefs are also used to create tourist attractions for diving and help reduce pressure on natural reefs by diverting fishing and recreational activity.&quot;</span><span class="p">,</span>
<span class="linenos">335</span>    <span class="p">},</span>
<span class="linenos">336</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Do fish immediately move into new artificial reefs?&quot;</span><span class="p">},</span>
<span class="linenos">337</span>    <span class="p">{</span>
<span class="linenos">338</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">339</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Fish and other marine organisms often begin exploring and colonizing new artificial reefs quite quickly—sometimes within just a few weeks of their deployment. The structures offer instant shelter from predators and new feeding opportunities, which attract small fish and invertebrates first. Over several months, larger predatory species may start appearing as the new reef becomes established as a hunting and breeding ground. The colonization process is further accelerated if the surrounding water already hosts healthy marine life populations. Eventually, the artificial reef can develop complex food webs, supporting a community of organisms similar to that of natural reefs, though full ecosystem development takes several years.&quot;</span><span class="p">,</span>
<span class="linenos">340</span>    <span class="p">},</span>
<span class="linenos">341</span>    <span class="p">{</span>
<span class="linenos">342</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
<span class="linenos">343</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;I love learning these facts. Can you tell me one more surprising animal fact?&quot;</span><span class="p">,</span>
<span class="linenos">344</span>    <span class="p">},</span>
<span class="linenos">345</span>    <span class="p">{</span>
<span class="linenos">346</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">347</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Of course! One particularly astonishing animal fact concerns the octopus: these remarkable creatures possess not one, but three hearts. Two of the hearts are responsible for pumping blood through the gills, where it picks up oxygen, while the third pumps oxygenated blood throughout the rest of the body. Octopuses also have blue blood, a consequence of their use of a copper-rich protein called hemocyanin instead of hemoglobin, which is based on iron and gives human blood its red color. The blue blood is more efficient at transporting oxygen in the cold, low-oxygen conditions of the ocean, making it especially advantageous for the octopus’s varied habitats. In addition to their unique circulatory system, octopuses are also known for their high intelligence, problem-solving abilities, and incredible camouflage skills.&quot;</span><span class="p">,</span>
<span class="linenos">348</span>    <span class="p">},</span>
<span class="linenos">349</span>    <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;That’s wild. Why do they have blue blood?&quot;</span><span class="p">},</span>
<span class="linenos">350</span>    <span class="p">{</span>
<span class="linenos">351</span>        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span>
<span class="linenos">352</span>        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;The blue color of octopus blood is due to the presence of hemocyanin, a copper-based molecule that binds with oxygen for transport throughout the body. This adaptation is particularly effective in the cold, low-oxygen environments found in many parts of the oceans where octopuses live. Hemocyanin is more efficient than hemoglobin (the iron-based molecule in red blood) under these conditions, which helps octopuses thrive in diverse and sometimes extreme marine settings. The evolution of blue blood is an example of the many unique physiological characteristics that have enabled cephalopods to become such successful marine invertebrates. It’s remarkable how life develops specialized solutions to meet the challenges of different environments.&quot;</span><span class="p">,</span>
<span class="linenos">353</span>    <span class="p">},</span>
<span class="linenos">354</span><span class="p">]</span>
<span class="linenos">355</span>
<span class="linenos">356</span><span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">LONG_CONVERSATION</span><span class="p">:</span>
<span class="linenos">357</span>    <span class="n">conversation</span><span class="o">.</span><span class="n">append_message</span><span class="p">(</span>
<span class="linenos">358</span>        <span class="n">Message</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">msg</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">],</span> <span class="n">role</span><span class="o">=</span><span class="n">msg</span><span class="p">[</span><span class="s2">&quot;role&quot;</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
<span class="linenos">359</span>    <span class="p">)</span>
<span class="linenos">360</span>
<span class="linenos">361</span><span class="n">conversation</span><span class="o">.</span><span class="n">append_user_message</span><span class="p">(</span><span class="s2">&quot;What tool do dolphins sometimes use when foraging on the seafloor, and why?&quot;</span><span class="p">)</span>
<span class="linenos">362</span><span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#message-transforms">Message Transforms</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#llm-setup">LLM Setup</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summarizing-long-messages">Summarizing Long Messages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summarizing-long-conversations">Summarizing Long Conversations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-both-transforms-together">Using Both Transforms Together</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#full-code">Full Code</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Oracle and/or its affiliates..
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>