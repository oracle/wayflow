


<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Security Considerations &#8212; wayflowcore 26.1.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css-style.css" />
    <link rel="stylesheet" type="text/css" href="../_static/core.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'core/security';</script>
  <script src="../_static/announcement.js"></script>

    <link rel="icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="For Contributors" href="contributing.html" />
    <link rel="prev" title="WayFlow Glossary" href="misc/glossary.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="26.1" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo-light.svg" class="logo__image only-light" alt="wayflowcore 26.1.0 documentation - Home"/>
    <img src="../_static/logo-dark.svg" class="logo__image only-dark pst-js-only" alt="wayflowcore 26.1.0 documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/oracle/wayflow" title="WayFlow GitHub repository" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../_static/icons/github-icon.svg" class="icon-link-image" alt="WayFlow GitHub repository"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/oracle/wayflow" title="WayFlow GitHub repository" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../_static/icons/github-icon.svg" class="icon-link-image" alt="WayFlow GitHub repository"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Essentials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="tutorials/index.html">Tutorials &amp; Use Cases</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorials/basic_agent.html">Build a Simple Conversational Assistant with Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials/basic_flow.html">Build a Simple Fixed-flow Assistant with Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials/usecase_prbot.html">Build a Simple Code Review Assistant</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="howtoguides/index.html">How-to Guides</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/io_descriptors.html">Change Input and Output Descriptors of Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_async.html">Use Asynchronous APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/installing_ollama.html">Install and Use Ollama</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/generation_config.html">Specify the Generation Configuration when Using LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/llm_from_different_providers.html">Use LLM from Different LLM Sources and Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_long_context.html">Handle long context with agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/agents.html">Create a ReAct Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_imagecontent.html">How to Send Images to LLMs and Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_ociagent.html">Use OCI Generative AI Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_a2aagent.html">How to Connect to A2A Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_prompttemplate.html">Use Templates for Advanced Prompting Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_userinputinflows.html">Ask for User Input in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/conditional_flows.html">Create Conditional Transitions in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_promptexecutionstep.html">Do Structured LLM Generation in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_userconfirmation.html">Add User Confirmation to a Tool Call Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/catching_exceptions.html">Catch Exceptions in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_mapstep.html">Do Map and Reduce Operations in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_parallelflowexecution.html">Run Multiple Flows in Parallel</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_flowbuilder.html">Build Flows with the Flow Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_agents_in_flows.html">Use Agents in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_multiagent.html">Build a Hierarchical Multi-Agent System</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_swarm.html">Build a Swarm of Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_managerworkers.html">Build a ManagerWorkers of Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_serve_agents.html">Serve Agents with WayFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_a2a_serving.html">Serve Assistants with A2A protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_build_assistants_with_tools.html">Build Assistants with Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_multiple_output_tool.html">Create Tools with Multiple Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/create_a_tool_from_a_flow.html">Convert Flows to Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_mcp.html">Connect MCP tools to Assistants</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_remote_tool_expired_token.html">Do Remote API Calls with Tokens</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_execute_agentspec_with_wayflowcore.html">Load and Execute an Agent Spec Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_serdeser.html">Serialize and Deserialize Flows and Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_serialize_conversations.html">Serialize and Deserialize Conversations</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_plugins.html">Build a New WayFlow Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_tracing.html">Enable Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_event_system.html">Use the Event System</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_datastores.html">Connect Assistants to Your Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/embeddingmodels_from_different_providers.html">Use Embedding Models from Different Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_variable.html">Use Variables for Shared State in Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_data_synthesis.html">Synthesize Data in WayFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_evaluation.html">Evaluate Assistants</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtoguides/howto_conversation_evaluation.html">Evaluate Conversations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api/index.html">API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="api/agentspec.html">Agent Spec Adapters</a></li>


<li class="toctree-l2"><a class="reference internal" href="api/conversation.html">Conversations</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/llmmodels.html">LLMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/flows.html">Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/agent.html">Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/agentserver.html">Agent Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/embeddingmodels.html">Embedding Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/contextproviders.html">Context Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/interrupts.html">Execution Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/prompttemplate.html">PromptTemplates</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/serialization.html">Serialization/Deserialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/tools.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/tracing.html">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/variables.html">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/datastores.html">Datastores</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/warnings.html">Warnings</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/evaluation.html">Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/component.html">Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/a2a.html">A2A</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="misc/reference_sheet.html">Reference Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc/glossary.html">Glossary</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">For Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="faqs.html">Frequently Asked Questions</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">WayFlow</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Security Considerations</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="security-considerations">
<h1>Security Considerations<a class="headerlink" href="#security-considerations" title="Permalink to this heading">#</a></h1>
<p>Scope: WayFlow Agents, Flows, Steps, or Tools in any environment (development, staging, production).</p>
<p>Why it matters: WayFlow integrates LLMs, Python, tools, and APIs. Its attack surface spans all Steps, Agents, Flows, Tools, and Context Providers. A single untrusted component (e.g., an unsafe tool or poorly-scoped <code class="docutils literal notranslate"><span class="pre">ContextProvider</span></code>) can compromise the entire runtime.</p>
<section id="considerations-regarding-tools">
<h2>Considerations regarding tools<a class="headerlink" href="#considerations-regarding-tools" title="Permalink to this heading">#</a></h2>
<p>WayFlow allows LLMs to interact with applications via <strong>Tools</strong> (<a class="reference internal" href="api/tools.html#clienttool"><span class="std std-ref">ClientTool</span></a>, <a class="reference internal" href="api/tools.html#servertool"><span class="std std-ref">ServerTool</span></a>, or <a class="reference internal" href="api/tools.html#remotetool"><span class="std std-ref">RemoteTool</span></a>), granting access to state or operations. Since tool inputs often come from LLMs or users, rigorous input sanitization and validation are crucial.</p>
<p><strong>Key Principles for Tool Security:</strong></p>
<ul class="simple">
<li><p><strong>Mandatory Input Validation</strong>: Always validate tool inputs.</p>
<ul>
<li><p>For <a class="reference internal" href="api/tools.html#clienttool"><span class="std std-ref">ClientTool</span></a> and <a class="reference internal" href="api/tools.html#servertool"><span class="std std-ref">ServerTool</span></a>, use <code class="docutils literal notranslate"><span class="pre">input_descriptors</span></code> to define/enforce schemas (types and descriptions) as a primary defense. Note that <code class="docutils literal notranslate"><span class="pre">input_descriptors</span></code> do not support constraints like ranges or max lengths, so you must implement additional validation in your tool’s code.</p></li>
<li><p>For <a class="reference internal" href="api/tools.html#remotetool"><span class="std std-ref">RemoteTool</span></a>, which constructs HTTP requests, validation is critical for all parameters that can be templated (e.g., <code class="docutils literal notranslate"><span class="pre">url</span></code>, <code class="docutils literal notranslate"><span class="pre">method</span></code>, <code class="docutils literal notranslate"><span class="pre">json_body</span></code>, <code class="docutils literal notranslate"><span class="pre">data</span></code>, <code class="docutils literal notranslate"><span class="pre">params</span></code>, <code class="docutils literal notranslate"><span class="pre">headers</span></code>, <code class="docutils literal notranslate"><span class="pre">cookies</span></code>). While <code class="docutils literal notranslate"><span class="pre">input_descriptors</span></code> can define the schema for arguments <em>passed to</em> the <a class="reference internal" href="api/tools.html#remotetool"><span class="std std-ref">RemoteTool</span></a>, the core security lies in controlling how these arguments are used to form the request and in features like <code class="docutils literal notranslate"><span class="pre">url_allow_list</span></code>.</p></li>
</ul>
</li>
<li><p><strong>Output Scrutiny</strong>: Define expected outputs with <code class="docutils literal notranslate"><span class="pre">output_descriptors</span></code>. For <a class="reference internal" href="api/tools.html#clienttool"><span class="std std-ref">ClientTool</span></a>, clients post results; for <a class="reference internal" href="api/tools.html#servertool"><span class="std std-ref">ServerTool</span></a>, the server <code class="docutils literal notranslate"><span class="pre">func</span></code> generates them. Calling Flows/Agents must treat incoming <a class="reference internal" href="api/tools.html#toolresult"><span class="std std-ref">ToolResult</span></a> content as untrusted until validated/sanitized.</p></li>
<li><p><strong>Least Privilege</strong>: Grant tools only permissions essential for their function.</p></li>
</ul>
<section id="tool-security-specifics">
<h3>Tool Security Specifics<a class="headerlink" href="#tool-security-specifics" title="Permalink to this heading">#</a></h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Rigorously sanitize all tool inputs. Tools, bridging LLM understanding with system operations, are prime targets. Validate types, lengths, and semantic correctness before core logic execution.</p>
</div>
<p><strong>`ServerTool` Considerations:</strong></p>
<ul class="simple">
<li><p><strong>Callable Security (`func`)</strong>: The <code class="docutils literal notranslate"><span class="pre">func</span></code> callable in <a class="reference internal" href="api/tools.html#servertool"><span class="std std-ref">ServerTool</span></a> is the primary security concern. Harden this server-executed code against vulnerabilities.</p></li>
<li><p><strong>Isolation for High-Risk Tools</strong>: Run high-risk <a class="reference internal" href="api/tools.html#servertool"><span class="std std-ref">ServerTool</span></a> instances (e.g., with elevated permissions, network/filesystem access) in sandboxed environments (containers/pods) with minimal IAM roles. Deny network/filesystem writes unless essential.</p></li>
<li><p><strong>Tools from `Flows` or `Steps`</strong>:</p>
<ul>
<li><p>When creating a <a class="reference internal" href="api/tools.html#servertool"><span class="std std-ref">ServerTool</span></a> via <a class="reference internal" href="api/tools.html#wayflowcore.tools.servertools.ServerTool.from_flow" title="wayflowcore.tools.servertools.ServerTool.from_flow"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_flow()</span></code></a>, or <a class="reference internal" href="api/tools.html#wayflowcore.tools.servertools.ServerTool.from_step" title="wayflowcore.tools.servertools.ServerTool.from_step"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_step()</span></code></a>, its security is inherited. Ensure source <code class="docutils literal notranslate"><span class="pre">Flow</span></code> or <code class="docutils literal notranslate"><span class="pre">Step</span></code> tools are secure.</p></li>
</ul>
</li>
</ul>
<p><strong>`ClientTool` Considerations:</strong></p>
<ul class="simple">
<li><p><strong>Client-Side Execution</strong>: <a class="reference internal" href="api/tools.html#clienttool"><span class="std std-ref">ClientTool</span></a> execution occurs on the client. Client environment security, though outside WayFlow’s control, impacts overall application security.</p></li>
<li><p><strong>Untrusted `ToolRequest`</strong>: Clients receive a <a class="reference internal" href="api/tools.html#toolrequest"><span class="std std-ref">ToolRequest</span></a>. Though WayFlow generates <code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">tool_request_id</span></code>, client code must parse <code class="docutils literal notranslate"><span class="pre">args</span></code> with a strict schema, avoiding direct use in shell commands or sensitive OS functions.</p></li>
<li><p><strong>Untrusted Client `ToolResult`</strong>: Server-side WayFlow components must treat <a class="reference internal" href="api/tools.html#toolresult"><span class="std std-ref">ToolResult</span></a> from clients as untrusted. Validate its <code class="docutils literal notranslate"><span class="pre">content</span></code> before processing.</p></li>
</ul>
<p><strong>`RemoteTool` Considerations:</strong></p>
<ul class="simple">
<li><p><strong>Templated Request Arguments</strong>: <a class="reference internal" href="api/tools.html#remotetool"><span class="std std-ref">RemoteTool</span></a> allows various parts of the HTTP request (URL, method, body, headers, etc.) to be templated using Jinja. This is powerful but introduces risks if the inputs to these templates are not strictly controlled. Maliciously crafted inputs could lead to information leakage (e.g., exposing sensitive data in URLs or headers) or enable attacks like SSRF (Server-Side Request Forgery) or automated DDoS.</p></li>
<li><p><strong>URL Allow List (`url_allow_list`)</strong>: This is a critical security feature. Always define a <code class="docutils literal notranslate"><span class="pre">url_allow_list</span></code> to restrict the tool to a predefined set of allowed URLs or URL patterns. This significantly mitigates the risk of the tool being used to make requests to unintended or malicious endpoints. Refer to the API documentation for detailed matching rules.</p></li>
<li><p><strong>Secure Connections (`allow_insecure_http`)</strong>: By default, <a class="reference internal" href="api/tools.html#remotetool"><span class="std std-ref">RemoteTool</span></a> disallows non-HTTPS URLs (<code class="docutils literal notranslate"><span class="pre">allow_insecure_http=False</span></code>). Maintain this default unless there’s an explicit, well-justified reason to allow insecure HTTP, and ensure the risks are understood.</p></li>
<li><p><strong>Credential Handling (`allow_credentials`)</strong>: By default (<code class="docutils literal notranslate"><span class="pre">allow_credentials=True</span></code>), URLs can contain credentials (e.g., <code class="docutils literal notranslate"><span class="pre">https://user:pass&#64;example.com</span></code>). If your use case does not require this, set <code class="docutils literal notranslate"><span class="pre">allow_credentials=False</span></code> to prevent accidental leakage or misuse of credentials in URLs.</p></li>
<li><p><strong>URL Fragments (`allow_fragments`)</strong>: Control whether URL fragments (e.g., <code class="docutils literal notranslate"><span class="pre">#section</span></code>) are permitted in requested URLs and allow list entries. Default is <code class="docutils literal notranslate"><span class="pre">True</span></code>. Set to <code class="docutils literal notranslate"><span class="pre">False</span></code> if fragments are not needed and could introduce ambiguity or bypass attempts.</p></li>
<li><p><strong>Output Parsing (`output_jq_query`)</strong>: If using <code class="docutils literal notranslate"><span class="pre">output_jq_query</span></code> to parse JSON responses, be aware that complex queries on very large or maliciously structured JSON could consume significant resources. While primarily a performance concern, extreme cases might have denial-of-service implications.</p></li>
</ul>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>As highlighted in the <a class="reference internal" href="api/tools.html#remotetool"><span class="std std-ref">RemoteTool</span></a> API, since the Agent can generate arguments
(url, method, json_body, data, params, headers, cookies) or parts of these arguments in the respective
Jinja templates, this can impose a security risk of information leakage and enable specific attack
vectors like automated DDOS attacks. Please use <a class="reference internal" href="api/tools.html#remotetool"><span class="std std-ref">RemoteTool</span></a> responsibly and ensure
that only valid URLs can be given as arguments or that no sensitive information is used for any of these
arguments by the agent. Utilize <code class="docutils literal notranslate"><span class="pre">url_allow_list</span></code>, <code class="docutils literal notranslate"><span class="pre">allow_credentials</span></code>, and <code class="docutils literal notranslate"><span class="pre">allow_fragments</span></code>
to control URL validity.</p>
</div>
</section>
<section id="harden-all-tools-servertool-clienttool-and-remotetool">
<h3>Harden All Tools (ServerTool, ClientTool and RemoteTool)<a class="headerlink" href="#harden-all-tools-servertool-clienttool-and-remotetool" title="Permalink to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table" id="id1">
<caption><span class="caption-text">Tool Hardening Guidelines</span><a class="headerlink" href="#id1" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Risk</p></th>
<th class="head"><p>Guidance</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Unvalidated arguments (leading to injection, DoS, etc.)</p></td>
<td><p><strong>Primary Defense</strong>:</p>
<ul class="simple">
<li><p>For <a class="reference internal" href="api/tools.html#clienttool"><span class="std std-ref">ClientTool</span></a> &amp; <a class="reference internal" href="api/tools.html#servertool"><span class="std std-ref">ServerTool</span></a>: Use <code class="docutils literal notranslate"><span class="pre">input_descriptors</span></code> for basic type checking. In <a class="reference internal" href="api/tools.html#servertool"><span class="std std-ref">ServerTool</span></a>’s <code class="docutils literal notranslate"><span class="pre">func</span></code>, add comprehensive validation (string length limits, numeric ranges, format constraints). Cap string lengths and numeric ranges in tool implementation code.</p></li>
<li><p>For <a class="reference internal" href="api/tools.html#remotetool"><span class="std std-ref">RemoteTool</span></a>:</p>
<ul>
<li><p>Rigorously validate and sanitize any inputs used in templated arguments (<code class="docutils literal notranslate"><span class="pre">url</span></code>, <code class="docutils literal notranslate"><span class="pre">method</span></code>, <code class="docutils literal notranslate"><span class="pre">json_body</span></code>, <code class="docutils literal notranslate"><span class="pre">data</span></code>, <code class="docutils literal notranslate"><span class="pre">params</span></code>, <code class="docutils literal notranslate"><span class="pre">headers</span></code>, <code class="docutils literal notranslate"><span class="pre">cookies</span></code>).</p></li>
<li><p><strong>Crucially, always configure `url_allow_list`</strong> to restrict outbound requests to known, trusted endpoints.</p></li>
<li><p>Leverage <code class="docutils literal notranslate"><span class="pre">allow_insecure_http=False</span></code> (default), and consider setting <code class="docutils literal notranslate"><span class="pre">allow_credentials=False</span></code> if not needed.</p></li>
</ul>
</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Excessive privileges (for <a class="reference internal" href="api/tools.html#servertool"><span class="std std-ref">ServerTool</span></a>)</p></td>
<td><p>Run in least-privilege containers/pods.</p>
<p>Separate network namespaces for sensitive data/external system access.</p>
<p>Explicitly deny unnecessary filesystem/network access.</p>
</td>
</tr>
<tr class="row-even"><td><p>Stateful tools</p></td>
<td><p>Prefer stateless tools. If stateful, use hardened datastores (e.g., Oracle Database) over in-memory objects where feasible.</p>
<p>Implement optimistic locking and rigorous input sanitization for state-modifying operations.</p>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="api/tools.html#clienttool"><span class="std std-ref">ClientTool</span></a> misuse (client-side vulnerabilities)</p></td>
<td><p>Client apps handling <a class="reference internal" href="api/tools.html#toolrequest"><span class="std std-ref">ToolRequest</span></a> must treat <code class="docutils literal notranslate"><span class="pre">args</span></code> as untrusted.</p>
<p>Validate/sanitize client-side <cite>args</cite> before local execution (esp. OS commands, sensitive API calls).</p>
</td>
</tr>
<tr class="row-even"><td><p>Insecure underlying components (for tools from Flows, Steps)</p></td>
<td><p>Ensure source Flows or Steps tools for WayFlow <a class="reference internal" href="api/tools.html#servertool"><span class="std std-ref">ServerTool</span></a> are vetted; the tool inherits their security.</p></td>
</tr>
<tr class="row-odd"><td><p>Data leakage via <a class="reference internal" href="api/tools.html#toolresult"><span class="std std-ref">ToolResult</span></a></p></td>
<td><p>Define <code class="docutils literal notranslate"><span class="pre">output_descriptors</span></code> clearly.</p>
<p>Ensure <a class="reference internal" href="api/tools.html#servertool"><span class="std std-ref">ServerTool</span></a> <code class="docutils literal notranslate"><span class="pre">func</span></code> and <a class="reference internal" href="api/tools.html#clienttool"><span class="std std-ref">ClientTool</span></a> client code return only necessary data.</p>
<p>Consuming Agent/Flow must validate/sanitize <a class="reference internal" href="api/tools.html#toolresult"><span class="std std-ref">ToolResult</span></a> <cite>content</cite>.</p>
</td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="considerations-regarding-network-communication">
<h2>Considerations regarding network communication<a class="headerlink" href="#considerations-regarding-network-communication" title="Permalink to this heading">#</a></h2>
<p>WayFlow components use the network for LLM communications, <a class="reference internal" href="api/flows.html#apicallstep"><span class="std std-ref">ApiCallStep</span></a> tool operations, and third-party integrations. Implement robust network security.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Adopt a defense-in-depth network security strategy for WayFlow, including supply-chain security for models/containers, network segmentation, encrypted communications, and strict egress controls.</p>
</div>
<section id="supply-chain-security-for-wayflow-assets">
<h3>Supply-Chain Security for WayFlow Assets<a class="headerlink" href="#supply-chain-security-for-wayflow-assets" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt><strong>Model Integrity</strong>: For third-party models used by WayFlow (fine-tuned, embeddings):</dt><dd><ul>
<li><p>Download via HTTPS, pin SHA-256 digests and verify integrity before loading into WayFlow.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Container Security</strong>: For containerized WayFlow:</dt><dd><ul>
<li><p>Use minimal, regularly updated base images. Scan images (e.g., Trivy, Grype) for CVE. Sign (e.g., before pushing to a package index) and verify (e.g., when downloading) images.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="network-segmentation-for-wayflow">
<h3>Network Segmentation for WayFlow<a class="headerlink" href="#network-segmentation-for-wayflow" title="Permalink to this heading">#</a></h3>
<p>Isolate WayFlow components to limit blast radius:</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>Subnet Isolation</strong>:</dt><dd><ul>
<li><p>LLM hosts (OCI Gen AI, vLLM) in dedicated subnets.</p></li>
<li><p>Tool backends and <a class="reference internal" href="api/flows.html#apicallstep"><span class="std std-ref">ApiCallStep</span></a> targets in isolated subnets.</p></li>
<li><p>Keep the WayFlow <em>control-flow</em> logic (e.g., Agents, Flows, BranchingSteps) separate from data processing (e.g., database mutations, data analytics)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>TLS</strong>:</dt><dd><ul>
<li><p>Use mTLS for WayFlow service-to-service communications such as connecting to MCP servers, Monitoring/Telemetry services, File Storage Services, Databases, and so on.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="egress-controls-for-wayflow-components">
<h3>Egress Controls for WayFlow Components<a class="headerlink" href="#egress-controls-for-wayflow-components" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt><strong>Strict Egress Rules</strong>: Default-deny outbound traffic:</dt><dd><ul>
<li><p>Allow only Allow-Listed domains/IPs for WayFlow components (such as when using Tools like <a class="reference internal" href="api/tools.html#remotetool"><span class="std std-ref">RemoteTool</span></a> with its <code class="docutils literal notranslate"><span class="pre">url_allow_list</span></code> parameter, <a class="reference internal" href="api/flows.html#apicallstep"><span class="std std-ref">ApiCallStep</span></a>, or <a class="reference internal" href="api/flows.html#promptexecutionstep"><span class="std std-ref">PromptExecutionStep</span></a>)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Centralized Allow-Lists for WayFlow</strong>:</dt><dd><ul>
<li><p>LLM provider endpoints and Telemetry/logging destinations.</p></li>
<li><p>Approved Tool API endpoints for tools making external calls, such as <a class="reference internal" href="api/flows.html#apicallstep"><span class="std std-ref">ApiCallStep</span></a> and <a class="reference internal" href="api/tools.html#remotetool"><span class="std std-ref">RemoteTool</span></a> (enforced via its <code class="docutils literal notranslate"><span class="pre">url_allow_list</span></code> parameter).</p></li>
<li><p>Make sure to set up alert on policy violations.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="network-connection-requirements">
<h3>Network Connection Requirements<a class="headerlink" href="#network-connection-requirements" title="Permalink to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table" id="id2">
<caption><span class="caption-text">WayFlow Network Security: Key Implementations</span><a class="headerlink" href="#id2" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 40.0%" />
<col style="width: 60.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Area</p></th>
<th class="head"><p>WayFlow-Specific Implementation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>External LLM Traffic Encryption</p></td>
<td><ul class="simple">
<li><p>OCI Gen AI: HTTPS by default.</p></li>
<li><p>vLLM: Front with TLS terminator (Nginx/Caddy) or use mTLS ingress.</p></li>
<li><p>Verify TLS certs; pin where feasible.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>WayFlow Component Egress Rules</p></td>
<td><ul class="simple">
<li><p>Container network policies (iptables, Calico, Cilium) allowing only approved LLM endpoints, Tool API destinations, telemetry sinks, and DNS.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>External API Call Security (e.g., <a class="reference internal" href="api/flows.html#apicallstep"><span class="std std-ref">ApiCallStep</span></a>, <a class="reference internal" href="api/tools.html#remotetool"><span class="std std-ref">RemoteTool</span></a>)</p></td>
<td><ul class="simple">
<li><p>Enforce HTTPS: Use <code class="docutils literal notranslate"><span class="pre">allow_insecure_http=False</span></code> (default for both).</p></li>
<li><p><strong>URL Allow Lists</strong>: For <a class="reference internal" href="api/tools.html#remotetool"><span class="std std-ref">RemoteTool</span></a>, always configure its <code class="docutils literal notranslate"><span class="pre">url_allow_list</span></code> parameter. For <a class="reference internal" href="api/flows.html#apicallstep"><span class="std std-ref">ApiCallStep</span></a>, ensure broader network-level allow-lists are in place.</p></li>
<li><p>Validate/sanitize templated URLs and other request parameters (headers, body) derived from potentially untrusted inputs.</p></li>
<li><p>Consider <code class="docutils literal notranslate"><span class="pre">allow_credentials=False</span></code> and <code class="docutils literal notranslate"><span class="pre">allow_fragments=False</span></code> for <a class="reference internal" href="api/tools.html#remotetool"><span class="std std-ref">RemoteTool</span></a> if those features are not strictly necessary.</p></li>
<li><p>Use connection timeouts/rate limiting (tool-specific or via infrastructure).</p></li>
<li><p>Log outbound requests (destination URLs, sanitized headers/bodies) for audit.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Data Residency</p></td>
<td><ul class="simple">
<li><p>Ensure LLM providers meet data residency needs.</p></li>
<li><p>Use regional LLM endpoints for data locality with WayFlow.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>Network Monitoring &amp; Alerting</p></td>
<td><ul class="simple">
<li><p>Maintain allow-list of approved hostnames and IPs for WayFlow traffic.</p></li>
<li><p>Alert on policy violations/unauthorized connection attempts from WayFlow components.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="considerations-regarding-api-keys-and-secrets-management">
<h2>Considerations regarding API keys and secrets management<a class="headerlink" href="#considerations-regarding-api-keys-and-secrets-management" title="Permalink to this heading">#</a></h2>
<p>Secure API key/secret management is critical for WayFlow deployments (LLM providers, external services, internal auth) to prevent unauthorized access and data breaches.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Never embed API keys, passwords, or other secrets directly in code, configuration files, or serialized JSON/YAML. Always use secure injection mechanisms and follow the principle of least privilege for credential access.</p>
</div>
<section id="control-secret-sprawl">
<h3>Control Secret Sprawl<a class="headerlink" href="#control-secret-sprawl" title="Permalink to this heading">#</a></h3>
<p>Prevent hardcoded secrets in WayFlow:</p>
<ul class="simple">
<li><p><strong>Runtime injection for WayFlow required secrets (e.g., LLM API key or database credentials)</strong>:</p>
<ul>
<li><p>Avoid using Kubernetes/Docker secrets to deploy environment variables.</p></li>
<li><p>Use secrets managers (e.g., OCI Vault).</p></li>
</ul>
</li>
<li><p><strong>Avoid Baked Secrets in WayFlow</strong>:</p>
<ul>
<li><p>Never put API keys in WayFlow’s serialized JSON/YAML.</p></li>
<li><p>Exclude secrets from Python source shown to LLMs during WayFlow development.</p></li>
<li><p>Use placeholders in version-controlled WayFlow configs.</p></li>
<li><p>Use pre-commit hooks to prevent committing secrets to source control.</p></li>
</ul>
</li>
<li><p><strong>Per-Flow Service Accounts &amp; Rotation</strong>:</p>
<ul>
<li><p>Use dedicated service accounts per WayFlow Flow.</p></li>
<li><p>Rotate API keys regularly.</p></li>
<li><p>Automate key rotation if possible.</p></li>
<li><p>Monitor/audit credential use.</p></li>
</ul>
</li>
</ul>
</section>
<section id="llm-provider-authentication-security">
<h3>LLM Provider Authentication Security<a class="headerlink" href="#llm-provider-authentication-security" title="Permalink to this heading">#</a></h3>
<p><strong>OpenAI Models (`OpenAIModel`):</strong></p>
<ul class="simple">
<li><p>Injecting a Secret as an environment variable makes the value available to everything inside the Pod.</p></li>
<li><p>We recommend exploring alternatives to sourcing the <code class="docutils literal notranslate"><span class="pre">OPENAI_API_KEY</span></code> env variable at runtime.</p></li>
<li><p>Use organization-specific API keys with usage limits.</p></li>
<li><p>Monitor <a class="reference internal" href="api/llmmodels.html#tokenusage"><span class="std std-ref">TokenUsage</span></a> for anomaly detection.</p></li>
<li><p>Secure proxy credentials separately for VPN proxies.</p></li>
</ul>
<p><strong>OCI GenAI Models (`OCIGenAIModel`):</strong></p>
<ul class="simple">
<li><p><strong>Instance Principal</strong> (<a class="reference internal" href="api/llmmodels.html#ociclientconfigwithinstanceprincipal"><span class="std std-ref">OCIClientConfigWithInstancePrincipal</span></a>): Preferred for OCI Compute (no stored credentials).</p></li>
<li><p><strong>API Key</strong> (<a class="reference internal" href="api/llmmodels.html#ociclientconfigwithapikey"><span class="std std-ref">OCIClientConfigWithApiKey</span></a>): Store private keys in key management; protect <code class="docutils literal notranslate"><span class="pre">~/.oci/config</span></code> (permissions 600).</p></li>
<li><p><strong>User Authentication</strong> (<a class="reference internal" href="api/llmmodels.html#ociclientconfigwithuserauthentication"><span class="std std-ref">OCIClientConfigWithUserAuthentication</span></a>): Never log <code class="docutils literal notranslate"><span class="pre">key_content</span></code>.</p></li>
</ul>
<p><strong>vLLM Models (`VllmModel`):</strong></p>
<ul class="simple">
<li><p>Use internal DNS names and private networking</p></li>
<li><p>Implement authentication at reverse proxy level</p></li>
</ul>
</section>
<section id="credential-rotation-and-monitoring">
<h3>Credential Rotation and Monitoring<a class="headerlink" href="#credential-rotation-and-monitoring" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Rotation</strong>: Rotate WayFlow credentials regularly.</p></li>
<li><p><strong>Monitoring</strong>: Track WayFlow’s <a class="reference internal" href="api/llmmodels.html#tokenusage"><span class="std std-ref">TokenUsage</span></a> for anomalies.</p></li>
<li><p><strong>Incident Response</strong>: Have procedures to revoke compromised WayFlow credentials.</p></li>
</ul>
</section>
</section>
<section id="considerations-regarding-resource-exhaustion-vectors">
<h2>Considerations regarding Resource-exhaustion vectors<a class="headerlink" href="#considerations-regarding-resource-exhaustion-vectors" title="Permalink to this heading">#</a></h2>
<p>Resource-exhaustion events may stem from hostile over-use or from innocent implementation mistakes (e.g., unbounded loops, forgotten awaits), so interrupts should be viewed as guardrails against both abuse and developer error.
WayFlow provides two <strong>soft execution-interrupts</strong>, but they don’t cover all vectors. This section details their use, limitations, and additional production hardening techniques.</p>
<section id="built-in-execution-interrupts">
<h3>Built-in execution interrupts<a class="headerlink" href="#built-in-execution-interrupts" title="Permalink to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 80.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Class</p></th>
<th class="head"><p>Purpose / behaviour</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="api/interrupts.html#softtimeoutexecutioninterrupt"><span class="std std-ref">SoftTimeoutExecutionInterrupt</span></a></p></td>
<td><p>Stops the assistant <strong>after</strong> a configurable wall-clock duration (default 10 min).</p>
<ul class="simple">
<li><p><em>Soft</em> → it <em>waits</em> until the current Step or FlowExecutionStep returns; it <strong>cannot</strong> pre-empt a long-running Tool call or LLM generation.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="api/interrupts.html#softtokenlimitexecutioninterrupt"><span class="std std-ref">SoftTokenLimitExecutionInterrupt</span></a></p></td>
<td><p>Aborts execution once an LLM (or group of LLMs) has emitted a specified number of tokens.</p>
<ul class="simple">
<li><p><em>Soft</em> → the check happens between steps; generation already in flight finishes first.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="usage-example">
<h3>Usage example<a class="headerlink" href="#usage-example" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.executors.interrupts.timeoutexecutioninterrupt</span><span class="w"> </span><span class="kn">import</span> <span class="n">SoftTimeoutExecutionInterrupt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.executors.interrupts.tokenlimitexecutioninterrupt</span><span class="w"> </span><span class="kn">import</span> <span class="n">SoftTokenLimitExecutionInterrupt</span>

<span class="n">timeout_int</span>   <span class="o">=</span> <span class="n">SoftTimeoutExecutionInterrupt</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>          <span class="c1"># 30 s max</span>
<span class="n">token_int</span>     <span class="o">=</span> <span class="n">SoftTokenLimitExecutionInterrupt</span><span class="p">(</span><span class="n">total_tokens</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span> <span class="c1"># 500 tokens</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">conversation</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">execution_interrupts</span><span class="o">=</span><span class="p">[</span><span class="n">timeout_int</span><span class="p">,</span> <span class="n">token_int</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="gaps-in-coverage-what-is-not-provided">
<h3>Gaps in coverage (what is <strong>not</strong> provided)<a class="headerlink" href="#gaps-in-coverage-what-is-not-provided" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Memory limits</strong> – no built-in interrupt for resident-set or GPU VRAM.</p></li>
<li><p><strong>CPU / thread quotas</strong> – Python loops can still hog a core until the Step returns.</p></li>
<li><p><strong>Hard timeouts</strong> inside a Tool – a Tool that calls a REST API may block indefinitely.</p></li>
<li><p><strong>Concurrent-request ceilings</strong> – <code class="docutils literal notranslate"><span class="pre">MapStep(parallel_execution=True)</span></code> fans-out one sub-flow (or Tool call) per element in the input list. Because there is no internal throttle, nothing stops 1000 parallel MapStep forks (possibly leading to CPU thrashing or OOM-kill) without your own semaphore.</p></li>
<li><p><strong>LLM generation cancellation</strong> – once a prompt is sent, the soft timeout waits for the model to answer.</p></li>
</ul>
</section>
<section id="recommended-hardening-layers">
<h3>Recommended hardening layers<a class="headerlink" href="#recommended-hardening-layers" title="Permalink to this heading">#</a></h3>
<p class="rubric">OS / Container level</p>
<ul>
<li><p><strong>Resource Limits (cgroups/Kubernetes)</strong> for WayFlow containers:
Set CPU/memory requests and limits to prevent resource starvation by WayFlow processes.
Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resources</span><span class="p">:</span>
  <span class="n">requests</span><span class="p">:</span> <span class="p">{</span> <span class="n">cpu</span><span class="p">:</span> <span class="s2">&quot;500m&quot;</span><span class="p">,</span> <span class="n">memory</span><span class="p">:</span> <span class="s2">&quot;512Mi&quot;</span> <span class="p">}</span>
  <span class="n">limits</span><span class="p">:</span>   <span class="p">{</span> <span class="n">cpu</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>   <span class="n">memory</span><span class="p">:</span> <span class="s2">&quot;1Gi&quot;</span> <span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
<p class="rubric">Application level</p>
<ul>
<li><p><strong>Per-Tool timeouts</strong></p>
<p>For WayFlow Tools involving long-running I/O, wrap calls in <code class="docutils literal notranslate"><span class="pre">concurrent.futures.wait</span></code> or <code class="docutils literal notranslate"><span class="pre">subprocess.run</span></code> with a <code class="docutils literal notranslate"><span class="pre">timeout</span></code>. Raise a retryable error for the Flow.</p>
</li>
<li><p><strong>Concurrency guard</strong></p>
<p>For WayFlow’s <a class="reference internal" href="api/flows.html#mapstep"><span class="std std-ref">MapStep</span></a> or similar fan-out patterns:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">Semaphore</span>
<span class="c1"># Limit concurrent operations in a MapStep</span>
<span class="n">guard</span> <span class="o">=</span> <span class="n">Semaphore</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><strong>Input size validation</strong></p>
<p>Limit list lengths, string sizes, and recursion depth for data fed into WayFlow’s <a class="reference internal" href="api/flows.html#mapstep"><span class="std std-ref">MapStep</span></a> or recursive Agents to prevent exponential resource use.</p>
</li>
<li><p><strong>Circuit-breaker patterns</strong></p>
<p>For WayFlow interactions with LLMs or Tools, implement circuit breakers to trip after <em>n</em> failures/SLA breaches, returning a graceful error. Consider following code block for conceptual direction:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pybreaker</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreaker</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span><span class="p">,</span> <span class="n">ToolExecutionStep</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">requests</span><span class="w"> </span><span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">RequestException</span>

<span class="c1"># ❶ create a breaker: 5 failures trip; reset after 60 s</span>
<span class="n">api_breaker</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span><span class="n">fail_max</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">reset_timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">robust_get</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GET url with breaker; raises CircuitBreakerError if OPEN&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">api_breaker</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">resp</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span>
    <span class="k">except</span> <span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># will count as a failure inside the breaker</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;downstream error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

<span class="n">step</span> <span class="o">=</span> <span class="n">ToolExecutionStep</span><span class="p">(</span><span class="n">robust_get</span><span class="p">)</span>          <span class="c1"># use in a Flow</span>
</pre></div>
</div>
</li>
</ul>
<p class="rubric">LLM usage governance</p>
<ul class="simple">
<li><p>Combine WayFlow’s <code class="docutils literal notranslate"><span class="pre">SoftTokenLimitExecutionInterrupt</span></code> with server-side LLM provider usage quotas (e.g., OpenAI hard limits, vLLM rate-limiting).</p></li>
</ul>
</section>
</section>
<section id="considerations-regarding-input-validation-and-sanitation">
<h2>Considerations regarding input validation and sanitation<a class="headerlink" href="#considerations-regarding-input-validation-and-sanitation" title="Permalink to this heading">#</a></h2>
<p>WayFlow has no built-in input validation/sanitation. Developers are responsible for securing user inputs via validation, sanitation, and external guardrails.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>All user-provided inputs—whether from chat interfaces, API payloads, or Tool arguments—should be treated as potentially malicious and require rigorous validation and sanitation before processing.</p>
</div>
<section id="core-input-security-requirements">
<h3>Core Input Security Requirements<a class="headerlink" href="#core-input-security-requirements" title="Permalink to this heading">#</a></h3>
<p><strong>Validation and Bounds Checking:</strong></p>
<ul class="simple">
<li><p>Validate length/structure of all inputs to WayFlow (chat, API, Tool arguments).</p></li>
<li><p>Enforce max length limits on user inputs to WayFlow.</p></li>
<li><p>Validate formats/types before passing to WayFlow components.</p></li>
<li><p>Check inputs are within reasonable bounds for the WayFlow application.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">output_descriptors</span></code> on <a class="reference internal" href="api/flows.html#promptexecutionstep"><span class="std std-ref">PromptExecutionStep</span></a> for JSON schemas to reduce prompt-injection leakage.</p></li>
</ul>
<p><strong>External Guardrails Integration:</strong></p>
<p>WayFlow applications should leverage external security services to provide comprehensive input protection:</p>
<ul class="simple">
<li><p><strong>OCI Gen AI Inference Protection</strong>: Built-in guardrails (toxicity, prompt-injection, jailbreak scanning) per Responsible AI.</p></li>
<li><p><strong>Custom filtering for WayFlow</strong>: Use regex/policy filters with open-source models in WayFlow.</p></li>
<li><p><strong>LLM DevSecOps</strong>: Apply <a class="reference external" href="https://devsecopsguides.com/docs/rules/llm/">LLM DevSecOps guide</a> practices to WayFlow development.</p></li>
</ul>
<p><strong>Architectural Patterns for Input Security:</strong></p>
<ul class="simple">
<li><p><strong>Early filtering</strong>: Insert a <a class="reference internal" href="api/flows.html#branchingstep"><span class="std std-ref">BranchingStep</span></a> at Flow start to route “unsafe” content to a refuse/retry branch.</p></li>
<li><p><strong>Defense in depth</strong>: Layer multiple validation/sanitation for WayFlow inputs.</p></li>
<li><p><strong>Fail-safe defaults</strong>: Reject ambiguous/malformed inputs to WayFlow.</p></li>
</ul>
</section>
</section>
<section id="considerations-regarding-logging">
<h2>Considerations regarding logging<a class="headerlink" href="#considerations-regarding-logging" title="Permalink to this heading">#</a></h2>
<section id="error-handling-exception-hygiene">
<h3>Error handling &amp; exception hygiene<a class="headerlink" href="#error-handling-exception-hygiene" title="Permalink to this heading">#</a></h3>
<p>Robust error handling is key for WayFlow stability and security.</p>
<ul class="simple">
<li><p><strong>Custom WayFlow Steps</strong>: Implement comprehensive error handling. Map exceptions to sanitized messages, avoiding internal detail leakage.</p></li>
<li><p><strong>`CatchExceptionStep`</strong>: Configure to prevent stack trace/sensitive debug info leakage in user errors.</p></li>
<li><p><strong>Private Debug Logging</strong>: Log full exception traces for WayFlow errors privately for debugging, while sanitizing user-facing messages.</p></li>
</ul>
</section>
<section id="audit-observability">
<h3>Audit &amp; observability<a class="headerlink" href="#audit-observability" title="Permalink to this heading">#</a></h3>
<p>Comprehensive auditing/observability is vital for WayFlow.</p>
<ul class="simple">
<li><p><strong>Structured Logs for WayFlow Events</strong>: Log key WayFlow operations at <code class="docutils literal notranslate"><span class="pre">INFO</span></code> level:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">conversation_id</span></code>: Trace interaction lifecycle.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step_name</span></code>: Executed WayFlow Step.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input_hash</span></code>: Hash of Step/Tool input (avoid raw sensitive input).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_hash</span></code>: Hash of Step/Tool output.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tool_name</span></code>: Called Tool.</p></li>
</ul>
</li>
<li><p><strong>Tamper-Evident Log Storage for WayFlow</strong>: Use secure, append-only storage for WayFlow logs.</p></li>
<li><p><strong>PII Scrubbing in WayFlow Logs</strong>: Mask/redact/tokenize PII in WayFlow logs/traces before persistence for privacy compliance (GDPR, right to be forgotten). It may be beneficial to use frameworks for detecting, redacting, masking, and anonymizing sensitive data (PII) such as <a class="reference external" href="https://github.com/microsoft/presidio">Presidio</a></p></li>
</ul>
</section>
</section>
<section id="considerations-regarding-telemetry-observability">
<h2>Considerations regarding Telemetry &amp; observability<a class="headerlink" href="#considerations-regarding-telemetry-observability" title="Permalink to this heading">#</a></h2>
<p>WayFlow can emit rich execution traces—<strong>Spans</strong>—that describe every
tool call, LLM invocation, and Step transition inside an Agent or Flow.
These traces are invaluable for debugging and performance tuning, <strong>but
they may also contain sensitive data</strong>.</p>
<section id="what-s-in-a-span">
<h3>1.  What’s in a Span?<a class="headerlink" href="#what-s-in-a-span" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Flow / Agent configuration snapshot</p></li>
<li><p>Sequence of executed Steps (timestamps, duration)</p></li>
<li><p>Input / output payloads, including user prompts and Tool arguments</p></li>
<li><p>Status transitions and exception details</p></li>
</ul>
</section>
<section id="default-behaviour">
<h3>2.  Default behaviour<a class="headerlink" href="#default-behaviour" title="Permalink to this heading">#</a></h3>
<p>WayFlow sends <strong>no traces by default</strong>.
To enable exporting you must supply a custom
<a class="reference internal" href="api/tracing.html#spanexporter"><span class="std std-ref">SpanExporter</span></a>.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Raw Spans can expose PII, secrets, or proprietary model prompts. PII/secrets must be removed/hashed from logs/metrics.</p>
</div>
</section>
<section id="implementing-a-spanexporter">
<h3>3.  Implementing a SpanExporter<a class="headerlink" href="#implementing-a-spanexporter" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.tracing.spanexporter</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpanExporter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.tracing.span</span><span class="w"> </span><span class="kn">import</span> <span class="n">Span</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span><span class="o">,</span><span class="w"> </span><span class="nn">aiohttp</span>

<span class="k">class</span><span class="w"> </span><span class="nc">AsyncHTTPSExporter</span><span class="p">(</span><span class="n">SpanExporter</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">sanitize</span><span class="p">(</span><span class="n">span</span><span class="p">)</span>           <span class="c1"># e.g., redact secrets here</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;https://trace.local/ingest&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">(</span><span class="n">span</span><span class="p">))</span>   <span class="c1"># non-blocking</span>
</pre></div>
</div>
<p>Key points:</p>
<ul class="simple">
<li><p><strong>Async / non-blocking</strong> - keep the exporter off the critical path.</p></li>
<li><p><strong>Robust error handling</strong> - never raise from <code class="docutils literal notranslate"><span class="pre">export</span></code>; drop or queue on
failure.</p></li>
<li><p><strong>Back-pressure</strong> - apply rate limits or batch Spans to avoid DoS on the
collector.</p></li>
</ul>
</section>
<section id="spanprocessor-guidance">
<h3>4.  SpanProcessor guidance<a class="headerlink" href="#spanprocessor-guidance" title="Permalink to this heading">#</a></h3>
<p>When you add a custom <a class="reference internal" href="api/tracing.html#spanprocessor"><span class="std std-ref">SpanProcessor</span></a>:</p>
<ul class="simple">
<li><p>Apply sampling early to reduce volume.</p></li>
<li><p>Use bounded queues to cap memory.</p></li>
<li><p>Log (INFO) when Spans are dropped due to back-pressure.</p></li>
</ul>
</section>
</section>
<section id="considerations-regarding-ui-rendering">
<h2>Considerations regarding UI rendering<a class="headerlink" href="#considerations-regarding-ui-rendering" title="Permalink to this heading">#</a></h2>
<p>WayFlow uses <strong>Jinja 2</strong> for templates in core components like:</p>
<ul class="simple">
<li><p><a class="reference internal" href="api/flows.html#templaterenderingstep"><span class="std std-ref">TemplateRenderingStep</span></a></p></li>
<li><p><a class="reference internal" href="api/flows.html#outputmessagestep"><span class="std std-ref">OutputMessageStep</span></a></p></li>
<li><p><a class="reference internal" href="api/contextproviders.html#contextprovider"><span class="std std-ref">ContextProvider</span></a>-driven templates interpolating values into messages</p></li>
</ul>
<p>Jinja 2’s automatic HTML-escaping is <strong>disabled by design</strong> in WayFlow to:</p>
<ul class="simple">
<li><p>deliver prompt text to LLMs without foreign escape sequences, and</p></li>
<li><p>prevent mangling of deliberately model-generated HTML tags.</p></li>
</ul>
<p>This preserves model fidelity/latency but removes default XSS/code-injection safeguards.</p>
<p>WayFlow relies on a stricter implementation of the Jinja’s SandboxedEnvironment for security reasons.
Every callable is considered unsafe, and every attribute access is prevented, except for:</p>
<ul class="simple">
<li><p>The attributes <code class="docutils literal notranslate"><span class="pre">index0</span></code>, <code class="docutils literal notranslate"><span class="pre">index</span></code>, <code class="docutils literal notranslate"><span class="pre">first</span></code>, <code class="docutils literal notranslate"><span class="pre">last</span></code>, <code class="docutils literal notranslate"><span class="pre">length</span></code> of the <code class="docutils literal notranslate"><span class="pre">jinja2.runtime.LoopContext</span></code>;</p></li>
<li><p>The entries of a python dictionary (only native type is accepted);</p></li>
<li><p>The items of a python list (only native type is accepted).</p></li>
</ul>
<p>You should never write a template that includes a function call, or access to any internal attribute or element of
an arbitrary variable: that is considered unsafe, and it will raise a <code class="docutils literal notranslate"><span class="pre">SecurityException</span></code>.</p>
<p>Moreover, WayFlow performs additional checks are performed on the inputs provided for rendering.
In particular, only elements and sub-elements that are of basic python types
(<code class="docutils literal notranslate"><span class="pre">str</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, <code class="docutils literal notranslate"><span class="pre">bool</span></code>, <code class="docutils literal notranslate"><span class="pre">list</span></code>, <code class="docutils literal notranslate"><span class="pre">dict</span></code>, <code class="docutils literal notranslate"><span class="pre">tuple</span></code>, <code class="docutils literal notranslate"><span class="pre">set</span></code>, <code class="docutils literal notranslate"><span class="pre">NoneType</span></code>)
are accepted. In any other case, a <code class="docutils literal notranslate"><span class="pre">SecurityException</span></code> is raised.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>Never render the raw output of a WayFlow step directly to a browser.</strong>
Treat every <code class="docutils literal notranslate"><span class="pre">step.&lt;OUTPUT&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">Message.content</span></code> string as <em>untrusted</em>
and sanitise or escape it before display. Failure to do so can lead to
HTML/JS injection (stored XSS) where malicious scripts sent in chat can be
executed by the browser if auto-escaping is off.</p>
</div>
<section id="recommended-mitigations">
<h3>Recommended mitigations<a class="headerlink" href="#recommended-mitigations" title="Permalink to this heading">#</a></h3>
<ol class="arabic">
<li><p><strong>Segregate rendering responsibilities</strong></p>
<ul class="simple">
<li><p>Use WayFlow only for <em>data generation</em>.</p></li>
<li><p>Delegate structured text generation (e.g., HTML, XML, Markdown, SQL) to a
dedicated renderer that offers context-aware auto-escaping.</p></li>
</ul>
</li>
<li><p><strong>Sanitise any LLM or user-supplied markup</strong></p>
<p>For example, to sanitise HTML:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bleach</span>

<span class="n">safe_html</span> <span class="o">=</span> <span class="n">bleach</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span>
    <span class="n">raw_wayflow_output</span><span class="p">,</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;br&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">],</span>   <span class="c1"># whitelisted tags</span>
    <span class="n">attributes</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">strip</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Similar libraries exist for other markup languages.</p>
</li>
<li><p><strong>Adopt strict content policies</strong></p>
<p>Where the rendering context provides it (e.g., web browsers), enforce a
strict Content-Security-Policy to mitigate the risk of unsanitised content
executing. For other contexts (e.g., generating code), ensure the output is
treated as data and never directly executed.</p>
</li>
<li><p><strong>Use an “escape hatch” for deliberate rich content</strong></p>
<p>If you <em>need</em> the LLM to emit rich content (e.g., HTML e-mails, reports),
treat it as a download-only artifact where possible. If it must be
displayed, use a sandboxed environment (like an <code class="docutils literal notranslate"><span class="pre">&lt;iframe&gt;</span></code>) to isolate it
from the main application.</p>
</li>
<li><p><strong>Audit TemplateRenderingStep usage</strong></p>
<ul class="simple">
<li><p>Maintain a code-search pattern for <code class="docutils literal notranslate"><span class="pre">TemplateRenderingStep(...,</span> <span class="pre">template=)</span></code>.</p></li>
<li><p>Review every instance to ensure it is not piped straight to a renderer without escaping.</p></li>
</ul>
</li>
</ol>
</section>
<section id="extended-api-specific-guidance">
<h3>Extended API-specific guidance<a class="headerlink" href="#extended-api-specific-guidance" title="Permalink to this heading">#</a></h3>
<ul>
<li><p><strong>`OutputMessageStep`</strong></p>
<p>This class returns strings and performs <em>no</em> escaping. When its output is propagated to a web front-end (often via <code class="docutils literal notranslate"><span class="pre">DataFlowEdge</span> <span class="pre">→</span> <span class="pre">OutputMessageStep.OUTPUT</span></code>), apply HTML escaping there.</p>
</li>
<li><p><strong>`MessageList` / `GetChatHistoryStep`</strong></p>
<p>Chat histories can contain user HTML. If displaying transcripts, pipe the history through the same sanitiser used for new LLM outputs.</p>
</li>
<li><p><strong>`ServerTool` results</strong></p>
<p><a class="reference internal" href="api/tools.html#servertool"><span class="std std-ref">ServerTool</span></a> instances may return Markdown or HTML. Mark the result type explicitly (e.g., <code class="docutils literal notranslate"><span class="pre">text/plain</span></code> vs <code class="docutils literal notranslate"><span class="pre">text/markdown</span></code>) and render with a Markdown library that sanitises HTML by default (e.g., <code class="docutils literal notranslate"><span class="pre">markdown-it-py</span></code> with <code class="docutils literal notranslate"><span class="pre">linkify=False</span></code>).</p>
</li>
</ul>
</section>
</section>
<section id="considerations-regarding-assistant-flow-serialization">
<h2>Considerations regarding assistant/flow serialization<a class="headerlink" href="#considerations-regarding-assistant-flow-serialization" title="Permalink to this heading">#</a></h2>
<p>WayFlow components inheriting from <a class="reference internal" href="api/serialization.html#serializableobject"><span class="std std-ref">SerializableObject</span></a> can be converted to/from a dictionary representation (typically YAML) using <a class="reference internal" href="api/serialization.html#serialize"><span class="std std-ref">serialize</span></a>.</p>
<p>Serialized JSON of assistants/flows are computational programs. <strong>Executing deserialized objects is like executing code.</strong> Ensuring integrity/authenticity before deserialization is key to prevent Arbitrary Code Execution (ACE).</p>
<section id="secure-deserialization-practices">
<h3>Secure Deserialization Practices<a class="headerlink" href="#secure-deserialization-practices" title="Permalink to this heading">#</a></h3>
<p>Deserializing data from untrusted sources is inherently risky. Always treat serialized WayFlow objects from external or unverified origins as potentially malicious.</p>
<ol class="arabic simple">
<li><p><strong>Verify Data Integrity and Authenticity</strong>:
Before attempting to deserialize, ensure the JSON/YAML data comes from a trusted source and has not been tampered with. Implement mechanisms such as digital signatures to verify the origin and integrity of the serialized data.</p></li>
<li><p><strong>Choose JSON over YAML</strong>:
When serializing data, JSON if preferred over YAML as YAML presents the risk unsafe deserialization allowing remote code execution.</p></li>
<li><p><strong>Use Safe Loading if using YAML</strong>:
The YAML data itself should be parsed safely before passing it to WayFlow’s deserialization functions. Always use <code class="docutils literal notranslate"><span class="pre">yaml.safe_load()</span></code> from the PyYAML library instead of <code class="docutils literal notranslate"><span class="pre">yaml.load()</span></code> to prevent the execution of arbitrary Python code embedded within the YAML structure itself.</p></li>
<li><p><strong>Controlled Deserialization Context</strong>:
While <a class="reference internal" href="api/serialization.html#autodeserialize"><span class="std std-ref">autodeserialize</span></a> accepts a <code class="docutils literal notranslate"><span class="pre">deserialization_context</span></code>, ensure a reused context doesn’t carry over state from a prior untrusted deserialization that could be exploited.</p></li>
</ol>
<p><strong>Example of a safer deserialization pipeline:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">yaml</span><span class="w"> </span><span class="kn">import</span> <span class="n">safe_load</span> <span class="c1"># Crucially, use safe_load, not load</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">wayflowcore.serialization.serializer</span><span class="w"> </span><span class="kn">import</span> <span class="n">autodeserialize</span>
<span class="c1"># Assume verify_signature_and_integrity is a custom function you&#39;ve implemented</span>
<span class="c1"># to check the signature against the raw_yaml_string and a trusted key.</span>
<span class="c1"># This step is conceptual and depends on your specific trust model.</span>

<span class="n">raw_yaml_string</span><span class="p">,</span> <span class="n">signature</span> <span class="o">=</span> <span class="n">get_potentially_untrusted_yaml_and_signature</span><span class="p">()</span>
<span class="n">is_trusted_source</span> <span class="o">=</span> <span class="n">verify_signature_and_integrity</span><span class="p">(</span><span class="n">raw_yaml_string</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span>

<span class="k">if</span> <span class="n">is_trusted_source</span><span class="p">:</span>
    <span class="c1"># First, safely parse the YAML string to a Python object structure</span>
    <span class="n">parsed_yaml_object</span> <span class="o">=</span> <span class="n">safe_load</span><span class="p">(</span><span class="n">raw_yaml_string</span><span class="p">)</span>
    <span class="c1"># Then, deserialize the WayFlow object using autodeserialize</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parsed_yaml_object</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">assistant_or_flow</span> <span class="o">=</span> <span class="n">autodeserialize</span><span class="p">(</span><span class="n">parsed_yaml_object</span><span class="p">)</span>
</pre></div>
</div>
<p>Remember that <a class="reference internal" href="api/serialization.html#autodeserialize"><span class="std std-ref">autodeserialize</span></a> expects parsed YAML (a Python dictionary), not the raw YAML string, if using <code class="docutils literal notranslate"><span class="pre">safe_load</span></code>. Passing a string directly to <code class="docutils literal notranslate"><span class="pre">autodeserialize</span></code> makes it use <code class="docutils literal notranslate"><span class="pre">yaml.safe_load</span></code> internally. Explicit <code class="docutils literal notranslate"><span class="pre">safe_load</span></code> first allows pre-validation of the YAML structure.</p>
</section>
</section>
<section id="other-security-concerns">
<h2>Other Security Concerns<a class="headerlink" href="#other-security-concerns" title="Permalink to this heading">#</a></h2>
<p>For any other security concerns, please submit a <a class="reference external" href="https://github.com/oracle/wayflow/issues">GitHub issue</a>.</p>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#considerations-regarding-tools">Considerations regarding tools</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tool-security-specifics">Tool Security Specifics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#harden-all-tools-servertool-clienttool-and-remotetool">Harden All Tools (ServerTool, ClientTool and RemoteTool)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#considerations-regarding-network-communication">Considerations regarding network communication</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supply-chain-security-for-wayflow-assets">Supply-Chain Security for WayFlow Assets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#network-segmentation-for-wayflow">Network Segmentation for WayFlow</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#egress-controls-for-wayflow-components">Egress Controls for WayFlow Components</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#network-connection-requirements">Network Connection Requirements</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#considerations-regarding-api-keys-and-secrets-management">Considerations regarding API keys and secrets management</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#control-secret-sprawl">Control Secret Sprawl</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#llm-provider-authentication-security">LLM Provider Authentication Security</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#credential-rotation-and-monitoring">Credential Rotation and Monitoring</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#considerations-regarding-resource-exhaustion-vectors">Considerations regarding Resource-exhaustion vectors</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#built-in-execution-interrupts">Built-in execution interrupts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#usage-example">Usage example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gaps-in-coverage-what-is-not-provided">Gaps in coverage (what is <strong>not</strong> provided)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recommended-hardening-layers">Recommended hardening layers</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#considerations-regarding-input-validation-and-sanitation">Considerations regarding input validation and sanitation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#core-input-security-requirements">Core Input Security Requirements</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#considerations-regarding-logging">Considerations regarding logging</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#error-handling-exception-hygiene">Error handling &amp; exception hygiene</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#audit-observability">Audit &amp; observability</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#considerations-regarding-telemetry-observability">Considerations regarding Telemetry &amp; observability</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-s-in-a-span">1.  What’s in a Span?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#default-behaviour">2.  Default behaviour</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-a-spanexporter">3.  Implementing a SpanExporter</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spanprocessor-guidance">4.  SpanProcessor guidance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#considerations-regarding-ui-rendering">Considerations regarding UI rendering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recommended-mitigations">Recommended mitigations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extended-api-specific-guidance">Extended API-specific guidance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#considerations-regarding-assistant-flow-serialization">Considerations regarding assistant/flow serialization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#secure-deserialization-practices">Secure Deserialization Practices</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-security-concerns">Other Security Concerns</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Oracle and/or its affiliates..
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>