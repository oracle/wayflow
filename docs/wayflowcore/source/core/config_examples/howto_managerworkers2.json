{
    "component_type": "Flow",
    "id": "0823fc83-1baa-44bb-a192-531d34921e30",
    "name": "flow_52727579__auto",
    "description": "",
    "metadata": {
        "__metadata_info__": {}
    },
    "inputs": [
        {
            "type": "string",
            "title": "customer_id",
            "default": ""
        },
        {
            "type": "string",
            "title": "company_policy_info",
            "default": ""
        }
    ],
    "outputs": [
        {
            "description": "Number of days before getting back the refund.",
            "type": "string",
            "title": "refunds_days",
            "default": ""
        },
        {
            "description": "the message added to the messages list",
            "type": "string",
            "title": "output_message"
        }
    ],
    "start_node": {
        "$component_ref": "bba3ce84-0ab7-4a19-86dc-93eddaf18d9d"
    },
    "nodes": [
        {
            "$component_ref": "c48a82be-fb4c-4e7b-acfd-5b6dd5a80fcb"
        },
        {
            "$component_ref": "3d7ce624-3b69-4195-9e10-8c0082436d89"
        },
        {
            "$component_ref": "bba3ce84-0ab7-4a19-86dc-93eddaf18d9d"
        },
        {
            "$component_ref": "79c3ae52-6e18-4c95-9a21-cbe6f88a158f"
        }
    ],
    "control_flow_connections": [
        {
            "component_type": "ControlFlowEdge",
            "id": "38d403c7-cfd7-4610-92a5-807e6ed3df97",
            "name": "agent_step_to_output_step_control_flow_edge",
            "description": null,
            "metadata": {
                "__metadata_info__": {}
            },
            "from_node": {
                "$component_ref": "c48a82be-fb4c-4e7b-acfd-5b6dd5a80fcb"
            },
            "from_branch": null,
            "to_node": {
                "$component_ref": "3d7ce624-3b69-4195-9e10-8c0082436d89"
            }
        },
        {
            "component_type": "ControlFlowEdge",
            "id": "55450cd7-7564-4a00-8ad8-029934026f56",
            "name": "__StartStep___to_agent_step_control_flow_edge",
            "description": null,
            "metadata": {
                "__metadata_info__": {}
            },
            "from_node": {
                "$component_ref": "bba3ce84-0ab7-4a19-86dc-93eddaf18d9d"
            },
            "from_branch": null,
            "to_node": {
                "$component_ref": "c48a82be-fb4c-4e7b-acfd-5b6dd5a80fcb"
            }
        },
        {
            "component_type": "ControlFlowEdge",
            "id": "ce02118a-c0e8-48cd-8219-3363626a923a",
            "name": "output_step_to_None End node_control_flow_edge",
            "description": null,
            "metadata": {
                "__metadata_info__": {}
            },
            "from_node": {
                "$component_ref": "3d7ce624-3b69-4195-9e10-8c0082436d89"
            },
            "from_branch": null,
            "to_node": {
                "$component_ref": "79c3ae52-6e18-4c95-9a21-cbe6f88a158f"
            }
        }
    ],
    "data_flow_connections": [
        {
            "component_type": "DataFlowEdge",
            "id": "76476327-669a-4398-983b-83bddc8d46ed",
            "name": "agent_step_refunds_days_to_output_step_refunds_days_data_flow_edge",
            "description": null,
            "metadata": {
                "__metadata_info__": {}
            },
            "source_node": {
                "$component_ref": "c48a82be-fb4c-4e7b-acfd-5b6dd5a80fcb"
            },
            "source_output": "refunds_days",
            "destination_node": {
                "$component_ref": "3d7ce624-3b69-4195-9e10-8c0082436d89"
            },
            "destination_input": "refunds_days"
        },
        {
            "component_type": "DataFlowEdge",
            "id": "76d2b096-0fcd-4d45-a644-dc1dd57e8738",
            "name": "__StartStep___customer_id_to_agent_step_customer_id_data_flow_edge",
            "description": null,
            "metadata": {
                "__metadata_info__": {}
            },
            "source_node": {
                "$component_ref": "bba3ce84-0ab7-4a19-86dc-93eddaf18d9d"
            },
            "source_output": "customer_id",
            "destination_node": {
                "$component_ref": "c48a82be-fb4c-4e7b-acfd-5b6dd5a80fcb"
            },
            "destination_input": "customer_id"
        },
        {
            "component_type": "DataFlowEdge",
            "id": "e0cf2705-c6d2-40ed-b862-6c38021794b9",
            "name": "__StartStep___company_policy_info_to_agent_step_company_policy_info_data_flow_edge",
            "description": null,
            "metadata": {
                "__metadata_info__": {}
            },
            "source_node": {
                "$component_ref": "bba3ce84-0ab7-4a19-86dc-93eddaf18d9d"
            },
            "source_output": "company_policy_info",
            "destination_node": {
                "$component_ref": "c48a82be-fb4c-4e7b-acfd-5b6dd5a80fcb"
            },
            "destination_input": "company_policy_info"
        },
        {
            "component_type": "DataFlowEdge",
            "id": "15515102-d9fb-4265-972f-8c2eaa39a988",
            "name": "agent_step_refunds_days_to_None End node_refunds_days_data_flow_edge",
            "description": null,
            "metadata": {
                "__metadata_info__": {}
            },
            "source_node": {
                "$component_ref": "c48a82be-fb4c-4e7b-acfd-5b6dd5a80fcb"
            },
            "source_output": "refunds_days",
            "destination_node": {
                "$component_ref": "79c3ae52-6e18-4c95-9a21-cbe6f88a158f"
            },
            "destination_input": "refunds_days"
        },
        {
            "component_type": "DataFlowEdge",
            "id": "03bb2f10-2c37-4bfe-9646-cd6d4562c3bd",
            "name": "output_step_output_message_to_None End node_output_message_data_flow_edge",
            "description": null,
            "metadata": {
                "__metadata_info__": {}
            },
            "source_node": {
                "$component_ref": "3d7ce624-3b69-4195-9e10-8c0082436d89"
            },
            "source_output": "output_message",
            "destination_node": {
                "$component_ref": "79c3ae52-6e18-4c95-9a21-cbe6f88a158f"
            },
            "destination_input": "output_message"
        }
    ],
    "$referenced_components": {
        "c48a82be-fb4c-4e7b-acfd-5b6dd5a80fcb": {
            "component_type": "AgentNode",
            "id": "c48a82be-fb4c-4e7b-acfd-5b6dd5a80fcb",
            "name": "agent_step",
            "description": "",
            "metadata": {
                "__metadata_info__": {}
            },
            "inputs": [
                {
                    "type": "string",
                    "title": "customer_id",
                    "default": ""
                },
                {
                    "type": "string",
                    "title": "company_policy_info",
                    "default": ""
                }
            ],
            "outputs": [
                {
                    "description": "Number of days before getting back the refund.",
                    "type": "string",
                    "title": "refunds_days",
                    "default": ""
                }
            ],
            "branches": [
                "next"
            ],
            "agent": {
                "component_type": "ManagerWorkers",
                "id": "550d2a94-ad12-4e36-8138-3a1246a09b0a",
                "name": "managerworkers_153290a1__auto",
                "description": "",
                "metadata": {
                    "__metadata_info__": {}
                },
                "inputs": [
                    {
                        "type": "string",
                        "title": "customer_id",
                        "default": ""
                    },
                    {
                        "type": "string",
                        "title": "company_policy_info",
                        "default": ""
                    }
                ],
                "outputs": [
                    {
                        "description": "Number of days before getting back the refund.",
                        "type": "string",
                        "title": "refunds_days",
                        "default": ""
                    }
                ],
                "group_manager": {
                    "component_type": "ExtendedAgent",
                    "id": "CustomerServiceManager",
                    "name": "CustomerServiceManager",
                    "description": "Acts as the primary contact point for customer inquiries, analyzes the request, routes tasks to specialized agents (Refund Specialist, Satisfaction Surveyor), and ensures resolution.",
                    "metadata": {
                        "__metadata_info__": {}
                    },
                    "inputs": [
                        {
                            "description": "\"customer_id\" input variable for the template",
                            "type": "string",
                            "title": "customer_id"
                        },
                        {
                            "description": "\"company_policy_info\" input variable for the template",
                            "type": "string",
                            "title": "company_policy_info"
                        }
                    ],
                    "outputs": [],
                    "llm_config": {
                        "$component_ref": "bd13304e-265e-4f7f-aa48-d8242ba347c6"
                    },
                    "system_prompt": "You are a Customer Service Manager agent tasked with handling incoming customer interactions and orchestrating the resolution process efficiently.\n\n# Instructions\n- Greet the customer politely and acknowledge their message.\n- Analyze the customer's message to understand their core need (e.g., refund request, general query, feedback).\n- Answer common informational questions (e.g., about shipping times, return policy basics) directly if you have the knowledge, before delegating.\n- If the request is clearly about a refund, gather necessary details (like Order ID) if missing, and then assign the task to the 'RefundSpecialist' agent. Provide all relevant context.\n- If the interaction seems successfully concluded (e.g., refund processed, query answered) and requesting feedback is appropriate, assign the task to the 'SatisfactionSurveyor' agent. Provide customer context.\n- For general queries you cannot handle directly and that don't fit the specialist agents, state your limitations clearly and politely.\n- Await responses or status updates from specialist agents you have assigned to.\n- Summarize the final outcome or confirmation for the customer based on specialist agent reports.\n- Maintain a helpful, empathetic, and professional tone throughout the interaction.\n\n# Additional Context\nCustomer ID: {{customer_id}}\nCompany policies: {{company_policy_info}}",
                    "tools": [],
                    "toolboxes": [],
                    "human_in_the_loop": true,
                    "transforms": [],
                    "context_providers": null,
                    "can_finish_conversation": false,
                    "raise_exceptions": false,
                    "max_iterations": 10,
                    "initial_message": "Hi! How can I help you?",
                    "caller_input_mode": "always",
                    "agents": [],
                    "flows": [],
                    "agent_template": null,
                    "component_plugin_name": "AgentPlugin",
                    "component_plugin_version": "26.2.0.dev0"
                },
                "workers": [
                    {
                        "component_type": "ExtendedAgent",
                        "id": "RefundSpecialist",
                        "name": "RefundSpecialist",
                        "description": "Specializes in processing customer refund requests by verifying eligibility and executing the refund transaction using available tools.",
                        "metadata": {
                            "__metadata_info__": {}
                        },
                        "inputs": [],
                        "outputs": [],
                        "llm_config": {
                            "$component_ref": "bd13304e-265e-4f7f-aa48-d8242ba347c6"
                        },
                        "system_prompt": "You are a Refund Specialist agent whose objective is to process customer refund requests accurately and efficiently based on company policy.\n\n# Instructions\n- Receive the refund request details (e.g., order ID, customer ID, reason) from the 'CustomerServiceManager'.\n- Use the `check_refund_eligibility` tool to verify if the request meets the refund policy criteria using the provided order and customer IDs.\n- If the check indicates eligibility, determine the correct refund amount (up to the maximum allowed from the eligibility check).\n- If eligible, use the `process_refund` tool to execute the refund for the determined amount, providing order ID and reason.\n- If ineligible based on the check, clearly note the reason provided by the tool.\n- Report the final outcome (e.g., \"Refund processed successfully, Refund ID: [ID], Amount: [Amount]\", or \"Refund denied: [Reason from eligibility check]\") back to the 'CustomerServiceManager'.\n- Do not engage in general conversation; focus solely on the refund process.",
                        "tools": [
                            {
                                "component_type": "ServerTool",
                                "id": "cff39d54-c852-4114-871d-873e8f52c121",
                                "name": "check_refund_eligibility",
                                "description": "Checks if a given order is eligible for a refund based on company policy.\n\nReturns:\n    A dictionary containing eligibility status and details.\n    Example: {\"eligible\": True, \"max_refundable_amount\": 50.00, \"reason\": \"Within return window\"}\n             {\"eligible\": False, \"reason\": \"Order past 30-day return window\"}",
                                "metadata": {
                                    "__metadata_info__": {}
                                },
                                "inputs": [
                                    {
                                        "description": "The unique identifier for the order.",
                                        "type": "string",
                                        "title": "order_id"
                                    },
                                    {
                                        "description": "The unique identifier for the customer.",
                                        "type": "string",
                                        "title": "customer_id"
                                    }
                                ],
                                "outputs": [
                                    {
                                        "type": "object",
                                        "additionalProperties": {
                                            "anyOf": [
                                                {
                                                    "type": "string"
                                                },
                                                {
                                                    "type": "number"
                                                },
                                                {
                                                    "type": "boolean"
                                                }
                                            ]
                                        },
                                        "title": "tool_output"
                                    }
                                ],
                                "requires_confirmation": false
                            },
                            {
                                "component_type": "ServerTool",
                                "id": "1c876021-49eb-408b-90f6-d5dc3e13346b",
                                "name": "process_refund",
                                "description": "Processes a refund for a specific order and amount.\n\nReturns:\n    A dictionary confirming the refund status.\n    Example: {\"success\": True, \"refund_id\": \"REF_789XYZ\", \"message\": \"Refund processed successfully.\"}\n             {\"success\": False, \"message\": \"Refund processing failed due to payment gateway error.\"}",
                                "metadata": {
                                    "__metadata_info__": {}
                                },
                                "inputs": [
                                    {
                                        "description": "The unique identifier for the order to be refunded.",
                                        "type": "string",
                                        "title": "order_id"
                                    },
                                    {
                                        "description": "The amount to be refunded.",
                                        "type": "number",
                                        "title": "amount"
                                    },
                                    {
                                        "description": "The reason for the refund.",
                                        "type": "string",
                                        "title": "reason"
                                    }
                                ],
                                "outputs": [
                                    {
                                        "type": "object",
                                        "additionalProperties": {
                                            "anyOf": [
                                                {
                                                    "type": "boolean"
                                                },
                                                {
                                                    "type": "string"
                                                }
                                            ]
                                        },
                                        "title": "tool_output"
                                    }
                                ],
                                "requires_confirmation": false
                            }
                        ],
                        "toolboxes": [],
                        "human_in_the_loop": true,
                        "transforms": [],
                        "context_providers": null,
                        "can_finish_conversation": false,
                        "raise_exceptions": false,
                        "max_iterations": 10,
                        "initial_message": "Hi! How can I help you?",
                        "caller_input_mode": "always",
                        "agents": [],
                        "flows": [],
                        "agent_template": null,
                        "component_plugin_name": "AgentPlugin",
                        "component_plugin_version": "26.2.0.dev0"
                    },
                    {
                        "component_type": "ExtendedAgent",
                        "id": "SatisfactionSurveyor",
                        "name": "SatisfactionSurveyor",
                        "description": "Conducts brief surveys to gather feedback on customer satisfaction following service interactions.",
                        "metadata": {
                            "__metadata_info__": {}
                        },
                        "inputs": [],
                        "outputs": [],
                        "llm_config": {
                            "$component_ref": "bd13304e-265e-4f7f-aa48-d8242ba347c6"
                        },
                        "system_prompt": "You are a Satisfaction Surveyor agent tasked with collecting customer feedback about their recent service experience in a friendly manner.\n\n# Instructions\n- Receive the trigger to conduct a survey from the 'CustomerServiceManager', including context like the customer ID and the nature of the interaction if provided.\n- Politely ask the customer if they have a moment to provide feedback on their recent interaction.\n- If the customer agrees, ask 1-2 concise questions about their satisfaction (e.g., \"On a scale of 1 to 5, where 5 is highly satisfied, how satisfied were you with the resolution provided today?\", \"Is there anything else you'd like to share about your experience?\").\n- Use the `record_survey_response` tool to log the customer's feedback, including the satisfaction score and any comments provided. Ensure you pass the correct customer ID.\n- If the customer declines to participate, thank them for their time anyway. Do not pressure them. Use the `record_survey_response` tool to log the declination if possible (e.g., score=None, comments=\"Declined survey\").\n- Thank the customer for their participation if they provided feedback.\n- Report back to the 'CustomerServiceManager' confirming that the survey was attempted and whether it was completed or declined.",
                        "tools": [
                            {
                                "component_type": "ServerTool",
                                "id": "7c1caf2c-6809-4509-a7a3-5d79887dd231",
                                "name": "record_survey_response",
                                "description": "Records the customer's satisfaction survey response.\n\nReturns:\n    A dictionary confirming the recording status.\n    Example: {\"success\": True, \"message\": \"Survey response recorded.\"}\n             {\"success\": False, \"message\": \"Failed to record survey response.\"}",
                                "metadata": {
                                    "__metadata_info__": {}
                                },
                                "inputs": [
                                    {
                                        "description": "The unique identifier for the customer.",
                                        "type": "string",
                                        "title": "customer_id"
                                    },
                                    {
                                        "description": "The customer's satisfaction rating (e.g., 1-5), if provided.",
                                        "anyOf": [
                                            {
                                                "type": "integer"
                                            },
                                            {
                                                "type": "null"
                                            }
                                        ],
                                        "title": "satisfaction_score",
                                        "default": null
                                    },
                                    {
                                        "description": "Any additional comments provided by the customer, if provided.",
                                        "anyOf": [
                                            {
                                                "type": "string"
                                            },
                                            {
                                                "type": "null"
                                            }
                                        ],
                                        "title": "comments",
                                        "default": null
                                    }
                                ],
                                "outputs": [
                                    {
                                        "type": "object",
                                        "additionalProperties": {
                                            "anyOf": [
                                                {
                                                    "type": "boolean"
                                                },
                                                {
                                                    "type": "string"
                                                }
                                            ]
                                        },
                                        "title": "tool_output"
                                    }
                                ],
                                "requires_confirmation": false
                            }
                        ],
                        "toolboxes": [],
                        "human_in_the_loop": true,
                        "transforms": [],
                        "context_providers": null,
                        "can_finish_conversation": false,
                        "raise_exceptions": false,
                        "max_iterations": 10,
                        "initial_message": "Hi! How can I help you?",
                        "caller_input_mode": "always",
                        "agents": [],
                        "flows": [],
                        "agent_template": null,
                        "component_plugin_name": "AgentPlugin",
                        "component_plugin_version": "26.2.0.dev0"
                    }
                ],
                "$referenced_components": {
                    "bd13304e-265e-4f7f-aa48-d8242ba347c6": {
                        "component_type": "VllmConfig",
                        "id": "bd13304e-265e-4f7f-aa48-d8242ba347c6",
                        "name": "llm_0fbe0307__auto",
                        "description": null,
                        "metadata": {
                            "__metadata_info__": {}
                        },
                        "default_generation_parameters": null,
                        "url": "VLLM_HOST_PORT",
                        "model_id": "model-id",
                        "api_type": "chat_completions",
                        "api_key": null
                    }
                }
            }
        },
        "3d7ce624-3b69-4195-9e10-8c0082436d89": {
            "component_type": "PluginOutputMessageNode",
            "id": "3d7ce624-3b69-4195-9e10-8c0082436d89",
            "name": "output_step",
            "description": "",
            "metadata": {
                "__metadata_info__": {}
            },
            "inputs": [
                {
                    "description": "\"refunds_days\" input variable for the template",
                    "type": "string",
                    "title": "refunds_days"
                }
            ],
            "outputs": [
                {
                    "description": "the message added to the messages list",
                    "type": "string",
                    "title": "output_message"
                }
            ],
            "branches": [
                "next"
            ],
            "message": "{{refunds_days}}",
            "input_mapping": {},
            "output_mapping": {},
            "message_type": "AGENT",
            "rephrase": false,
            "llm_config": null,
            "expose_message_as_output": true,
            "component_plugin_name": "NodesPlugin",
            "component_plugin_version": "26.2.0.dev0"
        },
        "bba3ce84-0ab7-4a19-86dc-93eddaf18d9d": {
            "component_type": "StartNode",
            "id": "bba3ce84-0ab7-4a19-86dc-93eddaf18d9d",
            "name": "__StartStep__",
            "description": "",
            "metadata": {
                "__metadata_info__": {}
            },
            "inputs": [
                {
                    "type": "string",
                    "title": "customer_id",
                    "default": ""
                },
                {
                    "type": "string",
                    "title": "company_policy_info",
                    "default": ""
                }
            ],
            "outputs": [
                {
                    "type": "string",
                    "title": "customer_id",
                    "default": ""
                },
                {
                    "type": "string",
                    "title": "company_policy_info",
                    "default": ""
                }
            ],
            "branches": [
                "next"
            ]
        },
        "79c3ae52-6e18-4c95-9a21-cbe6f88a158f": {
            "component_type": "EndNode",
            "id": "79c3ae52-6e18-4c95-9a21-cbe6f88a158f",
            "name": "None End node",
            "description": null,
            "metadata": {
                "__metadata_info__": {}
            },
            "inputs": [
                {
                    "description": "Number of days before getting back the refund.",
                    "type": "string",
                    "title": "refunds_days",
                    "default": ""
                },
                {
                    "description": "the message added to the messages list",
                    "type": "string",
                    "title": "output_message"
                }
            ],
            "outputs": [
                {
                    "description": "Number of days before getting back the refund.",
                    "type": "string",
                    "title": "refunds_days",
                    "default": ""
                },
                {
                    "description": "the message added to the messages list",
                    "type": "string",
                    "title": "output_message"
                }
            ],
            "branches": [],
            "branch_name": "next"
        }
    },
    "agentspec_version": "26.2.0"
}
